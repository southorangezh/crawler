{
  "metadata": {
    "source_file": "map-app\\static\\js\\index.5da8ba4c.js",
    "chunk_index": 6,
    "total_chunks": 918,
    "chunk_size": 59795,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:50.142Z"
  },
  "content": "id(){return this.properties.id}get boundingSphere(){let e=this.getPositionCartesian3();if(e)return new uf.BoundingSphere(e,25)}update(e){let a=!1;e.position&&(this.properties.position=e.position,this.clampedPositionCartesian3=null,this.entities.positionSetter(new uf.ConstantPositionProperty(this.getPositionCartesian3())),a=!0),e.pixelSize&&(this.properties.pixelSize=e.pixelSize,this.entities.point?.pixelSizeSetter(new uf.ConstantProperty(e.pixelSize))),(0,pg.ri)(e.show)&&this.entities.showSetter(e.show),e.draggable&&(this.properties.draggable=e.draggable),(0,pg.ri)(e.actived)&&(this.properties.actived=e.actived);let r=e.occludedAlpha;(0,pg.ri)(r)&&(this.properties.occludedAlpha=0===r?void 0:r);let t=e.disableDepthTestDistance;(0,pg.ri)(t)&&(this.properties.disableDepthTestDistance=t),(0,pg.ri)(e.enableOccludeIn2dView)&&(this.properties.enableOccludeIn2dView=e.enableOccludeIn2dView),this.recomputeDepthStyle(),(0,pg.ri)(e.clampToGround)&&this.properties.clampToGround!==e.clampToGround&&(this.properties.clampToGround=e.clampToGround,a=!0),a&&this.toggleClamp()}getEntityOptions(){return{id:this.properties.id,show:this.properties.show,position:this.getPositionCartesian3(),point:{disableDepthTestDistance:this.properties.disableDepthTestDistance,color:this.getColor(),pixelSize:this.properties.pixelSize,outlineWidth:this.properties.outlineWidth,outlineColor:this.properties.outlineColor?uf.Color.fromCssColorString(this.properties.outlineColor):void 0,translucencyByDistance:this.properties.translucencyByDistance?new uf.NearFarScalar(...this.properties.translucencyByDistance):void 0,depthFailTranslucency:this.properties.occludedAlpha}}}init(){super.init(),this.toggleClamp()}clampedPositionCartesian3;onPositionClamp(e){e&&(this.clampedPositionCartesian3=e,this.entities.positionSetter(new uf.ConstantPositionProperty(this.getPositionCartesian3())),this.managers.render?.())}getPositionCartesian3(){if(this.properties.position)return this.clampedPositionCartesian3||(0,pg.jL)(this.properties.position)}getColor(){if(this.properties.cssColor)return uf.Color.fromCssColorString(this.properties.cssColor)}setCollectionMap(){this.managers._options.elements.add(\"point\",this,[this.id])}startDrag(e,a){let r=super.startDrag(e,a),t=this.getPositionCartesian3();return r&&t?{position:t}:r}dynamicDrag(e){this.entities.positionSetter(new uf.CallbackProperty(e,!1))}endDrag(){super.endDrag();let e=this.entities._values()[0];this.entities.positionSetter(new uf.ConstantPositionProperty(e?.position?.getValue(new uf.JulianDate)))}cacheViewModes;onSceneChange(e){let{is3D:a,id:r}=e;if(a&&\"3D\"===this.cacheViewModes[r]||!a&&\"2D\"===this.cacheViewModes[r])return;if(this.cacheViewModes[r]=a?\"3D\":\"2D\",!this.properties.actived)this.recomputeDepthStyle()}recomputeDepthStyle(e){let a=!!this.properties.actived,r=!!this.properties.enableOccludeIn2dView;(!Array.isArray(e)||0===e.length)&&(e=Object.keys(this.cacheViewModes)),e.forEach(e=>{let t=this.cacheViewModes[e];if(void 0===t)return;let{occludedAlpha:n,disableDepthTestDistance:i}=mb(t,a,r,this.properties.occludedAlpha,this.properties.disableDepthTestDistance),o=this.entities._get(e)?.point;if(!!o)o.depthFailTranslucency=new uf.ConstantProperty(n),o.disableDepthTestDistance=new uf.ConstantProperty(i)})}onManagerAdd(e){let a=this.managers._get(e);a&&this.entities._add(e,a.viewer.entities.add(this.getEntityOptions()))}onManagerRemove(e){let a=this.entities._get(e);a?.entityCollection.remove(a),this.entities._remove(e)}onManagerUpdate(e){let a=this.entities._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.removeClampWatcher(),this.entities._keys().forEach(e=>{let a=this.entities._get(e);a&&a.entityCollection.remove(a),this.entities._remove(e)})}}r(\"26978\");var hB=r(\"82780\");function hV(e){return e.id=(0,uW.k)(),e}class hU extends u_.EventEmitter{manager;editingMode;editingModeReactive;editing;activeShapePoints;activeCirclePosParams;cssColor;activeElement;disable;config;constructor(e){super(),this.manager=e,this.editingMode=\"line\",this.editingModeReactive=(0,uh.iH)(\"\"),this.editing=!1,this.activeShapePoints=(0,uh.iH)([]),this.activeCirclePosParams=(0,uh.qj)({centerPos:void 0,radius:0,centerPosCartesian3:void 0,circleEdgePoint:void 0,maxRadius:pP.MaxRadius}),this.cssColor=\"\",this.activeElement=null,this.disable=!1,this.config={},this.pickingPlane=null,this.dragging=(0,uh.iH)(!1),this.draggingIndex=-1,this.draggingArrayIndex=0,this._withShift=!1,this.pinStatus={horizontalMoving:!1,verticalMoving:!1,plane:null,ellipsoid:null}}pickingPlane;getEditing(){return this.editing}get activeTypedElement(){let{activeElement:e}=this;return e instanceof g_||!e?null:e.typedElement}dragging;setDragging(e){this.dragging.value=e,e?this.manager.hover.setCursor(\"grabbing\",\"temporary\"):this.manager.hover.setCursor(\"\",\"temporary\"),(this.activeElement instanceof hY||this.activeElement instanceof gs||this.activeElement instanceof hp)&&this.activeElement.setDragging(e)}setCircleEdit(e){this.dragging.value=e,e?this.manager.hover.setCursor(\"grabbing\",\"temporary\"):this.manager.hover.setCursor(\"\",\"temporary\")}draggingIndex;draggingArrayIndex;async mountPolygon(){let e=this.activeElement;if(e instanceof hW&&(e.active(\"selected\",!0),!this.disable)){this.activeShapePoints.value=[e.positions?.map(e=>hV(pg.jL(e)))||[]];let a=await this.getTerrainHeights(this.manager.viewer.scene.globe.terrainProvider,e.positions);if(this.cssColor=e.cssColor,!this.editing)return;this.activeShapePoints.value=[a],e.dynamize({positionsCallback:()=>this.activeShapePoints.value?.[0]?.map(e=>uf.Cartesian3.clone(e))||[]})}}async mountPrism(){let e=this.activeElement;e instanceof gs&&(e.active(\"selected\",!0),this.activeShapePoints.value=e.getEditActivePoints(),this.cssColor=e.cssColor)}async mountCylinder(){let e=this.activeElement;if(e instanceof hp){e.active(\"selected\",!0);let a=e.getEditActivePoints();a&&(this.activeShapePoints.value=a.map(e=>e.map(e=>(0,pg.jL)(e)))),this.cssColor=e.cssColor??\"#fff\"}}_withShift;get withShift(){return this._withShift}set withShift(e){this._withShift=e,this.activeElement&&\"polygon3d\"===this.editingMode&&this.editing&&this.activeElement instanceof hY&&(this.activeElement.shiftHotkeyEnable=e)}async mountPolygon3D(){let e=this.activeElement;e instanceof hY&&(e.active(\"selected\",!0),!this.disable&&e.positions?.length&&(this.activeShapePoints.value=[e.positions.map(e=>hV((0,pg.jL)(e)))||[]],this.cssColor=e.cssColor))}updatePositionsFor(e,a=!1,r){if(e===this.activeElement){if(e instanceof gs)this.activeShapePoints.value=e.getEditActivePoints();else if(e instanceof hp){let a=e.getEditActivePoints();a?this.activeShapePoints.value=a.map(e=>e.map(e=>(0,pg.jL)(e))):(this.activeShapePoints.value=[],this.editingModeReactive.value=\"\")}else e instanceof mX?(e.centerPos&&(this.activeCirclePosParams.centerPos=e.centerPos,this.activeCirclePosParams.centerPosCartesian3=hV((0,pg.jL)(e.centerPos))),e.radius&&(this.activeCirclePosParams.radius=e.radius),e.circleEdgePoint&&(this.activeCirclePosParams.circleEdgePoint=e.circleEdgePoint),this.cssColor=e.cssColor):e instanceof hY?e.category!==se.annotations&&(this.activeShapePoints.value=[e.positions?.map(e=>hV(pg.jL(e)))||[]]):(e.clampToGround?this.activeShapePoints.value=[e.positions?.map(e=>hV(pg.jL(e)))||[]]:this.activeShapePoints.value=[e.drawingPositions.map(e=>hV((0,pg.jL)(e,!1)))||[]],e instanceof hW&&(e.drawingPositions=this.getCurrentShape()));a&&this.emitShapeEdit(r)}}async mountCircle(){let e=this.activeElement;if(e instanceof mX&&(e.active(\"selected\",!0),!this.disable&&e.centerPos&&e.radius)){if(this.activeCirclePosParams.centerPos=e.centerPos,this.activeCirclePosParams.centerPosCartesian3=hV((0,pg.jL)(e.centerPos)),this.activeCirclePosParams.radius=e.radius,this.activeCirclePosParams.maxRadius=e.maxRadius,this.cssColor=e.cssColor,this.activeCirclePosParams.circleEdgePoint=e.circleEdgePoint,!this.editing)return;e.dynamize({positionsCallback:()=>this.activeCirclePosParams})}}async getTerrainHeights(e,a){let r=a?.map(e=>uf.Cartographic.fromDegrees(e.longitude,e.latitude))||[];try{r=await p9(this.manager,r)}catch{}return r.map(e=>hV((0,pg.jL)((0,pg.vi)(e))))}async mountPolyline(){let e=this.activeElement;if(!(e instanceof h8))return;if(e.active(\"selected\",!0),!this.disable)if(!e.clampToGround)this.activeShapePoints.value=[e.positions.map(e=>hV((0,pg.jL)(e,!1)))],e.dynamize({});else{let a=await this.getTerrainHeights(this.manager.viewer.scene.globe.terrainProvider,e.positions);if(!this.editing)return;this.activeShapePoints.value=[a],e.dynamize({positionsCallback:()=>this.activeShapePoints.value?.[0]||[]})}}async mountPolyline3D(){let e=this.activeElement;if(!(e instanceof gr))return;if(e.active(\"selected\",!0),!this.disable)this.activeShapePoints.value=[e.positions.map(e=>hV((0,pg.jL)(e)))]}startDrag(e,a=0){this.finishDrag(),this.setDragging(!0),this.draggingIndex=e,this.draggingArrayIndex=a,window.addEventListener(\"mouseup\",()=>{this.finishDrag(!0)},{once:!0})}startEditCircle(){this.finishDragCircle(),window.addEventListener(\"mouseup\",()=>{this.finishDragCircle(!0)},{once:!0})}cleanPickingPlane(){this.pickingPlane&&(this.pickingPlane=null)}pickPosition(e,a=0){let r=this.activeElement,t=r instanceof hY,n=r instanceof gs,i=r instanceof hp;if(t){let e=r.positionsWC||[];!this.pickingPlane&&(this.pickingPlane=ma(e))}else(n||i)&&!this.pickingPlane&&(this.pickingPlane=r.getPickingPlane(0===a?\"bottom\":\"top\"));if(t||n||i){if(!this.pickingPlane)return;return mt(e,this.pickingPlane,this.manager)}return this.manager.picker.pickPosition(e)}updateShapePoints(e){let a=this.activeElement,r=e.map(e=>(0,pg.KO)(e,a instanceof hY||a instanceof h8&&!a.clampToGround));if(a instanceof gs)a.update({positions:r}),this.activeShapePoints.value=a.getEditActivePoints();else if(a instanceof hp){let r=e[0],t=e[1],n=uf.Cartesian3.distance(r,t),i=(0,pg.KO)(r.clone()),o={};1===this.draggingIndex?o.radius=n:o.center=i,a.update(o);let s=a.getEditActivePoints();s&&(this.activeShapePoints.value=s.map(e=>e.map(e=>(0,pg.jL)(e))))}else this.activeShapePoints.value=[e],a instanceof h8&&!a.clampToGround&&(a.drawingPositions=r),a instanceof hW&&(a.drawingPositions=r),a instanceof hY&&a.update({positions:r})}emitMouseMovePolygonPolyline(e){let a=this.activeShapePoints.value[0],r=(0,pg.KO)(e),t=(0,pg.KO)(a[a.length-1]);\"line\"===this.editingMode&&this.manager.emit(\"onEditingMouseMove\",{element:this.activeElement,elementType:\"line\",pointIndex:a.length+1,curPoint:r,prePoint:t}),\"polygon\"===this.editingMode&&this.manager.emit(\"onEditingMouseMove\",{element:this.activeElement,elementType:\"polygon\",pointIndex:a.length+1,curPoint:r,prePoint:t})}dragPoint(e,a,r=0){if(!this.editing)return;this.setDragging(!0);let t=this.pickPosition(a,r),n=this.activeShapePoints.value?.[r];if(!!t&&!!n?.[e])hV(t),t.dynamic=!0,this.emitMouseMovePolygonPolyline(t),this.updateShapePoints(n.map((a,r)=>r===e?t:a))}dragMouseMove(e){this.dragPoint(this.draggingIndex,e.endPosition,this.draggingArrayIndex)}finishDragCircle(e=!1){e&&this.emitShapeEdit()}finishDrag(e=!1){this.activeShapePoints.value=this.activeShapePoints.value.map(e=>e.map((e,a)=>{if(a===this.draggingIndex){let a=uf.Cartesian3.clone(e);return hV(a),a.dynamic=!1,a}return e})),this.draggingIndex=-1,this.draggingArrayIndex=0,this.setDragging(!1),this.cleanPickingPlane(),e&&this.emitShapeEdit()}addPoint(e,a,r=0){let t=this.activeShapePoints.value?.[r];t[e]&&(this.updateShapePoints(t.reduce((r,t,n)=>(r.push(t),n===e&&(hV(a),r.push(a)),r),[])),this.startDrag(e+1,r))}removePoint(e,a=0){let r=this.activeShapePoints.value?.[a];if(!r[e])return;let t=\"polygon\"===this.editingMode||\"polygon3d\"===this.editingMode||\"prism\"===this.editingMode?3:2;if(r.length<=t){hB.Z.warn(uP(\"web.p_map.line_area_least_point_tips\",{length:t}));return}this.updateShapePoints(r.filter((a,r)=>r!==e)),this.emitShapeEdit()}getCurrentShape(){return this.activeShapePoints.value?.[0]?.map(e=>pg.KO(e,!0))}emitShapeEdit(e=\"endpoint\"){if(!this.disable&&!!this.activeElement)\"circle\"===this.editingMode?this.manager.emit(\"finishEdit\",{type:this.editingMode,origin:this.activeElement,shape:this.activeCirclePosParams,changeType:e}):\"pin\"!==this.editingMode&&((this.activeElement instanceof hW||this.activeElement instanceof h8)&&(this.activeElement.positions=this.getCurrentShape()),this.manager.emit(\"finishEdit\",{type:this.editingMode,origin:this.activeElement,shape:this.getCurrentShape(),changeType:e}))}pinStatus;mountPin(){let e=this.activeElement,a=e.getAuxiliaryPositions();this.activeShapePoints.value=[a||[]],e.dynamize(a?.[0])}unmountPin(){this.activeElement&&this.activeElement.stabilize()}initPinStatus(){this.pinStatus={horizontalMoving:!1,verticalMoving:!1,plane:null,ellipsoid:null}}pinLeftDown(e){let a=this.manager.viewer,[r]=p5(a,e.position);if(r){let e=this.activeElement;if(this.manager.getElement(r)===e){this.pinStatus.verticalMoving=!0,e.clampToGround&&(e.clampToGround=!1),this.mountPin();let r=this.activeShapePoints.value?.[0]?.[1];return r&&(this.pinStatus.plane=me(r,a)),!0}}return!1}pinMouseMove(e){if(!this.pinStatus.verticalMoving)return!1;let a=this.activeShapePoints.value?.[0];if(!a)return!1;let r=a[1];if(r&&this.pinStatus.plane){let t=this.manager.viewer.scene.camera.getPickRay(e.endPosition);if(!t)return!1;let n=uf.IntersectionTests.rayPlane(t,this.pinStatus.plane);if(n){let{height:e}=uf.Cartographic.fromCartesian(n),{longitude:t,latitude:i}=uf.Cartographic.fromCartesian(r);this.activeShapePoints.value=[[a[0],uf.Cartesian3.fromRadians(t,i,e)]],this.activeElement instanceof hG&&this.activeElement.updateHeight(e)}}return!0}pinLeftUp(){let e=!1;this.pinStatus.horizontalMoving&&(this.pinStatus.horizontalMoving=!1,this.pinStatus.ellipsoid=null,e=!0),this.pinStatus.verticalMoving&&(this.pinStatus.verticalMoving=!1,e=!0),e&&this.activeElement&&(this.manager.screenSpaceCameraController.startMouse(),this.unmountPin(),this.manager.emit(\"finishEdit\",{type:this.editingMode,origin:this.activeElement,shape:[(0,pg.KO)(this.activeShapePoints.value?.[0]?.[1],!0)],changeType:\"endpoint\"}))}enterEdit(e,a,r){this.manager.setMode(\"edit\"),this.cleanEdit(),this.editing=!0,this.editingMode=e,this.editingModeReactive.value=e,this.activeElement=a,this.disable=!!r,a instanceof hG?(a.active(\"selected\",!0),this.initPinStatus(),!this.disable&&a.update({hoverCursor:mK})):a instanceof h8?this.mountPolyline():a instanceof gr?this.mountPolyline3D():a instanceof hW?this.mountPolygon():a instanceof hY?this.mountPolygon3D():a instanceof gs?this.mountPrism():a instanceof hp?this.mountCylinder():a instanceof g_?a.active(\"selected\",!0):this.mountCircle(),this.postMountElement(),hL(a)&&a instanceof hG&&a.updateLabeling(this.manager.id,{visible:!0})}postMountElement(){this.updateEditPointSelection()}updateEditPointSelection(){if(!this.activeTypedElement)return;let{endPoint:e}=this.config;e&&this.emit(\"editing-point-change\",{activePointArrayIndex:0,activePointIndex:0})}cleanEdit(){let e=this.activeElement;this.editingModeReactive.value=\"\",e&&(e.active(\"selected\",!1),e instanceof hG?(this.initPinStatus(),!this.disable&&e.update({hoverCursor:\"\"})):!this.disable&&(e instanceof mX?e.stabilize(this.activeCirclePosParams):!(e instanceof g_)&&e.stabilize(this.activeShapePoints.value?.[0]),(e instanceof hY||e instanceof gs||e instanceof hp||e instanceof gr)&&e.exitEdit()));let a=null!==e;this.activeElement=null,this.activeShapePoints.value=[],this.cleanPickingPlane(),a&&this.manager.viewer&&this.manager.placer.executePlacement(),this.activeCirclePosParams.radius=0,this.activeCirclePosParams.centerPos=void 0,this.activeCirclePosParams.centerPosCartesian3=void 0,this.activeCirclePosParams.circleEdgePoint=void 0}exitEdit(){this.editing&&(!this.manager.onEditingOrDrawing&&this.manager.setHotKeyTips(su.esc,\"\"),this.emitShapeEdit(),this.cleanEdit(),this.editing=!1,this.manager.emit(\"exitEdit\"),this.emit(\"exit-edit\"),this.manager.clearMode(\"edit\"))}updateConfig(e){Object.assign(this.config,e),this.updateEditPointSelection()}}function hK(){return{label:{distanceVisible:!0,alphaVisible:!0,labelingVisible:!0},polygon:{distanceVisible:!0,alphaVisible:!0},all:{visible:!0}}}class hW extends(0,uX.AF)(pv,ph,pz){managers;constructor(e,a,r){super(),this.managers=a,this.entities=py({}),this.polygon=py({}),this.label=py({}),this.interactLevel=sc.Area,this._drawingPositions=[],this.isIntersect=!1,this.isAreaExceed=!1,this.destroyed=!1,this.colorProperty=void 0,this.activeState={selected:!1,recenter:!1,hover:!1},this.dynamic=!1,this.runtimeStates={},this.materialColor=void 0,this.lastPolylineMaterialState={color:void 0,activeColor:void 0,fence:!1},this.lastPolylineWidth=-1,this.namePosition=null,this.nameClampWatcher=null,this.cacheNamePositionHeight=0,this.fillAreaCanPick=!0,this.cacheAlphaByDistance=-1,this.cacheViewModes={},this.cacheLabelingWindowPosition={},this.cacheScreenSpaceBoundingBox={},this.properties=Object.assign({id:(0,uW.k)(),type:\"polygon\",fontSize:16},e),this.options=Object.assign({},r),this.init(),this.setCollectionMap()}properties;options;entities;polygon;label;interactLevel;_drawingPositions;isIntersect;isAreaExceed;destroyed;get useBatch(){return!this.dynamic&&this.clampToGround}switchCesiumPolygon(){this.entities.polygon?.showSetter(new uf.ConstantProperty(!this.useBatch));let e=this.id;e&&this.polygon._keys().forEach(a=>{let r=this.managers._get(a),t=this.polygon._get(a);r&&t&&r.groundPolygonColorVisualizer.updateAttributes(e,{show:this.useBatch})})}updateCesiumPolygon(e){(0,pg.ri)(e.show)&&!this.useBatch&&this.entities.polygon?.showSetter(new uf.ConstantProperty(e.show)),(0,pg.ri)(e.color)&&this.entities.polygon?.materialSetter(new uf.ColorMaterialProperty(e.color)),(0,pg.ri)(e.polygonHierarchy)&&this.entities.polygon?.hierarchySetter(new uf.ConstantProperty(e.polygonHierarchy));let a=this.id;a&&this.polygon._keys().forEach(r=>{let t=this.managers._get(r),n=this.polygon._get(r);t&&n&&(t.groundPolygonColorVisualizer.updateAttributes(a,{show:this.useBatch?e.show:void 0,color:e.color}),(0,pg.ri)(e.polygonHierarchy)&&t.groundPolygonColorVisualizer.updateGeometry(a,function e(a){return new uf.PolygonHierarchy(a.positions.map(e=>uf.Cartesian3.clone(e)),a.holes.map(a=>e(a)))}(e.polygonHierarchy)))})}get id(){return this.properties.id}get type(){return\"polygon\"}get typedElement(){return{type:this.type,element:this}}get positions(){return this.properties.positions||[]}get fill(){return this.properties.fill??!0}set positions(e){if(!0===this.destroyed)return;let a=this.properties.positions;if(this.properties.positions=e,this.dynamic){if(this.forceUpdatePosition){if(!e||!a)return;if(this.properties.needCheckIntersect&&this.checkAndHandleIntersect(e))this.properties.positions=a;else if(this.properties.needCheckArea){let{exceed:r,changeMode:t}=this.checkAndHandleArea(e,a);r&&t===sb.grow&&(this.properties.positions=a)}this.managers.editor?.updatePositionsFor?.(this)}}else e&&this.properties.needCheckIntersect&&this.checkAndHandleIntersect(e),e&&this.properties.needCheckArea&&this.checkAndHandleArea(e,a||[]),this.updatePositions(),this.managers.render?.()}get drawingPositions(){return this._drawingPositions}set drawingPositions(e){let a=this._drawingPositions;this._drawingPositions=e,this.properties.needCheckIntersect&&this.checkAndHandleIntersect(e),this.properties.needCheckArea&&this.checkAndHandleArea(e,a)}setPositions(e,a=!1){if(a&&this.properties.needCheckArea&&this.checkAndHandleArea(e,this.positions),a&&this.properties.needCheckIntersect&&this.checkAndHandleIntersect(e),this.drawingPositions=e,this.active(\"selected\")&&this.dynamic){let a=this.managers._get(f3).editor;if(a.activeElement===this)a.activeShapePoints.value=[e.map(e=>hV((0,pg.jL)(e)))]}else this.positions=e}get fontSize(){return this.properties.fontSize||16}set fontSize(e){this.properties.fontSize=e,this.label.fontSetter(this.getFont())}getFont(){return`600 ${this.fontSize}px ${pC}`}checkAndHandleIntersect(e){let a=mP(e);return a!==this.isIntersect&&(this.isIntersect=a,this.managers._get(f3).emit(\"elementSelfIntersection\",this,a,this.origin)),a}checkAndHandleArea(e,a){let r=sb.none,t=!1;if(!this.properties.maxArea)return{exceed:t,changeMode:r};let n=this.managers._get(f3).measurer.getHorizontalArea(e.map(e=>(0,pg.i9)(e))),i=this.managers._get(f3).measurer.getHorizontalArea(a.map(e=>(0,pg.i9)(e)));return n!==i&&(this.isAreaExceed=t=n>this.properties.maxArea,r=n>i?sb.grow:sb.shrink,this.managers._get(f3).emit(\"elementAreaOversize\",this,{exceed:t,changeMode:r,origin:this.origin})),{exceed:t,changeMode:r}}get forceUpdatePosition(){return this.properties.forceUpdatePosition||!1}set forceUpdatePosition(e){e!==this.properties.forceUpdatePosition&&(this.properties.forceUpdatePosition=e)}get name(){return this.properties.name}set name(e){this.properties.name=e,this.label?.textSetter(e||\"\"),this.managers.render?.()}colorProperty;setColorProperty(e){this.colorProperty=e,this.active()&&this.label.fillColorSetter(this.colorProperty?.getValue(uf.JulianDate.now()))}get cssColor(){return this.properties.cssColor||\"#FFFFFF\"}set cssColor(e){if(this.properties.cssColor!==e){this.properties.cssColor=e;let a=uf.Color.fromCssColorString(e);this.setColorProperty(new uf.ConstantProperty(a)),this.updateMaterial()}}get boundingSphere(){let e=this.properties.positions?.map(e=>pg.jL(e));if(e)return uf.BoundingSphere.fromPoints(e)}get clampToGround(){return void 0===this.properties.clampToGround||this.properties.clampToGround}get measureType(){return void 0===this.properties.measureType?\"\":this.properties.measureType}activeState;active(e=\"\",a){if(!this.properties.fromDraw)return!1;if((0,pg.ri)(a)&&e&&this.activeState[e]!==a&&(this.activeState[e]=a,this.toggleActive()),e)return this.activeState[e];{let{selected:e,recenter:a,hover:r}=this.activeState;return e||a||r}}update(e){if((0,pg.ri)(e.name)&&(this.name=e.name),(0,pg.ri)(e.cssColor)&&(this.cssColor=e.cssColor),(0,pg.ri)(e.show)&&(this.properties.show=e.show,this.entities.showSetter(e.show)),(0,pg.ri)(e.disableInteractive)&&(this.properties.disableInteractive=e.disableInteractive),e.labelDistanceDisplayCondition&&(this.properties.labelDistanceDisplayCondition=e.labelDistanceDisplayCondition,this.label.distanceDisplayConditionSetter(new uf.DistanceDisplayCondition(...e.labelDistanceDisplayCondition))),e.labelScaleByDistance){this.properties.labelScaleByDistance=e.labelScaleByDistance;let a=new uf.NearFarScalar(...e.labelScaleByDistance);this.label.scaleByDistanceSetter(a),this.label.pixelOffsetScaleByDistanceSetter(a)}e.placeable&&(this.properties.placeable=e.placeable),(0,pg.ri)(e.clampToGround)&&this.properties.clampToGround!==e.clampToGround&&(this.properties.clampToGround=e.clampToGround,this.switchCesiumPolygon(),this.entities.polygon?.perPositionHeightSetter(new uf.ConstantProperty(!this.properties.clampToGround)),this.properties.withPolyOutline&&this.entities.polyline?.clampToGroundSetter(new uf.ConstantProperty(this.properties.clampToGround))),(0,pg.ri)(e.fontSize)&&(this.fontSize=e.fontSize),pg.Pg.call(this,this.properties,{cssColor:e.cssColor,areaAlpha:e.areaAlpha,zIndex:e.zIndex,removable:e.removable,fromDraw:e.fromDraw,contextmenu:e.contextmenu,show:e.show,fenceLineWidth:e.fenceLineWidth,outlineStyle:e.outlineStyle,alphaByDistance:e.alphaByDistance});let a=!1;this.properties.fill!==e.fill&&(a=!0,this.properties.fill=e.fill),this.updateMaterial(a),(0,pg.ri)(e.positions)&&(this.positions=e.positions),(0,pg.ri)(e.holes)&&(this.properties.holes=e.holes),this.updateWidth(),this.updatePositions()}edit(e){this.managers._get(f3)?.editor.enterEdit(\"polygon\",this,e)}getEntityOptions(){let e;let a=-1!==this.cacheAlphaByDistance?this.cacheAlphaByDistance:void 0;this.materialColor=this.getCesiumColorAlpha(a);let r={id:this.id,show:this.properties.show},t=this.properties.positions?.map(e=>uf.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height)),n=this.properties.holes?.map(e=>uf.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height));if(n){let a=new uf.PolygonHierarchy(n);e=new uf.PolygonHierarchy(t,[a])}else e=new uf.PolygonHierarchy(t);let i={perPositionHeight:!this.clampToGround,color:this.materialColor,polygonHierarchy:e},o={...i,id:this.id,show:this.useBatch&&!1!==this.properties.show};r.polygon={...i,show:!this.useBatch&&!1!==this.properties.show};let s=this.properties.labelDistanceDisplayCondition?new uf.DistanceDisplayCondition(...this.properties.labelDistanceDisplayCondition):void 0,l=this.properties.labelScaleByDistance?new uf.NearFarScalar(...this.properties.labelScaleByDistance):void 0,d=this.getFont(),c={id:`${this.id}-label`,show:!1!==this.properties.show,position:new uf.Cartesian3,text:this.properties.name,...px,font:d,distanceDisplayCondition:s,scaleByDistance:l,pixelOffsetScaleByDistance:l,depthFailTranslucency:this.properties.labelOccludedAlpha,verticalOrigin:uf.VerticalOrigin.BOTTOM,pixelOffset:new uf.Cartesian2(0,-5)};return this.properties.withPolyOutline&&(r.polyline={clampToGround:this.clampToGround,width:this.properties.outlineWidth||3}),{options:r,polygonOptions:o,labelOptions:c}}init(){let e=uf.Color.fromCssColorString(this.cssColor);this.setColorProperty(new uf.ConstantProperty(e)),super.init()}setCollectionMap(){this.managers._options.elements.add(\"polygon\",this.options.parent||this,[this.id])}removeCollectionMap(){!this.options.parent&&super.removeCollectionMap()}dynamic;stabilize(e){this.dynamic=!1,this.switchCesiumPolygon(),this.options.drawing&&(this.options.drawing=!1,this._drawingPositions=[]),this.options.positionsCallback=void 0;e&&(this.properties.positions=e.map(e=>(0,pg.KO)(e,!0)),this.updatePositions(),this.label.showSetter(!0)),this.managers.render?.()}dynamize(e){this.options=Object.assign(this.options,e),this._dynamize()}_dynamize(){this.dynamic=!0,this.switchCesiumPolygon(),this.options.positionsCallback&&(this.entities.polygon?.hierarchySetter(new uf.CallbackProperty(()=>new uf.PolygonHierarchy(this.options.positionsCallback?.()),!1)),this.entities.polyline?.positionsSetter(new uf.CallbackProperty(()=>{let e=this.options.positionsCallback?.()||[];return e.length>0&&(e=e.concat([e[0]])),e},!1)),this.label.showSetter(!1))}runtimeStates;getLabelRuntimeVisible(e=f3){let a=this.runtimeStates[e];!a&&(a=hK());let r=a.label,{hover:t,selected:n}=this.activeState;return!n&&(!1!==this.properties.show&&r.distanceVisible&&r.alphaVisible&&r.labelingVisible||t)}getPolygonRuntimeVisible(e=f3){let a=this.runtimeStates[e];!a&&(a=hK());let r=a.polygon,{selected:t}=this.activeState;return!1!==this.properties.show&&r.distanceVisible&&r.alphaVisible||t}getTotalRuntimeVisible(e=f3){let a=this.runtimeStates[e];return!a&&(a=hK()),a.all.visible}updateShowByRuntimeState(e=f3){if(!this.clampToGround)return;let a=this.getPolygonRuntimeVisible(e)&&this.fill;this.updateCesiumPolygon({show:a});let r=this.entities._get(e);if(!r)return;let t=this.active();r.show=!1!==this.properties.show&&(this.getTotalRuntimeVisible(e)||t);let n=this.label._get(e);if(!!n)n.show=this.getLabelRuntimeVisible(e)}toggleActive(){if(this.active()){let e=uf.Color.fromCssColorString(this.active(\"recenter\")?pI:pD);this.label.fillColorSetter(this.colorProperty?.getValue(uf.JulianDate.now())),this.label.outlineColorSetter(e),this.entities.showSetter(!0),!this.active(\"selected\")&&this.active(\"hover\")&&(this.updateCesiumPolygon({show:this.fill}),this.label.showSetter(!0))}else this.label.fillColorSetter(px.fillColor),this.label.outlineColorSetter(px.outlineColor),this.managers._keys().forEach(e=>{this.updateShowByRuntimeState(e)});this.updateRuntimeOccludeStyle(),this.updateMaterial(),this.updateWidth(),this.managers.render?.()}getCesiumColor(){let e=this.properties.cssColor;if(e)return uf.Color.fromCssColorString(e)}getCesiumColorAlpha(e=this.properties.areaAlpha){let a=this.getCesiumColor();if(a)return(0,lL.isNil)(e)?a:a.withAlpha(e)}materialColor;updatePolygonMaterial(e){let a=-1!==this.cacheAlphaByDistance?this.cacheAlphaByDistance:void 0,r=this.getCesiumColorAlpha(a),t=this.fill;(e||!this.materialColor||!r||!uf.Color.equals(this.materialColor,r))&&(this.materialColor=r,this.updateCesiumPolygon({show:t,color:r?.withAlpha(t?r.alpha:0)}))}lastPolylineMaterialState;isEqualAndSet(e){let a=!0;return e.color instanceof uf.Color&&this.lastPolylineMaterialState.color instanceof uf.Color?!uf.Color.equals(e.color,this.lastPolylineMaterialState.color)&&(a=!1):e.color!==this.lastPolylineMaterialState.color&&(a=!1),e.activeColor instanceof uf.Color&&this.lastPolylineMaterialState.activeColor instanceof uf.Color?!uf.Color.equals(e.activeColor,this.lastPolylineMaterialState.activeColor)&&(a=!1):e.activeColor!==this.lastPolylineMaterialState.activeColor&&(a=!1),e.fence!==this.lastPolylineMaterialState.fence&&(a=!1),this.lastPolylineMaterialState=e,a}getDepthFailMaterial(e){return new uf.PolylineDashMaterialProperty({color:e})}updateMaterial(e=!1){this.updatePolygonMaterial(e);let a={color:void 0,activeColor:void 0,fence:!1};if(this.active()){let r=uf.Color.fromCssColorString(this.active(\"recenter\")?pI:pD),t=new uf.PolylineOutlineMaterialProperty({color:this.colorProperty,outlineColor:r,outlineWidth:2});a.activeColor=r,a.color=this.getCesiumColor(),this.properties.outlineStyle===sf.Fence&&(t=new mZ(uf.Color.fromCssColorString(this.properties.cssColor||\"#ffffff\"),uf.Color.fromCssColorString(\"#ffffff\"),6),a.fence=!0),(e||!this.isEqualAndSet(a))&&(this.entities.polyline?.materialSetter(t),!this.clampToGround&&this.entities.polyline?.depthFailMaterialSetter(this.getDepthFailMaterial(uf.Color.fromCssColorString(this.properties.cssColor||\"#ffffff\"))))}else{let r=this.getCesiumColor();a.color=r;let t=new uf.ColorMaterialProperty(r);this.properties.outlineStyle===sf.Fence&&(t=new mZ(r),a.fence=!0),this.properties.outlineStyle===sf.Dash&&(t=new uf.PolylineDashMaterialProperty({color:r})),(e||!this.isEqualAndSet(a))&&(this.entities.polyline?.materialSetter(t),!this.clampToGround&&this.entities.polyline?.depthFailMaterialSetter(this.getDepthFailMaterial(r||uf.Color.WHITE)))}}lastPolylineWidth;updateWidth(){if(this.active()){let e=(this.properties.outlineWidth||3)+2;this.properties.outlineStyle===sf.Fence&&(e=10),e!==this.lastPolylineWidth&&(this.entities.polyline?.widthSetter(new uf.ConstantProperty(e)),this.lastPolylineWidth=e)}else{let e=this.properties.outlineWidth||3;this.properties.outlineStyle===sf.Fence&&(e=12),e!==this.lastPolylineWidth&&(this.entities.polyline?.widthSetter(new uf.ConstantProperty(e)),this.lastPolylineWidth=e)}}updatePositions(){if(!this.dynamic){let e,a;if(this.properties.positions){let r=this.properties.positions.map(e=>uf.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height)),t=this.properties.holes?.map(e=>uf.Cartesian3.fromDegrees(e.longitude,e.latitude,e.height));if(t){let a=new uf.PolygonHierarchy(t);e=new uf.PolygonHierarchy(r,[a])}else e=new uf.PolygonHierarchy(r);a=r.concat(r[0]).map(e=>uf.Cartesian3.clone(e)),this.namePosition=function(e){if(e.length>0){var a;return{longitude:(a=pQ()([e.map(mi)]))[0],latitude:a[1],height:a[2]}}}(this.properties.positions)||null,this.namePosition?(this.label.positionSetter(uf.Cartesian3.fromDegrees(this.namePosition.longitude,this.namePosition.latitude,this.namePosition.height)),this.toggleNameClampWithoutHeight()):(this.label.showSetter(!1),this.removeNameWatcher())}this.updateCesiumPolygon({polygonHierarchy:e}),this.entities.polyline?.positionsSetter(new uf.ConstantProperty(a))}}namePosition;nameClampWatcher;cacheNamePositionHeight;updateNamePositionCallback(e){e&&(this.label.positionSetter(e),this.cacheNamePositionHeight=uf.Cartographic.fromCartesian(e).height,this.managers.render?.())}toggleNameClampWithoutHeight(){let e=this.namePosition;if(e){let a=uf.Cartographic.fromDegrees(e.longitude,e.latitude);this.nameClampWatcher?this.nameClampWatcher.update(a):this.nameClampWatcher=this.managers._get(f3)?.picker.clampWithWatcher(a,e=>this.updateNamePositionCallback(e))}}removeNameWatcher(){this.nameClampWatcher&&(this.nameClampWatcher?.unclamp(),this.nameClampWatcher=null)}fillAreaCanPick;canPick(e){return!(e instanceof uf.GroundPrimitive)||this.fillAreaCanPick}cacheAlphaByDistance;updateAlphaByDistance(e,a){let r;let t=this.properties.alphaByDistance;if(!t)return;let[n,i,o,s]=t;if(!(n<=o&&n>=0&&i>=0&&s>=0&&i<=1&&s<=1))return;let l=Number.POSITIVE_INFINITY,{viewportCenterDistance:d,cameraHeight:c}=a;if(!(0,pg.ri)(d)&&(!(0,pg.ri)(c)||c<=0))return;if((0,pg.ri)(d)&&(l=d),(0,pg.ri)(c)&&c<l&&(l=c),l<n)r=i;else if(l>o)r=s;else{let e=(s-i)/(Math.log(o)-Math.log(n)),a=i-e*Math.log(n);r=e*Math.log(l)+a}let u=this.properties.disableHoverAlpha??0;this.fillAreaCanPick=r>u;let p=this.runtimeStates[e.id];if(p&&(p.polygon.alphaVisible=r>u),!(.001>=Math.abs(this.cacheAlphaByDistance-r)))this.cacheAlphaByDistance=r,r>u&&this.updatePolygonMaterial()}cacheViewModes;onSceneChange(e,a){this.updateVisibleByDistance(e),this.clampToGround&&this.updateAlphaByDistance(e,a),this.updateShowByRuntimeState(e.id);let{is3D:r,id:t}=e;if(r&&\"3D\"===this.cacheViewModes[t]||!r&&\"2D\"===this.cacheViewModes[t])return;if(this.cacheViewModes[t]=r?\"3D\":\"2D\",!this.active())this.updateRuntimeOccludeStyle([t])}updateRuntimeOccludeStyle(e){let a=this.active(),r=!!this.properties.labelEnableOccludeIn2dView;(!Array.isArray(e)||0===e.length)&&(e=Object.keys(this.cacheViewModes)),e.forEach(e=>{let t=this.cacheViewModes[e];if(void 0===t)return;let{occludedAlpha:n,disableDepthTestDistance:i}=mb(t,a,r,this.properties.labelOccludedAlpha,void 0),o=this.label._get(e);if(!!o)o.depthFailTranslucency=n,o.disableDepthTestDistance=i})}updateVisibleByDistance(e){let a=this.anchor;if(!a)return;let r=e.viewer.camera.positionWC,t=this.properties.labelDistanceDisplayCondition,n=this.runtimeStates[e.id];if(t){let e=uf.Cartesian3.distance(r,a),i=e<t[1];n&&(n.label.distanceVisible=i||e>t[0],n.polygon.distanceVisible=i,n.all.visible=i)}}get placeable(){return!!this.properties.placeable}set placeable(e){this.properties.placeable=e}get anchor(){if(!this.namePosition)return null;let e={longitude:this.namePosition.longitude,latitude:this.namePosition.latitude,height:this.cacheNamePositionHeight};return(0,pg.jL)(e)}cacheLabelingWindowPosition;getLabelingWindowPosition(e){let a=this.managers._get(e).viewer.scene;if(!a)return null;let r=a.frameState.frameNumber;if(this.cacheLabelingWindowPosition[e]?.frameNumber===r)return this.cacheLabelingWindowPosition[e].labelingWindowPosition||null;let t=null;if(this.anchor){let e=uf.SceneTransforms.wgs84ToWindowCoordinates(a,this.anchor);e&&(t=e)}return this.cacheLabelingWindowPosition[e]={frameNumber:r,labelingWindowPosition:t},t}cacheScreenSpaceBoundingBox;getScreenSpaceBoundingBox(e,a){let r=this.managers._get(e)?.viewer?.scene;if(!r)return null;let t=r.frameState.frameNumber;if(this.cacheScreenSpaceBoundingBox[e]?.frameNumber===t)return this.cacheScreenSpaceBoundingBox[e].screenSpaceBoundingBox||null;let n=null;if(!a&&(a=this.getCurrentPlacement(e)),\"UnSet\"!==a){let a=this.label._get(e),t=this.getLabelingWindowPosition(e);if(r&&a&&t){let e=uf.Label.getScreenSpaceBoundingBox(a,t,new uf.BoundingRectangle);n=p2.fromCesiumBoundingRect(e)}}return this.cacheScreenSpaceBoundingBox[e]={frameNumber:t,screenSpaceBoundingBox:n},n}resetPlacement(e){}getCurrentPlacement(e){return\"Center\"}nextPlacement(e){return\"UnSet\"}updateLabeling(e,{visible:a}){let r=this.runtimeStates[e];void 0!==a&&r&&(r.label.labelingVisible=a,this.updateShowByRuntimeState(e))}getLabelVisible(e=f3){let a=this.label._get(e);return!!a&&a.show}canPlaceable(e){if(!this.placeable)return!1;if(!1===this.properties.show)return this.properties.show;let{screenRect:a,manager:r,managerId:t}=e,n=this.getScreenSpaceBoundingBox(t);if(!n||!p2.intersect(a,n,7))return!1;let i=this.properties.labelDistanceDisplayCondition;if(i&&this.anchor){let e=r.viewer.camera.positionWC,a=uf.Cartesian3.distance(e,this.anchor);return a>i[0]||a<i[1]}return!0}hasPrimitive(e){return e instanceof uf.Label&&this.label._values().includes(e)}onManagerAdd(e){let a=this.managers._get(e);if(this.runtimeStates[e]=hK(),a){let{options:r,labelOptions:t,polygonOptions:n}=this.getEntityOptions();this.entities._add(e,a.viewer.entities.add(r)),this.polygon._add(e,a.groundPolygonColorVisualizer.add(n)),this.label._add(e,a.labelVisualizer.add(t)),this.updateMaterial(!0),this.updateWidth(),this.options.drawing?(this._dynamize(),this.active(\"selected\",!0)):this.updatePositions(),a.render()}}onManagerRemove(e){let a=this.entities._get(e);a?.entityCollection.remove(a),this.entities._remove(e);let r=this.managers._get(f3),t=this.polygon._get(e);r?.groundPolygonColorVisualizer.remove(t),this.polygon._remove(e);let n=this.label._get(e);r?.labelVisualizer.remove(n),this.label._remove(e)}onManagerUpdate(e){let a=this.entities._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){this.destroyed=!0,super.destroy(),this.removeNameWatcher(),this.managers._keys().forEach(e=>{this.onManagerRemove(e)})}}(rV=sv||(sv={})).Blue=\"#2D8CF0\",rV.Green=\"#19BE6B\",rV.Yellow=\"#FFBB00\",rV.Red=\"#E23C39\",rV.Purple=\"#B620E0\";let hZ=\"#2D8CF0\";(rU=sz||(sz={}))[rU.HighDistance=2e3]=\"HighDistance\",rU[rU.HighAltitude=500]=\"HighAltitude\",rU[rU.ModalDistance=4e3]=\"ModalDistance\",rU[rU.ModalAltitude=1e3]=\"ModalAltitude\",rU[rU.LowDistance=6e3]=\"LowDistance\",rU[rU.LowAltitude=2e3]=\"LowAltitude\";class hY extends(0,uX.AF)(pv,ph,pz,pw){managers;constructor(e,a){super(),this.managers=a,this.interactLevel=sc.Area,this.primitives=py({}),this.transformer=null,this.geometryChanged=!1,this.readyForGroundGeometry=!1,this.terrainHeightsPromise=uf.GroundPolylinePrimitive.initializeTerrainHeights(),this.hpr={heading:0,pitch:0,roll:0},this.visualCenterWC=new uf.Cartesian3(0,0,0),this.positionsWC=[],this.positionsPlaneFrame=[],this.xDirectionWC=new uf.Cartesian3(0,0,0),this.yDirectionWC=new uf.Cartesian3(0,0,0),this.zDirectionWC=new uf.Cartesian3(0,0,0),this._hprMatrix=new uf.Matrix4,this._hprMatrixInverse=new uf.Matrix4,this._planeSpaceMatrix=new uf.Matrix4,this._planeSpaceMatrixInverse=new uf.Matrix4,this.dragging=!1,this.beforeDraggingPositions=[],this.beforeDraggingArea=0,this.activeState={selected:!1,recenter:!1,hover:!1},this._shiftHotkeyEnable=!1,this.isIntersect=!1,this.isAreaExceed=!1,this.modelMatrix=uf.Matrix4.IDENTITY,this.copyCount=0,this.cacheStatus={},this.terrainHeightsPromise.then(()=>{this.readyForGroundGeometry=!0}),this.properties=Object.assign({id:(0,uW.k)(),show:!0,type:\"polygon3d\"},e),!1!==e.transformable&&(this.transformer=new hn({show:!1,onDragStart:this.onTransformerDragStart.bind(this),onDragMove:this.onTransformerDragMove.bind(this),onDragEnd:this.onTransformerDragEnd.bind(this)},a)),this.init(),this.setCollectionMap()}properties;interactLevel;primitives;transformer;geometryChanged;readyForGroundGeometry;terrainHeightsPromise;setCesiumLabelParams(e){let{labelScaleByDistance:a,labelOccludedAlpha:r,labelDistanceDisplayCondition:t}=this.properties,n=a?new uf.NearFarScalar(...a):void 0;e.scaleByDistance=n,e.pixelOffsetScaleByDistance=n,e.depthFailTranslucency=r,e.distanceDisplayCondition=t?new uf.DistanceDisplayCondition(...t):void 0}updateNameLabel(e){if(!1===this.properties.labelVisible)return;let a=this.primitives._get(e),r=this.managers._get(e),t=r.nameLabelCollection,n=this.active();if(!r||!a||!t)return;let i=a.nameLabel;if(i)i.fillColor=n?uf.Color.fromCssColorString(this.cssColor):pR.LabelOptions.fillColor,i.text=String(this.properties.name),this.visualCenterWC&&!uf.Cartesian3.equals(i.position,this.visualCenterWC)&&(i.position=this.visualCenterWC),i.disableDepthTestDistance=n?Number.POSITIVE_INFINITY:0,this.setCesiumLabelParams(i);else{let e=this.visualCenterWC;if((uf.Cartesian3.equals(e,uf.Cartesian3.ZERO)||uf.Cartesian3.equals(e,uf.Cartesian3.ONE))&&this.updateSelf(),!1===this.properties.show||!e)return;let r={position:e,text:this.properties.name,pixelOffset:new uf.Cartesian2(0,-5),depthFailTranslucency:this.properties.labelOccludedAlpha,disableDepthTestDistance:n?Number.POSITIVE_INFINITY:0};n&&(r.fillColor=uf.Color.fromCssColorString(this.cssColor));let i=Object.assign({},pR.LabelOptions,r),o=t.add(i);this.setCesiumLabelParams(o),a.nameLabel=o}}hpr;visualCenterWC;get visualCenter(){return(0,pg.KO)(this.visualCenterWC,!0)}positionsWC;positionsPlaneFrame;xDirectionWC;yDirectionWC;zDirectionWC;get normalWC(){return this.zDirectionWC}_hprMatrix;get hprMatrix(){return this._hprMatrix}_hprMatrixInverse;get hprMatrixInverse(){return this._hprMatrixInverse}_planeSpaceMatrix;get planeSpaceMatrix(){return uf.Matrix4.multiply(p3,this._hprMatrixInverse,this._planeSpaceMatrix)}_planeSpaceMatrixInverse;get planeSpaceMatrixInverse(){return uf.Matrix4.inverse(this.planeSpaceMatrix,this._planeSpaceMatrixInverse)}dragging;beforeDraggingPositions;beforeDraggingArea;cleanDragging(){this.beforeDraggingPositions=[],this.beforeDraggingArea=0}checkIntersectAndAreaExceed(){let e={isIntersect:!1,isAreaExceed:!1,areaChangeMode:sb.none},a=this.checkIntersection();e.isIntersect=a;let r=this.getArea();if(this.properties.maxArea){let a=r>this.properties.maxArea;e.isAreaExceed=a;let t=r>this.beforeDraggingArea?sb.grow:sb.shrink;e.areaChangeMode=t}return e}setDragging(e){if(this.dragging!==e){if(this.dragging=e,e)this.beforeDraggingPositions=this.positions||[],this.beforeDraggingArea=this.getArea();else{let{isIntersect:e,isAreaExceed:a,areaChangeMode:r}=this.checkIntersectAndAreaExceed();e&&this.beforeDraggingPositions&&this.resetPositions(),a&&r===sb.grow&&this.beforeDraggingPositions&&this.resetPositions(),!function(e,a=1e-4){let r=ma(e);if(!r)return!0;let t=!0;for(let n=3;n<e.length&&(t=uf.Plane.getPointDistance(r,e[n])<a);n++);return t}(this.positionsWC,.1)&&this.resetPositions(),this.cleanDragging()}}}resetPositions(){this.update({positions:this.beforeDraggingPositions}),this.managers.editor?.updatePositionsFor?.(this)}get boundingSphere(){return uf.BoundingSphere.fromPoints(this.positionsWC)}updateTransformer(){!1!==this.properties.transformable&&this.transformer&&this.transformer.update({position:this.visualCenter,headingPitchRoll:this.hpr})}onTransformerDragStart(e){this.transformType=e,this.transformState=\"changing\"}onTransformerDragMove(e){this.updateModelMatrix(e),this.managers.render?.()}onTransformerDragEnd(){let e=this.positionsWC.map(e=>(0,pg.KO)(uf.Matrix4.multiplyByPoint(this.modelMatrix,e,new uf.Cartesian3),!0));this.modelMatrix=uf.Matrix4.IDENTITY,this.update({positions:e});let a=\"rotate\"===this.transformType?\"rotate\":\"translate\";this.managers.editor?.updatePositionsFor?.(this,!0,a),this.transformType=\"\",this.transformState=\"static\"}reversePositions(){let e=this.properties.positions;e&&(this.properties.positions=e.reverse(),this.updateSelf())}getArea(){return function(e){let a=0;for(let r=0,t=e.length;r<t;r++){let t=e[r].x,n=e[r===e.length-1?0:r+1].y,i=e[r===e.length-1?0:r+1].x,o=e[r].y;a+=t*n*.5,a-=i*o*.5}return Math.abs(a)}(this.positionsPlaneFrame.map(e=>uf.Cartesian2.fromCartesian3(e)))}get cssColor(){return this.properties.cssColor||hZ}get positions(){return this.properties.positions||[]}get id(){return String(this.properties.id)}get type(){return\"polygon3d\"}get typedElement(){return{type:this.type,element:this}}get useAsyncGeometry(){return!this.readyForGroundGeometry}activeState;toggleActive(){this.primitives._keys().forEach(e=>{this.updateOutlinePrimitive(e),this.updateNameLabel(e),this.properties.enableGroundShadow&&this.updateGroundShadow(e)})}active(e=\"\",a){if(!this.properties.fromDraw)return!1;if((0,pg.ri)(a)&&e&&this.activeState[e]!==a&&(this.activeState[e]=a,this.toggleActive()),e)return this.activeState[e];{let{selected:e,recenter:a,hover:r}=this.activeState;return e||a||r}}_shiftHotkeyEnable;get shiftHotkeyEnable(){return this._shiftHotkeyEnable}set shiftHotkeyEnable(e){this._shiftHotkeyEnable=e,!1!==this.properties.transformable&&this.transformer&&(this.transformer.shiftHotkeyEnable=e)}edit(e){if(this.managers._get(f3)?.editor?.enterEdit?.(\"polygon3d\",this,e),this.managers._get(f3).hover.setCursor(\"default\",\"hover\"),!e&&!1!==this.properties.transformable&&this.transformer){this.transformer.update({show:!0,position:this.visualCenter,headingPitchRoll:this.hpr});let e=this.managers._get(f3).viewer.camera;this.transformer.onCameraChanged(e)}}exitEdit(){this.managers._get(f3).hover.setCursor(\"pointer\",\"hover\"),!1!==this.properties.transformable&&this.transformer&&(this.transformer.update({show:!1}),this.transformer.onDragging&&(this.modelMatrix=uf.Matrix4.IDENTITY,this.transformer.endDrag()))}isIntersect;isAreaExceed;emitIntersectAndAreaExceed(){let e=this.checkIntersection();if(e!==this.isIntersect&&(this.isIntersect=e,this.managers._get(f3).emit(\"onPolygon3DIntersectChange\",this,e)),this.properties.maxArea){let e=this.getArea()>this.properties.maxArea;this.isAreaExceed!==e&&(this.isAreaExceed=e,this.managers._get(f3).emit(\"onPolygon3DAreaExceedChange\",this,e))}}createTransformer(){let e=this.active()&&this.properties.transformable;this.transformer=new hn({show:e,onDragStart:this.onTransformerDragStart.bind(this),onDragMove:this.onTransformerDragMove.bind(this),onDragEnd:this.onTransformerDragEnd.bind(this),position:this.visualCenter,headingPitchRoll:this.hpr},this.managers)}update(e){let a=!1,r=!1,t=!1,n=[];(0,pg.ri)(e.show)&&(this.properties.show=e.show,this.updateShow(),this.managers.render?.(),n.push(\"show\")),(0,pg.ri)(e.labelDistanceDisplayCondition)&&(this.properties.labelDistanceDisplayCondition=e.labelDistanceDisplayCondition,t=!0,n.push(\"labelDistanceDisplayCondition\")),(0,pg.ri)(e.labelOccludedAlpha)&&(this.properties.labelOccludedAlpha=e.labelOccludedAlpha,t=!0,n.push(\"labelOccludedAlpha\")),(0,pg.ri)(e.labelScaleByDistance)&&(this.properties.labelScaleByDistance=e.labelScaleByDistance,t=!0,n.push(\"labelScaleByDistance\")),(0,pg.ri)(e.labelEnableOccludeIn2dView)&&(this.properties.labelEnableOccludeIn2dView=e.labelEnableOccludeIn2dView,t=!0,n.push(\"labelEnableOccludeIn2dView\")),(0,pg.ri)(e.labelVisible)&&(t=this.properties.labelVisible===e.labelVisible,this.properties.labelVisible=e.labelVisible,n.push(\"labelVisible\")),(0,pg.ri)(e.cssColor)&&(this.properties.cssColor=e.cssColor,t=!0,n.push(\"cssColor\")),Object.keys(e).forEach(t=>{let i=e[t];if(!n.includes(t))(0,pg.ri)(i)&&(this.properties[t]=i,\"positions\"===t&&(a=!0),\"transformable\"===t&&!1!==i&&(r=!0))}),this.render(t),r&&!this.transformer&&this.createTransformer(),a&&(this.emitIntersectAndAreaExceed(),this.active()&&this.managers.editor?.updatePositionsFor?.(this))}updateSelf(){if(this.positions&&this.positions.length>2){this.positionsWC.length=0,this.positionsWC.push(...this.positions.map(e=>(0,pg.jL)(e)));let{avgCenter:e,xDirectionWC:a,yDirectionWC:r,zDirectionWC:t}=function(e){if(e.length<3)return{avgCenter:uf.Cartesian3.ONE,xDirectionWC:uf.Cartesian3.UNIT_X,yDirectionWC:uf.Cartesian3.UNIT_Y,zDirectionWC:uf.Cartesian3.UNIT_Z};let a=ms(e),r=e.map((a,r)=>{let t=r+1;t===e.length&&(t=0);let n=e[t];return uf.Cartesian3.normalize(uf.Cartesian3.subtract(n,a,new uf.Cartesian3),new uf.Cartesian3)}).map((e,a,r)=>{let t=a+1;t===r.length&&(t=0);let n=r[t];return uf.Cartesian3.cross(e,n,new uf.Cartesian3)}).reduce((e,a)=>uf.Cartesian3.add(e,a,e),new uf.Cartesian3);uf.Cartesian3.normalize(r,r);let t=a.clone(),n=uf.Cartesian3.cross(t,r,new uf.Cartesian3),i=uf.Cartesian3.normalize(n,n),o=uf.Cartesian3.cross(r,i,new uf.Cartesian3);return{avgCenter:a,xDirectionWC:i,yDirectionWC:o,zDirectionWC:r}}(this.positionsWC);mc(this.visualCenterWC,e),mc(this.xDirectionWC,a),mc(this.yDirectionWC,r),mc(this.zDirectionWC,t);let{heading:n,roll:i}=function(e,a,r,t){let n=uf.Transforms.eastNorthUpToFixedFrame(e),i=uf.Matrix4.inverse(n,new uf.Matrix4),o=uf.Cartesian3.add(e,a,new uf.Cartesian3),s=uf.Cartesian3.add(e,r,new uf.Cartesian3),l=uf.Cartesian3.add(e,t,new uf.Cartesian3),d=uf.Matrix4.multiplyByPoint(i,o,o),c=uf.Matrix4.multiplyByPoint(i,s,s),u=uf.Matrix4.multiplyByPoint(i,l,l),p=uf.Cartesian3.angleBetween(ml,d),m=(d.y>0?1:-1)*p*uf.Math.DEGREES_PER_RADIAN,h=uf.Cartesian3.angleBetween(md,c);return{heading:m,roll:(u.z>0?1:-1)*h*uf.Math.DEGREES_PER_RADIAN}}(e,a,r,t);this.hpr={heading:n,pitch:0,roll:i},this._hprMatrix=uf.Transforms.headingPitchRollToFixedFrame(this.visualCenterWC,new uf.HeadingPitchRoll(n*uf.Math.RADIANS_PER_DEGREE,0,i*uf.Math.RADIANS_PER_DEGREE)),this._hprMatrixInverse=uf.Matrix4.inverse(this._hprMatrix,this._hprMatrixInverse),this.positionsPlaneFrame.length=0;let o=this.positionsWC.map(e=>uf.Matrix4.multiplyByPoint(this.planeSpaceMatrix,e,new uf.Cartesian3));this.positionsPlaneFrame.push(...o),this.updateTransformer()}}updateShow(){let e=this.primitives,a=!1!==this.properties.show;e.main&&e.main.showSetter(a),e.outline&&e.outline.showSetter(a),e.nameLabel&&e.nameLabel.showSetter(a),e.shadow&&e.shadow.showSetter(a)}render(e=!0){this.primitives._keys().forEach(a=>{this.updateSelf(),this.updatePolygonPrimitive(a),this.updateOutlinePrimitive(a),e&&this.updateNameLabel(a),this.properties.enableGroundShadow&&this.updateGroundShadow(a)})}addPrimitives(e){!this.primitives._get(e)&&this.primitives._add(e,{}),this.updatePolygonPrimitive(e),this.updateOutlinePrimitive(e),!1!==this.properties.labelVisible&&this.updateNameLabel(e),this.properties.enableGroundShadow&&this.updateGroundShadow(e)}updatePolygonPrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e),t=this.id;if(!r||!a)return;let n=r.primitiveContainers.polygon3d,i=a.main;if(i&&n.contains(i)&&n.remove(i),a.main=void 0,!1===this.properties.show)return;let o=n.add(new uf.Primitive({geometryInstances:new uf.GeometryInstance({geometry:new uf.CoplanarPolygonGeometry(this.getGeometryOptions()),attributes:{color:this.getColorAttribute(),depthFailColor:this.getColorAttribute(!1,!0)},id:t}),appearance:new uf.PerInstanceColorAppearance,depthFailAppearance:this.properties.depthFail?new uf.PerInstanceColorAppearance:void 0,asynchronous:!1,modelMatrix:this.modelMatrix}));a.main=o}updateGroundShadow(e){let a=this.managers._get(e);if(!a)return;let r=a.primitiveContainers.polyline3d,t=this.primitives._get(e);!t&&(this.primitives._add(e,{}),t=this.primitives._get(e));let n=t.shadow;n&&r.contains(n)&&r.remove(n),t.shadow=void 0;let i=this.active();if(!1===this.properties.show||!i)return;let o=function(e){let a=e.positions,r=[];if(a.length>=2){let a=e.getGroundShadowGeometryOptions(),t=new uf.GroundPolylineGeometry(a);r.push(new uf.GeometryInstance({id:`polyline-shadow-${e.id}`,geometry:t}))}let t=new uf.PolylineMaterialAppearance({material:uf.Material.fromType(uf.Material.ColorType,{color:uf.Color.fromCssColorString(pR.GroundShadowColor).withAlpha(pR.GroundShadowAlpha)})});return new uf.GroundPolylinePrimitive({geometryInstances:r,asynchronous:e.useAsyncGeometry,appearance:t})}(this);t.shadow=o,r.add(o)}checkIntersection(){return mT(this.positionsPlaneFrame.map(e=>({x:e.x,y:e.y})))}updateOutlinePrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e);if(!r||!a)return;let t=r.primitiveContainers.polyline3d,n=a.outline;if(n&&t.contains(n)&&t.remove(n),a.outline=void 0,!1===this.properties.show||!this.properties.outlined)return;let i=this.active(),o=[];if(this.positions&&this.positions.length>=3){let e=[this.positions[0]];o=this.positions.slice().concat(e).map(e=>(0,pg.jL)(e))}let s=new uf.GeometryInstance({geometry:new uf.PolylineGeometry({positions:o,width:i?2*(this.properties.outlineWidth||3):this.properties.outlineWidth||2,vertexFormat:uf.PolylineMaterialAppearance.VERTEX_FORMAT})}),l=i?uf.Material.fromType(uf.Material.PolylineOutlineType,{color:uf.Color.fromCssColorString(this.cssColor),outlineColor:uf.Color.fromCssColorString(pI),outlineWidth:this.properties.outlineWidth||pR.BorderLineWidth}):uf.Material.fromType(uf.Material.ColorType,{color:uf.Color.fromCssColorString(this.cssColor)}),d=new uf.PolylineMaterialAppearance({material:l}),c=new uf.PolylineMaterialAppearance({material:uf.Material.fromType(uf.Material.PolylineDashType,{color:uf.Color.fromCssColorString(this.properties.cssColor||\"#fff\"),gapColor:new uf.Color(0,0,0,0),dashLength:16,dashPattern:255})});a.outline=t.add(new uf.Primitive({geometryInstances:s,appearance:d,depthFailAppearance:c,asynchronous:!1,modelMatrix:this.modelMatrix}))}getColor(e=!1,a=!1){let r=uf.Color.fromCssColorString(this.properties.cssColor||\"#FFFFFF\");return!e&&(r=uf.Color.fromAlpha(r,this.properties.areaAlpha||1)),a&&(r=uf.Color.fromAlpha(r,.5*r.alpha)),r}getColorAttribute(e=!1,a=!1){return uf.ColorGeometryInstanceAttribute.fromColor(this.getColor(e,a))}getGroundShadowGeometryOptions(){let e=this.positions.map(e=>(0,pg.jL)(e));return e.push(e[0]),{positions:e,width:pR.GroundShadowWidth}}getGeometryOptions(){return{polygonHierarchy:new uf.PolygonHierarchy(this.properties.positions?.map(e=>pg.jL(e)))}}modelMatrix;updateModelMatrix(e){this.modelMatrix=e,this.render()}recenter(){let e=this.properties.positions;e&&this.managers._keys().forEach(a=>{this.managers._get(a).lookAtPositions(e)})}stabilize(){}copyCount;convertToGroundEl(){let e=this.properties;return!e.positions||e.positions.length<3?null:new hW({category:e.category,positions:e.positions.map(e=>hu.clone(e)),name:`${e.name}_${++this.copyCount}`,cssColor:e.cssColor,alphaByDistance:e.areaAlphaByDistance,disableHoverAlpha:.125,withPolyOutline:!0,areaAlpha:.2,fromDraw:!0,placeable:!0,removable:e.removable,labelDistanceDisplayCondition:e.labelDistanceDisplayCondition,labelScaleByDistance:e.labelScaleByDistance,labelOccludedAlpha:e.labelOccludedAlpha,labelEnableOccludeIn2dView:e.labelEnableOccludeIn2dView},this.managers)}cacheStatus;onSceneChange(e,a){this.updateVisibleByDistance(e),this.updateAlphaByDistance(e,a);let{is3D:r,id:t}=e;this.updateShowByRuntimeState(t);let n=this.cacheStatus[t];if(!n&&(n=hY.createDefaultCacheStatus(t)),r&&\"3D\"===n.viewMode||!r&&\"2D\"===n.viewMode)return;if(n.viewMode=r?\"3D\":\"2D\",!this.active())this.updateRuntimeOccludedStyle([t])}getPolygonRuntimeVisible({polygon:e}){let{selected:a}=this.activeState;return!1!==this.properties.show&&!1!==e.distanceVisible||a}getLabelRuntimeVisible({label:e}){let{selected:a}=this.activeState;return!1!==this.properties.show&&!1!==e.distanceVisible&&e.labelingVisible||a}getOutlineRuntimeVisible({outline:e}){let{selected:a}=this.activeState;return!1!==this.properties.show&&!1!==e.distanceVisible||a}updateShowByRuntimeState(e){let a=this.cacheStatus[e],r=this.primitives._get(e);if(!a||!r)return;let t=r.main;t&&(t.show=this.getPolygonRuntimeVisible(a));let n=r.nameLabel;n&&(n.show=this.getLabelRuntimeVisible(a));let i=r.outline;i&&(i.show=this.getOutlineRuntimeVisible(a))}updateVisibleByDistance(e){let a=this.visualCenterWC;if(!a)return;let r=e.viewer.camera.positionWC,t=this.properties.labelDistanceDisplayCondition,n=this.cacheStatus[e.id];if(t){let e=uf.Cartesian3.distance(r,a),i=e<t[1];n&&(n.label.distanceVisible=i&&e>t[0],n.polygon.distanceVisible=i&&e>t[0],n.outline.distanceVisible=i&&e>t[0])}}updateAlphaByDistance(e,a){}updateRuntimeOccludedStyle(e){let a=this.active(),r=!!this.properties.labelEnableOccludeIn2dView;(!Array.isArray(e)||0===e.length)&&(e=Object.keys(this.cacheStatus)),e.forEach(e=>{let t=this.cacheStatus[e]?.viewMode;if(!t)return;let{occludedAlpha:n,disableDepthTestDistance:i}=mb(t,a,r,this.properties.labelOccludedAlpha,void 0),o=this.primitives.nameLabel?._get(e);o&&(o.depthFailTranslucency=n,o.disableDepthTestDistance=i)})}get placeable(){return!!this.properties.placeable}set placeable(e){this.properties.placeable=e}get anchor(){return this.visualCenterWC?this.visualCenterWC:null}getScreenSpaceBoundingBox(e,a){let r=this.managers._get(e)?.viewer.scene,t=this.primitives._get(e);if(!a&&(a=this.getCurrentPlacement()),\"UnSet\"===a||!r||!t)return null;let n=t.nameLabel;if(!this.anchor||!n)return null;let i=n.computeScreenSpacePosition(r);if(!i)return null;let o=uf.Label.getScreenSpaceBoundingBox(n,i);return p2.fromCesiumBoundingRect(o)}getLabelingWindowPosition(e){let a=this.primitives._get(e),r=this.managers._get(e)?.viewer.scene;return a&&a.nameLabel?a.nameLabel.computeScreenSpacePosition(r):null}getCurrentPlacement(){return\"Center\"}nextPlacement(){return\"UnSet\"}resetPlacement(){}updateLabeling(e,a){let r=this.cacheStatus[e];void 0!==a.visible&&r&&(r.label.labelingVisible=a.visible,this.updateShowByRuntimeState(e))}canPlaceable(e){if(!this.placeable)return!1;if(!1===this.properties.show)return this.properties.show;let{screenRect:a,manager:r,managerId:t}=e,n=this.getScreenSpaceBoundingBox(t);if(!n||!p2.intersect(a,n,0))return!1;let i=this.properties.labelDistanceDisplayCondition;if(i&&this.anchor){let e=r.viewer.camera.positionWC,a=uf.Cartesian3.distance(e,this.anchor);return a>i[0]||a<i[1]}return!0}setCollectionMap(){this.managers._options.elements.add(\"polygon3d\",this,[this.id]),this.uid=this.id||\"\"}static createDefaultCacheStatus(e){return{ownerId:e,polygon:{},outline:{},label:{}}}onManagerAdd(e){!(this.positions.length<=2)&&(this.cacheStatus[e]=hY.createDefaultCacheStatus(e),this.addPrimitives(e),this.updateSelf(),this.emitIntersectAndAreaExceed())}onManagerRemove(e){this.removePrimitives(e),delete this.cacheStatus[e]}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}hasPrimitive(e){return this.primitives._keys().some(a=>{let r=this.primitives._get(a);return r.main===e||r.outline===e||r.nameLabel===e||r.shadow===e})}removePrimitives(e){let a=this.primitives._get(e),r=this.managers._get(e);if(!r||!a)return;let t=r.primitiveContainers.polygon3d,n=r.primitiveContainers.polyline3d,i=r.nameLabelCollection;a.main&&t.remove(a.main),a.outline&&n.remove(a.outline),a.nameLabel&&i&&i.remove(a.nameLabel),a.shadow&&n.remove(a.shadow),this.primitives._remove(e)}destroy(){this.transformer&&this.transformer.destroy(),this.primitives._keys().forEach(e=>{this.removePrimitives(e)}),this.removeCollectionMap()}}let hQ=[0,2e5],h$=[100,2e5],hX=[5e3,1,2e4,.7],h0=[80,0,12e3,.3],h1=[80,.1,12e3,.3],h2={PrismBaselineIntersect:\"prism-baseline-intersect\"};(rK=sw||(sw={}))[rK.normal=0]=\"normal\",rK[rK.arrow=1]=\"arrow\",rK[rK.circle=2]=\"circle\",rK[rK.end=3]=\"end\";let h3=\"PolylineDirection\";uf.Material._materialCache.addMaterial(h3,{fabric:{type:h3,uniforms:{color:new uf.Color(0,1,1,1),directionColor:new uf.Color(1,1,1,1),outlineColor:new uf.Color(1,1,1,1),outlineWidth:0},source:\"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nuniform vec4 color;\\nuniform vec4 directionColor; // \\nuniform vec4 outlineColor; // \\nuniform float outlineWidth; // \\n\\nin float v_width; // \\nin float v_polylineAngle; // \\n\\nconst float fragLength = 100.0; // \\nconst float startPosition = 0.45; //  0  1\\nconst float endPosition = 0.55; //  0  1\\n\\nmat2 rotate(float rad) {\\n float c = cos(rad);\\n float s = sin(rad);\\n return mat2(\\n c, s,\\n -s, c\\n );\\n}\\n\\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\\n{\\n float slope = (p0.y - p1.y) / (p0.x - p1.x); // \\n return slope * (x - p0.x) + p0.y; //  x  y \\n}\\n\\nczm_material czm_getMaterial(czm_materialInput materialInput)\\n{\\n //  Dash \\n czm_material material = czm_getDefaultMaterial(materialInput);\\n vec2 st = materialInput.st;\\n\\n // copy from polyline outline\\n float halfInteriorWidth = 0.5 * (v_width - outlineWidth) / v_width;\\n float b = step(0.5 - halfInteriorWidth, st.t);\\n b *= 1.0 - step(0.5 + halfInteriorWidth, st.t);\\n\\n // Find the distance from the closest separator (region between two colors)\\n float d1 = abs(st.t - (0.5 - halfInteriorWidth));\\n float d2 = abs(st.t - (0.5 + halfInteriorWidth));\\n float dist = min(d1, d2);\\n\\n vec4 currentColor = mix(outlineColor, color, b);\\n vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist);\\n outColor = czm_gammaCorrect(outColor);\\n\\n // \\n vec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\\n\\n // , 0 ~ 1\\n float"
}