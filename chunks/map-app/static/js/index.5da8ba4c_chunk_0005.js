{
  "metadata": {
    "source_file": "map-app\\static\\js\\index.5da8ba4c.js",
    "chunk_index": 5,
    "total_chunks": 918,
    "chunk_size": 94547,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:50.141Z"
  },
  "content": "halfWidth)\\n {\\n d1 = abs(st.s - base);\\n }\\n float d2 = abs(st.t - ptOnUpperLine);\\n float d3 = abs(st.t - ptOnLowerLine);\\n dist = min(min(d1, d2), d3);\\n }\\n\\n vec4 outsideColor = vec4(0.0);\\n vec4 currentColor = mix(outsideColor, fragColor, clamp(s + t, 0.0, 1.0));\\n vec4 outColor = czm_antialias(outsideColor, fragColor, currentColor, dist);\\n\\n outColor = czm_gammaCorrect(outColor);\\n material.diffuse = outColor.rgb;\\n material.alpha = outColor.a;\\n return material;\\n}\\n\"},translucent:!0});class hg{constructor(e=uf.Color.WHITE){this.color=e}color;definitionChanged=new Event;isConstant=!0;equals(e){return this===e||e instanceof hg&&Color.equals(this.color,e.color)}getType(e){return hh}getValue(e,a){return!defined(a)&&(a={}),a.color=this.color,a}}class hf extends(0,uX.AF)(pv,ph,pz){managers;constructor(e,a){super(),this.managers=a,this.interactLevel=sc.Thing,this.primitives=py({}),this.properties=Object.assign({show:!0},e),this.init(),this.setCollectionMap(\"frustum\")}interactLevel;properties;primitives;update(e){Object.keys(e).forEach(a=>{let r=e[a];(0,pg.ri)(r)&&(this.properties[a]=r)}),this.render()}render(){this.primitives._keys().forEach(e=>{this.updatePrimitive(e),this.updateOutlinePrimitive(e),this.updateDirectionPrimitive(e)})}addPrimitives(e){!this.primitives._get(e)&&this.primitives._add(e,{}),this.updatePrimitive(e),this.updateOutlinePrimitive(e),this.updateDirectionPrimitive(e)}updatePrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.main&&r.viewer.scene.primitives.remove(a.main),a.main=void 0,this.properties.show&&!this.properties.disableFrustum&&(a.main=r.viewer.scene.primitives.add(new uf.Primitive({geometryInstances:new uf.GeometryInstance({geometry:new uf.FrustumGeometry(this.getGeometryOptions()),attributes:{color:this.getColorAttribute()}}),appearance:new uf.PerInstanceColorAppearance({flat:!0}),asynchronous:!1}))))}updateOutlinePrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.outline&&r.viewer.scene.primitives.remove(a.outline),a.outline=void 0,this.properties.show&&this.properties.outlined&&(a.outline=r.viewer.scene.primitives.add(new uf.Primitive({geometryInstances:new uf.GeometryInstance({geometry:new uf.FrustumOutlineGeometry(this.getGeometryOptions()),attributes:{color:this.getColorAttribute(!0)}}),appearance:new uf.PerInstanceColorAppearance({flat:!0}),asynchronous:!1}))))}updateDirectionPrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.direction&&r.viewer.scene.primitives.remove(a.direction),a.direction=void 0,this.properties.show&&this.properties.direction&&(a.direction=r.viewer.scene.primitives.add(new uf.Primitive({geometryInstances:new uf.GeometryInstance({geometry:new uf.PolylineGeometry({positions:this.getDirectionPoints(),vertexFormat:uf.PolylineMaterialAppearance.VERTEX_FORMAT,width:8})}),appearance:new uf.PolylineMaterialAppearance({material:uf.Material.fromType(hh,{color:this.getColor(!0),dashLength:12})}),asynchronous:!1}))))}getPositionCartesian3(){return this.properties.position?(0,pg.jL)(this.properties.position):uf.Cartesian3.ZERO}getDirectionPoints(){let e=this.getPositionCartesian3(),a=uf.Ray.getPoint(new uf.Ray(e,uf.Matrix3.multiplyByVector(uf.Matrix3.fromQuaternion(this.getOrientation(!1)),uf.Cartesian3.UNIT_X,new uf.Cartesian3)),this.properties.far||2e3);return[e,a]}getOrientation(e=!0){let{headingPitchRoll:a}=this.properties,r=this.getPositionCartesian3();return r&&a?uf.Transforms.headingPitchRollQuaternion(r,uf.HeadingPitchRoll.fromDegrees(a.heading-90,a.pitch+(e?-90:0),a.roll)):uf.Quaternion.ZERO}getColor(e=!1){let a=uf.Color.fromCssColorString(this.properties.color||\"#FFFFFF\");return!e&&(a=uf.Color.fromAlpha(a,.2)),a}getColorAttribute(e=!1){return uf.ColorGeometryInstanceAttribute.fromColor(this.getColor(e))}getGeometryOptions(){let e=this.properties.fov;return(!e||e<=0||e>=180)&&(e=60),{frustum:new uf.PerspectiveFrustum(function(e,a,r,t=.1,n=5e8){let i,o;let s=Math.tan(.5*a);if(\"horizontal\"===r)i=a,o=2*Math.atan(s/e);else if(\"vertical\"===r)o=a,i=2*Math.atan(s*e);else{let a=Math.atan(e);i=2*Math.atan(Math.sin(a)*s),o=2*Math.atan(Math.cos(a)*s)}return{fov:e<=1?o:i,aspectRatio:e,near:t,far:n}}(this.properties.aspectRatio||1,uf.Math.toRadians(e),this.properties.fovType||\"horizontal\",.01,this.properties.far||2e3)),origin:this.getPositionCartesian3(),orientation:this.getOrientation()}}onManagerAdd(e){this.addPrimitives(e)}onManagerRemove(e){this.removePrimitives(e)}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}hasPrimitive(e){return this.primitives._keys().some(a=>{let r=this.primitives._get(a);return r.main===e||r.outline===e||r.direction===e})}removePrimitives(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.main&&r.viewer.scene.primitives.remove(a.main),a.outline&&r.viewer.scene.primitives.remove(a.outline),a.direction&&r.viewer.scene.primitives.remove(a.direction)),this.primitives._remove(e)}destroy(){this.primitives._keys().forEach(e=>{this.removePrimitives(e)}),this.removeCollectionMap()}}class h_ extends(0,uX.AF)(ph){managers;constructor(e,a){super(),this.managers=a,this.interactLevel=sc.Area,this.primitives=py({}),this.properties=Object.assign({show:!0,width:.5,cssColor:\"#414141\",clampToGround:!1},e),this.geometryInstances=[],this.init(),this.setCollectionMap(\"grid\")}properties;interactLevel;primitives;geometryInstances;get show(){return this.properties.show}set show(e){this.properties.show=e,this.primitives.showSetter(e)}get name(){return this.properties.name}set name(e){this.properties.name=e}addLineGeometry(e){let a;a=this.properties.clampToGround?new uf.GroundPolylineGeometry({positions:e,width:this.properties.width}):new uf.PolylineGeometry({positions:e,width:this.properties.width,vertexFormat:uf.PolylineMaterialAppearance.VERTEX_FORMAT}),this.geometryInstances.push(new uf.GeometryInstance({geometry:a}))}getPrimitive(){let e=new uf.PolylineMaterialAppearance({material:new uf.Material({fabric:{type:\"Color\",uniforms:{color:uf.Color.fromCssColorString(this.properties.cssColor)}}})});return this.properties.clampToGround?new uf.GroundPolylinePrimitive({geometryInstances:this.geometryInstances,appearance:e}):new uf.Primitive({geometryInstances:this.geometryInstances,appearance:e})}addPrimitive(e){let a=this.managers._get(e);a&&this.primitives._add(e,a.viewer.scene.primitives.add(this.getPrimitive()))}removePrimitive(e){let a=this.managers._get(e),r=this.primitives._get(e);a&&r&&(a.viewer.scene.primitives.remove(r),this.primitives._remove(e))}init(){let e;let{south:a,north:r,west:t,east:n}=this.properties.rectangle,i=this.properties.lineNumber,o=(n-t)/i,s=(r-a)/i;for(let i=t;i<=n;)e=uf.Cartesian3.fromDegreesArray([i,a,i,r]),this.addLineGeometry(e),i+=o;for(let i=a;i<=r;)e=uf.Cartesian3.fromDegreesArray([t,i,n,i]),this.addLineGeometry(e),i+=s;super.init()}update(e){let a=!0;(0,pg.ri)(e.rectangle)&&(this.properties.rectangle=e.rectangle,a=!0),(0,pg.ri)(e.lineNumber)&&(this.properties.lineNumber=e.lineNumber,a=!0),(0,pg.ri)(e.show)&&(this.show=e.show),(0,pg.ri)(e.name)&&(this.name=e.name),(0,pg.ri)(e.width)&&(this.properties.width=e.width,a=!0),(0,pg.ri)(e.lineNumber)&&(this.properties.lineNumber=e.lineNumber,a=!0),(0,pg.ri)(e.cssColor)&&(this.properties.cssColor=e.cssColor,a=!0),a&&(this.primitives._keys().forEach(e=>{this.removePrimitive(e)}),this.geometryInstances=[],this.init())}onManagerAdd(e){this.addPrimitive(e)}onManagerRemove(e){this.removePrimitive(e)}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){this.primitives._keys().forEach(e=>{this.removePrimitive(e)}),this.geometryInstances=[],super.destroy()}}let hb=\"terrain\";class hk extends(0,uX.AF)(ph){managers;constructor(e,a){super(),this.managers=a,this.type=hb,this.terrainProviders=py({}),this._ready=!1,this.readyPromise=new Promise(e=>this.resolveCallback=e),this.properties=Object.assign({},e),this.init(),this.setCollectionMap(hb)}type;properties;terrainProviders;_ready;resolveCallback;readyPromise;get boundingSphere(){let{rectangle:e}=this.properties;if(e){let a=uf.Rectangle.fromDegrees(e.west,e.south,e.east,e.north,new uf.Rectangle);return uf.BoundingSphere.fromPoints([uf.Rectangle.northeast(a),uf.Rectangle.northwest(a),uf.Rectangle.southeast(a),uf.Rectangle.southwest(a)].map(e=>uf.Cartesian3.fromRadians(e.longitude,e.latitude)))}}get ready(){return this._ready}get authToken(){let e=this.properties.authToken;return\"object\"==typeof e&&\"name\"in e&&\"value\"in e?e:null}getRectangle(){return this.properties.rectangle}async changeView(e=\"tilt\",a=f3){if(await this.readyPromise,this.boundingSphere){let r;let t=this.boundingSphere.center,n=this.boundingSphere.radius,i=uf.Cartographic.fromCartesian(t),o=(0,pg.vi)(i);r=\"tilt\"===e?-45:-90;let s=this.managers._get(a),l=this.terrainProviders._get(a),d=await s.computedPositionTerrainHeightOfApi({longitude:o.longitude,latitude:o.latitude});if(!l)return;let c=uf.Cartesian3.fromRadians(i.longitude,i.latitude,d);s.viewer.scene.camera.lookAt(c,new uf.HeadingPitchRange(0,uf.Math.toRadians(r),4*n)),s.viewer.camera.lookAtTransform(uf.Matrix4.IDENTITY),s.render()}}addTerrainProvider(e){let{url:a,show:r}=this.properties;if(this._ready=!1,!a)return;let t={};this.authToken&&(t[this.authToken.name]=this.authToken.value);let n=new uf.Resource({url:a,headers:t});uf.CesiumTerrainProvider.fromUrl(n).then(a=>{if(this.isDestroyed)return;this.terrainProviders._add(e,a),this._ready=!0,this.resolveCallback?.(this);let t=(0,uf.defaultValue)(r,!0),n=this.managers._get(e);n&&t&&a&&n.customTerrainProvider&&n.customTerrainProvider.addCustomTerrain(a)})}removeTerrainProvider(e){let a=this.terrainProviders._get(e),r=this.managers._get(e);r&&a&&r.customTerrainProvider&&(r.customTerrainProvider.removeCustomTerrain(a),this.terrainProviders._remove(e))}updateUrl(e){e&&this.managers._keys().forEach(e=>{this.removeTerrainProvider(e),this.addTerrainProvider(e)})}updateShow(e){e?this.managers._keys().forEach(e=>{let a=this.managers._get(e),r=this.terrainProviders._get(e);a&&r&&a.customTerrainProvider&&a.customTerrainProvider.addCustomTerrain(r)}):this.managers._keys().forEach(e=>{let a=this.managers._get(e),r=this.terrainProviders._get(e);a&&r&&a.customTerrainProvider&&a.customTerrainProvider.removeCustomTerrain(r)})}update(e){let{url:a,show:r,rectangle:t,authToken:n}=e;a&&a!==this.properties.url&&(this.properties.url=a,this.updateUrl(a)),(0,uf.defined)(r)&&r!==this.properties.show&&(this.properties.show=r,this.updateShow(r)),(0,uf.defined)(t)&&(this.properties.rectangle=t),(0,uf.defined)(n)&&(this.properties.authToken=n)}onManagerAdd(e){this.addTerrainProvider(e)}onManagerRemove(e){this.removeTerrainProvider(e)}onManagerUpdate(e){let a=this.terrainProviders._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.managers._keys().forEach(e=>{this.removeTerrainProvider(e)})}}let hv=Object.freeze({UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7}),hz=Object.freeze({START:0,LOADING:1,DONE:2,FAILED:3});function hw(e){if(c2.wG.every(a=>0>e.indexOf(a)))return!1;let a=e.split(\"/\");if(3!==a.length)return!1;let r=Number(a[0]),t=Number(a[1]);return{x:t,y:Number(a[2].split(\".\")[0]),level:r}}class hy extends uf.ImageryLayer{constructor(e,a){super(e.imageryProvider,{}),this._imageryLayer=e,this._imageryProvider=e.imageryProvider,this.tileFiles=a}_imageryLayer;_imageryProvider;tileFiles;ignoreRegionLimitation=!1;_requestImagery(e){let a=this._imageryProvider,r=this._imageryLayer,t=this;function n(a){if(!(0,pg.ri)(a))return i();e.image=a,e.state=hv.RECEIVED,e.request=void 0,uf.TileProviderError.reportSuccess(r._requestImageError)}function i(n){if(e.request.state===uf.RequestState.CANCELLED){e.state=hv.UNLOADED,e.request=void 0;return}e.state=hv.FAILED,e.request=void 0,t.isCurrentImagery(e)&&(r._requestImageError=uf.TileProviderError.reportError(r._requestImageError,a,a.errorEvent,r.getMessage(e),e.x,e.y,e.level,n),r._requestImageError.retry&&o())}function o(){if(!t.isCurrentImagery(e)&&!t.ignoreRegionLimitation){e.request=void 0,e.state=hv.FAILED;return}let r=new uf.Request({throttle:!1,throttleByServer:!0,type:uf.RequestType.IMAGERY});e.request=r,e.state=hv.TRANSITIONING;let o=a.requestImage(e.x,e.y,e.level,r);if(!(0,pg.ri)(o)){e.state=hv.UNLOADED,e.request=void 0;return}(0,pg.ri)(a.getTileCredits)&&(e.credits=a.getTileCredits(e.x,e.y,e.level)),Promise.resolve(o).then(n,i)}o()}getMessage(e){return`Failed to obtain image tile X: ${e.x} Y: ${e.y} Level: ${e.level}.`}isCurrentImagery(e){if(this._imageryProvider,!function(e,a){let r=!1;if(Array.isArray(e))for(let t=0;t<e.length;t++){let n=hw(e[t].name);if(n){let{x:e,y:t,level:i}=n;if(e===a.x&&t===a.y&&i===a.level){r=!0;break}}}else{let t=e[a.level]?.[a.x];if(t)for(let e=0;e<t.length;e++){let{begin_y:n,end_y:i}=t[e];if(n<=a.y&&a.y<=i){r=!0;break}}}return r}(this.tileFiles,e))return this.getMessage(e),!1;return!0}isDestroyed(){return!1}}let hS=\"2dModel\";class hj extends(0,uX.AF)(ph){managers;constructor(e,a){super(),this.managers=a,this.type=hS,this.imageryLayers=py({}),this.customFiles=[],this._terrainShowed=!1,this.properties=Object.assign({},e),this.init(),this.setCollectionMap(hS)}type;properties;imageryLayers;terrain;get ready(){let e=this.imageryLayers._get(f3),a=(0,pg.ri)(e.imageryProvider);return!!(this.terrain&&this.terrain.ready)&&a}get boundingSphere(){let e=this.imageryLayers._get(f3);if(e){let a=uf.Rectangle.equals(e.rectangle,uf.Rectangle.MAX_VALUE)?e.imageryProvider.rectangle:e.rectangle;if(a&&!uf.Rectangle.equals(a,uf.Rectangle.MAX_VALUE))return uf.BoundingSphere.fromPoints([uf.Rectangle.northeast(a),uf.Rectangle.northwest(a),uf.Rectangle.southeast(a),uf.Rectangle.southwest(a)].map(e=>uf.Cartesian3.fromRadians(e.longitude,e.latitude)))}}get authToken(){let e=this.properties.authToken;return\"object\"==typeof e&&\"name\"in e&&\"value\"in e?e:null}get isBaseLayer(){return!!this.properties.isBaseLayer}update(e){let{terrainUrl:a,terrainShow:r,show:t,url:n,files:i,layerIndex:o,splitDirection:s,authToken:l}=e;(0,pg.ri)(a)&&!this.properties.terrainUrl&&(this.properties.terrainUrl=a),(0,pg.ri)(r)&&(this.properties.terrainShow=r),(0,pg.ri)(l)&&(this.properties.authToken=l),(0,pg.ri)(t)&&(this.properties.show=t,this.imageryLayers.showSetter(t)),(0,pg.ri)(s)&&(this.properties.splitDirection=s),(0,pg.ri)(i)&&Array.isArray(i)&&this.updateReconstructionTiles(i),this.updateImageryLayerIndex(o),this.toggleTerrain()}raiseToTop(){this.imageryLayers._keys().forEach(e=>{let a=this.imageryLayers._get(e),r=this.managers._get(e);a&&r&&r.viewer.imageryLayers.raiseToTop(a)})}lowerToBottom(){this.imageryLayers._keys().forEach(e=>{let a=this.imageryLayers._get(e),r=this.managers._get(e);a&&r&&r.viewer.imageryLayers.lowerToBottom(a)})}updateImageryLayerIndex(e){if(!(0,pg.ri)(e))return;let a=e+1;this.imageryLayers._keys().forEach(e=>{let r=this.imageryLayers._get(e),t=this.managers._get(e);if(r&&t){let e=t.viewer.imageryLayers,n=e.indexOf(r);if(a>n){let t=0;for(;t<a-n;)e.raise(r),t++}}})}customFiles;updateReconstructionTiles(e){this.customFiles.push(...e),this.imageryLayers._keys().forEach(e=>{let a=this.imageryLayers._get(e),r=this.managers._get(e)?.viewer;if(a&&r&&\"function\"==typeof a.imageryProvider._reload){var t,n,i,o;t=a,n=r.scene.globe._surface,i=r.terrainProvider,o=this.customFiles,t._imageryCache={},n.forEachLoadedTile(function(e){let a;if(!function(e,a){let r=!1;for(let t=0;t<e.length;t++){let n=hw(e[t].name);if(n){let{x:e,y:t,level:i}=n;if(e===a._x&&function(e,a,r,t){return e.data.imagery.find(e=>{let n=(0,pg.LS)(e.readyImagery,e.loadingImagery);return n.x===a&&n.y===r&&n.level===t})}(a,e,t,i)){r=!0;break}}}return r}(o,e)||(0,pg.ri)(e._loadedCallbacks[t._layerIndex]))return;let r=e.data.imagery,n=r.length,s=-1,l=0;for(a=0;a<n;++a){let e=r[a];if((0,pg.LS)(e.readyImagery,e.loadingImagery).imageryLayer===t)-1===s&&(s=a),++l;else if(-1!==s)break}if(-1===s)return;let d=s+l;t._createTileImagerySkeletons(e,i,d)&&(e._loadedCallbacks[t._layerIndex]=function(e,a,r){return function(t){let n,i,o;let s=-1,l=t.data.imagery,d=l.length;for(o=0;o<d;++o)if(n=l[o],(i=(0,pg.LS)(n.readyImagery,n.loadingImagery)).imageryLayer===a){s=o;break}if(-1!==s){let d=s+e;if(n=l[d],i=(0,pg.ri)(n)?(0,pg.LS)(n.readyImagery,n.loadingImagery):void 0,!(0,pg.ri)(i)||i.imageryLayer!==a)return!a._createTileImagerySkeletons(t,r,d);for(o=s;o<d;++o)l[o].freeResources();l.splice(s,e)}return!0}}(l,t,i),e.state=hz.LOADING)})}}),this.managers.render?.()}getImageryLayer(){let{url:e,minimumLevel:a,maximumLevel:r,show:t,files:n=[],splitDirection:i}=this.properties,o={};this.authToken&&(o[this.authToken.name]=this.authToken.value);let s=new uf.Resource({url:e,headers:o}),l=new uf.ImageryLayer(new uf.UrlTemplateImageryProvider({url:s,rectangle:this.getCesiumRectangle(),minimumLevel:a,maximumLevel:r}),{show:t});return(0,pg.ri)(n)&&(Array.isArray(n)&&(this.customFiles=n),(l=new hy(l,n)).ignoreRegionLimitation=this.isBaseLayer),this.setSplitDirection(l,i),l}setSplitDirection(e,a){if(void 0!==a)switch(a){case\"left\":e.splitDirection=uf.SplitDirection.LEFT;break;case\"right\":e.splitDirection=uf.SplitDirection.RIGHT;break;case\"up\":e.splitDirection=uf.SplitDirection.UP;break;case\"down\":e.splitDirection=uf.SplitDirection.DOWN}}addImageryLayer(e){let{layerIndex:a}=this.properties,r=this.getImageryLayer();this.imageryLayers._add(e,r);let t=this.managers._get(e);if(t){let e=t.viewer.imageryLayers;(0,pg.ri)(a)?e.add(r,a+1):e.add(r,a);let n=e.indexOf(r);t.emit(\"imageryAdded\",n,e.length),t.baseMapProvider.raiseMapMark()}}removeImageryLayer(e){let a=this.imageryLayers._get(e),r=this.managers._get(e);a&&r&&r.viewer.imageryLayers.remove(a),this.imageryLayers._remove(e)}init(){super.init(),this.toggleTerrain()}getCesiumRectangle(e=this.properties.rectangle){if(e)return uf.Rectangle.fromDegrees(e.west,e.south,e.east,e.north)}getRectangle(){return this.properties.rectangle}async changeView(e=\"tilt\",a=f3){if(this.boundingSphere){let r;let t=this.boundingSphere.center,n=this.boundingSphere.radius,i=uf.Cartographic.fromCartesian(t);r=\"tilt\"===e?-45:-90;let o=this.managers._get(a),s=await o.computedPositionTerrainHeight([i]);if(!this.imageryLayers._get(a))return;let l=s[0],d=uf.Cartesian3.fromRadians(i.longitude,i.latitude,l);o.viewer.scene.camera.lookAt(d,new uf.HeadingPitchRange(0,uf.Math.toRadians(r),4*n)),o.viewer.camera.lookAtTransform(uf.Matrix4.IDENTITY),o.render()}}_terrainShowed;toggleTerrain(){this.properties.terrainUrl&&!this.terrain&&(this.terrain=new hk({url:this.properties.terrainUrl,show:this.properties.terrainShow,category:this.category,authToken:this.properties.authToken},this.managers));let e=(0,pg.LS)(this.properties.show,!0)&&(0,pg.LS)(this.properties.terrainShow,!0);e!==this._terrainShowed&&this.terrain&&(this._terrainShowed=e,this.terrain.update({show:e}))}onManagerAdd(e){this.addImageryLayer(e)}onManagerRemove(e){this.removeImageryLayer(e)}onManagerUpdate(e){let a=this.imageryLayers._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){this.managers._keys().forEach(e=>{this.removeImageryLayer(e)}),this.removeCollectionMap(),this.terrain&&this.terrain.destroy()}}class hD extends(0,uX.AF)(pv,ph,mk){managers;constructor(e,a){super(),this.managers=a,this.entities=py({}),this.interactLevel=sc.Thing,this.clampedPositionCartesian3=null,this.cacheViewModes={},this.cachePositions={},this.properties=Object.assign({id:(0,uW.k)()},e),this.init(),this.setCollectionMap(\"label\"),this.preventClickEvent=e.preventClickEvent||!1,this.managers.render?.()}properties;entities;interactLevel;preventClickEvent;get id(){return this.properties.id}get boundingSphere(){let e=this.getPositionCartesian3();if(e)return new uf.BoundingSphere(e,25)}init(){super.init(),this.toggleClamp()}update(e){let a=!1;e.position&&(this.properties.position=e.position,this.clampedPositionCartesian3=null,this.entities.positionSetter(new uf.ConstantPositionProperty(this.getPositionCartesian3())),a=!0,this.cachePositions={}),e.text&&(this.properties.text=e.text,this.entities.label?.textSetter(new uf.ConstantProperty(e.text))),e.pixelOffset&&(this.properties.pixelOffset=e.pixelOffset,this.entities.label?.pixelOffsetSetter(new uf.ConstantProperty(new uf.Cartesian2(...e.pixelOffset)))),e.fillColor&&(this.properties.fillColor=e.fillColor,this.entities.label?.fillColorSetter(new uf.ConstantProperty(uf.Color.fromCssColorString(e.fillColor)))),(0,pg.ri)(e.show)&&(this.properties.show=e.show,this.entities.showSetter(e.show)),e.distanceDisplayCondition&&(this.properties.distanceDisplayCondition=e.distanceDisplayCondition,this.entities.label?.distanceDisplayConditionSetter(new uf.ConstantProperty(new uf.DistanceDisplayCondition(...e.distanceDisplayCondition)))),e.scaleByDistance&&(this.properties.scaleByDistance=e.scaleByDistance,this.entities.label?.scaleByDistanceSetter(new uf.ConstantProperty(new uf.NearFarScalar(...e.scaleByDistance))),this.entities.label?.pixelOffsetScaleByDistanceSetter(new uf.ConstantProperty(new uf.NearFarScalar(...e.scaleByDistance)))),(0,pg.ri)(e.actived)&&(this.properties.actived=e.actived);let r=e.occludedAlpha;(0,pg.ri)(r)&&(this.properties.occludedAlpha=0===r?void 0:r);let t=e.disableDepthTestDistance;(0,pg.ri)(t)&&(this.properties.disableDepthTestDistance=t),(0,pg.ri)(e.enableOccludeIn2dView)&&(this.properties.enableOccludeIn2dView=e.enableOccludeIn2dView),this.updateRuntimeOccludedStyle(),(0,pg.ri)(e.clampToGround)&&this.properties.clampToGround!==e.clampToGround&&(this.properties.clampToGround=e.clampToGround,a=!0),a&&this.toggleClamp()}clampedPositionCartesian3;onPositionClamp(e){e&&(this.clampedPositionCartesian3=e,this.entities.positionSetter(new uf.ConstantPositionProperty(this.getPositionCartesian3())),this.managers.render?.())}getEntityOptions(){let e={id:this.properties.id,show:this.properties.show,position:this.getPositionCartesian3(),label:{text:this.properties.text,disableDepthTestDistance:this.properties.disableDepthTestDistance,fillColor:this.properties.fillColor?uf.Color.fromCssColorString(this.properties.fillColor):void 0,outlineColor:this.properties.outlineColor?uf.Color.fromCssColorString(this.properties.outlineColor):void 0,font:this.properties.font,horizontalOrigin:this.properties.horizontalOrigin?uf.HorizontalOrigin[this.properties.horizontalOrigin]:void 0,verticalOrigin:this.properties.verticalOrigin?uf.VerticalOrigin[this.properties.verticalOrigin]:void 0,style:this.properties.style?uf.LabelStyle[this.properties.style]:void 0,outlineWidth:this.properties.outlineWidth,pixelOffset:this.properties.pixelOffset?new uf.Cartesian2(...this.properties.pixelOffset):void 0,distanceDisplayCondition:this.properties.distanceDisplayCondition?new uf.DistanceDisplayCondition(...this.properties.distanceDisplayCondition):void 0,scale:this.properties.scale||1,showBackground:this.properties.showBackground,backgroundColor:this.properties.backgroundColor?uf.Color.fromCssColorString(this.properties.backgroundColor):void 0,backgroundPadding:this.properties.backgroundPadding?new uf.Cartesian2(...this.properties.backgroundPadding):void 0,scaleByDistance:this.properties.scaleByDistance?new uf.NearFarScalar(...this.properties.scaleByDistance):void 0,depthFailTranslucency:this.properties.occludedAlpha,pixelOffsetScaleByDistance:this.properties.scaleByDistance?new uf.NearFarScalar(...this.properties.scaleByDistance):void 0}};return pS()&&e.label&&(e.label.showBackground=!0,e.label.backgroundPadding=new uf.Cartesian2(0,0)),e}getPositionCartesian3(){if(this.properties.position)return this.clampedPositionCartesian3||(0,pg.jL)(this.properties.position)}setCollectionMap(e){this.managers._options.elements.add(e,this,[this.id])}cacheViewModes;cachePositions;onSceneChange(e){let{is3D:a,id:r}=e;if(a&&\"3D\"===this.cacheViewModes[r]||!a&&\"2D\"===this.cacheViewModes[r])return;if(this.cacheViewModes[r]=a?\"3D\":\"2D\",this.updateRealtimeClamping(e),!this.properties.actived)this.updateRuntimeOccludedStyle([e.id])}updateRealtimeClamping(e){if(this.clampToGround)return;let{is3D:a,id:r}=e,t=this.cachePositions[r];if(!t&&(t=this.cachePositions[r]=uf.Cartesian3.ONE.clone()),a){if(!uf.Cartesian3.equalsEpsilon(t,uf.Cartesian3.ONE)){let e=new uf.ConstantPositionProperty(t);this.entities.positionSetter(e)}}else if(this.position){this.cachePositions[r]=(0,pg.jL)(this.position);let e=new uf.ConstantPositionProperty(uf.Cartesian3.fromDegrees(this.position.longitude,this.position.latitude,0));this.entities.positionSetter(e)}}updateRuntimeOccludedStyle(e){let a=!!this.properties.actived,r=!!this.properties.enableOccludeIn2dView;(!Array.isArray(e)||0===e.length)&&(e=Object.keys(this.cacheViewModes)),e.forEach(e=>{let t=this.cacheViewModes[e];if(void 0===t)return;let{occludedAlpha:n,disableDepthTestDistance:i}=mb(t,a,r,this.properties.occludedAlpha,this.properties.disableDepthTestDistance),o=this.entities._get(e)?.label;if(!!o)o.depthFailTranslucency=new uf.ConstantProperty(n),o.disableDepthTestDistance=new uf.ConstantProperty(i)})}onManagerAdd(e){let a=this.managers._get(e);a&&this.entities._add(e,a.viewer.entities.add(this.getEntityOptions()))}onManagerRemove(e){let a=this.entities._get(e);a?.entityCollection.remove(a),this.entities._remove(e)}onManagerUpdate(e){let a=this.entities._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.removeClampWatcher(),this.entities._keys().forEach(e=>{let a=this.entities._get(e);a&&a.entityCollection.remove(a),this.entities._remove(e)}),this.cachePositions={}}}let hI={default:\"#FFFFFF\",changing:\"#FFF000\"};function hA(e=\"default\",a=!1,r,t=!1){let n=hI[e];return(a?n=`${n}66`:t&&(n=`${n}cc`),t&&!a)?new uf.ColorMaterialProperty(uf.Color.fromCssColorString(r||n)):new uf.PolylineDashMaterialProperty({color:uf.Color.fromCssColorString(r||n),dashLength:8})}class hC extends(0,uX.AF)(pv,pf,p_,ph){managers;constructor(e,a,r){super(),this.managers=a,this.entities=py({}),this.interactLevel=sc.Line,this.dynamicGroundPicking=!1,this.cacheViewModes={},this.properties=Object.assign({id:(0,uW.k)(),solid:!0,show:!0},e),this.options=Object.assign({},r),this.calculatePositionInCesium(),this.init(),this.setCollectionMap(),this.managers.render?.()}properties;options;entities;interactLevel;get id(){return this.properties.id}get firstEntity(){return this.entities._values()[0]}get changing(){return this.options.changing||!!this.properties.dynamicPosition}get position(){return this.properties.position}set position(e){if(this.changing)return;let a=this.properties.position,r=!a||!e||!uf.Math.equalsEpsilon(a.longitude,e.longitude,uf.Math.EPSILON9)||!uf.Math.equalsEpsilon(a.latitude,e.latitude,uf.Math.EPSILON9);(r||a.height!==e.height)&&(this.properties.position=e,this.calculatePositionInCesium(r),this.entities.positionSetter(new uf.ConstantPositionProperty(this.groundPositionCartesian3)),this.entities.polyline?.positionsSetter(new uf.ConstantProperty(this.getLinePositions())),this.onUpdatePolylinePositions(),this.watchGlobe(),this.managers.render?.())}update(e){(0,pg.ri)(e.position)&&(this.position=e.position),e.draggable&&(this.properties.draggable=e.draggable),(0,pg.ri)(e.hoverCursor)&&(this.properties.hoverCursor=e.hoverCursor),(0,pg.ri)(e.removable)&&(this.properties.removable=e.removable),e.distanceDisplayCondition&&(this.properties.distanceDisplayCondition=e.distanceDisplayCondition,this.entities.point?.distanceDisplayConditionSetter(0===e.distanceDisplayCondition.length?void 0:new uf.ConstantProperty(new uf.DistanceDisplayCondition(...e.distanceDisplayCondition))),this.entities.polyline?.distanceDisplayConditionSetter(0===e.distanceDisplayCondition.length?void 0:new uf.ConstantProperty(new uf.DistanceDisplayCondition(...e.distanceDisplayCondition)))),(0,pg.ri)(e.show)&&(this.properties.show=e.show,this.entities.showSetter(e.show))}getEntityOptions(e){let a=this.properties.distanceDisplayCondition,r=a&&a.length?new uf.ConstantProperty(new uf.DistanceDisplayCondition(...a)):pA;return{id:this.properties.id,position:this.groundPositionCartesian3,parent:this.options.parent?._get(e),point:{pixelSize:7,depthFailTranslucency:.4,distanceDisplayCondition:r},polyline:{positions:this.getLinePositions(),material:hA(\"default\",!1,this.properties.cssColor,this.properties.solid),depthFailMaterial:hA(\"default\",!0,this.properties.cssColor,this.properties.solid),distanceDisplayCondition:r}}}init(){super.init(),this.onUpdatePolylinePositions(),this.watchGlobe()}stabilize(e){this.options.changing&&(this.options.changing=!1);let a=e||this.options.positionCallback?.();this.options.positionCallback=void 0,this.options.groundPositionCallback=void 0,a&&(this.position=(0,pg.KO)(a,!0)),this.setColor()}dynamize(e){this.options=Object.assign(this.options,e),this.setColor(),this.setChangingCallback()}dynamicGroundPosition;dynamicGroundCarto;dynamicGroundPicking;setDynamicGround(e,a,r){if(!this.dynamicPosition)return;let t=new uf.Cartographic(e||this.dynamicGroundCarto?.longitude||0,a||this.dynamicGroundCarto?.latitude||0,r||this.dynamicGroundCarto?.height||0);this.dynamicGroundCarto=t,this.dynamicGroundPosition=uf.Cartographic.toCartesian(this.dynamicGroundCarto),this.dynamicPositionCartesian3&&this.onUpdatePolylinePositions([this.dynamicGroundPosition,this.dynamicPositionCartesian3])}stabilizePosition(){if(this.dynamicPosition){let e=this.dynamicPosition;this.properties.dynamicPosition=void 0,this.position=e,this.setColor()}}dynamizePosition(e){!this.dynamicPosition&&(this.entities.polyline?.positionsSetter(new uf.CallbackProperty(()=>[this.dynamicGroundPosition,this.dynamicPositionCartesian3],!1)),this.entities.positionSetter(new uf.CallbackProperty(()=>this.dynamicGroundPosition,!1))),super.dynamizePosition(e,!1),this.dynamicPositionCartesian3&&this.clampDynamicGroundPosition(this.dynamicPositionCartesian3),this.setColor()}async clampDynamicGroundPosition(e){let a=this.managers._get(f3),r=uf.Cartographic.fromCartesian(e),t=!1;if(this.dynamicGroundCarto&&uf.Math.equalsEpsilon(r.longitude,this.dynamicGroundCarto.longitude,uf.Math.EPSILON7)&&uf.Math.equalsEpsilon(r.latitude,this.dynamicGroundCarto.latitude,uf.Math.EPSILON7)&&(t=!0),this.setDynamicGround(r.longitude,r.latitude),t||this.dynamicGroundPicking)return;this.dynamicGroundPicking=!0;let n=await a.picker.sampleHeightAsync(r)||0;this.dynamicGroundPicking=!1,this.setDynamicGround(void 0,void 0,n)}afterManagerAdd(e){if(this.dynamicPosition){let a=this.entities._get(e);a&&(a.polyline&&(a.polyline.positions=new uf.CallbackProperty(()=>[this.dynamicGroundPosition,this.dynamicPositionCartesian3],!1)),a.position=new uf.CallbackProperty(()=>this.dynamicGroundPosition,!1))}}setColor(){let e=this.changing?\"changing\":\"default\";this.entities.point?.colorSetter(uf.Color.fromCssColorString(this.properties.cssColor||hI[e])),this.entities.polyline?.materialSetter(hA(e,!1,this.properties.cssColor,this.properties.solid)),this.entities.polyline?.depthFailMaterialSetter(hA(e,!0,this.properties.cssColor,this.properties.solid))}setChangingCallback(){this.options.groundPositionCallback&&this.entities.positionSetter(new uf.CallbackProperty(this.options.groundPositionCallback,!1)),this.options.positionCallback&&this.entities.polyline?.positionsSetter(new uf.CallbackProperty(()=>{let e=this.options.positionCallback?.(),a=this.options.groundPositionCallback?.()||this.groundPositionCartesian3;return e&&a?[e,a]:[]},!1))}positionCartesian3;groundPositionCartesian3;positionCartographic;calculatePositionInCesium(e=!0){this.properties.position?(this.positionCartesian3=(0,pg.jL)(this.properties.position),this.positionCartographic=(0,pg.i9)(this.properties.position),e&&(this.groundPositionCartesian3=uf.Cartesian3.fromRadians(this.positionCartographic.longitude,this.positionCartographic.latitude))):(this.positionCartesian3=void 0,this.positionCartographic=void 0)}globeWatcher;watchGlobe(){let e=this.positionCartographic;e&&(this.globeWatcher?this.globeWatcher.update(e):this.globeWatcher=this.managers._get(f3)?.picker.clampWithWatcher(e,e=>this.updateGround(e)))}unwatchGlobe(){this.globeWatcher&&(this.globeWatcher.unclamp(),this.globeWatcher=void 0)}getLinePositions(){if(this.positionCartesian3&&this.groundPositionCartesian3)return[this.groundPositionCartesian3,this.positionCartesian3]}onUpdatePolylinePositions(e=this.getLinePositions()){e&&this.properties.onLinePositionsChange?.([pg.KO(e[0],!0),pg.KO(e[1],!0)])}updateGround(e){e&&!this.changing&&this.entities.polyline&&(uf.Cartesian3.clone(e,this.groundPositionCartesian3),this.entities.polyline.positionsSetter(new uf.ConstantProperty(this.getLinePositions())),this.entities.positionSetter(new uf.ConstantPositionProperty(this.groundPositionCartesian3)),this.onUpdatePolylinePositions())}getParentElement(){if(this.options.parent)return this.managers._options.elements.getWithId(this.options.parent._values()[0]?.id)}setCollectionMap(){this.managers._options.elements.add(\"locating-line\",this.getParentElement()||this,[this.id])}removeCollectionMap(){!this.getParentElement()&&this.managers._options.elements.delete(this)}startDrag(e,a,r){let t=this.managers._get(f3),n=\"horizontal\"===a&&!!this.properties.draggable?.horizontal;if(n&&this.positionCartesian3&&(this.properties.onDragStart?.(\"horizontal\"),r?.primitive)){if(r.primitive instanceof uf.PointPrimitive)return{position:this.positionCartesian3,clampToGround:!0};{let a=me(this.positionCartesian3,t.viewer),r=t.viewer.scene.camera.getPickRay(e.position);if(r){let e=uf.IntersectionTests.rayPlane(r,a);if(e)return{position:e,clampToGround:!1}}}}return n}cacheViewModes;onSceneChange(e){if(!1===this.properties.show)return;let{is3D:a,id:r}=e;if(a&&\"3D\"===this.cacheViewModes[r]||!a&&\"2D\"===this.cacheViewModes[r])return;this.cacheViewModes[r]=a?\"3D\":\"2D\";let t=this.entities._get(r);t&&(t.show=a&&!!this.properties.show)}onManagerAdd(e){let a=this.managers._get(e);if(a){let r=this.options.parent?._get(e)?.entityCollection||a.viewer.entities;this.entities._add(e,r.add(this.getEntityOptions(e))),this.afterManagerAdd(e)}this.setColor(),this.setChangingCallback()}onManagerRemove(e){let a=this.entities._get(e);a?.entityCollection.remove(a),this.entities._remove(e)}onManagerUpdate(e){let a=this.entities._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.entities._keys().forEach(e=>{let a=this.entities._get(e);a&&a.entityCollection.remove(a),this.entities._remove(e)}),this.unwatchGlobe()}}class hx extends(0,uX.AF)(pv,pf,p_,ph){managers;constructor(e,a){super(),this.managers=a,this.entities=py({}),this.interactLevel=sc.Thing,this.properties=Object.assign({id:(0,uW.k)()},e),this.init(),this.setCollectionMap(\"model\"),this.managers.render?.()}properties;entities;interactLevel;get id(){return this.properties.id}get boundingSphere(){let e=this.getPositionCartesian3();if(e)return new uf.BoundingSphere(e,100)}update(e){(0,pg.ri)(e.modelURI)&&(this.properties.modelURI=e.modelURI,this.entities.model?.uriSetter(new uf.ConstantProperty(e.modelURI))),(0,pg.ri)(e.position)&&(this.properties.position=e.position,this.entities.positionSetter(new uf.ConstantPositionProperty(this.getPositionCartesian3()))),(0,pg.ri)(e.show)&&(this.properties.show=e.show,this.entities.showSetter(e.show)),(0,pg.ri)(e.headingPitchRoll)&&(this.properties.headingPitchRoll=e.headingPitchRoll,this.entities.orientationSetter(new uf.ConstantProperty(this.getOrientation()))),(0,pg.ri)(e.outlineCssColor)&&(this.properties.outlineCssColor=e.outlineCssColor,this.entities.model?.silhouetteColorSetter(new uf.ConstantProperty(this.getSilhouetteColor()))),(0,pg.ri)(e.outlineWidth)&&(this.properties.outlineWidth=e.outlineWidth,this.entities.model?.silhouetteSizeSetter(new uf.ConstantProperty(e.outlineWidth))),(0,pg.ri)(e.minimumPixelSize)&&(this.properties.minimumPixelSize=e.minimumPixelSize,this.entities.model?.minimumPixelSizeSetter(new uf.ConstantProperty(e.minimumPixelSize))),e.draggable&&(this.properties.draggable=e.draggable);let a=!1;e.cssColor&&(this.properties.cssColor=e.cssColor,a=!0),(0,pg.ri)(e.hoverCursor)&&(this.properties.hoverCursor=e.hoverCursor),(0,pg.ri)(e.contextmenu)&&(this.properties.contextmenu=e.contextmenu),e.lightIntensity&&(this.properties.lightIntensity=e.lightIntensity,a=!0),a&&this.entities.model?.colorSetter(new uf.ConstantProperty(this.getColor())),(0,pg.ri)(e.removable)&&(this.properties.removable=e.removable)}getEntityOptions(){return{id:this.properties.id,show:this.properties.show,position:this.getPositionCartesian3(),orientation:new uf.ConstantProperty(this.getOrientation()),model:{uri:this.properties.modelURI,scale:this.properties.scale,colorBlendMode:this.properties.colorBlendMode,minimumPixelSize:this.properties.minimumPixelSize,maximumScale:this.properties.maximumScale,silhouetteSize:this.properties.outlineWidth,silhouetteColor:this.getSilhouetteColor(),color:this.getColor()}}}getColor(){if(this.properties.cssColor){let e=uf.Color.fromCssColorString(this.properties.cssColor);return(0,pg.ri)(this.properties.lightIntensity)&&(e.red*=this.properties.lightIntensity,e.green*=this.properties.lightIntensity,e.blue*=this.properties.lightIntensity),e}}getSilhouetteColor(){if(this.properties.outlineCssColor)return uf.Color.fromCssColorString(this.properties.outlineCssColor)}getPositionCartesian3(){if(this.properties.position)return(0,pg.jL)(this.properties.position)}getOrientation(){let{headingPitchRoll:e}=this.properties,a=this.getPositionCartesian3();if(a&&e){let r=uf.Math.toRadians(e.heading),t=uf.Math.toRadians(e.pitch),n=uf.Math.toRadians(e.roll),i=new uf.HeadingPitchRoll(r,t,n);return uf.Transforms.headingPitchRollQuaternion(a,i)}}setCollectionMap(e){this.managers._options.elements.add(e,this,[this.id])}startDrag(e,a){let r=super.startDrag(e,a),t=this.getPositionCartesian3();return r&&t?{position:t}:r}dynamicDrag(e){this.entities.positionSetter(new uf.CallbackProperty(e,!1))}endDrag(){super.endDrag();let e=this.entities._values()[0];this.entities.positionSetter(new uf.ConstantPositionProperty(e?.position?.getValue(new uf.JulianDate)))}onManagerAdd(e){let a=this.managers._get(e);a&&(this.entities._add(e,a.viewer.entities.add(this.getEntityOptions())),this.afterManagerAdd(e))}onManagerRemove(e){let a=this.entities._get(e);a?.entityCollection.remove(a),this.entities._remove(e)}onManagerUpdate(e){let a=this.entities._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.entities._keys().forEach(e=>{let a=this.entities._get(e);a&&a.entityCollection.remove(a),this.entities._remove(e)})}}class hM extends(0,uX.AF)(pv,pf,ph,pz){managers;options;constructor(e,a,r){super(),this.managers=a,this.options=r,this.primitives=py({}),this.interactLevel=sc.Thing,this.addingModel={},this.isDestroyed=!1,this.properties=Object.assign({id:(0,uW.k)(),show:!0},e),this.init(),this.setCollectionMap(\"model-next\"),this.managers.render?.()}properties;primitives;interactLevel;get id(){return this.properties.id}get boundingSphere(){let e=this.getPositionCartesian3();if(e)return new uf.BoundingSphere(e,100)}render(){this.primitives._keys().forEach(e=>{this.updatePrimitive(e)})}update(e){let a=!1;Object.keys(e).forEach(r=>{let t=e[r];(0,pg.ri)(t)&&(this.properties[r]=t),(\"modelURI\"===r||\"displayOnTop\"===r||\"show\"===r)&&(a=!0)}),!a&&(a=!0,this.primitives._keys().forEach(e=>{this.updateModel(e)&&(a=!1)})),a&&this.render()}getColor(){if(this.properties.cssColor){let e=uf.Color.fromCssColorString(this.properties.cssColor);return(0,pg.ri)(this.properties.lightIntensity)&&(e.red*=this.properties.lightIntensity,e.green*=this.properties.lightIntensity,e.blue*=this.properties.lightIntensity),e}}getSilhouetteColor(){if(this.properties.outlineCssColor)return uf.Color.fromCssColorString(this.properties.outlineCssColor)}getPositionCartesian3(){if(this.properties.position)return(0,pg.jL)(this.properties.position)}setCollectionMap(e){this.managers._options.elements.add(e,this.options?.parent||this,[this.id])}removeCollectionMap(){!this.options?.parent&&super.removeCollectionMap()}addPrimitives(e){!this.primitives._get(e)&&this.primitives._add(e,{}),this.updatePrimitive(e)}getHeadingPitchRoll(){let e=this.properties.headingPitchRoll;if(e){let a=uf.Math.toRadians(e.heading),r=uf.Math.toRadians(e.pitch),t=uf.Math.toRadians(e.roll);return new uf.HeadingPitchRoll(a,r,t)}}updateModel(e){let a=this.primitives._get(e);if(!a.main)return!1;(0,pg.ri)(this.properties.scale)&&(a.main.scale=this.properties.scale),(0,pg.ri)(this.properties.colorBlendMode)&&(a.main.colorBlendMode=this.properties.colorBlendMode),(0,pg.ri)(this.properties.minimumPixelSize)&&(a.main.minimumPixelSize=this.properties.minimumPixelSize),(0,pg.ri)(this.properties.maximumScale)&&(a.main.maximumScale=this.properties.maximumScale),(0,pg.ri)(this.properties.outlineWidth)&&(a.main.silhouetteSize=this.properties.outlineWidth);let r=this.getSilhouetteColor();(0,pg.ri)(r)&&(a.main.silhouetteColor=r);let t=this.getColor();(0,pg.ri)(t)&&(a.main.color=t);let n=this.getPositionCartesian3(),i=this.getHeadingPitchRoll();return n&&i&&(a.main.modelMatrix=uf.Transforms.headingPitchRollToFixedFrame(n,i)),!0}addingModel;async updatePrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e),t=this.id;if(r&&a&&(a.main&&r.viewer.scene.primitives.remove(a.main),a.main=void 0,this.properties.show)){let n=this.getPositionCartesian3(),i=this.getHeadingPitchRoll();if(!n||!i)return;let o=uf.Transforms.headingPitchRollToFixedFrame(n,i),s=(0,uW.k)();this.addingModel[e]=s;let l=await uf.Model.fromGltfAsync({url:this.properties.modelURI||\"\",scale:this.properties.scale,colorBlendMode:this.properties.colorBlendMode,minimumPixelSize:this.properties.minimumPixelSize,maximumScale:this.properties.maximumScale,silhouetteSize:this.properties.outlineWidth,silhouetteColor:this.getSilhouetteColor(),color:this.getColor(),modelMatrix:o,opaquePass:this.properties.displayOnTop?uf.Pass.OVERLAY:uf.Pass.OPAQUE,id:t});if(this.addingModel[e]!==s||!this.isShowIn(e)||this.isDestroyed){l.destroy();return}a.main=r.viewer.scene.primitives.add(l)}}onManagerAdd(e){this.addPrimitives(e)}removePrimitives(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&a.main&&r.viewer.scene.primitives.remove(a.main),this.primitives._remove(e)}onManagerRemove(e){this.removePrimitives(e)}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}hasPrimitive(e){return this.primitives._keys().some(a=>this.primitives._get(a).main===e)}isDestroyed;destroy(){this.isDestroyed=!0,this.primitives._keys().forEach(e=>{this.removePrimitives(e)}),this.removeCollectionMap()}}let hE=\"data:image/png;base64,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\",hP=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTkycHgiIGhlaWdodD0iMTkycHgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDx0aXRsZT4y5Zu+5qCHLzQ4cHgvcGluMTwvdGl0bGU+CiAgICA8ZyBpZD0iMuWbvuaghy80OHB4L3BpbjEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtMuWkh+S7vS00IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNC4wMDAwMDAsIDguMDAwMDAwKSIgZmlsbD0iI0ZGRkZGRiIgZmlsbC1ydWxlPSJub256ZXJvIj4KICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4ODQ5NjEsMS45NzcxNjI0ZS0xNCBMMjAuMTc2OTkyMiwxMy44NDAyMjcxIEwxMS40Nzk2NTIyLDI1Ljc3MTEzMDQgTDExLjQ3OTgwMDUsMjkuNjE2OTc1NyBMOC42OTcxOTE3OCwyOS42MTY5NzU3IEw4LjY5NzA0MzQ4LDI1Ljc3MTEzMDQgTC0xLjM1OTI5OTE1ZS0xNCwxMy44NDAyMjcxIEwxMC4wODg0OTYxLDEuOTc3MTYyNGUtMTQgWiBNMTAuMDg4MzA2NCw0LjcyMzcwNTM3IEwzLjQ0MzQzNjg0LDEzLjg0MDIyNzEgTDEwLjA4ODMwNjQsMjIuOTU2MDUzMiBMMTYuNzMzMTc2LDEzLjg0MDIyNzEgTDEwLjA4ODMwNjQsNC43MjM3MDUzNyBaIiBpZD0i5b2i54q2Ij48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4K\",hT=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTkycHgiIGhlaWdodD0iMTkycHgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDx0aXRsZT4y5Zu+5qCHLzQ4cHgvcGluMTwvdGl0bGU+CiAgICA8ZGVmcz4KICAgICAgICA8ZmlsdGVyIHg9IjAuMCUiIHk9IjAuMCUiIHdpZHRoPSIxMDAuMCUiIGhlaWdodD0iMTAwLjAlIiBmaWx0ZXJVbml0cz0ib2JqZWN0Qm91bmRpbmdCb3giIGlkPSJmaWx0ZXItMSI+CiAgICAgICAgICAgIDxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjAiIGluPSJTb3VyY2VHcmFwaGljIj48L2ZlR2F1c3NpYW5CbHVyPgogICAgICAgIDwvZmlsdGVyPgogICAgPC9kZWZzPgogICAgPGcgaWQ9IjLlm77moIcvNDhweC9waW4xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0i57yW57uELTLlpIfku70tNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTQuMDAwMDAwLCA4LjAwMDAwMCkiPgogICAgICAgICAgICA8ZWxsaXBzZSBpZD0i5qSt5ZyG5b2iIiBmaWxsLW9wYWNpdHk9IjAuMyIgZmlsbD0iIzAwMDAwMCIgZmlsdGVyPSJ1cmwoI2ZpbHRlci0xKSIgY3g9IjEwLjA2MTkzNDkiIGN5PSIyOS40OTI0MDEiIHJ4PSIzLjQ3MDY3MTk0IiByeT0iMi4wODY5NTY1MiI+PC9lbGxpcHNlPgogICAgICAgICAgICA8cGF0aCBkPSJNMTAuMDg4NDk2MSwtMC40MjQ0MTU4MDkgTDIwLjQ4NjM2MzUsMTMuODQwMjMyMiBMMTEuNzI5NjU1MywyNS44NTI1NzU5IEwxMS43Mjk4MTAxLDI5Ljg2Njk3NTcgTDguNDQ3MjAxNDIsMjkuODY2OTc1NyBMOC40NDcwNDY2MiwyNS44NTI1ODIzIEwtMC4zMDkzNjk0MjIsMTMuODQwMjI5NyBMMTAuMDg4NDk2MSwtMC40MjQ0MTU4MDkgWiBNMTAuMDg4MzA2NCw1LjE0ODEzNzcyIEwzLjc1MjgwMjA4LDEzLjg0MDIyMTUgTDEwLjA4ODMwNjQsMjIuNTMxNjQyIEwxNi40MjM4MTA3LDEzLjg0MDIyMTUgTDEwLjA4ODMwNjQsNS4xNDgxMzc3MiBaIiBpZD0i5b2i54q2IiBzdHJva2Utb3BhY2l0eT0iMC40OTU5ODQ0ODQiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIwLjUiIGZpbGwtcnVsZT0ibm9uemVybyI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+Cg==\",hR=new Set([\"Right\",\"Top\",\"Left\",\"Bottom\"]),hF=()=>hR.values();function hL(e){return e.placeable&&!0===e.placeable}let hN=1,hJ={Right:[16,-16],Left:[-16,-16],Bottom:[0,10],Top:[0,-36],UnSet:[0,0],Center:[0,0]},hO={distanceDisplayCondition:pA,verticalOrigin:uf.VerticalOrigin.BOTTOM,width:48,height:48,pixelOffset:new uf.Cartesian2(0,10*hN)},hq={width:24,height:24,pixelOffset:new uf.Cartesian2(0,-9*hN)};class hG extends(0,uX.AF)(pv,ph,pz){managers;constructor(e,a){super(),this.managers=a,this.interactLevel=sc.Thing,this.billboards=py({}),this.label=py({}),this.propertyBag={color:void 0},this.activeState={selected:!1,recenter:!1,hover:!1},this.runtimeState={visible:{label:!0,billboard:!0,bgBillboard:!0,shadowBillboard:!0,all:!0}},this.clampWatcher=null,this.dynamic=!1,this.positionCartesian3=void 0,this.cacheViewModes={},this.cacheScreenSpaceBoundingBox={},this.cacheLabelingWindowPosition={},this.labelingPlacements={},this.labelingPlacementIters={},this.properties=Object.assign({id:(0,uW.k)(),type:\"pin\",fontSize:16},e),this.init(),this.managers.render?.()}properties;interactLevel;billboards;label;auxiliary;propertyBag;setPosition(e){e&&(this.billboards.main?.positionSetter(e),this.billboards.background?.positionSetter(e),this.billboards.activeShadow?.positionSetter(e),this.label.positionSetter(e))}setDefaultPinColor(e){this.propertyBag.color=e;let a=e?.getValue(uf.JulianDate.now());this.billboards.main?.colorSetter(a),this.active()&&this.label.fillColorSetter(a),this.billboards.activeShadow?.colorSetter(a)}setCustomPinColor(e){this.propertyBag.color=e;let a=e?.getValue(uf.JulianDate.now());this.active()&&this.label.fillColorSetter(a),this.billboards.background?.colorSetter(a)}setColorProperty(e){this.properties.customImage?this.setCustomPinColor(e):this.setDefaultPinColor(e)}get id(){return this.properties.id}get type(){return\"pin\"}get typedElement(){return{type:this.type,element:this}}getId(e=\"main\"){let a=this.properties.id;switch(e){case\"main\":return a;case\"background\":return`${a}-background`;case\"activeShadow\":return`${a}-activeShadow`;case\"customHover\":return`${a}-customHover`}}get name(){return this.properties.name}set name(e){this.properties.name=e,this.label.textSetter(e||\"\"),this.managers.render?.()}get clampToGround(){return this.properties.clampToGround}set clampToGround(e){this.properties.clampToGround!==e&&(this.properties.clampToGround=e,!this.dynamic&&(this.toggleAuxiliary(),this.clampToGround?this.toggleClampWithoutHeight():this.removeWatcher(),this.managers.render?.()))}get boundingSphere(){let e=this.getPositionCartesian3();if(e)return new uf.BoundingSphere(e,100)}get cssColor(){return this.properties.cssColor||\"#FFFFFF\"}set cssColor(e){this.properties.cssColor!==e&&(this.properties.cssColor=e,this.setColorProperty(new uf.ConstantProperty(this.getColor())),this.managers.render?.())}get position(){return this.properties.position}set position(e){let a=this.properties.position;(!a||!e||a.longitude!==e.longitude||a.latitude!==e.latitude||a.height!==e.height&&!this.clampToGround)&&(this.properties.position=e,this.setPosition(this.getPositionCartesian3()),this.auxiliary&&!this.dynamic&&(this.auxiliary.position=e),this.clampToGround&&this.toggleClampWithoutHeight(),this.managers.render?.())}activeState;runtimeState;get fontSize(){return this.properties.fontSize||16}set fontSize(e){this.properties.fontSize=e,this.label.fontSetter(this.getFont())}getFont(){return`600 ${this.fontSize}px ${pC}`}active(e=\"\",a){if((0,pg.ri)(a)&&e&&this.activeState[e]!==a&&(this.activeState[e]=a,this.toggleActive()),e)return this.activeState[e];{let{selected:e,recenter:a,hover:r}=this.activeState;return e||a||r}}toggleCustomImage(){this.properties.customImage?(this.billboards.main?.imageSetter(this.properties.customImage),this.billboards.main?.widthSetter(hq.width),this.billboards.main?.heightSetter(hq.height),this.billboards.main?.pixelOffsetSetter(hq.pixelOffset),this.billboards.main?.colorSetter(uf.Color.fromCssColorString(\"#ffffff\"))):(this.billboards.main?.imageSetter(hP),this.billboards.main?.widthSetter(hO.width),this.billboards.main?.heightSetter(hO.height),this.billboards.main?.pixelOffsetSetter(hO.pixelOffset),this.billboards.main?.colorSetter(uf.Color.fromCssColorString(this.properties.cssColor||\"#ffffff\"))),this.toggleActive()}update(e){if((0,pg.ri)(e.name)&&(this.name=e.name),(0,pg.ri)(e.customImage)&&this.properties.customImage!==e.customImage&&(this.properties.customImage=e.customImage,this.toggleCustomImage()),(0,pg.ri)(e.cssColor)&&(this.cssColor=e.cssColor),(0,pg.ri)(e.clampToGround)&&(this.clampToGround=e.clampToGround),(0,pg.ri)(e.position)&&(this.position=e.position),(0,pg.ri)(e.show)&&(this.properties.show=e.show,this.billboards.main?.showSetter(e.show),this.billboards.background?.showSetter(e.show),this.toggleActive(),this.label.showSetter(e.show),this.auxiliary?.update({show:e.show})),(0,pg.ri)(e.fontSize)&&(this.fontSize=e.fontSize),(0,pg.ri)(e.contextmenu)&&(this.properties.contextmenu=e.contextmenu),(0,pg.ri)(e.removable)&&(this.properties.removable=e.removable),(0,pg.ri)(e.hoverCursor)&&(this.properties.hoverCursor=e.hoverCursor),(0,pg.ri)(e.placeable)&&(this.properties.placeable=e.placeable),e.distanceDisplayCondition){let a=new uf.DistanceDisplayCondition(...e.distanceDisplayCondition);this.properties.distanceDisplayCondition=e.distanceDisplayCondition,this.label.distanceDisplayConditionSetter(a),this.billboards.main?.distanceDisplayConditionSetter(a),this.billboards.background?.distanceDisplayConditionSetter(a),this.billboards.activeShadow?.distanceDisplayConditionSetter(a)}if(e.scaleByDistance){let a=new uf.NearFarScalar(...e.scaleByDistance);this.properties.scaleByDistance=e.scaleByDistance,this.label.scaleByDistanceSetter(a),this.billboards.main?.scaleByDistanceSetter(a),this.billboards.background?.scaleByDistanceSetter(a),this.label.pixelOffsetScaleByDistanceSetter(a),this.billboards.main?.pixelOffsetScaleByDistanceSetter(a),this.billboards.background?.pixelOffsetScaleByDistanceSetter(a),this.billboards.activeShadow?.scaleByDistanceSetter(a)}let a=e.occludedAlpha;(0,pg.ri)(a)&&(this.properties.occludedAlpha=0===a?void 0:a),(0,pg.ri)(e.enableOccludeIn2dView)&&(this.properties.enableOccludeIn2dView=e.enableOccludeIn2dView),this.updateRuntimeOccludedStyle()}edit(e){this.managers._get(f3)?.editor?.enterEdit?.(\"pin\",this,e)}getEntityOptions(){let e=this.properties.distanceDisplayCondition?new uf.DistanceDisplayCondition(...this.properties.distanceDisplayCondition):void 0,a=this.properties.scaleByDistance?new uf.NearFarScalar(...this.properties.scaleByDistance):void 0,r=this.getPositionCartesian3(),t={id:this.getId(),show:this.properties.show,position:r,...hO,image:hP,color:this.propertyBag.color?.getValue(uf.JulianDate.now()),depthFailTranslucency:this.properties.occludedAlpha,distanceDisplayCondition:e,scaleByDistance:a,pixelOffsetScaleByDistance:a};this.properties.customImage&&(t={...t,image:this.properties.customImage,color:void 0,...hq});let n=this.getFont();return{billboardOptions:t,labelOptions:{id:`${this.getId()}-label`,show:this.properties.show,position:r,...px,font:n,text:this.properties.name,horizontalOrigin:uf.HorizontalOrigin.LEFT,pixelOffset:new uf.Cartesian2(20*hN,-16*hN),depthFailTranslucency:this.properties.occludedAlpha,distanceDisplayCondition:e,scaleByDistance:a,pixelOffsetScaleByDistance:a}}}init(){this.setPosition(this.getPositionCartesian3()),this.setColorProperty(new uf.ConstantProperty(this.getColor())),super.init(),this.setCollectionMap(),this.toggleAuxiliary(),this.clampToGround&&this.toggleClampWithoutHeight()}clampWatcher;updatePositionCallback(e){e&&(this.setPosition(e),this.managers.render?.())}toggleClampWithoutHeight(){let e=this.properties.position;if(e){let a=uf.Cartographic.fromDegrees(e.longitude,e.latitude);this.clampWatcher?this.clampWatcher.update(a):this.clampWatcher=this.managers._get(f3).picker.clampWithWatcher(a,e=>this.updatePositionCallback(e))}}removeWatcher(){this.clampWatcher&&(this.clampWatcher?.unclamp(),this.clampWatcher=null)}handleActiveImage(){let e=uf.Color.fromCssColorString(this.active(\"recenter\")?pI:pD);if(this.label.fillColorSetter(this.propertyBag.color?.getValue(uf.JulianDate.now())),this.label.outlineColorSetter(e),this.label.showSetter(!0),this.properties.customImage){let e=uf.Color.fromCssColorString(this.properties.cssColor||\"#ffffff\");this.billboards.background?.colorSetter(e),this.billboards.background?.imageSetter(\"data:image/png;base64,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REREREREREREREREREREREREREREREREREREREREREREREREREREpEL/B9m4JPlE3rMAAAAAAElFTkSuQmCC\")}else this.billboards.background?.colorSetter(e),this.billboards.background?.imageSetter(\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTkycHgiIGhlaWdodD0iMTkycHgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDx0aXRsZT4y5Zu+5qCHLzQ4cHgvcGluMjwvdGl0bGU+CiAgICA8ZyBpZD0iMuWbvuaghy80OHB4L3BpbjIiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSLnvJbnu4QtMuWkh+S7vS00IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNC4wMDAwMDAsIDguMDAwMDAwKSIgZmlsbC1ydWxlPSJub256ZXJvIiBzdHJva2U9IiNGRkZGRkYiIHN0cm9rZS13aWR0aD0iMS41Ij4KICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4ODQ5NjEsLTEuMjczMjQ3NDMgTDIxLjEwNTEwNiwxMy44NDAyNDIzIEwxMi4yMjk2NjE2LDI2LjAxNTQ2NyBMMTIuMjI5ODI5NCwzMC4zNjY5NzU3IEw3Ljk0NzIyMDcsMzAuMzY2OTc1NyBMNy45NDcwNTI5LDI2LjAxNTQ4NjEgTC0wLjkyODEwODI2NywxMy44NDAyMzQ4IEwxMC4wODg0OTYxLC0xLjI3MzI0NzQzIFogTTEwLjA4ODMwNjQsNS45OTcwMDI0MyBMNC4zNzE1MzI1NywxMy44NDAyMTAzIEwxMC4wODgzMDY0LDIxLjY4MjgxOTYgTDE1LjgwNTA4MDIsMTMuODQwMjEwMyBMMTAuMDg4MzA2NCw1Ljk5NzAwMjQzIFoiIGlkPSLlvaLnirYiPjwvcGF0aD4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPgo=\")}handleBaseImage(){this.properties.customImage?this.billboards.background?.imageSetter(hE):this.billboards.background?.imageSetter(hT)}toggleActive(){let e=this.active();if(e?this.handleActiveImage():(this.handleBaseImage(),this.label.fillColorSetter(px.fillColor),this.label.outlineColorSetter(px.outlineColor),!this.runtimeState.visible.label&&this.label.showSetter(!1)),this.updateRuntimeOccludedStyle(),this.active(\"selected\")?(this.showActiveEntity(),this.properties.customImage&&this.billboards.background?.imageSetter(hE),this.runtimeState.visible.shadowBillboard=!0):(this.billboards.activeShadow?.showSetter(!1),this.runtimeState.visible.shadowBillboard=!1),this.properties.scaleByDistance){let a=e?void 0:new uf.NearFarScalar(...this.properties.scaleByDistance);this.label.scaleByDistanceSetter(a),this.billboards.main?.scaleByDistanceSetter(a),this.billboards.background?.scaleByDistanceSetter(a),this.label.pixelOffsetScaleByDistanceSetter(a),this.billboards.main?.pixelOffsetScaleByDistanceSetter(a),this.billboards.background?.pixelOffsetScaleByDistanceSetter(a),this.billboards.activeShadow?.scaleByDistanceSetter(a),this.billboards.activeShadow?.pixelOffsetScaleByDistanceSetter(a)}if(this.properties.distanceDisplayCondition){let a=e?void 0:new uf.DistanceDisplayCondition(...this.properties.distanceDisplayCondition);this.label.distanceDisplayConditionSetter(a),this.billboards.main?.distanceDisplayConditionSetter(a),this.billboards.background?.distanceDisplayConditionSetter(a),this.billboards.activeShadow?.distanceDisplayConditionSetter(a)}this.managers.render?.()}showBackgroundEntity(){let e=this.properties.scaleByDistance?new uf.NearFarScalar(...this.properties.scaleByDistance):void 0;this.billboards._keys().forEach(a=>{let r=this.managers._get(a),t=this.billboards._get(a);!t.background&&r&&(t.background=r.billboardVisualizer.add({id:this.getId(\"background\"),position:this.getPositionCartesian3(),...hO,image:this.properties.customImage?hE:hT,color:this.properties.customImage?uf.Color.fromCssColorString(this.properties.cssColor||\"#ffffff\"):void 0,depthFailTranslucency:this.properties.occludedAlpha,distanceDisplayCondition:this.properties.distanceDisplayCondition?new uf.DistanceDisplayCondition(...this.properties.distanceDisplayCondition):void 0,scaleByDistance:e,pixelOffsetScaleByDistance:e}))})}showActiveEntity(){let e=this.properties.scaleByDistance?new uf.NearFarScalar(...this.properties.scaleByDistance):void 0;this.billboards._keys().forEach(a=>{let r=this.managers._get(a),t=this.billboards._get(a),n=t.activeShadow,i=this.properties.customImage?\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAm0SURBVHic7d39ceTGEcbhXifgy0DIQJeBNwMxA68zYAZaRUArAp4joBUBqQhIRYBVBGQGr/4AWHemecvpAWZ7BvN7qq6u6oQqNYDu+cQCO8PqJH0ys8/znx/MbDCzT/N//vTmj5nZy/zHzOz05t/+mP/tabfbvf43rGQXHUDrJA1mtjezf9iU8IN9TewSTmb2ZGa/21QUDwX/X5tHATjNrfvezH6yr618pBebCuI3oyDcKIBEkq7M7J9mdhUdywdezOxXM/vvbrd7ig6mdhTAGfPw5mebWvwhMpZMDzb1DF92u93LB8cCE0kHSY/ajmdJt5oKGt+gB/iGpL2Z3VqbrX2qL2b2CytKk79FB1ADSXtJ92Z2b9tOfjOzg5mN9AiTrnuAOQFurP6JbUn/tqlH6HKO0G0BSLq2aYJbcs2+FScz+1ePS6jdFcDc6l9iqPO6Pv9kZn/Of786mZm9jsPfDEWGb/7+cf77s11maNZ1b7B5ko4FV1oeJd3M84nVexVJnyR9lnQt6X5e2SnhWdOeB7ZC0jAnzdruNC2ZDkHntddU1CXO7SbinLAyTck/rpgYowKT/ns0FcON1u0Z7lWgN8OFaBourJUQt5r2Caqmaah0pfV6hVFS9PNO8NJ64/1bVdbap9K8v7HCNXiWdIg+HySak3apWzWa+G9pvUI4Rp8LztDU/d8tvMn32kjiv6WpEMaF1+cYfR54h6bkX/IA26gOuvn5Ot1QBBuyQvLfaqOt/vdo6g2WXLNj9DnAFid/95M7LesNjtHxd29B8o/qrNX/Hk37GrnLxcfo+Lul/NWeO5L/f2nZhiGPTlya8tf5j9Gx10rTcPI+45o+iwblcjTt8JL8hSivZx0pggvQtHqR4zo69pYsKAKeHSpF0zg1Z7J2iI69RcpbIbqNjnuzlDc+PUTH3TLlzbUO0XFvjvJaI4Y9K5D/8ZJRzAfWo7xx/zE67q3QtDo0Oq//Y3Tcm5B58RmHrkx5+wTH6LibJ3/3S8tTyFwEXkN03M2Sf+gzimW4ouTfg7mLjrlZ8ne5++iYeyB/r3yIjrk58i+/8RaDC5F/PjBGx9wUTRNfz4bXoxj6XJSmJ0g9jtExN0P+bfghOuYeOe/TyH1KIP/E9xgdc6/kXxVimPoR+VqVZzH0CSXfXI25wDnytyiH6JjhXq07RMdbLflak/voeDGRb0JML/Ae+Vd+9tEx4yvRCywjWv+mydcLcP/eEq1/8+TrBYboeM0q+UjenNCpqzkPPX7KpxG/Oo7lTRKv5Puxyz46XrxPvlU8ntp9pfThz3N0rDhPvn2cITre8CGQfMMfTxeLGP9xHMswyNli8KWSBih9MswwSOnDH5bOGuFs1EIfZQkdAs0teuoF+K1kLFiVZxgU2qtHzwH2jmO/FIoBK5uXqU+Jh/9ULpKPRRfAj4nHPfH18uY8JR7XdQ+QugrwUDIIFJE6ZN2XDOIjYQWgaQ2Y8f92pfYAr0vhISJ7gL3j2OSLiTrsdrsnM0sdtoYNgyILYEg87oHxf7MeEo/7oWQQ50QWQOpJ0/q364/E44aSQZwTWQCp3d6fRaNASamN11AyiHMiCyB1AnwqGQSKSh26DiWDqI6mnz+mGqLjRR7nfQ55JCKqBxgSj3vZ7XangnGgoHnxouqVoKgCYPjTj6oXMaJ3gj/C8ieKqn4IVDIIXETVE2F6AJRW9T2svQDQD1aB3sEmWPtS72FXBQBUIaoAUseFfy8aBS4h9R6GzBVqLwDe/d++1HvYVQEAVai9BxhKBoGLqLoXr70A0L6qH3upfQhUdeuBJEN0AOfU3gPwKsT20QO8Nf9gOol4H2iznG/+6G4V6JR4HMOgdqU2XqeoFx+0UAD0AO2quvU3iy2A1GFQ2CszsFjyqy+LRnFGZAGkPiRFD9Cu6t/80cIQaB/9Dnn4zfcseQ5QMJSzWhgCmdELtMjz7YeHgnGcFVYA89seTomHh75DHllSG63QN39E7wQ/JB5HD9Ce1EbroWQQH4kugN8Tj9vzgqzmpDZaqTlQRHQBeOYB+1JBYF3yffq26vcGFSe+Erk5Sv9KJB8+d1wsMQyqn6b3gTbTqEUPgcx8nz/iy+L1uzI+feWj9C+Lj9Gx4jxJ944ePXyDs4YewCx9KWxQ4AfVcN48RN0nHl7Fp69qKQDPl8V/LhYFljo4jvXc8+1zDIMkJsPVkW/y+1zD8Mesnh7AzLcjSC9Qn2tzrP3XMPypiqTB0QPQC1TE2fpLzOPeJ9+ewG10vJhIOjruW/jaf7Xk7wXYFwg23zNa/7XI1wuwLxDMeb8eo+OtnqS944JK0nV0zL3iXhUiZy8gJsQh5Nv1HVXJ0mf15J8LMLG6MEnXznu0j465KfKtLEjSMTrmXsg/9KGB8tK0tjw6L/QQHffWZd4XftKaQ9LBeaFHMc4sSr75mSTdRMfcNEl3zgt+Fx3zVsk/7q/mmZ9maZoQj84Lf4yOe2skXTnvgcRG5TrkHwpRBCuS9Fm+3V6Joc+6JN1kFAEbLwsprwcexdBnfRk3QpIO0XG3KjP5n8VqXBnyP3j1imU4p8zkl+h1y1LefOCZIkinaa3/MeM684j6Jci/S0wRJFqQ/Oz2XlJmEYxifPpdC5J/FJPey5N/V5IiOEO+pzu5njVQfos1RMdeE+U1Jqz4RNOybnuIjr8GC5KfOVUNlL9k130RZCa/xPP9daEI/JS3uy6xuVinBUXwqM5WMZS3ikby144i+BjJv3FLiiA69tIWJD+POLRE+c8NbXY7f0HyH6NjRwblPce+ySIg+Tu1oAg284MOkr9zcxF0mQDy/453M+eObyjvMeqmE6HHc8YZPSVET+cKB3UwJFiQ/Jub/OMd2vCkUKx8IcWCIqh2Q4jkh8uCIjhEx/4WyY8sWyiCBcnfzfNPOGNBEewriJ2H/7Cc8p6ND/1VFMmPVamhnwaS/ChiQREMF4yRX7+hHFX8I3uSH8Wp0jdNkPy4mNqKgOTHxdWSdKqsGNGR6CIg+RFuYRFkLzmS/KjGgiLIXnfPTH5eWYgyLlkEamhTDh1ZUATJ3y8m+VE1FXz0ODP5pQoezENHShSBeFktWqIVX7eiDfwuAR3SCm9fIPnRtCVFsCD5q/1tMjqk/Net5DhGny/wf5TfmpP82IbCRXCMPj/gQ4WK4Bh9XkCylYvgGH0+gNtKRXCMPg8gm/J3d6UNfaQDHVPe8z28shDb4SwCkh/bI+me5Ee39PFPHHlrG7btTBGQ/OjDXAQjyY9u6etPK0l+9GkugiE6DgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4vwFqfM01+WKCwcAAAAASUVORK5CYII=\":\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTkycHgiIGhlaWdodD0iMTkycHgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDx0aXRsZT4y5Zu+5qCHLzQ4cHgvcGluMzwvdGl0bGU+CiAgICA8ZGVmcz4KICAgICAgICA8ZmlsdGVyIHg9Ii02NS42JSIgeT0iLTQ2LjIlIiB3aWR0aD0iMjMxLjIlIiBoZWlnaHQ9IjE5MC4xJSIgZmlsdGVyVW5pdHM9Im9iamVjdEJvdW5kaW5nQm94IiBpZD0iZmlsdGVyLTEiPgogICAgICAgICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSI0IiBpbj0iU291cmNlR3JhcGhpYyI+PC9mZUdhdXNzaWFuQmx1cj4KICAgICAgICA8L2ZpbHRlcj4KICAgIDwvZGVmcz4KICAgIDxnIGlkPSIy5Zu+5qCHLzQ4cHgvcGluMyIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+CiAgICAgICAgPGcgaWQ9IjLlm77moIcvNDhweC9waW4x5aSH5Lu9LTIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE0LjAwMDAwMCwgOC4wMDAwMDApIiBmaWxsPSIjRkZGRkZGIj4KICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4ODQ5NjEsLTAuODQ4ODMxNjE3IEwyMC43OTU3MzQ4LDEzLjg0MDIzNzMgTDExLjk3OTY1ODUsMjUuOTM0MDIxNSBMMTEuOTc5ODE5OCwzMC4xMTY5NzU3IEw4LjE5NzIxMTA2LDMwLjExNjk3NTcgTDguMTk3MDQ5NzYsMjUuOTM0MDM0MiBMLTAuNjE4NzM4ODQ1LDEzLjg0MDIzMjIgTDEwLjA4ODQ5NjEsLTAuODQ4ODMxNjE3IFogTTEwLjA4ODMwNjQsNS41NzI1NzAwOCBMNC4wNjIxNjczMiwxMy44NDAyMTU5IEwxMC4wODgzMDY0LDIyLjEwNzIzMDggTDE2LjExNDQ0NTUsMTMuODQwMjE1OSBMMTAuMDg4MzA2NCw1LjU3MjU3MDA4IFoiIGlkPSLlvaLnirblpIfku70tMyIgc3Ryb2tlPSIjRkZGRkZGIiBmaWxsLXJ1bGU9Im5vbnplcm8iIGZpbHRlcj0idXJsKCNmaWx0ZXItMSkiPjwvcGF0aD4KICAgICAgICAgICAgPHBvbHlnb24gaWQ9IuefqeW9ouWkh+S7vSIgcG9pbnRzPSIxMC4xIDcuMzc1MDU2NjkgMTQuODM4MDE2NSAxMy44NzUwNTY3IDEwLjEgMjAuMzc1MDU2NyA1LjM2MTk4MzQ3IDEzLjg3NTA1NjciPjwvcG9seWdvbj4KICAgICAgICA8L2c+CiAgICA8L2c+Cjwvc3ZnPgo=\",o=this.properties.customImage?uf.Color.fromCssColorString(\"#ffffff\"):this.propertyBag.color?.getValue(uf.JulianDate.now());n?(n.show=!0,this.billboards.activeShadow?.imageSetter(i),this.billboards.activeShadow?.colorSetter(o)):r&&(t.activeShadow=r.billboardVisualizer.add({id:this.getId(\"activeShadow\"),position:this.getPositionCartesian3(),...hO,image:i,depthFailTranslucency:this.properties.occludedAlpha,color:o,distanceDisplayCondition:this.properties.distanceDisplayCondition?new uf.DistanceDisplayCondition(...this.properties.distanceDisplayCondition):void 0,scaleByDistance:e,pixelOffsetScaleByDistance:e}))})}toggleAuxiliary(){this.properties.clampToGround?this.auxiliary&&(this.auxiliary.destroy(),this.auxiliary=void 0):!this.auxiliary&&(this.auxiliary=new hC({position:this.position,category:this.category,distanceDisplayCondition:this.properties.distanceDisplayCondition,onLinePositionsChange:()=>{let e=this.managers._get(f3);e&&this.updateRealtimeClamping(e)}},this.managers,{}))}hasPrimitive(e){return e instanceof uf.Billboard?this.billboards._values().some(a=>a.main===e||a.background===e||a.activeShadow===e):e instanceof uf.Label&&this.label._values().includes(e)}setCollectionMap(){this.managers._options.elements.add(\"pin\",this,[this.getId(),this.getId(\"background\"),this.getId(\"activeShadow\")])}updateHeight(e){this.position&&(this.position={...this.position,height:e})}dynamic;stabilize(e){this.dynamic=!1,this.clampToGround&&this.toggleClampWithoutHeight();e&&(this.position=(0,pg.KO)(e,!0)),this.auxiliary&&this.auxiliary.stabilize(e)}dynamize(e){this.dynamic=!0,this.clampToGround&&this.toggleClampWithoutHeight(),this.auxiliary&&this.auxiliary.dynamize({changing:!0,groundPositionCallback:e?()=>e:void 0,positionCallback:()=>this.getPositionCartesian3()})}positionCartesian3;getPositionCartesian3(){if(this.properties.position)return this.positionCartesian3=(0,pg.jL)(this.properties.position),this.positionCartesian3;this.positionCartesian3=void 0}getColor(){if(this.properties.cssColor)return uf.Color.fromCssColorString(this.properties.cssColor)}getAuxiliaryPositions(){if(this.auxiliary)return this.auxiliary.getLinePositions()}cacheViewModes;onSceneChange(e,a){this.auxiliary?.onSceneChange(e);let{is3D:r,id:t}=e;if(r&&\"3D\"===this.cacheViewModes[t]||!r&&\"2D\"===this.cacheViewModes[t])return;if(this.cacheViewModes[t]=r?\"3D\":\"2D\",this.updateRealtimeClamping(e),!this.active())this.updateRuntimeOccludedStyle([e.id])}updateRealtimeClamping(e){if(this.clampToGround)return;let{is3D:a,id:r}=e;if(a)this.positionCartesian3&&this.setPosition(this.positionCartesian3);else if(this.position){let e=this.getAuxiliaryPositions()?.[0];!e&&(e=uf.Cartesian3.fromDegrees(this.position.longitude,this.position.latitude)),this.setPosition(e)}}updateRuntimeOccludedStyle(e){let a=this.active(),r=!!this.properties.enableOccludeIn2dView;(!Array.isArray(e)||0===e.length)&&(e=Object.keys(this.cacheViewModes)),e.forEach(e=>{let t=this.cacheViewModes[e];if(void 0===t)return;let{occludedAlpha:n,disableDepthTestDistance:i}=mb(t,a,r,this.properties.occludedAlpha,void 0),o=this.billboards._get(e),s=o?.main,l=this.label._get(e),d=o?.background,c=o?.activeShadow;s&&(s.depthFailTranslucency=n,s.disableDepthTestDistance=i),l&&(l.depthFailTranslucency=n,l.disableDepthTestDistance=i),d&&(d.depthFailTranslucency=n,d.disableDepthTestDistance=i),c&&(c.depthFailTranslucency=n,c.disableDepthTestDistance=i)})}get placeable(){return!!this.properties.placeable}set placeable(e){this.properties.placeable=e}cacheScreenSpaceBoundingBox;getLabelScreenSpaceBoundingBox(e,a,r,t){let n=this.getPlace(r),i=mf(a,e.horizontalOrigin,e.verticalOrigin,new uf.Cartesian2,1),o=e.scaleByDistance?mp(t,e.scaleByDistance):1,s=mf(a,n.horizon,n.vertical,n.labelPixelOffset?uf.Cartesian2.fromArray(n.labelPixelOffset):new uf.Cartesian2,o),l=a.width*o,d=a.height*o,c=a.x+a.width/2-i.x,u=a.y+a.height/2-i.y;return c+=s.x,u+=s.y,c-=l/2,u-=d/2,p2.fromCesiumBoundingRect(new uf.BoundingRectangle(c,u,l,d))}getScreenSpaceBoundingBox(e,a){let r=this.managers._get(e)?.viewer.scene;if(!r)return null;let t=r.frameState.frameNumber,n=this.label._get(e);if(!a&&(a=this.getCurrentPlacement(e)),this.cacheScreenSpaceBoundingBox[e]?.frameNumber===t){let r=this.cacheScreenSpaceBoundingBox[e].screenSpaceBoundingBox;return r&&n&&\"UnSet\"!==a?this.getLabelScreenSpaceBoundingBox(n,r,a,this.cacheLabelingWindowPosition[e]?.distanceToCamera||Number.POSITIVE_INFINITY):null}let i=null;if(\"UnSet\"!==a){let a=this.getLabelingWindowPosition(e);r&&n&&a&&(i=uf.Label.getScreenSpaceBoundingBox(n,a,new uf.BoundingRectangle))}return(this.cacheScreenSpaceBoundingBox[e]={frameNumber:t,screenSpaceBoundingBox:i},i&&n)?this.getLabelScreenSpaceBoundingBox(n,i,a,this.cacheLabelingWindowPosition[e]?.distanceToCamera||Number.POSITIVE_INFINITY):null}cacheLabelingWindowPosition;getLabelingWindowPosition(e){let a=this.managers._get(e)?.viewer.scene;if(!a)return null;let r=a.frameState.frameNumber;if(this.cacheLabelingWindowPosition[e]?.frameNumber===r)return this.cacheLabelingWindowPosition[e].labelingWindowPosition||null;let t=null,n=this.anchor;if(n){let e=uf.SceneTransforms.wgs84ToWindowCoordinates(a,n);e&&(t=e)}return this.cacheLabelingWindowPosition[e]={frameNumber:r,labelingWindowPosition:t,distanceToCamera:n?uf.Cartesian3.distance(a.camera.positionWC,n):Number.POSITIVE_INFINITY},t}get anchor(){return this.position?(0,pg.jL)(this.position):null}labelingPlacements;labelingPlacementIters;resetPlacement(e){let a=this.labelingPlacementIters[e]=hF();this.labelingPlacements[e]=a.next().value}getCurrentPlacement(e){return this.labelingPlacements[e]||\"Right\"}nextPlacement(e){let{value:a,done:r}=this.labelingPlacementIters[e].next();return r?this.labelingPlacements[e]=\"UnSet\":(this.labelingPlacements[e]=a,a)}getLabelVisible(e=f3){let a=this.label._get(e);return!!a&&a.show}getPlace(e){let a=uf.HorizontalOrigin.RIGHT,r=uf.VerticalOrigin.CENTER;return\"Right\"===e&&(a=uf.HorizontalOrigin.LEFT,r=uf.VerticalOrigin.CENTER),\"Left\"===e&&(a=uf.HorizontalOrigin.RIGHT,r=uf.VerticalOrigin.CENTER),\"Top\"===e&&(r=uf.VerticalOrigin.BOTTOM,a=uf.HorizontalOrigin.CENTER),\"Bottom\"===e&&(r=uf.VerticalOrigin.TOP,a=uf.HorizontalOrigin.CENTER),{horizon:a,vertical:r,labelPixelOffset:hJ[e]}}updateLabeling(e,{visible:a,placement:r}){let t=this.label._get(e);if(!t||void 0!==a&&(t.show=a,this.runtimeState.visible.label=a,!a)||!r)return;let n=this.getPlace(r);t.horizontalOrigin=n.horizon,t.verticalOrigin=n.vertical,t.pixelOffset=n.labelPixelOffset?uf.Cartesian2.fromArray(n.labelPixelOffset):new uf.Cartesian2}canPlaceable(e){if(!this.placeable)return!1;if(!1===this.properties.show)return this.properties.show;let{screenRect:a,manager:r,managerId:t}=e,n=this.getCurrentPlacement(t),i=this.getScreenSpaceBoundingBox(t,\"UnSet\"===n?\"Right\":n);if(!i||!p2.intersect(a,i,7))return!1;let o=this.properties.distanceDisplayCondition;if(o&&this.anchor){let e=r.viewer.camera.positionWC,a=uf.Cartesian3.distance(e,this.anchor);return a>o[0]||a<o[1]}return!0}onManagerAdd(e){let a=this.managers._get(e);if(a){let{billboardOptions:r,labelOptions:t}=this.getEntityOptions();this.billboards._add(e,{main:a.billboardVisualizer.add(r)}),this.label._add(e,a.labelVisualizer.add(t)),this.showBackgroundEntity(),this.toggleActive(),this.resetPlacement(e)}}removeEntities(e){let a=this.managers._get(e);if(a){let r=this.billboards._get(e);r&&(a.billboardVisualizer.remove(r.main),r.background&&a.billboardVisualizer.remove(r.background),r.activeShadow&&a.billboardVisualizer.remove(r.activeShadow)),this.billboards._remove(e);let t=this.label._get(e);t&&a.labelVisualizer.remove(t),this.label._remove(e)}}onManagerRemove(e){this.removeEntities(e),delete this.labelingPlacementIters[e],delete this.labelingPlacements[e]}onManagerUpdate(e){let a=this.billboards._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.managers._keys().forEach(e=>{this.removeEntities(e)}),this.auxiliary?.destroy(),this.removeWatcher()}}class hH extends(0,uX.AF)(pv,ph,pf,mk){managers;constructor(e,a){super(),this.managers=a,this.entities=py({}),this.interactLevel=sc.Thing,this.clampedPositionCartesian3=null,this.cacheViewModes={},this.properties=Object.assign({id:(0,uW.k)()},e),this.init(),this.setCollectionMap(),this.managers.render?.()}entities;properties;interactLevel;get id(){return this.properties.id}get boundingSphere(){let e=this.getPositionCartesian3();if(e)return new uf.BoundingSphere(e,25)}update(e){let a=!1;e.position&&(this.properties.position=e.position,this.clampedPositionCartesian3=null,this.entities.positionSetter(new uf.ConstantPositionProperty(this.getPositionCartesian3())),a=!0),e.pixelSize&&(this.properties.pixelSize=e.pixelSize,this.entities.point?.pixelSizeSetter(new uf.ConstantProperty(e.pixelSize))),(0,pg.ri)(e.show)&&this.entities.showSetter(e.show),e.draggable&&(this.properties.draggable=e.draggable),(0,pg.ri)(e.actived)&&(this.properties.actived=e.actived);let r=e.occludedAlpha;(0,pg.ri)(r)&&(this.properties.occludedAlpha=0===r?void 0:r);let t=e.disableDepthTestDistance;(0,pg.ri)(t)&&(this.properties.disableDepthTestDistance=t),(0,pg.ri)(e.enableOccludeIn2dView)&&(this.properties.enableOccludeIn2dView=e.enableOccludeIn2dView),this.recomputeDepthStyle(),(0,pg.ri)(e.clampToGround)&&this.properties.clampToGround!==e.clampToGround&&(this.properties.clampToGround=e.clampToGround,a=!0),a&&this.toggleClamp()}getEntityOptions(){return{id:this.properties.id,show:this.properties.show,position:this.getPositionCartesian3(),point:{disableDepthTestDistance:this.properties.disableDepthTestDistance,color:this.getColor(),pixelSize:this.properties.pixelSize,outlineWidth:this.properties.outlineWidth,outlineColor:this.properties.outlineColor?uf.Color.fromCssColorString(this.properties.outlineColor):void 0,translucencyByDistance:this.properties.translucencyByDistance?new uf.NearFarScalar(...this.properties.translucencyByDistance):void 0,depthFailTranslucency:this.properties.occludedAlpha}}}init(){super.init(),this.toggleClamp()}clampedPositionCartesian3;onPositionClamp(e){e&&(this.clampedPositionCartesian3=e,this.entities.positionSetter(new uf.ConstantPositionProperty(this.getPositionCartesian3())),this.managers.render?.())}getPositionCartesian3(){if(this.properties.position)return this.clampedPositionCartesian3||(0,pg.jL)(this.properties.position)}getColor(){if(this.properties.cssColor)return uf.Color.fromCssColorString(this.properties.cssColor)}setCollectionMap(){this.managers._options.elements.add(\"point\",this,[this.id])}startDrag(e,a){let r=super.startDrag(e,a),t=this.getPositionCartesian3();return r&&t?{position:t}:r}dynamicDrag(e){this.entities.positionSetter(new uf.CallbackProperty(e,!1))}endDrag(){super.endDrag();let e=this.entities._values()[0];this.entities.positionSetter(new uf.ConstantPositionProperty(e?.position?.getValue(new uf.JulianDate)))}cacheViewModes;onSceneChange(e){let{is3D:a,id:r}=e;if(a&&\"3D\"===this.cacheViewModes[r]||!a&&\"2D\"===this.cacheViewModes[r])return;if(this.cacheViewModes[r]=a?\"3D\":\"2D\",!this.properties.actived)this.recomputeDepthStyle()}recomputeDepthStyle(e){let a=!!this.properties.actived,r=!!this.properties.enableOccludeIn2dView;(!Array.isArray(e)||0===e.length)&&(e=Object.keys(this.cacheViewModes)),e.forEach(e=>{let t=this.cacheViewModes[e];if(void 0===t)return;let{occludedAlpha:n,disableDepthTestDistance:i}=mb(t,a,r,this.properties.occludedAlpha,this.properties.disableDepthTestDistance),o=this.entities._get(e)?.point;if(!!o)o.depthFailTranslucency=new uf.ConstantProperty(n),o.disableDepthTestDistance=new uf.ConstantProperty(i)})}onManagerAdd(e){let a=this.managers._get(e);a&&this.entities._add(e,a.viewer.entities.add(this.getEntityOptions()))}onManagerRemove(e){let a=this.entities._get(e);a?.entityCollection.remove(a),this.entities._remove(e)}onManagerUpdate(e){let a=this.entities._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.removeClampWatcher(),this.entities._keys().forEach(e=>{let a=this.entities._get(e);a&&a.entityCollection.remove(a),this.entities._remove(e)})}}r(\"26978\");var hB=r(\"82780\");function hV(e){return e.id=(0,uW.k)(),e}class hU extends u_.EventEmitter{manager;editingMode;editingModeReactive;editing;activeShapePoints;activeCirclePosParams;cssColor;activeElement;disable;config;constructor(e){super(),this.manager=e,this.editingMode=\"line\",this.editingModeReactive=(0,uh.iH)(\"\"),this.editing=!1,this.activeShapePoints=(0,uh.iH)([]),this.activeCirclePosParams=(0,uh.qj)({centerPos:void 0,radius:0,centerPosCartesian3:void 0,circleEdgePoint:void 0,maxRadius:pP.MaxRadius}),this.cssColor=\"\",this.activeElement=null,this.disable=!1,this.config={},this.pickingPlane=null,this.dragging=(0,uh.iH)(!1),this.draggingIndex=-1,this.draggingArrayIndex=0,this._withShift=!1,this.pinStatus={horizontalMoving:!1,verticalMoving:!1,plane:null,ellipsoid:null}}pickingPlane;getEditing(){return this.editing}get activeTypedElement(){let{activeElement:e}=this;return e instanceof g_||!e?null:e.typedElement}dragging;setDragging(e){this.dragging.value=e,e?this.manager.hover.setCursor(\"grabbing\",\"temporary\"):this.manager.hover.setCursor(\"\",\"temporary\"),(this.activeElement instanceof hY||this.activeElement instanceof gs||this.activeElement instanceof hp)&&this.activeElement.setDragging(e)}setCircleEdit(e){this.dragging.value=e,e?this.manager.hover.setCursor(\"grabbing\",\"temporary\"):this.manager.hover.setCursor(\"\",\"temporary\")}draggingIndex;draggingArrayIndex;async mountPolygon(){let e=this.activeElement;if(e instanceof hW&&(e.active(\"selected\",!0),!this.disable)){this.activeShapePoints.value=[e.positions?.map(e=>hV(pg.jL(e)))||[]];let a=await this.getTerrainHeights(this.manager.viewer.scene.globe.terrainProvider,e.positions);if(this.cssColor=e.cssColor,!this.editing)return;this.activeShapePoints.value=[a],e.dynamize({positionsCallback:()=>this.activeShapePoints.value?.[0]?.map(e=>uf.Cartesian3.clone(e))||[]})}}async mountPrism(){let e=this.activeElement;e instanceof gs&&(e.active(\"selected\",!0),this.activeShapePoints.value=e.getEditActivePoints(),this.cssColor=e.cssColor)}async mountCylinder(){let e=this.activeElement;if(e instanceof hp){e.active(\"selected\",!0);let a=e.getEditActivePoints();a&&(this.activeShapePoints.value=a.map(e=>e.map(e=>(0,pg.jL)(e)))),this.cssColor=e.cssColor??\"#fff\"}}_withShift;get withShift(){return this._withShift}set withShift(e){this._withShift=e,this.activeElement&&\"polygon3d\"===this.editingMode&&this.editing&&this.activeElement instanceof hY&&(this.activeElement.shiftHotkeyEnable=e)}async mountPolygon3D(){let e=this.activeElement;e instanceof hY&&(e.active(\"selected\",!0),!this.disable&&e.positions?.length&&(this.activeShapePoints.value=[e.positions.map(e=>hV((0,pg.jL)(e)))||[]],this.cssColor=e.cssColor))}updatePositionsFor(e,a=!1,r){if(e===this.activeElement){if(e instanceof gs)this.activeShapePoints.value=e.getEditActivePoints();else if(e instanceof hp){let a=e.getEditActivePoints();a?this.activeShapePoints.value=a.map(e=>e.map(e=>(0,pg.jL)(e))):(this.activeShapePoints.value=[],this.editingModeReactive.value=\"\")}else e instanceof mX?(e.centerPos&&(this.activeCirclePosParams.centerPos=e.centerPos,this.activeCirclePosParams.centerPosCartesian3=hV((0,pg.jL)(e.centerPos))),e.radius&&(this.activeCirclePosParams.radius=e.radius),e.circleEdgePoint&&(this.activeCirclePosParams.circleEdgePoint=e.circleEdgePoint),this.cssColor=e.cssColor):e instanceof hY?e.category!==se.annotations&&(this.activeShapePoints.value=[e.positions?.map(e=>hV(pg.jL(e)))||[]]):(e.clampToGround?this.activeShapePoints.value=[e.positions?.map(e=>hV(pg.jL(e)))||[]]:this.activeShapePoints.value=[e.drawingPositions.map(e=>hV((0,pg.jL)(e,!1)))||[]],e instanceof hW&&(e.drawingPositions=this.getCurrentShape()));a&&this.emitShapeEdit(r)}}async mountCircle(){let e=this.activeElement;if(e instanceof mX&&(e.active(\"selected\",!0),!this.disable&&e.centerPos&&e.radius)){if(this.activeCirclePosParams.centerPos=e.centerPos,this.activeCirclePosParams.centerPosCartesian3=hV((0,pg.jL)(e.centerPos)),this.activeCirclePosParams.radius=e.radius,this.activeCirclePosParams.maxRadius=e.maxRadius,this.cssColor=e.cssColor,this.activeCirclePosParams.circleEdgePoint=e.circleEdgePoint,!this.editing)return;e.dynamize({positionsCallback:()=>this.activeCirclePosParams})}}async getTerrainHeights(e,a){let r=a?.map(e=>uf.Cartographic.fromDegrees(e.longitude,e.latitude))||[];try{r=await p9(this.manager,r)}catch{}return r.map(e=>hV((0,pg.jL)((0,pg.vi)(e))))}async mountPolyline(){let e=this.activeElement;if(!(e instanceof h8))return;if(e.active(\"selected\",!0),!this.disable)if(!e.clampToGround)this.activeShapePoints.value=[e.positions.map(e=>hV((0,pg.jL)(e,!1)))],e.dynamize({});else{let a=await this.getTerrainHeights(this.manager.viewer.scene.globe.terrainProvider,e.positions);if(!this.editing)return;this.activeShapePoints.value=[a],e.dynamize({positionsCallback:()=>this.activeShapePoints.value?.[0]||[]})}}async mountPolyline3D(){let e=this.activeElement;if(!(e instanceof gr))return;if(e.active(\"selected\",!0),!this.disable)this.activeShapePoints.value=[e.positions.map(e=>hV((0,pg.jL)(e)))]}startDrag(e,a=0){this.finishDrag(),this.setDragging(!0),this.draggingIndex=e,this.draggingArrayIndex=a,window.addEventListener(\"mouseup\",()=>{this.finishDrag(!0)},{once:!0})}startEditCircle(){this.finishDragCircle(),window.addEventListener(\"mouseup\",()=>{this.finishDragCircle(!0)},{once:!0})}cleanPickingPlane(){this.pickingPlane&&(this.pickingPlane=null)}pickPosition(e,a=0){let r=this.activeElement,t=r instanceof hY,n=r instanceof gs,i=r instanceof hp;if(t){let e=r.positionsWC||[];!this.pickingPlane&&(this.pickingPlane=ma(e))}else(n||i)&&!this.pickingPlane&&(this.pickingPlane=r.getPickingPlane(0===a?\"bottom\":\"top\"));if(t||n||i){if(!this.pickingPlane)return;return mt(e,this.pickingPlane,this.manager)}return this.manager.picker.pickPosition(e)}updateShapePoints(e){let a=this.activeElement,r=e.map(e=>(0,pg.KO)(e,a instanceof hY||a instanceof h8&&!a.clampToGround));if(a instanceof gs)a.update({positions:r}),this.activeShapePoints.value=a.getEditActivePoints();else if(a instanceof hp){let r=e[0],t=e[1],n=uf.Cartesian3.distance(r,t),i=(0,pg.KO)(r.clone()),o={};1===this.draggingIndex?o.radius=n:o.center=i,a.update(o);let s=a.getEditActivePoints();s&&(this.activeShapePoints.value=s.map(e=>e.map(e=>(0,pg.jL)(e))))}else this.activeShapePoints.value=[e],a instanceof h8&&!a.clampToGround&&(a.drawingPositions=r),a instanceof hW&&(a.drawingPositions=r),a instanceof hY&&a.update({positions:r})}emitMouseMovePolygonPolyline(e){let a=this.activeShapePoints.value[0],r=(0,pg.KO)(e),t=(0,pg.KO)(a[a.length-1]);\"line\"===this.editingMode&&this.manager.emit(\"onEditingMouseMove\",{element:this.activeElement,elementType:\"line\",pointIndex:a.length+1,curPoint:r,prePoint:t}),\"polygon\"===this.editingMode&&this.manager.emit(\"onEditingMouseMove\",{element:this.activeElement,elementType:\"polygon\",pointIndex:a.length+1,curPoint:r,prePoint:t})}dragPoint(e,a,r=0){if(!this.editing)return;this.setDragging(!0);let t=this.pickPosition(a,r),n=this.activeShapePoints.value?.[r];if(!!t&&!!n?.[e])hV(t),t.dynamic=!0,this.emitMouseMovePolygonPolyline(t),this.updateShapePoints(n.map((a,r)=>r===e?t:a))}dragMouseMove(e){this.dragPoint(this.draggingIndex,e.endPosition,this.draggingArrayIndex)}finishDragCircle(e=!1){e&&this.emitShapeEdit()}finishDrag(e=!1){this.activeShapePoints.value=this.activeShapePoints.value.map(e=>e.map((e,a)=>{if(a===this.draggingIndex){let a=uf.Cartesian3.clone(e);return hV(a),a.dynamic=!1,a}return e})),this.draggingIndex=-1,this.draggingArrayIndex=0,this.setDragging(!1),this.cleanPickingPlane(),e&&this.emitShapeEdit()}addPoint(e,a,r=0){let t=this.activeShapePoints.value?.[r];t[e]&&(this.updateShapePoints(t.reduce((r,t,n)=>(r.push(t),n===e&&(hV(a),r.push(a)),r),[])),this.startDrag(e+1,r))}removePoint(e,a=0){let r=this.activeShapePoints.value?.[a];if(!r[e])return;let t=\"polygon\"===this.editingMode||\"polygon3d\"===this.editingMode||\"prism\"===this.editingMode?3:2;if(r.length<=t){hB.Z.warn(uP(\"web.p_map.line_area_least_point_tips\",{length:t}));return}this.updateShapePoints(r.filter((a,r)=>r!==e)),this.emitShapeEdit()}getCurrentShape(){return this.activeShapePoints.value?.[0]?.map(e=>pg.KO(e,!0))}emitShapeEdit(e=\"endpoint\"){if(!this.disable&&!!this.activeElement)\"circle\"===this.editingMode?this.manager.emit(\"finishEdit\",{type:this.editingMode,origin:this.activeElement,shape:this.activeCirclePosParams,changeType:e}):\"pin\"!==this.editingMode&&((this.activeElement instanceof hW||this.activeElement instanceof h8)&&(this.activeElement.positions=this.getCurrentShape()),this.manager.emit(\"finishEdit\",{type:this.editingMode,origin:this.activeElement,shape:this.getCurrentShape(),changeType:e}))}pinStatus;mountPin(){let e=this.activeElement,a=e.getAuxiliaryPositions();this.activeShapePoints.value=[a||[]],e.dynamize(a?.[0])}unmountPin(){this.activeElement&&this.activeElement.stabilize()}initPinStatus(){this.pinStatus={horizontalMoving:!1,verticalMoving:!1,plane:null,ellipsoid:null}}pinLeftDown(e){let a=this.manager.viewer,[r]=p5(a,e.position);if(r){let e=this.activeElement;if(this.manager.getElement(r)===e){this.pinStatus.verticalMoving=!0,e.clampToGround&&(e.clampToGround=!1),this.mountPin();let r=this.activeShapePoints.value?.[0]?.[1];return r&&(this.pinStatus.plane=me(r,a)),!0}}return!1}pinMouseMove(e){if(!this.pinStatus.verticalMoving)return!1;let a=this.activeShapePoints.value?.[0];if(!a)return!1;let r=a[1];if(r&&this.pinStatus.plane){let t=this.manager.viewer.scene.camera.getPickRay(e.endPosition);if(!t)return!1;let n=uf.IntersectionTests.rayPlane(t,this.pinStatus.plane);if(n){let{height:e}=uf.Cartographic.fromCartesian(n),{longitude:t,latitude:i}=uf.Cartographic.fromCartesian(r);this.activeShapePoints.value=[[a[0],uf.Cartesian3.fromRadians(t,i,e)]],this.activeElement instanceof hG&&this.activeElement.updateHeight(e)}}return!0}pinLeftUp(){let e=!1;this.pinStatus.horizontalMoving&&(this.pinStatus.horizontalMoving=!1,this.pinStatus.ellipsoid=null,e=!0),this.pinStatus.verticalMoving&&(this.pinStatus.verticalMoving=!1,e=!0),e&&this.activeElement&&(this.manager.screenSpaceCameraController.startMouse(),this.unmountPin(),this.manager.emit(\"finishEdit\",{type:this.editingMode,origin:this.activeElement,shape:[(0,pg.KO)(this.activeShapePoints.value?.[0]?.[1],!0)],changeType:\"endpoint\"}))}enterEdit(e,a,r){this.manager.setMode(\"edit\"),this.cleanEdit(),this.editing=!0,this.editingMode=e,this.editingModeReactive.value=e,this.activeElement=a,this.disable=!!r,a instanceof hG?(a.active(\"selected\",!0),this.initPinStatus(),!this.disable&&a.update({hoverCursor:mK})):a instanceof h8?this.mountPolyline():a instanceof gr?this.mountPolyline3D():a instanceof hW?this.mountPolygon():a instanceof hY?this.mountPolygon3D():a instanceof gs?this.mountPrism():a instanceof hp?this.mountCylinder():a instanceof g_?a.active(\"selected\",!0):this.mountCircle(),this.postMountElement(),hL(a)&&a instanceof hG&&a.updateLabeling(this.manager.id,{visible:!0})}postMountElement(){this.updateEditPointSelection()}updateEditPointSelection(){if(!this.activeTypedElement)return;let{endPoint:e}=this.config;e&&this.emit(\"editing-point-change\",{activePointArrayIndex:0,activePointIndex:0})}cleanEdit(){let e=this.activeElement;this.editingModeReactive.value=\"\",e&&(e.active(\"selected\",!1),e instanceof hG?(this.initPinStatus(),!this.disable&&e.update({hoverCursor:\"\"})):!this.disable&&(e instanceof mX?e.stabilize(this.activeCirclePosParams):!(e instanceof g_)&&e.stabilize(this.activeShapePoints.value?.[0]),(e instanceof hY||e instanceof gs||e instanceof hp||e instanceof gr)&&e.exitEdit()));let a=null!==e;this.activeElement=null,this.activeShapePoints.value=[],this.cleanPickingPlane(),a&&this.manager.viewer&&this.manager.placer.executePlacement(),this.activeCirclePosParams.radius=0,this.activeCirclePosParams.centerPos=void 0,this.activeCirclePosParams.centerPosCartesian3=void 0,this.activeCirclePosParams.circleEdgePoint=void 0}exitEdit(){this.editing&&(!this.manager.onEditingOrDrawing&&this.manager.setHotKeyTips(su.esc,\"\"),this.emitShapeEdit(),this.cleanEdit(),this.editing=!1,this.manager.emit(\"exitEdit\"),this.emit(\"exit-edit\"),this.manager.clearMode(\"edit\"))}updateConfig(e){Object.assign(this.config,e),this.updateEditPointSelection()}}function hK(){return{label:{distanceVisible:!0,alphaVisible:!0,labelingVisible:!0},polygon:{distanceVisible:!0,alphaVisible:!0},all:{visible:!0}}}class"
}