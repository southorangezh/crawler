{
  "metadata": {
    "source_file": "map-app\\static\\js\\index.5da8ba4c.js",
    "chunk_index": 8,
    "total_chunks": 918,
    "chunk_size": 16386,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:50.144Z"
  },
  "content": "baseLeft = reverseBase;\\n\\n if(startType == SHAPE_TYPE_END) {\\n baseLeft = halfB;\\n }\\n\\n if(endType == SHAPE_TYPE_END) {\\n base += halfB;\\n }\\n\\n // 这里用来解决圆形端点的裂缝问题\\n float circleOffset = 0.01 * baseLeft;\\n\\n float halfWidth = 0.08;\\n\\n // 左侧 \\n if(st.s < baseLeft) {\\n\\n if(outlineShow) {\\n halfWidth += outlineWidth;\\n }\\n\\n float ptOnUpperLineLeft = 0.5 + halfWidth;\\n float ptOnLowerLineLeft = 0.5 - halfWidth;\\n\\n if(startType == SHAPE_TYPE_CIRCLE && st.s < baseLeft - circleOffset) {\\n float r = baseLeft / 2.0;\\n vec2 leftCenter = vec2(r, 0.5);\\n\\n ptOnUpperLineLeft = getCirclePointOnLine(leftCenter, r, st.s, 1.0);\\n ptOnLowerLineLeft = getCirclePointOnLine(leftCenter, r, st.s, 0.0);\\n } else if(startType == SHAPE_TYPE_END) {\\n ptOnUpperLineLeft = 1.0;\\n ptOnLowerLineLeft = 0.0;\\n } else if(startType == SHAPE_TYPE_ARROW) {\\n vec2 leftCenter = vec2(0.0, 0.5);\\n ptOnUpperLineLeft = getArrowPointOnLine(vec2(baseLeft, 1.0), leftCenter, st.s);\\n ptOnLowerLineLeft = getArrowPointOnLine(vec2(baseLeft, 0.0), leftCenter, st.s);\\n }\\n\\n float t = 1.0 - step(ptOnUpperLineLeft, st.t);\\n t *= step(ptOnLowerLineLeft, st.t);\\n\\n float d1 = czm_infinity;\\n if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\\n {\\n d1 = abs(st.s - baseLeft);\\n }\\n float d2 = abs(st.t - ptOnUpperLineLeft);\\n float d3 = abs(st.t - ptOnLowerLineLeft);\\n float dist = min(min(d1, d2), d3);\\n\\n float dtUpper = abs(st.t - ptOnUpperLineLeft);\\n dtUpper = step(dtUpper, outlineWidth);\\n\\n float dtLower = abs(st.t - ptOnLowerLineLeft);\\n dtLower = step(dtLower, outlineWidth);\\n\\n vec4 contentColor;\\n if(outlineShow) {\\n contentColor = mix(color, outlineColor, clamp(dtUpper + dtLower, 0.0, 1.0));\\n } else {\\n contentColor = color;\\n }\\n\\n vec4 outsideColor = vec4(0.0);\\n vec4 currentColor = mix(outsideColor, contentColor, clamp(t, 0.0, 1.0));\\n vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist, 0.05);\\n\\n outColor = czm_gammaCorrect(outColor);\\n material.diffuse = outColor.rgb;\\n material.alpha = outColor.a;\\n \\n return material;\\n } else if(st.s <= base) {\\n\\n float fuzzFactor = 0.1; // 效果比较好的经验值\\n if(lineWidth > 10.0) {\\n fuzzFactor = 0.05; // 效果比较好的经验值\\n }\\n\\n if(outlineShow) {\\n halfWidth += outlineWidth;\\n }\\n\\n float ptOnUpperLineRight = 0.5 + halfWidth;\\n float ptOnLowerLineRight = 0.5 - halfWidth;\\n\\n float s = step(0.5 - halfWidth, st.t);\\n s *= 1.0 - step(0.5 + halfWidth, st.t);\\n s *= 1.0 - step(base, st.s);\\n\\n float t = step(base, materialInput.st.s);\\n t *= 1.0 - step(ptOnUpperLineRight, st.t);\\n t *= step(ptOnLowerLineRight, st.t);\\n\\n // Find the distance from the closest separator (region between two colors)\\n float d1 = abs(st.t - (0.5 - halfWidth));\\n float d2 = abs(st.t - (0.5 + halfWidth));\\n float dist = min(d1, d2);\\n\\n float dtUpper = abs(st.t - (0.5 + halfWidth));\\n dtUpper = step(dtUpper, outlineWidth);\\n\\n float dtLower = abs(st.t - (0.5 - halfWidth));\\n dtLower = step(dtLower, outlineWidth);\\n\\n vec4 contentColor;\\n if(outlineShow) {\\n contentColor = mix(color, outlineColor, clamp(dtUpper + dtLower, 0.0, 1.0));\\n } else {\\n contentColor = color;\\n }\\n\\n vec4 outsideColor = vec4(contentColor.r, contentColor.g, contentColor.b, 0.0);\\n vec4 currentColor = mix(outsideColor, contentColor, clamp(s + t, 0.0, 1.0));\\n\\n vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist, fuzzFactor);\\n\\n\\n float delta = outlineWidth * 10.0;\\n\\n outColor = czm_gammaCorrect(outColor);\\n material.diffuse = outColor.rgb;\\n material.alpha = outColor.a;\\n return material;\\n } else {\\n\\n if(outlineShow) {\\n halfWidth += outlineWidth;\\n }\\n\\n float ptOnUpperLineRight = 0.5 + halfWidth;\\n float ptOnLowerLineRight = 0.5 - halfWidth;\\n\\n if(endType == SHAPE_TYPE_CIRCLE && st.s > base + circleOffset) {\\n float r = reverseBase / 2.0;\\n vec2 rightCenter = vec2(1.0 - r, 0.5);\\n\\n ptOnUpperLineRight = getCirclePointOnLine(rightCenter, r, st.s, 1.0);\\n ptOnLowerLineRight = getCirclePointOnLine(rightCenter, r, st.s, 0.0);\\n } else if(endType == SHAPE_TYPE_END) {\\n ptOnUpperLineRight = 1.0;\\n ptOnLowerLineRight = 0.0;\\n } else if(endType == SHAPE_TYPE_ARROW) {\\n vec2 rightCenter = vec2(1.0, 0.5);\\n\\n ptOnUpperLineRight = getArrowPointOnLine(vec2(base, 1.0), rightCenter, st.s);\\n ptOnLowerLineRight = getArrowPointOnLine(vec2(base, 0.0), rightCenter, st.s);\\n }\\n\\n float s = step(0.5 - halfWidth, st.t);\\n s *= 1.0 - step(0.5 + halfWidth, st.t);\\n s *= 1.0 - step(base, st.s);\\n\\n float t = step(base, materialInput.st.s);\\n t *= 1.0 - step(ptOnUpperLineRight, st.t);\\n t *= step(ptOnLowerLineRight, st.t);\\n\\n // Find the distance from the closest separator (region between two colors)\\n\\n float d1 = czm_infinity;\\n if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\\n {\\n d1 = abs(st.s - base);\\n }\\n float d2 = abs(st.t - ptOnUpperLineRight);\\n float d3 = abs(st.t - ptOnLowerLineRight);\\n float dist = min(min(d1, d2), d3);\\n\\n float dtUpper = abs(st.t - ptOnUpperLineRight);\\n dtUpper = step(dtUpper, outlineWidth);\\n\\n float dtLower = abs(st.t - ptOnLowerLineRight);\\n dtLower = step(dtLower, outlineWidth);\\n\\n vec4 contentColor;\\n if(outlineShow) {\\n contentColor = mix(color, outlineColor, clamp(dtUpper + dtLower, 0.0, 1.0));\\n } else {\\n contentColor = color;\\n }\\n\\n vec4 outsideColor = vec4(contentColor.r, contentColor.g, contentColor.b, 0.0);\\n vec4 currentColor = mix(outsideColor, contentColor, clamp(s + t, 0.0, 1.0));\\n\\n vec4 outColor = czm_antialias(outlineColor, color, currentColor, dist, 0.05);\\n\\n outColor = czm_gammaCorrect(outColor);\\n material.diffuse = outColor.rgb;\\n material.alpha = outColor.a;\\n return material;\\n }\\n}\\n\"},translucent:!0});class h6{constructor(e){this.color=e.color||uf.Color.WHITE,this.startType=e.startType,this.endType=e.endType,this.outlineShow=e.outlineShow||!1,this.lineWidth=e.lineWidth,e.outlineShow?this.outlineColor=uf.Color.WHITE:this.outlineColor=this.color}color;startType;endType;outlineShow;outlineColor;lineWidth;definitionChanged=new uf.Event;isConstant=!0;equals(e){return this===e||e instanceof h6&&uf.Color.equals(this.color,e.color)&&this.startType===e.startType&&this.endType===e.endType&&this.outlineShow===e.outlineShow&&uf.Color.equals(this.outlineColor,e.outlineColor)&&this.lineWidth===e.lineWidth}getType(e){return h5}getValue(e,a){return!(0,uf.defined)(a)&&(a={}),a.color=this.color,a.startType=this.startType,a.endType=this.endType,a.outlineShow=this.outlineShow,a.outlineColor=this.outlineColor,a.lineWidth=this.lineWidth,a}}function h9(){return{label:{distanceVisible:!0,labelingVisible:!0},all:{visible:!0}}}class h8 extends(0,uX.AF)(pv,ph,pz){managers;constructor(e,a,r){super(),this.managers=a,this.entities=py({}),this.primitives=py({}),this.interactLevel=sc.Line,this._drawingPositions=[],this.label=py({}),this.colorProperty=void 0,this.activeState={selected:!1,recenter:!1,hover:!1},this.runtimeStates={},this.isIntersect=!1,this.isAreaExceed=!1,this.clampWatchers={},this.dynamic=!1,this.namePosition=null,this.nameClampWatcher=null,this.cacheNamePositionHeight=0,this._dynamicPositions=[],this.cacheViewModes={},this.cacheLabelingWindowPosition={},this.cacheScreenSpaceBoundingBox={},this.properties=Object.assign({id:(0,uW.k)(),fontSize:16},e),this.options=Object.assign({},r),this.init(),this.setCollectionMap()}properties;options;entities;primitives;interactLevel;_drawingPositions;label;get usePrimitive(){return(this.options.drawing||this.dynamic)&&!1===this.properties.clampToGround}get firstEntity(){return this.entities._values()[0]}get id(){return this.properties.id}get type(){return\"polyline\"}get typedElement(){return{type:this.type,element:this}}get positions(){return this.properties.positions||[]}set positions(e){if(this.properties.positions=e,!this.dynamic){let e=this.getPositionsCartesian3();this.dynamicPositions?e&&(this._dynamicPositions=e):(this.entities.polyline?.positionsSetter(new uf.ConstantProperty(e)),this.toggleClampWithoutHeight(),this.label.positionSetter(this.getNamePositionCartesian()||new uf.Cartesian3),this.managers.render?.())}this.usePrimitive&&e&&(this.drawingPositions=e)}get drawingPositions(){return this._drawingPositions}set drawingPositions(e){this._drawingPositions=e,this.updatePrimitive(),this.managers._keys().forEach(e=>{this.managers._get(e).editor.updatePositionsFor(this,!1,\"endpoint\")}),this.properties.needCheckIntersect&&this.emitIntersect(e),this.properties.needCheckArea&&this.emitAreaExceed(e)}setPositions(e,a=!1){if(a&&this.properties.needCheckArea&&this.emitAreaExceed(e),a&&this.properties.needCheckIntersect&&this.emitIntersect(e),this.drawingPositions=e,this.active(\"selected\")&&this.dynamic){let a=this.managers._get(f3).editor;if(a.activeElement===this)a.activeShapePoints.value=[e.map(e=>hV((0,pg.jL)(e)))]}else this.positions=e}get name(){return this.properties.name}set name(e){this.properties.name=e,this.label.textSetter(e||\"\"),this.managers.render?.()}get width(){return this.properties.width||3}set width(e){if(this.properties.width!==e){this.properties.width=e;let a=this.useCustomEndPoint&&this.properties.width?5.2*this.properties.width:this.properties.width;this.entities.polyline?.widthSetter(new uf.ConstantProperty(a)),this.managers.render?.()}}get clampToGround(){return this.properties.clampToGround||!1}set clampToGround(e){this.properties.clampToGround=e,this.entities.polyline?.clampToGroundSetter(new uf.ConstantProperty(e)),this.toggleClampWithoutHeight()}get clampWithoutHeight(){return this.properties.clampWithoutHeight||!1}set clampWithoutHeight(e){this.properties.clampWithoutHeight=e,this.toggleClampWithoutHeight()}get useCustomEndPoint(){let e=!!this.properties.customEndpoints,a=this.properties.customEndpoints?.start!==sw.normal||this.properties.customEndpoints?.end!==sw.normal;return e&&a}colorProperty;setColorProperty(e){this.colorProperty=e}get cssColor(){return this.properties.cssColor||\"#FFFFFF\"}set cssColor(e){this.properties.cssColor!==e&&(this.properties.cssColor=e,this.setColorProperty(new uf.ConstantProperty(uf.Color.fromCssColorString(this.properties.cssColor))),this.updateMaterial())}get errorCssColor(){return this.properties.errorCssColor||\"#FFFFFF\"}activeState;runtimeStates;getLabelRuntimeVisible(e=f3){let a=this.runtimeStates[e];!a&&(a=h9());let r=a.label,t=this.active();return!1!==this.properties.show&&r.distanceVisible&&r.labelingVisible||t}getTotalRuntimeVisible(e=f3){let a=this.runtimeStates[e];return!a&&(a=h9()),a.all.visible}updateShowByRuntimeState(e=f3){let a=this.entities._get(e);if(!a)return;let r=this.active();if(a.show=!1!==this.properties.show&&(this.getTotalRuntimeVisible()||r),!this.dynamic){let a=this.label._get(e);if(!a)return;a.show=this.getLabelRuntimeVisible(e)}}isIntersect;isAreaExceed;active(e=\"\",a){if(!this.properties.fromDraw)return!1;if((0,pg.ri)(a)&&e&&this.activeState[e]!==a){let{selected:r,recenter:t,hover:n}=this.activeState;this.activeState[e]=a,this.toggleActive(r||t||n)}if(e)return this.activeState[e];{let{selected:e,recenter:a,hover:r}=this.activeState;return e||a||r}}get boundingSphere(){let e=this.firstEntity?.polyline?.positions?.getValue(uf.JulianDate.now())||this.properties.positions?.map(e=>pg.jL(e));if(e)return uf.BoundingSphere.fromPoints(e)}get fontSize(){return this.properties.fontSize||16}set fontSize(e){this.properties.fontSize=e,this.label.fontSetter(this.getFont())}getFont(){return`600 ${this.fontSize}px ${pC}`}emitIntersect(e){let a=mP(e);a!==this.isIntersect&&(this.isIntersect=a,this.managers._get(f3).emit(\"elementSelfIntersection\",this,a,this.origin))}emitAreaExceed(e){let a=this.managers._get(f3).measurer.getHorizontalArea(e.map(pg.i9)),r=!!this.properties.maxArea&&a>this.properties.maxArea;r!==this.isAreaExceed&&(this.isAreaExceed=r,this.managers._get(f3).emit(\"elementAreaOversize\",this,{exceed:r,changeMode:sb.none,origin:this.origin}))}updatePrimitive(){let e=this.drawingPositions.map(e=>(0,pg.jL)(e,!1));this.managers._keys().forEach(a=>{this.removePrimitive(a),this.addPrimitive(a,e)})}applyWidth(){let e=this.width+(this.properties.outlineWidth||2);this.useCustomEndPoint&&(e=5.2*this.width),this.entities.polyline?.widthSetter(new uf.ConstantProperty(e)),this.managers.render?.()}update(e){if(this.isDestroyed)return;let a=this.properties;if((0,pg.ri)(e.name)&&(this.name=e.name),(0,pg.ri)(e.cssColor)&&(this.cssColor=e.cssColor),(0,pg.ri)(e.dash)&&(a.dash=e.dash),(0,pg.ri)(e.isFence)&&(a.isFence=e.isFence),(0,pg.ri)(e.dashMaskLength)&&(a.dashMaskLength=e.dashMaskLength),(0,pg.ri)(e.direction)&&(a.direction=e.direction),(0,pg.ri)(e.depthFailAlpha)&&(a.depthFailAlpha=e.depthFailAlpha),(0,pg.ri)(e.positions)&&(this.positions=e.positions),(0,pg.ri)(e.width)&&(this.width=e.width),(0,pg.ri)(e.outlineWidth)&&(a.outlineWidth=e.outlineWidth),(0,pg.ri)(e.show)&&(this.properties.show=e.show,this.entities.showSetter(e.show)),(0,pg.ri)(e.depthFailCssColor)&&(a.depthFailCssColor=e.depthFailCssColor),(0,pg.ri)(e.customEndpoints)&&(this.properties.customEndpoints=e.customEndpoints,this.applyWidth()),(0,pg.ri)(e.fontSize)&&(this.fontSize=e.fontSize),e.labelDistanceDisplayCondition&&(a.labelDistanceDisplayCondition=e.labelDistanceDisplayCondition,this.label.distanceDisplayConditionSetter(new uf.DistanceDisplayCondition(...e.labelDistanceDisplayCondition)),this.entities.polyline?.distanceDisplayConditionSetter(new uf.ConstantProperty(new uf.DistanceDisplayCondition(...e.labelDistanceDisplayCondition)))),e.labelScaleByDistance){a.labelScaleByDistance=e.labelScaleByDistance;let r=new uf.NearFarScalar(...e.labelScaleByDistance);this.label.scaleByDistanceSetter(r),this.label.pixelOffsetScaleByDistanceSetter(r)}e.placeable&&(a.placeable=e.placeable);let r=e.labelOccludedAlpha;(0,pg.ri)(r)&&(a.labelOccludedAlpha=0===r?void 0:r),(0,pg.ri)(e.labelEnableOccludeIn2dView)&&(a.labelEnableOccludeIn2dView=e.labelEnableOccludeIn2dView),pg.Pg.call(this,this.properties,{fromDraw:e.fromDraw}),this.updateRuntimeOccludeStyle(),this.updateMaterial(),(0,pg.ri)(e.contextmenu)&&(a.contextmenu=e.contextmenu),(0,pg.ri)(e.removable)&&(a.removable=e.removable),this.usePrimitive&&this.updatePrimitive()}edit(e){this.managers._get(f3).editor.enterEdit(\"line\",this,e)}getEntityOptions(){let e={id:this.id,show:this.properties.show,polyline:{positions:this.getPositionsCartesian3(),width:this.useCustomEndPoint&&this.properties.width?5.2*this.properties.width:this.properties.width,clampToGround:this.properties.clampToGround,zIndex:this.properties.zIndex}},a=this.properties.labelDistanceDisplayCondition?new uf.DistanceDisplayCondition(...this.properties.labelDistanceDisplayCondition):void 0,r=this.properties.labelScaleByDistance?new uf.NearFarScalar(...this.properties.labelScaleByDistance):void 0,t=this.getFont(),n={id:`${this.id}-label`,show:!1!==this.properties.show,position:this.getNamePositionCartesian()||new uf.Cartesian3,text:this.properties.name,...px,font:t,distanceDisplayCondition:a,scaleByDistance:r,pixelOffsetScaleByDistance:r,depthFailTranslucency:this.properties.labelOccludedAlpha,verticalOrigin:uf.VerticalOrigin.BOTTOM,pixelOffset:new uf.Cartesian2(0,-5)};return this.options.drawing&&(this.dynamic=!0,this.options.positionsCallback&&e.polyline&&(e.polyline.positions=new uf.CallbackProperty(this.options.positionsCallback,!1))),this.properties.dynamicPositions&&e.polyline&&(e.polyline.positions=this.getDynamicPositions(!0)),{options:e,labelOptions:n}}init(){this.setColorProperty(new uf.ConstantProperty(uf.Color.fromCssColorString(this.cssColor))),super.init(),this.toggleClampWithoutHeight()}toggleActive(e){let a=this.active();if(a!==e){if(a){let e=uf.Color.fromCssColorString(this.active(\"recenter\")?pI:pD),a=this.colorProperty;this.properties.customEndpoints&&this.useCustomEndPoint?this.entities.polyline?.widthSetter(new uf.ConstantProperty(((5.2*this.width)??3)+2)):this.properties.direction?this.entities.polyline?.widthSetter(new uf.ConstantProperty((this.width??3)+2/2)):this.properties.isFence?this.entities.polyline?.widthSetter(new uf.ConstantProperty(16)):this.entities.polyline?.widthSetter(new uf.ConstantProperty((this.width??3)+2)),this.entities.polyline?.materialSetter(this.getActiveMaterial());let r=this.getDepthFailMaterial();r&&!this.dynamic&&this.entities.polyline?.depthFailMaterialSetter(r),this.label.fillColorSetter(a?.getValue(uf.JulianDate.now())),this.label.outlineColorSetter(e),!this.active(\"selected\")&&this.active(\"hover\")&&(this.entities.polyline?.showSetter(new"
}