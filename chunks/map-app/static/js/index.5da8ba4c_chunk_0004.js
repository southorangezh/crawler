{
  "metadata": {
    "source_file": "map-app\\static\\js\\index.5da8ba4c.js",
    "chunk_index": 4,
    "total_chunks": 918,
    "chunk_size": 43949,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:50.140Z"
  },
  "content": "t=this.primitives[r];if(t&&t.showSetter(e.show),a.doubleSideAxis&&r.includes(\"axis\")){let a=this.primitives[`${r}_mirror`];a&&a.showSetter(e.show)}});let r=this.primitives._get(f3)?.translate_helper;r&&!1===e.show&&this.managers._get(f3).viewer.scene.primitives.remove(r)}let r=!1;if((0,pg.ri)(e.position)&&(a.position=e.position,r=!0),(0,pg.ri)(e.headingPitchRoll)&&(a.headingPitchRoll=e.headingPitchRoll,r=!0),(0,pg.ri)(e.distanceDisplayCondition)){a.distanceDisplayCondition=e.distanceDisplayCondition;let[r,t]=e.distanceDisplayCondition;this.primitives._values().forEach(e=>{Object.values(e).forEach(e=>{e instanceof uf.Model&&(e.distanceDisplayCondition=new uf.DistanceDisplayCondition(r,t))})})}r&&this.partModelReadyPromise.then(()=>{this.calculateProps(),this.managers.render?.()})}hasElementEditing(){let e=this.managers._get(f3).editor.activeElement;return e?.active()}onCameraChanged(e){if(!1===this.parallelAxisRenderOptimize||!this.hasElementEditing()||!this.show)return;let a=this.properties.directionUsed;!a&&(a=[\"green\",\"red\",\"blue\"]);let r=this.primitives._get(f3);if(!!r)a.forEach(a=>{let t=this.checkIfViewDirectionParallel(a,e.directionWC);[`${a}_axis_color`,`${a}_axis_color_mirror`,`${a}_axis_mask`,`${a}_axis_mask_mirror`].forEach(e=>{let a=r[e];a&&(a.show=!t)})}),this.managers.render?.()}onManagerAdd(e){this.addPrimitives(e),this.managers._get(e).addListener(\"cameraChanged\",this.onCameraChanged.bind(this))}onManagerRemove(e){this.removePrimitives(e),this.managers._get(e)?.removeListener(\"cameraChanged\",this.onCameraChanged.bind(this))}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}hasPrimitive(e){return this.primitives._keys().some(a=>{let r=this.primitives._get(a);return m7.some(a=>{let t=r[a]===e;return a.includes(\"axis\")?t||r[`${a}_mirror`]===e:t})})}removePrimitives(e){let a=this.primitives._get(e),r=this.managers._get(e);if(r&&a){let e=r.viewer.scene.primitives;m7.forEach(r=>{if(a[r]&&e.remove(a[r]),r.includes(\"axis\")&&this.properties.doubleSideAxis){let t=a[`${r}_mirror`];e.remove(t)}}),a.translate_helper&&e.remove(a.translate_helper)}this.primitives._remove(e)}onMouseEnter(e){!this.properties.hoverCursor&&this.managers._get(f3)?.hover.setCursor(\"grab\",\"hover\"),this.setHoverStyle(e,!0),super.onMouseEnter(e)}onMouseLeave(e){this.setHoverStyle(e,!1)}destroy(){this.managers._get(f3)?.removeListener(\"cameraChanged\",this.onCameraChanged.bind(this)),this.togglePartShowState(!1),this.primitives._keys().forEach(e=>{this.removePrimitives(e)}),this.removeCollectionMap()}}let hi={bottom:\"bottom\",top:\"top\",side:\"side\"};function ho(e,a,r,t){let n=`${e}_${a}_${hi[r]}`;return\"number\"==typeof t&&(n+=`_${t}`),n}function hs(e,a){let[r,t,n,i]=e.split(\"_\");if(t===a){let e=\"\";if(Object.keys(hi).forEach(a=>{hi[a]===n&&(e=a)}),e)return[e,Number(i)]}return!1}class hl{dragStatus=null;edgeDraggable=!1;canDrag(e,a){if(this.edgeDraggable&&!(0,pg.ri)(e)&&\"string\"==typeof a?.id){let e=hs(a?.id,this.id);if(e){let[a,r]=e;switch(a){case\"bottom\":case\"top\":return\"vertical\";case\"side\":return\"horizontal\"}}}return!1}startDrag(e,a,r){let t=hs(r?.id,this.id),n=this.managers._get(f3).viewer;if(t&&n){let r=n.scene.camera.getPickRay(e.position),[i,o]=t;if(\"vertical\"===a){let e;if(\"bottom\"===i?e=p8(this.height||0):\"top\"===i&&(e=p8(this.absoluteHeight)),e&&r){let a=uf.IntersectionTests.rayEllipsoid(r,e);if(a){let e=uf.Ray.getPoint(r,a.start||a.stop);return this.dragStatus={type:i},{position:e,clampToGround:!1}}}}else if(\"horizontal\"===a&&\"side\"===i&&\"number\"==typeof o){let e=this.startDragSide?.(o,r);if(e)return e}}return!1}onDrag(e,a){if(this.dragStatus){let e=(0,pg.KO)(a,!0);if(\"bottom\"===this.dragStatus.type&&(0,pg.ri)(e.height)&&e.height<this.absoluteHeight-.5){this.update({height:e.height,extrudedHeight:this.absoluteHeight-e.height});return}if(\"top\"===this.dragStatus.type&&(0,pg.ri)(e.height)){let a=this.height||0;e.height>a+.5&&this.update({extrudedHeight:e.height-a})}\"side\"===this.dragStatus.type&&\"number\"==typeof this.dragStatus.index&&this.updateSide?.(e)}}}function hd(e){let a=(0,pg.ri)(e.outColorCssString)?e.outColorCssString:\"#FF0000\",r=(0,pg.ri)(e.innerColorCssString)?e.innerColorCssString:\"#00FF00\",t=(0,pg.ri)(e.outAlpha)&&e.outAlpha>=0&&e.outAlpha<=1?e.outAlpha:.3,n=(0,pg.ri)(e.innerAlpha)&&e.innerAlpha>=0&&e.innerAlpha<=1?e.innerAlpha:.2;return new uf.Material({fabric:{type:\"DoubleSideSolidColor\",uniforms:{outColor:uf.Color.fromCssColorString(a),innerColor:uf.Color.fromCssColorString(r),outAlpha:t,innerAlpha:n},source:\"czm_material czm_getMaterial(czm_materialInput materialInput) {\\n czm_material m = czm_getDefaultMaterial(materialInput);\\n float side = dot(materialInput.positionToEyeEC, materialInput.normalEC);\\n m.alpha = side < 0.0 ? innerAlpha : outAlpha;\\n m.diffuse = side < 0.0 ? vec3(innerColor) : vec3(outColor);\\n return m;\\n}\"},translucent:e=>1!==e.uniforms.outAlpha&&1!==e.uniforms.innerAlpha})}let hc=uf.Math.DEGREES_PER_RADIAN;class hu{static fromLngLat(e,a,r=0){return{longitude:e,latitude:a,height:r}}static from(e,a){let r=hu.fromLngLat(e.longitude,e.latitude,e.height);return a.longitude&&(r.longitude=a.longitude),a.latitude&&(r.latitude=a.latitude),a.height&&(r.height=a.height),r}static clone(e){return hu.fromLngLat(e.longitude,e.latitude,e.height)}static zero(){return hu.fromLngLat(0,0)}static fromCartesian(e){let a=uf.Cartographic.fromCartesian(e);return{longitude:a.longitude*hc,latitude:a.latitude*hc,height:a.height}}}class hp extends(0,uX.AF)(pv,ph,pz,hl,pw){managers;properties;interactLevel;primitives;transformer;localMatrix;isAreaExceed;dragging;beforeDraggingRadius;beforeDraggingExtrudedHeight;beforeDraggingArea;constructor(e,a){super(),this.managers=a,this.interactLevel=sc.Area,this.primitives=py({}),this.localMatrix=uf.Matrix4.IDENTITY,this.isAreaExceed=!1,this.dragging=!1,this.beforeDraggingRadius=0,this.beforeDraggingExtrudedHeight=0,this.beforeDraggingArea=0,this.helperRadiusLine=void 0,this.helperSideLine=void 0,this.activeState={selected:!1,recenter:!1,hover:!1},this.properties=Object.assign({id:(0,uW.k)(),show:!0,type:\"cylinder\"},e),this.transformer=new hn({show:!1,headingPitchRoll:hn.EnuOrientationHpr,doubleSideAxis:!0,disableRotate:!0,directionUsed:[\"blue\"],onDragStart:this.onTransformerDragStart.bind(this),onDragMove:this.onTransformerDragMove.bind(this),onDragEnd:this.onTransformerDragEnd.bind(this)},a),this.init(),this.setCollectionMap()}get id(){return this.properties.id}get type(){return\"cylinder\"}get typedElement(){return{type:this.type,element:this}}get center(){return this.properties.center}get height(){return Number(this.properties.height)}get extrudedHeight(){return Number(this.properties.extrudedHeight)}get absoluteHeight(){return Number(this.height)+Number(this.extrudedHeight)}get cssColor(){return this.properties.cssColor}get outlineWidth(){return this.properties.outlineWidth}get modelMatrix(){return this.localMatrix}get circlePoints(){return mF(this.properties.center,this.properties.radius)}get averageCenter(){let e={longitude:0,latitude:0,height:this.height+this.extrudedHeight/2};return this.center&&(e.longitude=this.center.longitude,e.latitude=this.center.latitude),e}get radius(){return this.properties.radius}setCollectionMap(){this.managers._options.elements.add(\"cylinder\",this,[this.id])}get errorCssColor(){return this.properties.errorCssColor||\"#FFFFFF\"}update(e){let a=!1;Object.keys(e).forEach(r=>{let t=e[r];(0,pg.ri)(t)&&(this.properties[r]=t,[\"center\",\"radius\",\"height\",\"extrudedHeight\"].includes(r)&&(a=!0))}),this.render(),a&&(this.emitAreaExceed(),this.active()&&(this.managers.editor?.updatePositionsFor?.(this),this.updateEditingHelperLine(f3))),this.managers.render?.()}render(){this.primitives._keys().forEach(e=>{this.center&&this.radius&&(this.updateTransformer(),this.updatePolygonPrimitive(e),this.updatePolylinePrimitive(e))})}getTopArea(){let e=this.radius||0;return Math.PI*e*e}getAllArea(){let e=Math.PI*(this.radius||0)*2;return this.getTopArea()+e*this.extrudedHeight}checkAreaExceed(){let e={isAreaExceed:!1,areaChangeMode:sb.none},a=this.getTopArea(),r=this.getAllArea();if(this.properties.maxTopArea&&this.properties.maxAllArea){let t=a>this.properties.maxTopArea||r>this.properties.maxAllArea;e.isAreaExceed=t;let n=r>this.beforeDraggingArea?sb.grow:sb.shrink;e.areaChangeMode=n}return e}emitAreaExceed(){let{isAreaExceed:e,areaChangeMode:a}=this.checkAreaExceed();this.isAreaExceed!==e&&this.properties.needCheckArea&&(this.isAreaExceed=e,this.managers._get(f3).emit(\"elementAreaOversize\",this,{exceed:e,changeMode:a,origin:this.origin}))}onManagerAdd(e){this.addPrimitives(e),this.emitAreaExceed()}onManagerRemove(e){this.removePrimitives(e)}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}hasPrimitive(e){return this.primitives._keys().some(a=>{let r=this.primitives._get(a);return r.polygon===e||r.polyline===e})}addPrimitives(e){!this.primitives._get(e)&&this.primitives._add(e,{}),this.center&&this.radius&&(this.updatePolygonPrimitive(e),this.updatePolylinePrimitive(e))}updateModelMatrix(e){this.localMatrix=e,this.render()}updatePolygonPrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e),t=r.viewer.scene.primitives;r&&a&&(a.polygon&&t.remove(a.polygon),a.polygon=void 0,this.properties.show&&(a.polygon=t.add(function(e){let a=new uf.PolygonGeometry(e.getPolygonGeometryOptions()),r=new uf.GeometryInstance({geometry:a,id:e.id}),t=hd(e.getPolygonMaterialOptions()),n=new uf.MaterialAppearance({material:t,faceForward:!1});return new uf.Primitive({geometryInstances:[r],appearance:n,asynchronous:!1,modelMatrix:e.modelMatrix})}(this))))}updatePolylinePrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e),t=r.viewer.scene.primitives;r&&a&&(a.polyline&&t.remove(a.polyline),a.polyline=void 0,this.properties.show&&this.properties.outlined&&(a.polyline=t.add(function(e){let a=e.active(),r=e.circlePoints,t=[...r,r[0]],n=new uf.PolylineGeometry({positions:t.map(a=>(a.height=Number(e.height)+Number(e.extrudedHeight),(0,pg.jL)(a))),width:a?2*(e.outlineWidth||3):e.outlineWidth||2,vertexFormat:uf.PolylineMaterialAppearance.VERTEX_FORMAT}),i=new uf.GeometryInstance({geometry:n,id:ho(\"cylinder\",e.id,\"top\")}),o=new uf.PolylineGeometry({positions:t.map(a=>(a.height=e.height,(0,pg.jL)(a))),width:a?2*(e.outlineWidth||3):e.outlineWidth||2,vertexFormat:uf.PolylineMaterialAppearance.VERTEX_FORMAT}),s=new uf.GeometryInstance({geometry:o,id:ho(\"cylinder\",e.id,\"bottom\")}),l=e.isAreaExceed?e.errorCssColor:e.cssColor,d=new uf.PolylineMaterialAppearance({material:new uf.Material({fabric:{type:uf.Material.PolylineOutlineType,uniforms:{color:uf.Color.fromCssColorString(l||\"#fff\"),outlineColor:uf.Color.fromCssColorString(a?pI:l||\"#fff\"),outlineWidth:a?e.outlineWidth||3:0}}})}),c=new uf.PolylineMaterialAppearance({material:new uf.Material({fabric:{type:uf.Material.PolylineDashType,uniforms:{color:uf.Color.fromCssColorString(l||\"#fff\"),gapColor:new uf.Color(0,0,0,0),dashLength:16,dashPattern:255}}})});return new uf.Primitive({geometryInstances:[i,s],asynchronous:!1,appearance:d,depthFailAppearance:c,modelMatrix:e.modelMatrix})}(this))))}updateEditingHelperLine(e){let a=this.managers._get(e),r=a.viewer.scene.primitives;if(a){if(this.removeEditingHelperLinePrimitive(),(this.activeState.hover||this.activeState.selected)&&this.properties.show){let e=this.createHelperRadiusLinePrimitive();e&&(e.forEach(e=>r.add(e)),this.helperRadiusLine=e[0],this.helperSideLine=e[1])}a.render()}}removePrimitives(e){let a=this.primitives._get(e),r=this.managers._get(e);if(r&&a){let e=r.viewer.scene.primitives,t=a.polygon,n=a.polyline;t&&e.remove(t),n&&e.remove(n)}this.primitives._remove(e),this.removeEditingHelperLinePrimitive(e)}onTransformerDragStart(e){this.transformType=e,this.transformState=\"changing\"}onTransformerDragMove(e){this.updateModelMatrix(e),this.helperRadiusLine&&(this.helperRadiusLine.modelMatrix=this.localMatrix),this.helperSideLine&&(this.helperSideLine.modelMatrix=this.localMatrix),this.managers.render?.()}onTransformerDragEnd(){if(!this.center)return;let e=(0,pg.KO)(uf.Matrix4.multiplyByPoint(this.localMatrix,(0,pg.jL)(this.center),new uf.Cartesian3),!0);this.localMatrix=uf.Matrix4.IDENTITY,this.update({center:e,height:e.height});let a=\"rotate\"===this.transformType?\"rotate\":\"translate\";this.managers.editor?.updatePositionsFor?.(this,!0,a),this.transformType=\"\",this.updateEditingHelperLine(f3),this.transformState=\"static\"}updateTransformer(){this.transformer.update({position:this.averageCenter})}stabilize(){}destroy(){this.transformer.destroy(),this.primitives._keys().forEach(e=>{this.removePrimitives(e)}),this.removeCollectionMap()}getPolygonMaterialOptions(){let e=this.isAreaExceed;return{outColorCssString:e?this.properties.errorCssColor:this.properties.cssColor,innerColorCssString:e?this.properties.errorCssColor:this.properties.innerCssColor,outAlpha:(0,pg.ri)(this.properties.areaAlpha)?this.properties.areaAlpha:.3,innerAlpha:.4}}getPolygonGeometryOptions(){return this.properties.center&&this.properties.radius?{closeBottom:!!this.properties.closeBottom,closeTop:!!this.properties.closeTop,height:Number(this.properties.height),extrudedHeight:Number(this.properties.height)+Number(this.properties.extrudedHeight),polygonHierarchy:new uf.PolygonHierarchy(this.circlePoints.map(e=>(0,pg.jL)(e,!0)))}:{polygonHierarchy:new uf.PolygonHierarchy}}getEditActivePoints(){let e=this.center,a=this.circlePoints;if(!e||!Array.isArray(a)||0===a.length||!1===this.properties.show)return;let r=Number(this.height)+Number(this.extrudedHeight),t=hu.from(e,{height:r}),n=hu.from(a[0],{height:this.height}),i=hu.from(n,{height:r});return[[hu.from(e,{height:this.height}),n],[t,i]]}helperRadiusLine;helperSideLine;createHelperRadiusLinePrimitive(){let e=this.getEditActivePoints();if(!e)return;let[[a,r],[t,n]]=e,i=(0,pg.jL)(a),o=(0,pg.jL)(t),s=(0,pg.jL)(r),l=(0,pg.jL)(n),d=new uf.PolylineMaterialAppearance({material:uf.Material.fromType(uf.Material.PolylineDashType,{color:uf.Color.fromCssColorString(\"#2D8CF0\").brighten(.6,new uf.Color)})}),c=new uf.GeometryInstance({geometry:new uf.PolylineGeometry({positions:[o,l],width:2})}),u=new uf.GeometryInstance({geometry:new uf.PolylineGeometry({positions:[i,s],width:2})}),p=new uf.Primitive({geometryInstances:[c,u],allowPicking:!1,appearance:d,modelMatrix:this.localMatrix,asynchronous:!1}),m=this.isAreaExceed,h=new uf.PolylineMaterialAppearance({material:uf.Material.fromType(uf.Material.PolylineOutlineType,{color:uf.Color.fromCssColorString((m?this.properties.errorCssColor:this.cssColor)||\"#fff\"),outlineColor:uf.Color.fromCssColorString(\"#fff\"),outlineWidth:3})}),g=new uf.GeometryInstance({geometry:new uf.PolylineGeometry({positions:[s.clone(),l.clone()],width:6})});return[p,new uf.Primitive({geometryInstances:[g],allowPicking:!1,appearance:h,modelMatrix:this.localMatrix,asynchronous:!1})]}removeEditingHelperLinePrimitive(e=f3){let a=this.managers._get(e).viewer.scene.primitives;this.helperRadiusLine&&a.remove(this.helperRadiusLine),this.helperSideLine&&a.remove(this.helperSideLine)}activeState;toggleActive(){this.updateEditingHelperLine(f3),this.primitives._keys().forEach(e=>{this.updatePolylinePrimitive(e)})}cleanDragging(){this.beforeDraggingRadius=0,this.beforeDraggingExtrudedHeight=0,this.beforeDraggingArea=0}resetPositions(){this.update({radius:this.beforeDraggingRadius,extrudedHeight:this.beforeDraggingExtrudedHeight}),this.managers.editor?.updatePositionsFor?.(this)}startDrag(e,a,r){return this.setDragging(!0),super.startDrag(e,a,r)}setDragging(e){if(this.dragging!==e){if(this.dragging=e,e)this.beforeDraggingRadius=this.radius||0,this.beforeDraggingExtrudedHeight=this.extrudedHeight,this.beforeDraggingArea=this.getAllArea();else{let{isAreaExceed:e,areaChangeMode:a}=this.checkAreaExceed();e&&a===sb.grow&&this.beforeDraggingRadius&&this.beforeDraggingArea&&this.resetPositions(),this.cleanDragging()}}}active(e=\"\",a){if(!this.properties.fromDraw)return!1;if((0,pg.ri)(a)&&e&&this.activeState[e]!==a&&(this.activeState[e]=a,this.toggleActive()),e)return this.activeState[e];{let{selected:e,recenter:a,hover:r}=this.activeState;return e||a||r}}static EditingCursor=\"default\";edit(e){this.managers._get(f3)?.editor?.enterEdit?.(\"cylinder\",this,e),this.managers._get(f3).hover.setCursor(hp.EditingCursor,\"hover\"),this.transformer.update({show:!0,position:this.averageCenter});let a=this.managers._get(f3).viewer.camera;this.transformer.onCameraChanged(a),this.edgeDraggable=!0}exitEdit(){this.removeEditingHelperLinePrimitive(),this.transformer.update({show:!1}),this.transformer.onDragging&&(this.localMatrix=uf.Matrix4.IDENTITY,this.transformer.endDrag()),this.edgeDraggable=!1}getPickingPlane(e){if(!this.center)return null;let a=\"bottom\"===e?hu.from(this.center,{height:this.height}):hu.from(this.center,{height:this.extrudedHeight+this.height}),r=(0,pg.jL)(a),t=uf.Cartesian3.normalize(r,new uf.Cartesian3);return uf.Plane.fromPointNormal(r,t)}endDrag(){this.setDragging(!1);let e=this.getEditActivePoints()?.flat();return e&&this.managers._get(f3).emit(\"finishEdit\",{type:\"cylinder\",origin:this,changeType:\"edge\",shape:e}),null}onMouseEnter(e){let a=hs(String(e.id),this.id);if(!1===a)return;let r=this.managers._get(f3).hover;this.activeState.selected&&[\"bottom\",\"top\"].includes(a[0])&&(r.setCursor(\"ns-resize\",\"hover\"),r.isCylinderHovering.value=!0)}onMouseLeave(e){if(!1!==hs(String(e.id),this.id))this.managers._get(f3).hover.setCursor(\"\",\"hover\"),this.managers._get(f3).hover.isCylinderHovering.value=!1}}class hm extends(0,uX.AF)(pv,ph,p_,pf){managers;constructor(e,a){super(),this.managers=a,this.entities=py({}),this.interactLevel=sc.Thing,this.globeWatchers={},this.cacheRect=new p2,this.cacheRectParts={billboard:new p2,label:new p2,point:new p2},this.properties=Object.assign({id:(0,uW.k)()},e),this.calculatePositionInCesium(),this.init(),this.setCollectionMap(),this.managers.render?.(),this.preventClickEvent=e.preventClickEvent||!1,this.properties.point?.clampToGround&&this.watchGlobe()}properties;entities;interactLevel;preventClickEvent;get id(){return this.properties.id}get position(){return this.properties.position}set position(e){this.properties.position=e,this.calculatePositionInCesium(),this.properties.point?.clampToGround&&this.watchGlobe()}get positionCartesian3(){return this.groundPositionCartesian3}get labelShow(){return this.properties.label?.show||!1}set labelShow(e){this.properties.label&&(this.properties.label.show=e,this.setEntityLabelShow(e))}update(e){if(e.id&&(this.properties.id=e.id),e.position&&(this.position=e.position),e.draggable&&(this.properties.draggable=e.draggable),e.distanceDisplayCondition){let a=new uf.ConstantProperty(new uf.DistanceDisplayCondition(...e.distanceDisplayCondition));this.properties.distanceDisplayCondition=e.distanceDisplayCondition,this.entities.label?.distanceDisplayConditionSetter(a),this.entities.point?.distanceDisplayConditionSetter(a),this.entities.billboard?.distanceDisplayConditionSetter(a)}if(e.scaleByDistance){let a=new uf.ConstantProperty(new uf.NearFarScalar(...e.scaleByDistance));this.properties.scaleByDistance=e.scaleByDistance,this.entities.label?.scaleByDistanceSetter(a),this.entities.point?.scaleByDistanceSetter(a),this.entities.billboard?.scaleByDistanceSetter(a),this.entities.label?.pixelOffsetScaleByDistanceSetter(a),this.entities.billboard?.pixelOffsetScaleByDistanceSetter(a)}(0,pg.ri)(e.label?.show)&&(this.labelShow=e.label?.show||!1),e.point?.show!==void 0&&(this.properties.point&&(this.properties.show=e.point.show),this.entities.point?.showSetter(new uf.ConstantProperty(!1!==this.properties.show))),e.point&&this.properties.point&&((0,pg.ri)(e.point.outlineWidth)&&(this.properties.point.outlineWidth=e.point.outlineWidth,this.entities.point?.outlineWidthSetter(new uf.ConstantProperty(e.point.outlineWidth))),(0,pg.ri)(e.point.outlineColor)&&(this.properties.point.outlineColor=e.point.outlineColor,this.entities.point?.outlineColorSetter(new uf.ConstantProperty(uf.Color.fromCssColorString(e.point.outlineColor)))),(0,pg.ri)(e.point.cssColor)&&(this.properties.point.cssColor=e.point.cssColor,this.entities.point?.colorSetter(new uf.ConstantProperty(uf.Color.fromCssColorString(e.point.cssColor))))),(0,pg.ri)(e.placeable)&&(this.properties.placeable=e.placeable)}stabilizePosition(){if(this.dynamicPosition){let e=this.dynamicPosition;super.stabilizePosition(),this.position=e}}dynamizePosition(e){super.dynamizePosition(e,!0),this.dynamicPositionCartesian3&&this.properties.point?.clampToGround&&(this.dynamicPositionCartesian3=this.managers._get(f3)?.picker.clamp(this.dynamicPositionCartesian3))}getEntityOptions(){let e=this.properties.distanceDisplayCondition?new uf.DistanceDisplayCondition(...this.properties.distanceDisplayCondition):void 0,a=this.properties.scaleByDistance?new uf.NearFarScalar(...this.properties.scaleByDistance):void 0,r=this.properties,{billboard:t,point:n,label:i}=r;return{id:r.id,show:r.show,position:this.groundPositionCartesian3,billboard:t?{show:!1!==t.show,image:t.image,width:t.width,height:t.height,disableDepthTestDistance:t.disableDepthTestDistance,depthFailTranslucency:t.occludedAlpha,distanceDisplayCondition:e,scaleByDistance:a,pixelOffsetScaleByDistance:a}:void 0,point:n?{show:!1!==n.show,disableDepthTestDistance:n.disableDepthTestDistance,color:function(e){if(e)return uf.Color.fromCssColorString(e)}(n?.cssColor),pixelSize:n.pixelSize,outlineWidth:n.outlineWidth,outlineColor:n.outlineColor?uf.Color.fromCssColorString(n.outlineColor):void 0,translucencyByDistance:n.translucencyByDistance?new uf.NearFarScalar(...n.translucencyByDistance):void 0,depthFailTranslucency:n.occludedAlpha,distanceDisplayCondition:e,scaleByDistance:a}:void 0,label:i?{text:i?.text,show:!1!==i.show,disableDepthTestDistance:i?.disableDepthTestDistance,fillColor:i?.fillColor?uf.Color.fromCssColorString(i?.fillColor):void 0,outlineColor:i?.outlineColor?uf.Color.fromCssColorString(i?.outlineColor):void 0,font:i?.font,horizontalOrigin:i?.horizontalOrigin?uf.HorizontalOrigin[i?.horizontalOrigin]:void 0,verticalOrigin:i?.verticalOrigin?uf.VerticalOrigin[i?.verticalOrigin]:void 0,style:i?.style?uf.LabelStyle[i?.style]:void 0,outlineWidth:i?.outlineWidth,pixelOffset:i?.pixelOffset?new uf.Cartesian2(...i?.pixelOffset):void 0,distanceDisplayCondition:e,scale:i?.scale||1,showBackground:i?.showBackground||pS(),backgroundColor:i?.backgroundColor?uf.Color.fromCssColorString(i?.backgroundColor):void 0,backgroundPadding:i?.backgroundPadding?new uf.Cartesian2(...i?.backgroundPadding):void 0,depthFailTranslucency:i?.occludedAlpha,scaleByDistance:a,pixelOffsetScaleByDistance:a}:void 0}}calculatePositionInCesium(){this.properties.position?(this.positionCartographic=(0,pg.i9)(this.properties.position),this.groundPositionCartesian3=(0,pg.jL)(this.properties.position),this.setEntityPosition()):(this.positionCartographic=void 0,this.groundPositionCartesian3=void 0)}positionCartographic;groundPositionCartesian3;globeWatchers;watchGlobe(){let e=this.positionCartographic;if(!!e)this.managers._keys().forEach(a=>{let r=this.globeWatchers[a];if(r)r.update(e);else{let r=this.managers._get(a).picker.clampWithWatcher(e,e=>this.updateGround(e));this.globeWatchers[a]=r}})}updateGround(e){e&&!this.dynamicPosition&&(this.groundPositionCartesian3=uf.Cartesian3.clone(e),this.setEntityPosition())}setEntityPosition(){this.entities.positionSetter(new uf.ConstantPositionProperty(this.groundPositionCartesian3))}setEntityLabelShow(e){this.entities.label?.showSetter(new uf.ConstantProperty(e))}unwatchGlobe(){Object.values(this.globeWatchers).forEach(e=>{e.unclamp()}),this.globeWatchers={}}setCollectionMap(){this.managers._options.elements.add(\"drag-point\",this,[this.id])}get anchor(){return this.properties.position?(0,pg.jL)(this.properties.position):null}startDrag(e,a){let r=super.startDrag(e,a),t=this.anchor;return r&&t?{position:t}:r}getLabelingWindowPosition(e){let a=this.managers._get(e)?.viewer.scene;if(!this.position)return null;let r=(0,pg.jL)(this.position),t=uf.SceneTransforms.wgs84ToWindowCoordinates(a,r);return t?t:null}get placeable(){return!!this.properties.placeable}set placeable(e){this.properties.placeable=e}cacheRect;cacheRectParts;getScreenSpaceBoundingBox(e){let a=this.managers._get(e)?.viewer.scene,r=this.entities._get(e);if(!a||!r||!this.anchor)return null;let t=void 0!==this.properties.label&&!!this.properties.label.show,n=void 0!==this.properties.billboard&&!!this.properties.billboard.show,i=void 0!==this.properties.point&&!!this.properties.point.show,o={billboard:n,label:t,point:i};if(n){let e=Number(this.properties.billboard?.width),r=Number(this.properties.billboard?.height),t=this.properties.billboard?.scaleByDistance?new uf.NearFarScalar(...this.properties.billboard?.scaleByDistance):void 0,n=m_({type:\"Billboard\",width:e,height:r,anchor:this.anchor,scene:a,hOrigin:this.properties.billboard?.horizontalOrigin?uf.HorizontalOrigin[this.properties.billboard?.horizontalOrigin]:uf.HorizontalOrigin.CENTER,vOrigin:this.properties.billboard?.verticalOrigin?uf.VerticalOrigin[this.properties.billboard.verticalOrigin]:uf.VerticalOrigin.BASELINE,pixelOffset:this.properties.billboard?.pixelOffset?uf.Cartesian2.fromArray(this.properties.billboard.pixelOffset):void 0,scaleByDistance:t,pixelOffsetScaleByDistance:t});n&&(this.cacheRectParts.billboard=n)}if(t){let e=String(this.properties.label?.text),r=String(this.properties.label?.font),t=this.properties.label?.scaleByDistance?new uf.NearFarScalar(...this.properties.label?.scaleByDistance):void 0,n=m_({type:\"Label\",text:e,font:r,scene:a,anchor:this.anchor,hOrigin:this.properties.label?.horizontalOrigin?uf.HorizontalOrigin[this.properties.label?.horizontalOrigin]:uf.HorizontalOrigin.CENTER,vOrigin:this.properties.label?.verticalOrigin?uf.VerticalOrigin[this.properties.label.verticalOrigin]:uf.VerticalOrigin.BASELINE,pixelOffset:this.properties.label?.pixelOffset?uf.Cartesian2.fromArray(this.properties.label.pixelOffset):void 0,scaleByDistance:t,pixelOffsetScaleByDistance:t});n&&(this.cacheRectParts.label=n)}if(i&&r.point&&this.anchor){let e=function(e,a,r){let t;if(e instanceof uf.PointGraphics){if(!r)return null;t=r}else t=e.position;let n=uf.SceneTransforms.wgs84ToWindowCoordinates(a,t);if(!n||mm(n,a))return null;let i=uf.JulianDate.now(),o=\"number\"==typeof e.pixelSize?e.pixelSize:e.pixelSize?.getValue(i),s=o/2+(\"number\"==typeof e.outlineWidth?e.outlineWidth:e.outlineWidth?.getValue(i)),l=new p2;return l.xMin=n.x-s,l.yMin=n.y-s,l.xMax=n.x+s,l.yMax=n.y+s,l}(r.point,a,this.anchor);e&&(this.cacheRectParts.point=e)}return Object.keys(this.cacheRectParts).forEach(e=>{if(!o[e])return;let a=this.cacheRectParts[e],r=this.cacheRect;p2.union(a,r,r)}),this.cacheRect}resetPlacement(e){}getCurrentPlacement(e){return\"Top\"}nextPlacement(e){return\"UnSet\"}updateLabelingVisible(e,a){this.entities.label?.showSetter(new uf.ConstantProperty(a))}updateLabeling(e,{visible:a,placement:r}){let t=this.entities._get(e);t?.label&&void 0!==a&&(t.label.show=new uf.ConstantProperty(a))}canPlaceable(e){if(!this.placeable)return!1;let{screenRect:a,manager:r,managerId:t}=e,n=this.getScreenSpaceBoundingBox(t);if(!n||!p2.intersect(a,n,7))return!1;let i=this.properties.distanceDisplayCondition;if(i&&this.anchor){let e=r.viewer.camera.positionWC,a=uf.Cartesian3.distance(e,this.anchor);return a>i[0]||a<i[1]}return!0}dynamicDrag(e){this.entities.positionSetter(new uf.CallbackProperty(e,!1))}endDrag(){super.endDrag();let e=this.entities._values()[0];this.entities.positionSetter(new uf.ConstantPositionProperty(e?.position?.getValue(new uf.JulianDate)))}onManagerAdd(e){let a=this.managers._get(e);a&&(this.entities._add(e,a.viewer.entities.add(this.getEntityOptions())),this.afterManagerAdd(e))}onManagerRemove(e){let a=this.entities._get(e);a?.entityCollection.remove(a),this.entities._remove(e)}onManagerUpdate(e){let a=this.entities._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.entities._keys().forEach(e=>{let a=this.entities._get(e);a&&a.entityCollection.remove(a),this.entities._remove(e)}),this.unwatchGlobe()}}let hh=\"PolylineDashArrow\";uf.Material._materialCache.addMaterial(hh,{strict:!0,fabric:{type:hh,uniforms:{color:uf.Color.WHITE,gapColor:uf.Color.TRANSPARENT,dashLength:16,dashPattern:255},source:\"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nuniform vec4 color;\\nuniform vec4 gapColor;\\nuniform float dashLength;\\nuniform float dashPattern;\\n\\nin float v_polylineAngle;\\nin float v_width;\\n\\nconst float maskLength = 16.0;\\n\\nmat2 rotate(float rad) {\\n float c = cos(rad);\\n float s = sin(rad);\\n return mat2(\\n c, s,\\n -s, c\\n );\\n}\\n\\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\\n{\\n float slope = (p0.y - p1.y) / (p0.x - p1.x);\\n return slope * (x - p0.x) + p0.y;\\n}\\n\\nczm_material czm_getMaterial(czm_materialInput materialInput)\\n{\\n czm_material material = czm_getDefaultMaterial(materialInput);\\n\\n vec2 pos = rotate(v_polylineAngle) * gl_FragCoord.xy;\\n\\n // Get the relative position within the dash from 0 to 1\\n float dashPosition = fract(pos.x / (dashLength * czm_pixelRatio));\\n // Figure out the mask index.\\n float maskIndex = floor(dashPosition * maskLength);\\n // Test the bit mask.\\n float maskTest = floor(dashPattern / pow(2.0, maskIndex));\\n vec4 fragColor = (mod(maskTest, 2.0) < 1.0) ? gapColor : color;\\n\\n vec2 st = materialInput.st;\\n\\n#ifdef GL_OES_standard_derivatives\\n float base = 1.0 - abs(fwidth(st.s)) * 10.0 * czm_pixelRatio;\\n#else\\n float base = 0.975; // 2.5% of the line will be the arrow head\\n#endif\\n\\n vec2 center = vec2(1.0, 0.5);\\n float ptOnUpperLine = getPointOnLine(vec2(base, 1.0), center, st.s);\\n float ptOnLowerLine = getPointOnLine(vec2(base, 0.0), center, st.s);\\n\\n float halfWidth = 0.15;\\n float s = step(0.5 - halfWidth, st.t);\\n s *= 1.0 - step(0.5 + halfWidth, st.t);\\n s *= 1.0 - step(base, st.s);\\n\\n float t = step(base, materialInput.st.s);\\n t *= 1.0 - step(ptOnUpperLine, st.t);\\n t *= step(ptOnLowerLine, st.t);\\n\\n // Find the distance from the closest separator (region between two colors)\\n float dist;\\n if (st.s < base)\\n {\\n if (fragColor.a < 0.005) { // matches 0/255 and 1/255\\n discard;\\n }\\n float d1 = abs(st.t - (0.5 - halfWidth));\\n float d2 = abs(st.t - (0.5 + halfWidth));\\n dist = min(d1, d2);\\n }\\n else\\n {\\n fragColor = color;\\n float d1 = czm_infinity;\\n if (st.t < 0.5 - halfWidth && st.t > 0.5 + halfWidth)\\n {\\n d1 = abs(st.s - base);\\n }\\n float d2 = abs(st.t - ptOnUpperLine);\\n float d3 = abs(st.t - ptOnLowerLine);\\n dist = min(min(d1, d2), d3);\\n }\\n\\n vec4 outsideColor = vec4(0.0);\\n vec4 currentColor = mix(outsideColor, fragColor, clamp(s + t, 0.0, 1.0));\\n vec4 outColor = czm_antialias(outsideColor, fragColor, currentColor, dist);\\n\\n outColor = czm_gammaCorrect(outColor);\\n material.diffuse = outColor.rgb;\\n material.alpha = outColor.a;\\n return material;\\n}\\n\"},translucent:!0});class hg{constructor(e=uf.Color.WHITE){this.color=e}color;definitionChanged=new Event;isConstant=!0;equals(e){return this===e||e instanceof hg&&Color.equals(this.color,e.color)}getType(e){return hh}getValue(e,a){return!defined(a)&&(a={}),a.color=this.color,a}}class hf extends(0,uX.AF)(pv,ph,pz){managers;constructor(e,a){super(),this.managers=a,this.interactLevel=sc.Thing,this.primitives=py({}),this.properties=Object.assign({show:!0},e),this.init(),this.setCollectionMap(\"frustum\")}interactLevel;properties;primitives;update(e){Object.keys(e).forEach(a=>{let r=e[a];(0,pg.ri)(r)&&(this.properties[a]=r)}),this.render()}render(){this.primitives._keys().forEach(e=>{this.updatePrimitive(e),this.updateOutlinePrimitive(e),this.updateDirectionPrimitive(e)})}addPrimitives(e){!this.primitives._get(e)&&this.primitives._add(e,{}),this.updatePrimitive(e),this.updateOutlinePrimitive(e),this.updateDirectionPrimitive(e)}updatePrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.main&&r.viewer.scene.primitives.remove(a.main),a.main=void 0,this.properties.show&&!this.properties.disableFrustum&&(a.main=r.viewer.scene.primitives.add(new uf.Primitive({geometryInstances:new uf.GeometryInstance({geometry:new uf.FrustumGeometry(this.getGeometryOptions()),attributes:{color:this.getColorAttribute()}}),appearance:new uf.PerInstanceColorAppearance({flat:!0}),asynchronous:!1}))))}updateOutlinePrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.outline&&r.viewer.scene.primitives.remove(a.outline),a.outline=void 0,this.properties.show&&this.properties.outlined&&(a.outline=r.viewer.scene.primitives.add(new uf.Primitive({geometryInstances:new uf.GeometryInstance({geometry:new uf.FrustumOutlineGeometry(this.getGeometryOptions()),attributes:{color:this.getColorAttribute(!0)}}),appearance:new uf.PerInstanceColorAppearance({flat:!0}),asynchronous:!1}))))}updateDirectionPrimitive(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.direction&&r.viewer.scene.primitives.remove(a.direction),a.direction=void 0,this.properties.show&&this.properties.direction&&(a.direction=r.viewer.scene.primitives.add(new uf.Primitive({geometryInstances:new uf.GeometryInstance({geometry:new uf.PolylineGeometry({positions:this.getDirectionPoints(),vertexFormat:uf.PolylineMaterialAppearance.VERTEX_FORMAT,width:8})}),appearance:new uf.PolylineMaterialAppearance({material:uf.Material.fromType(hh,{color:this.getColor(!0),dashLength:12})}),asynchronous:!1}))))}getPositionCartesian3(){return this.properties.position?(0,pg.jL)(this.properties.position):uf.Cartesian3.ZERO}getDirectionPoints(){let e=this.getPositionCartesian3(),a=uf.Ray.getPoint(new uf.Ray(e,uf.Matrix3.multiplyByVector(uf.Matrix3.fromQuaternion(this.getOrientation(!1)),uf.Cartesian3.UNIT_X,new uf.Cartesian3)),this.properties.far||2e3);return[e,a]}getOrientation(e=!0){let{headingPitchRoll:a}=this.properties,r=this.getPositionCartesian3();return r&&a?uf.Transforms.headingPitchRollQuaternion(r,uf.HeadingPitchRoll.fromDegrees(a.heading-90,a.pitch+(e?-90:0),a.roll)):uf.Quaternion.ZERO}getColor(e=!1){let a=uf.Color.fromCssColorString(this.properties.color||\"#FFFFFF\");return!e&&(a=uf.Color.fromAlpha(a,.2)),a}getColorAttribute(e=!1){return uf.ColorGeometryInstanceAttribute.fromColor(this.getColor(e))}getGeometryOptions(){let e=this.properties.fov;return(!e||e<=0||e>=180)&&(e=60),{frustum:new uf.PerspectiveFrustum(function(e,a,r,t=.1,n=5e8){let i,o;let s=Math.tan(.5*a);if(\"horizontal\"===r)i=a,o=2*Math.atan(s/e);else if(\"vertical\"===r)o=a,i=2*Math.atan(s*e);else{let a=Math.atan(e);i=2*Math.atan(Math.sin(a)*s),o=2*Math.atan(Math.cos(a)*s)}return{fov:e<=1?o:i,aspectRatio:e,near:t,far:n}}(this.properties.aspectRatio||1,uf.Math.toRadians(e),this.properties.fovType||\"horizontal\",.01,this.properties.far||2e3)),origin:this.getPositionCartesian3(),orientation:this.getOrientation()}}onManagerAdd(e){this.addPrimitives(e)}onManagerRemove(e){this.removePrimitives(e)}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}hasPrimitive(e){return this.primitives._keys().some(a=>{let r=this.primitives._get(a);return r.main===e||r.outline===e||r.direction===e})}removePrimitives(e){let a=this.primitives._get(e),r=this.managers._get(e);r&&a&&(a.main&&r.viewer.scene.primitives.remove(a.main),a.outline&&r.viewer.scene.primitives.remove(a.outline),a.direction&&r.viewer.scene.primitives.remove(a.direction)),this.primitives._remove(e)}destroy(){this.primitives._keys().forEach(e=>{this.removePrimitives(e)}),this.removeCollectionMap()}}class h_ extends(0,uX.AF)(ph){managers;constructor(e,a){super(),this.managers=a,this.interactLevel=sc.Area,this.primitives=py({}),this.properties=Object.assign({show:!0,width:.5,cssColor:\"#414141\",clampToGround:!1},e),this.geometryInstances=[],this.init(),this.setCollectionMap(\"grid\")}properties;interactLevel;primitives;geometryInstances;get show(){return this.properties.show}set show(e){this.properties.show=e,this.primitives.showSetter(e)}get name(){return this.properties.name}set name(e){this.properties.name=e}addLineGeometry(e){let a;a=this.properties.clampToGround?new uf.GroundPolylineGeometry({positions:e,width:this.properties.width}):new uf.PolylineGeometry({positions:e,width:this.properties.width,vertexFormat:uf.PolylineMaterialAppearance.VERTEX_FORMAT}),this.geometryInstances.push(new uf.GeometryInstance({geometry:a}))}getPrimitive(){let e=new uf.PolylineMaterialAppearance({material:new uf.Material({fabric:{type:\"Color\",uniforms:{color:uf.Color.fromCssColorString(this.properties.cssColor)}}})});return this.properties.clampToGround?new uf.GroundPolylinePrimitive({geometryInstances:this.geometryInstances,appearance:e}):new uf.Primitive({geometryInstances:this.geometryInstances,appearance:e})}addPrimitive(e){let a=this.managers._get(e);a&&this.primitives._add(e,a.viewer.scene.primitives.add(this.getPrimitive()))}removePrimitive(e){let a=this.managers._get(e),r=this.primitives._get(e);a&&r&&(a.viewer.scene.primitives.remove(r),this.primitives._remove(e))}init(){let e;let{south:a,north:r,west:t,east:n}=this.properties.rectangle,i=this.properties.lineNumber,o=(n-t)/i,s=(r-a)/i;for(let i=t;i<=n;)e=uf.Cartesian3.fromDegreesArray([i,a,i,r]),this.addLineGeometry(e),i+=o;for(let i=a;i<=r;)e=uf.Cartesian3.fromDegreesArray([t,i,n,i]),this.addLineGeometry(e),i+=s;super.init()}update(e){let a=!0;(0,pg.ri)(e.rectangle)&&(this.properties.rectangle=e.rectangle,a=!0),(0,pg.ri)(e.lineNumber)&&(this.properties.lineNumber=e.lineNumber,a=!0),(0,pg.ri)(e.show)&&(this.show=e.show),(0,pg.ri)(e.name)&&(this.name=e.name),(0,pg.ri)(e.width)&&(this.properties.width=e.width,a=!0),(0,pg.ri)(e.lineNumber)&&(this.properties.lineNumber=e.lineNumber,a=!0),(0,pg.ri)(e.cssColor)&&(this.properties.cssColor=e.cssColor,a=!0),a&&(this.primitives._keys().forEach(e=>{this.removePrimitive(e)}),this.geometryInstances=[],this.init())}onManagerAdd(e){this.addPrimitive(e)}onManagerRemove(e){this.removePrimitive(e)}onManagerUpdate(e){let a=this.primitives._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){this.primitives._keys().forEach(e=>{this.removePrimitive(e)}),this.geometryInstances=[],super.destroy()}}let hb=\"terrain\";class hk extends(0,uX.AF)(ph){managers;constructor(e,a){super(),this.managers=a,this.type=hb,this.terrainProviders=py({}),this._ready=!1,this.readyPromise=new Promise(e=>this.resolveCallback=e),this.properties=Object.assign({},e),this.init(),this.setCollectionMap(hb)}type;properties;terrainProviders;_ready;resolveCallback;readyPromise;get boundingSphere(){let{rectangle:e}=this.properties;if(e){let a=uf.Rectangle.fromDegrees(e.west,e.south,e.east,e.north,new uf.Rectangle);return uf.BoundingSphere.fromPoints([uf.Rectangle.northeast(a),uf.Rectangle.northwest(a),uf.Rectangle.southeast(a),uf.Rectangle.southwest(a)].map(e=>uf.Cartesian3.fromRadians(e.longitude,e.latitude)))}}get ready(){return this._ready}get authToken(){let e=this.properties.authToken;return\"object\"==typeof e&&\"name\"in e&&\"value\"in e?e:null}getRectangle(){return this.properties.rectangle}async changeView(e=\"tilt\",a=f3){if(await this.readyPromise,this.boundingSphere){let r;let t=this.boundingSphere.center,n=this.boundingSphere.radius,i=uf.Cartographic.fromCartesian(t),o=(0,pg.vi)(i);r=\"tilt\"===e?-45:-90;let s=this.managers._get(a),l=this.terrainProviders._get(a),d=await s.computedPositionTerrainHeightOfApi({longitude:o.longitude,latitude:o.latitude});if(!l)return;let c=uf.Cartesian3.fromRadians(i.longitude,i.latitude,d);s.viewer.scene.camera.lookAt(c,new uf.HeadingPitchRange(0,uf.Math.toRadians(r),4*n)),s.viewer.camera.lookAtTransform(uf.Matrix4.IDENTITY),s.render()}}addTerrainProvider(e){let{url:a,show:r}=this.properties;if(this._ready=!1,!a)return;let t={};this.authToken&&(t[this.authToken.name]=this.authToken.value);let n=new uf.Resource({url:a,headers:t});uf.CesiumTerrainProvider.fromUrl(n).then(a=>{if(this.isDestroyed)return;this.terrainProviders._add(e,a),this._ready=!0,this.resolveCallback?.(this);let t=(0,uf.defaultValue)(r,!0),n=this.managers._get(e);n&&t&&a&&n.customTerrainProvider&&n.customTerrainProvider.addCustomTerrain(a)})}removeTerrainProvider(e){let a=this.terrainProviders._get(e),r=this.managers._get(e);r&&a&&r.customTerrainProvider&&(r.customTerrainProvider.removeCustomTerrain(a),this.terrainProviders._remove(e))}updateUrl(e){e&&this.managers._keys().forEach(e=>{this.removeTerrainProvider(e),this.addTerrainProvider(e)})}updateShow(e){e?this.managers._keys().forEach(e=>{let a=this.managers._get(e),r=this.terrainProviders._get(e);a&&r&&a.customTerrainProvider&&a.customTerrainProvider.addCustomTerrain(r)}):this.managers._keys().forEach(e=>{let a=this.managers._get(e),r=this.terrainProviders._get(e);a&&r&&a.customTerrainProvider&&a.customTerrainProvider.removeCustomTerrain(r)})}update(e){let{url:a,show:r,rectangle:t,authToken:n}=e;a&&a!==this.properties.url&&(this.properties.url=a,this.updateUrl(a)),(0,uf.defined)(r)&&r!==this.properties.show&&(this.properties.show=r,this.updateShow(r)),(0,uf.defined)(t)&&(this.properties.rectangle=t),(0,uf.defined)(n)&&(this.properties.authToken=n)}onManagerAdd(e){this.addTerrainProvider(e)}onManagerRemove(e){this.removeTerrainProvider(e)}onManagerUpdate(e){let a=this.terrainProviders._get(e),r=this.isShowIn(e);a&&!r&&this.onManagerRemove(e),!a&&r&&this.onManagerAdd(e)}destroy(){super.destroy(),this.managers._keys().forEach(e=>{this.removeTerrainProvider(e)})}}let hv=Object.freeze({UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7}),hz=Object.freeze({START:0,LOADING:1,DONE:2,FAILED:3});function hw(e){if(c2.wG.every(a=>0>e.indexOf(a)))return!1;let a=e.split(\"/\");if(3!==a.length)return!1;let r=Number(a[0]),t=Number(a[1]);return{x:t,y:Number(a[2].split(\".\")[0]),level:r}}class hy extends uf.ImageryLayer{constructor(e,a){super(e.imageryProvider,{}),this._imageryLayer=e,this._imageryProvider=e.imageryProvider,this.tileFiles=a}_imageryLayer;_imageryProvider;tileFiles;ignoreRegionLimitation=!1;_requestImagery(e){let a=this._imageryProvider,r=this._imageryLayer,t=this;function n(a){if(!(0,pg.ri)(a))return i();e.image=a,e.state=hv.RECEIVED,e.request=void 0,uf.TileProviderError.reportSuccess(r._requestImageError)}function i(n){if(e.request.state===uf.RequestState.CANCELLED){e.state=hv.UNLOADED,e.request=void 0;return}e.state=hv.FAILED,e.request=void 0,t.isCurrentImagery(e)&&(r._requestImageError=uf.TileProviderError.reportError(r._requestImageError,a,a.errorEvent,r.getMessage(e),e.x,e.y,e.level,n),r._requestImageError.retry&&o())}function o(){if(!t.isCurrentImagery(e)&&!t.ignoreRegionLimitation){e.request=void 0,e.state=hv.FAILED;return}let r=new uf.Request({throttle:!1,throttleByServer:!0,type:uf.RequestType.IMAGERY});e.request=r,e.state=hv.TRANSITIONING;let o=a.requestImage(e.x,e.y,e.level,r);if(!(0,pg.ri)(o)){e.state=hv.UNLOADED,e.request=void 0;return}(0,pg.ri)(a.getTileCredits)&&(e.credits=a.getTileCredits(e.x,e.y,e.level)),Promise.resolve(o).then(n,i)}o()}getMessage(e){return`Failed to obtain image tile X: ${e.x} Y: ${e.y} Level: ${e.level}.`}isCurrentImagery(e){if(this._imageryProvider,!function(e,a){let r=!1;if(Array.isArray(e))for(let t=0;t<e.length;t++){let n=hw(e[t].name);if(n){let{x:e,y:t,level:i}=n;if(e===a.x&&t===a.y&&i===a.level){r=!0;break}}}else{let t=e[a.level]?.[a.x];if(t)for(let e=0;e<t.length;e++){let{begin_y:n,end_y:i}=t[e];if(n<=a.y&&a.y<=i){r=!0;break}}}return r}(this.tileFiles,e))return this.getMessage(e),!1;return!0}isDestroyed(){return!1}}let hS=\"2dModel\";class hj extends(0,uX.AF)(ph){managers;constructor(e,a){super(),this.managers=a,this.type=hS,this.imageryLayers=py({}),this.customFiles=[],this._terrainShowed=!1,this.properties=Object.assign({},e),this.init(),this.setCollectionMap(hS)}type;properties;imageryLayers;terrain;get"
}