{
  "metadata": {
    "source_file": "map-app\\static\\js\\index.5da8ba4c.js",
    "chunk_index": 15,
    "total_chunks": 918,
    "chunk_size": 62635,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:50.149Z"
  },
  "content": "instanceof h8)&&!(e instanceof mX))e.updateLabeling(this.managerId,{visible:!0})}executeHoverPlacement(e){this.executeElPlacement(e)}scratchElGroupByLevel={[fN]:[],[fJ]:[],[fO]:[]};clearScratchElGroup(){let e=this.scratchElGroupByLevel;e[fN].length=0,e[fJ].length=0,e[fO].length=0}executeNormalPlacement(){let e=this.elementGroup.normal,a=this.scratchElGroupByLevel;this.clearScratchElGroup(),e.forEach(e=>{if(\"interactLevel\"in e)e.interactLevel===fN&&a[fN].push(e),e.interactLevel===fJ&&a[fJ].push(e),e.interactLevel===fO&&a[fO].push(e)}),this.staticIfNeed(\"start\");for(let e=fN;e>=fO;e--)this.executeSingleLevelElGroupPlacement(a[e]);this.staticIfNeed(\"end\")}executeSingleLevelElGroupPlacement(e){e.sort(this.sortElements.bind(this)),e.forEach(e=>{this.executeElPlacement(e)})}executeElPlacement(e){e.resetPlacement(this.managerId);let a=e.getCurrentPlacement(this.managerId);for(;\"UnSet\"!==a;){let r=e.getScreenSpaceBoundingBox(this.managerId,a);if(!r||0!==this.currentIndex.query(r).size){a=e.nextPlacement(this.managerId);continue}this.currentIndex.insert({data:{el:e},rect:r}),e.updateLabeling(this.managerId,{placement:a,visible:!0});return}e.updateLabeling(this.managerId,{visible:!1})}selectManagerElements(e){this.elements.set.forEach(a=>{(a instanceof hW||a instanceof h8||a instanceof hG||a instanceof mX||a instanceof gr||a instanceof hY)&&e.includes(a.category)&&a.canPlaceable(this)&&this.selectedElements.push(a)})}selectEditOrDrawElements(){let e=this.drawer.getDrawingMode(),a=this.editor.getEditing(),r=this.editor.editingMode,t=e===c2.oO.polygon||\"polygon\"===r,n=e===c2.oO.line||\"line\"===r&&a;(t||n)&&this.elements.set.forEach(e=>{e instanceof hm&&e.canPlaceable(this)&&this.selectedElements.push(e)})}tsaPops=new Set;addTsaPop(e){this.tsaPops.add(e),this.executePlacement({owner:\"tsa\",categories:[]})}removeTsaPop(e){this.tsaPops.delete(e),this.executePlacement({owner:\"tsa\",categories:[]})}selectTSAElements(){this.tsaPops.forEach(e=>{let a=e.getScreenSpaceBoundingBox(this.managerId);a&&!this.outsideScreen(a)&&this.selectedElements.push(e)})}groupByElementState(){let e=this.selectedElements;if(e.length<=1)return;let a=this.elementGroup,r=this.activeEditEl,t=this.activeDrawEl;r&&hL(r)&&(a.active=r),t&&hL(t)&&(a.active=t);let n=this.hover.hoveringElement;n&&hL(n)&&(a.hover=n),a.normal=e.filter(e=>e!==a.active&&e!==a.hover)}}let fG=`uniform vec4 color; uniform float repeat; uniform float offset; uniform float thickness; czm_material czm_getMaterial(czm_materialInput materialInput) { czm_material material = czm_getDefaultMaterial(materialInput); float sp = 1.0/repeat; vec2 st = materialInput.st; float dis = distance(st, vec2(0.5)); float m = mod(dis + offset, sp); float a = step(sp*(1.0-thickness), m); material.diffuse = color.rgb; material.alpha = a * color.a; vec3 normalMC = material.normal; if(normalMC.y < 0.0 && normalMC.z < 0.0) { discard; } return material; }`;class fH{manager;constructor(e){this.manager=e,this.collection=e.viewer.scene.primitives.add(new uf.LabelCollection)}collection;add(e){let a=this.collection.add(e);return a._depthFailTranslucency=e.depthFailTranslucency,a}remove(e){return this.collection.remove(e)}}class fB{manager;constructor(e){this.manager=e,this.collection=e.viewer.scene.primitives.add(new uf.BillboardCollection)}collection;add(e){let a=this.collection.add(e);return a._depthFailTranslucency=e.depthFailTranslucency,a}remove(e){return this.collection.remove(e)}}class fV{manager;constructor(e){this.manager=e,this.primitive=null,this.instances=[],this.updating=!1}primitive;instances;async init(){await uf.GroundPrimitive.initializeTerrainHeights(),this.instances.length&&!this.primitive&&(this.primitive=this.manager.viewer.scene.groundPrimitives.add(new uf.GroundPrimitive({geometryInstances:this.instances,appearance:new uf.PerInstanceColorAppearance({translucent:!0}),asynchronous:!1})))}destroy(){this.primitive&&!this.manager.viewer.isDestroyed()&&this.manager.viewer.scene.groundPrimitives.remove(this.primitive),this.primitive=null}updating;requestUpdate(){!this.updating&&(this.updating=!0,window.requestAnimationFrame(()=>{this.updating=!1,this.destroy(),this.init()}))}add(e){let a=new uf.GeometryInstance({id:e.id,geometry:new uf.PolygonGeometry({polygonHierarchy:e.polygonHierarchy}),attributes:{show:new uf.ShowGeometryInstanceAttribute(e.show),color:e.color?uf.ColorGeometryInstanceAttribute.fromColor(e.color):new uf.ColorGeometryInstanceAttribute}});return this.instances.push(a),this.requestUpdate(),a}remove(e){let a=this.instances,r=a.indexOf(e);-1!==r&&a.splice(r,1),this.requestUpdate()}updateAttributes(e,a){let r=this.instances.find(a=>a.id===e);if(r&&(void 0!==a.show&&(r.attributes.show=new uf.ShowGeometryInstanceAttribute(a.show)),a.color&&(r.attributes.color=uf.ColorGeometryInstanceAttribute.fromColor(a.color))),this.primitive){if(!this.primitive.ready)return;let r=this.primitive.getGeometryInstanceAttributes(e);r&&(void 0!==a.show&&(r.show=uf.ShowGeometryInstanceAttribute.toValue(a.show,r.show)),a.color&&(r.color=uf.ColorGeometryInstanceAttribute.toValue(a.color,r.color)))}return r}updateGeometry(e,a){let r=this.instances.find(a=>a.id===e);r&&(r.geometry=new uf.PolygonGeometry({polygonHierarchy:a})),this.requestUpdate()}}uf.Ion.defaultAccessToken=\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJjZjcyZDBjYy1jM2I1LTQ2MGItOWNjZC1iYjk1ZWE3YzRiNWEiLCJpZCI6MzI2NTUsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1OTczMDI2Njl9._apnc0_OVrjqSl2H8RwQJEVwNhAYyAcueIARFlrS7ew\";let fU=2*window.Math.atan(.5);async function fK(){let e=new uf.Resource({url:`${window.CURRENT_FE_ENV_CONFIG.terrainHost}/dem/api/v2/terrain-tiles/wgs84/`,queryParameters:{ak:window.CURRENT_FE_ENV_CONFIG.terrainKey}});return await uf.CesiumTerrainProvider.fromUrl(e,{forceRequestLayerJson:!0})}function fW(e){console.error(e)}async function fZ(e,a){if(e.viewer.isDestroyed())return{occluded:!1};let r=e.customTerrainProvider.getFallbackTerrainProvider();try{let e=uf.Cartographic.fromCartesian(a),t=e.height,n=await (0,uf.sampleTerrainMostDetailed)(r,[e]);return{occluded:n[0].height>t,surfaceHeight:n[0].height}}catch(e){fW(e)}return{occluded:!1}}async function fY(e,a){let{heading:r,pitch:t,direction:n,position:i}=a.viewer.camera,o=uf.Cartesian3.distance(i,e),s=function(e,a=100,r=1500,t=200){if(e<a)return a;if(e>r)return r;{let r=Math.round(e/t)*t;return 0===r?a:r}}(o,100,1500)-20,l={heading:0,pitch:uf.Math.toRadians(-90),roll:0};o<2e4&&(l.heading=r,l.pitch=t);let d=new uf.Cartesian3;if(o<2e4){let r=uf.Cartesian3.multiplyByScalar(n,-s,new uf.Cartesian3);uf.Cartesian3.add(e,r,d);let t=await fZ(a,d);if(t.occluded){let a=t.surfaceHeight+100,r=uf.Cartographic.fromCartesian(d);uf.Cartesian3.fromRadians(r.longitude,r.latitude,a,void 0,d);let{heading:n,pitch:i}=(0,fr.Il)(d,e);l.heading=n,l.pitch=i}}else{let a=uf.Cartographic.fromCartesian(e);a.height+=1500,uf.Cartesian3.fromRadians(a.longitude,a.latitude,a.height,void 0,d)}return{orientation:l,destination:d}}function fQ(e){return[c2.tT.map,c2.tT.wayline,c2.tT.CustomFlyCircleArea,c2.tT.CustomFlyPolygonArea,c2.tT.CustomLimitPolygonArea,c2.tT.CustomLimitCircleArea,c2.tT.NoLandingZone].includes(e)}class f$ extends ub(){collection;id;type;elements;elementsEditable;viewer;customTerrainProvider;mapEngine;mapConfig;resolve;readyPromise;picker;drawer;editor;piner;measurer;flysafeDrawer;baseMapProvider;interactor;dragger;hover;contextmenu;screenSpaceCameraController;observer;placer;labelVisualizer;billboardVisualizer;groundPolygonColorVisualizer;theme;constructor(e,a,r,t=sa.normal){super(),this.collection=a,this.id=r,this.type=t,this.elementsEditable=!0,this.mapEngine=window.CURRENT_BE_ENV_CONFIG.map_engine,this.mapConfig=function(e=!1){let a=window.CURRENT_BE_ENV_CONFIG,r=window.CURRENT_FE_ENV_CONFIG,t=uF();if(gZ)return{};if(\"g\"===a.map_engine)return{satelliteBase:gX(\"satelliteBase\",t),satelliteMark:gX(\"satelliteMark\",t),street:gX(\"street\",t)};let n=r.tianDiTuKey,i=\"lAsOZvyB3LuDw8scMpR9LRN8DjqXDDaq\";return{satelliteBase:g$(\"satelliteBase\",t,n),satelliteMark:e?g$(\"satelliteMark\",t,n):g2(\"satelliteMark\",i),street:e?g$(\"street\",t,n):g2(\"street\",i),streetMark:e?g$(\"streetMark\",t,n):void 0,fallbackSatelliteBase:g2(\"satelliteBase\",i)}}(),this.readyPromise=new Promise(e=>{this.resolve=e}),this.drawer=new g9(this),this.editor=new hU(this),this.piner=new fu(this),this.measurer=new fc(this),this.baseMapProvider=new fp(this),this.interactor=new fm(this),this.dragger=new fk(this),this.hover=new fv(this),this.contextmenu=new fz(this),this.theme=(0,uh.iH)(\"\"),this.isMapError=(0,uh.iH)(!1),this.customMapErrorMessage=(0,uh.iH)(\"\"),this.partialShow=(0,uh.iH)(!1),this.onElementUpdate=({el:e})=>{var a;if((a=e)instanceof hW||a instanceof h8||a instanceof hG||a instanceof mX||a instanceof hm||a instanceof mv||a instanceof hD||a instanceof hx||a instanceof hM||a instanceof gt||a instanceof hx)this.executePlacementThrottled()},this.executePlacementThrottled=(0,lL.throttle)(()=>{if(!this.viewer.isDestroyed())this.placer.executePlacement(),this.placer.executePlacement({owner:\"tsa\",categories:[se.tsa]})},400),this.executePopPlacementThrottled=(0,lL.throttle)(()=>{if(!this.viewer.isDestroyed())this.placer.executePlacement({owner:\"tsa\",categories:[se.tsa]})},400),this.primitiveContainers={polyline3d:new uf.PrimitiveCollection,polygon3d:new uf.PrimitiveCollection,prism:new uf.PrimitiveCollection,heightController:new uf.PrimitiveCollection,\"polyline-triangle\":new uf.PrimitiveCollection,\"polyline-slope\":new uf.PrimitiveCollection,\"polyline-profile\":new uf.PrimitiveCollection,\"point-collection\":new uf.PrimitiveCollection},this.nameLabelCollection=null,this.usePrefer3dTiles=!1,this.toggleModelStageForChanged=()=>{this.toggleModelPostStage(this.useModelPostStage)},this.modelStage=null,this.viewInitialized=!1,this.frustum=(0,uh.iH)(\"\"),this.frustumBound=[80,81],this.adjustOrthographicFrustumThrottled=(0,lL.debounce)(function(){if(!this.viewer.isDestroyed())this.viewer.camera._adjustOrthographicFrustum(!0)},500),this._sceneInstantParams={viewportCenterDistance:void 0,cameraHeight:void 0},this._sceneInstantParamsMark={requestCount:0,lastComputeTime:0},this.hotKeyWidget=(0,uh.qj)({disableTravelBy:[]}),this.#e=\"single\",this.osmBuildingPrimitive=void 0,this.osmAdding=!1,this.cameraMoving=\"\",this.mode={edit:!1,draw:!1,pin:!1},this.origin=c2.tT.map,this.isDrawingLayerLocked=!1,this.drawingElementProps={[c2.oO.line]:{},[c2.oO.polygon]:{},[c2.oO.circle]:{},[c2.oO.polygon3d]:{},[c2.oO.prism]:{},[c2.oO.cylinder]:{},[c2.oO.closedLine]:{}},this.globeShow=!0,this.clipEnabled=!0,this.needCheckDsm=(0,uh.iH)(!0),this.baseImageryShow=!0,this.doodleWidget=(0,uh.qj)({visible:!0,color:(0,uh.qj)({pin:hZ,polyline:hZ,polygon:hZ,circle:hZ})}),this.centerWidget=(0,uh.qj)({visible:!1,center:null}),this.centerWidgetClick=null,this.navigationWidget=(0,uh.qj)({visible:!0,compassVisible:!0,frustumVisible:!0,flySafeVisible:!0,customAreaVisible:!0,unlockLicenseSettingLabelVisible:!0,zoomVisible:!0,switchVisible:!0,keep:!0}),this.airSenseWidget=(0,uh.qj)({visible:!1,checkbox:[1,2,3]}),this.operationsWidget=(0,uh.qj)({visible:!0,searchVisible:!0}),this.searchWidget=(0,uh.qj)({items:[]}),this.operationActive=(0,uh.iH)(\"\"),this.operations=(0,uh.iH)([]),this.operationPopActive=(0,uh.iH)({}),this.guideWidget=(0,uh.iH)(null),this.widgetShow=(0,uh.qj)({imprint:!0}),this.hotkeys=(0,uh.iH)({}),this.highlightMaskCount=0,this.elements=a._options.elements,this.viewer=this.initCesiumViewer(e),this.configureDefault(),this.flysafeDrawer=new fa(this),this.picker=new fP(this),this.screenSpaceCameraController=new fb(this),this.customTerrainProvider=new fg(this,this.viewer),this.placer=new fq(this),this.placer.debugStatEnable=!0,this.labelVisualizer=new fH(this),this.billboardVisualizer=new fB(this),this.groundPolygonColorVisualizer=new fV(this),this.initResources(),this.initAsyncResources().finally(()=>{this.resolve?.(this)})}initCesiumViewer(e){let a={animation:!1,timeline:!1,homeButton:!1,geocoder:!1,sceneModePicker:!1,baseLayerPicker:!1,fullscreenButton:!1,navigationHelpButton:!1,requestRenderMode:!0,maximumRenderTimeChange:1/0,showRenderLoopErrors:!1,contextOptions:{webgl:{preserveDrawingBuffer:!0}}},r=this.baseMapProvider.getInitialProvider();r&&(a.baseLayer=this.baseMapProvider.getLayerForProvider(r));let t=new uf.Viewer(e,a);return g4(sI.MAP_CONFIG_PRIVATE)&&a.baseLayer&&a.baseLayer.imageryProvider instanceof uf.SingleTileImageryProvider&&t.imageryLayers.remove(a.baseLayer),t}configureDefault(){let e=this.viewer,a=e.scene,r=a.screenSpaceCameraController;r.minimumZoomDistance=3,r.maximumZoomDistance=5e6,r.enableOrthographicFrustumZoomAdjustment=!1,r.enableCollisionDetection=!1,a.disableGetTilesetHeight=!0;a.globe.depthTestAgainstTerrain=!0,a.globe.enableOrthographicOccludersJudge=!0;let t=e.cesiumWidget;t.creditContainer.style.display=\"none\",this.overrideShowErrorPanel(),t._showRenderLoopErrors=!0,t.screenSpaceEventHandler.removeInputAction(uf.ScreenSpaceEventType.LEFT_CLICK),t.screenSpaceEventHandler.removeInputAction(uf.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),a.moon.show=!1,a.globe.baseColor=uf.Color.fromCssColorString(\"#42543E\"),a.camera.percentageChanged=.1,a.globe.maximumScreenSpaceError=2.4,a.globe.atmosphereHueShift=-.01,a.globe.atmosphereSaturationShift=.23,a.globe.atmosphereBrightnessShift=.23,a.skyAtmosphere.hueShift=-.01,a.skyAtmosphere.saturationShift=-.06,a.skyAtmosphere.brightnessShift=.38}initResources(){this.baseMapProvider.initialize(),this.initView(),this.initPrimitiveCollections(),this.useCustomLight(),this.openSwitchFrustum(!0),this.initObserver(),this.interactor.initEvents(),this.initMapListener(),this.initHotKey(),this.prefer3dTiles(!0)}async initAsyncResources(){let e=this.viewer;if(!g4(sI.MAP_TERRAIN_PRIVATE)&&(this.customTerrainProvider.globalTerrainProvider=await fK()),!e.isDestroyed())e.terrainProvider=this.customTerrainProvider.getInitialTerrainProvider()}isMapError;customMapErrorMessage;partialShow;overrideShowErrorPanel(){this.viewer.cesiumWidget.showErrorPanel=(e,a,r)=>{this.isMapError.value=!0}}setTerrain(e){this.customTerrainProvider.setTerrain(e)}render(){if(!this.viewer.isDestroyed())this.viewer.scene.requestRender()}initObserver(){let e=this.viewer;this.observer=new MutationObserver(a=>{let r=!1;a.forEach(e=>{e.attributeName&&[\"width\",\"height\"].includes(e.attributeName)&&(r=!0)}),r&&(this.emit(\"sizeChange\",{width:e.canvas.clientWidth,height:e.canvas.clientHeight}),this.executePlacementThrottled())}),this.observer.observe(e.canvas,{attributes:!0})}initMapListener(){let e=this.viewer.scene,a=this.elements;this.viewer.camera.changed.addEventListener(()=>this.emit(\"cameraChange\")),e.terrainProviderChanged.addEventListener(()=>{this.emit(\"terrainDataChange\")}),e.globe.tileLoadProgressEvent.addEventListener(e=>{0===e&&this.emit(\"tilesLoaded\")}),e.preUpdate.addEventListener(()=>{a.pyramidVisualizer.update(this),this.computeSceneInstantState()});let r=this.getCameraAttitude(),t=this.getCameraPosition();e.postRender.addEventListener(()=>{this.emit(\"prependPostRender\");let a=this.getCameraAttitude(),n=this.getCameraPosition(),i=!uf.Math.equalsEpsilon(a.heading,r.heading,uf.Math.EPSILON4)||!uf.Math.equalsEpsilon(a.pitch,r.pitch,uf.Math.EPSILON4)||!uf.Math.equalsEpsilon(a.roll,r.roll,uf.Math.EPSILON4)||!uf.Math.equalsEpsilon(a.fov,r.fov,uf.Math.EPSILON4),o=!uf.Math.equalsEpsilon(n.longitude,t.longitude,uf.Math.EPSILON9)||!uf.Math.equalsEpsilon(n.latitude,t.latitude,uf.Math.EPSILON9)||!uf.Math.equalsEpsilon(n.height,t.height,uf.Math.EPSILON3);i&&(this.emit(\"cameraAttitudeChange\",a),r=a),o&&(this.emit(\"cameraPositionChange\",n),t=n),(i||o)&&(this.emit(\"cameraChanged\",e.camera),this.executePlacementThrottled()),this.emit(\"postRender\")}),e.camera.moveEnd.addEventListener(()=>{}),this.elements.addListener(\"elementUpdate\",this.onElementUpdate)}onElementUpdate;executePlacementThrottled;executePopPlacementThrottled;getCameraPosition(){return(0,pg.KO)(this.viewer.camera.positionWC,!0)}getCameraAttitude(){let e=this.viewer.camera,a=fU,r=e.frustum;return r instanceof uf.PerspectiveFrustum&&(a=r.fov),{heading:uf.Math.toDegrees(e.heading),pitch:uf.Math.toDegrees(e.pitch),roll:uf.Math.toDegrees(e.roll),fov:uf.Math.toDegrees(a)}}setCameraAttribute(e){let a={},r=!1;if(e.position){r=!0,a.destination=(0,pg.jL)(e.position);let t=this.getCameraAttitude();a.orientation=uf.HeadingPitchRoll.fromDegrees(t.heading,t.pitch,t.roll)}if(e.attitude){let{heading:t,pitch:n,roll:i,fov:o}=e.attitude;if((0,pg.ri)(t)||(0,pg.ri)(n)||(0,pg.ri)(i)){r=!0;let e=this.getCameraAttitude();a.orientation=uf.HeadingPitchRoll.fromDegrees((0,pg.LS)(t,e.heading),(0,pg.LS)(n,e.pitch),(0,pg.LS)(i,e.roll))}(0,pg.ri)(o)&&(this.viewer.camera.frustum=new uf.PerspectiveFrustum({fov:uf.Math.toRadians(o),aspectRatio:this.viewer.canvas.clientWidth/this.viewer.canvas.clientHeight,near:.1}))}r&&this.viewer.camera.setView(a)}initView(){if(\"g\"!==this.mapEngine){let e=uf.BoundingSphere.fromPoints([uf.Cartesian3.fromDegrees(123.266667,53.55),uf.Cartesian3.fromDegrees(112.348889,3.973889),uf.Cartesian3.fromDegrees(73.5,39.38),uf.Cartesian3.fromDegrees(135.174826,48.573433)]);e.radius=1.6*e.radius,this.viewer.camera.viewBoundingSphere(e,new uf.HeadingPitchRange(0,-90)),this.viewer.camera.lookAtTransform(uf.Matrix4.IDENTITY)}else this.viewer.camera.setView({destination:uf.Cartesian3.fromDegrees(0,0,this.viewer.scene.screenSpaceCameraController.maximumZoomDistance),convert:!0})}primitiveContainers;nameLabelCollection;initPrimitiveCollections(){let e=this.viewer.scene.primitives;Object.values(this.primitiveContainers).forEach(a=>{e.add(a)}),this.nameLabelCollection=e.add(new uf.LabelCollection)}usePrefer3dTiles;prefer3dTiles(e){this.usePrefer3dTiles!==e&&(this.usePrefer3dTiles=e,e?(this.elements.addListener(\"tilesetUpdate\",this.toggleModelStageForChanged),this.toggleModelStageForChanged()):(this.elements.removeListener(\"tilesetUpdate\",this.toggleModelStageForChanged),this.toggleModelPostStage(!1)))}toggleModelStageForChanged;get useModelPostStage(){return this.usePrefer3dTiles&&this.elements.getTilesets().length>0&&this.globeShow}modelStage;toggleModelPostStage(e){this.viewer.scene.prefer3dTiles=e}viewInitialized;async initViewFrom(e){if(!this.viewInitialized&&e.length>0){if(this.viewInitialized=!0,e.length>1){let a=uf.Rectangle.fromCartographicArray(e.map(pg.i9));if(this.viewer.camera.setView({destination:(0,pg.E8)(a,2)}),this.viewer.camera.positionCartographic.height<1500){let e=this.viewer.camera.positionCartographic;this.viewer.camera.setView({destination:uf.Cartesian3.fromRadians(e.longitude,e.latitude,1500),convert:!0})}}else{let[a]=e,r=1500;try{let e=await this.getPositionHeight(a);(0,pg.ri)(e)&&(r+=e)}catch(e){fW(e)}return this.viewer.camera.setView({destination:(0,pg.jL)({...a,height:r})}),!0}}return!1}useCustomLight(){let e=uf.Matrix3.fromHeadingPitchRoll(uf.HeadingPitchRoll.fromDegrees(70,30,0)),a=()=>{let a=new uf.Cartesian3;return uf.Cartesian3.normalize(this.viewer.camera.positionWC,a),uf.Cartesian3.negate(a,a),uf.Matrix3.multiplyByVector(e,a,a)};this.viewer.scene.light=new uf.DirectionalLight({direction:a(),intensity:4}),this.viewer.scene.preRender.addEventListener(e=>{e.light.direction=a()})}frustum;get is3D(){return\"orthographic\"!==this.frustum.value}frustumBound;removeFrustumSwitcher;removeOrthographicReset;adjustOrthographicFrustumThrottled;_sceneInstantParams;_sceneInstantParamsMark;getSceneInstantState(){return this._sceneInstantParams}async computeSceneInstantState(){let e=window.performance.now();if(this._sceneInstantParamsMark.requestCount++,1!==this._sceneInstantParamsMark.requestCount){10===this._sceneInstantParamsMark.requestCount&&(this._sceneInstantParamsMark.requestCount=0);return}if(e-this._sceneInstantParamsMark.lastComputeTime<100){this._sceneInstantParamsMark.requestCount=0;return}this._sceneInstantParamsMark.lastComputeTime=e;let a={viewportCenterDistance:void 0,cameraHeight:void 0},{viewer:r}=this,{camera:t}=r,n=await (0,fr.Pc)(this),i=t.positionWC;if(n&&(a.viewportCenterDistance=uf.Cartesian3.distance(n,i)),this.is3D){let e=await this.picker.sampleHeightAsync(t.positionCartographic);(0,pg.ri)(e)&&(a.cameraHeight=t.positionCartographic.height-e)}else a.cameraHeight=a.viewportCenterDistance;this._sceneInstantParams=a}openSwitchFrustum(e){if(e&&\"\"===this.frustum.value){let e;let a=()=>{let a=this.viewer.camera;\"orthographic\"!==this.frustum.value&&a.pitch<uf.Math.toRadians(-this.frustumBound[1])?(a.switchToOrthographicFrustum(),this.setSceneEnvironment({atmosphere:{groundLightIntensity:0}}),this.frustum.value=\"orthographic\"):\"perspective\"!==this.frustum.value&&a.pitch>uf.Math.toRadians(-this.frustumBound[0])&&(a.frustum=new uf.PerspectiveFrustum,a.frustum.near=.1,a.frustum.aspectRatio=this.viewer.scene.drawingBufferWidth/this.viewer.scene.drawingBufferHeight,a.frustum.fov=fU,this.setSceneEnvironment({atmosphere:{groundLightIntensity:10}}),this.frustum.value=\"perspective\");let r=this.viewer.scene.globeHeight;(0,pg.ri)(r)&&(!(0,pg.ri)(e)||!uf.Math.equalsEpsilon(e,r,0,1))&&this.adjustOrthographicFrustumThrottled(),e=void 0===r?0:r};this.removeFrustumSwitcher=this.viewer.scene.preRender.addEventListener(a),this.removeOrthographicReset=this.viewer.camera.moveEnd.addEventListener(()=>{\"orthographic\"===this.frustum.value&&uf.Math.greaterThan(this.viewer.camera.pitch,fr.eM,fr.vq)&&fr.gK(this,!1)}),a()}else!e&&\"\"!==this.frustum.value&&(this.removeFrustumSwitcher?.(),this.removeFrustumSwitcher=void 0,this.removeOrthographicReset?.(),this.removeOrthographicReset=void 0,this.frustum.value=\"\",this.viewer.camera.switchToPerspectiveFrustum(),this.viewer.camera.frustum.near=.1)}hotKeyWidget;static EscIgnoreOrigins=[c2.tT.map,c2.tT.wayline,c2.tT.model,c2.tT.CustomLimitCircleArea,c2.tT.CustomFlyPolygonArea,c2.tT.CustomLimitPolygonArea,c2.tT.CustomFlyCircleArea,c2.tT.NoLandingZone];#e;get cameraConstrollerPickPositionMode(){return this.#e}set cameraConstrollerPickPositionMode(e){this.#e=e,this.screenSpaceCameraController.pickPositionMode=e}initHotKey(){this.unBindHotKeyListener=function(e=[],a,r){let t=\"all\",n=document.body,i=!0,o=!1,s=[],l=[],d=!1;mH.Z.filter=()=>!0;let c=(0,uW.k)();e.forEach(e=>{let a=[];e.keyName.forEach(e=>{e in mO?a.unshift(e):a.push(e)});let r=a.join(\"+\");if(!function(e,a,r){if(void 0!==r){let t=window.$HotkeyScopeState[a];!t&&(t={},window.$HotkeyScopeState[a]=t),t[e]=r}}(c,r,e.scope),void 0!==e.scope){let a=window.$HotkeyScopeState[r];!a&&(a={},window.$HotkeyScopeState[r]=a),a[c]=e.scope}l.push({keyName:r,keyDown:a=>{mB(r,e.scope)&&e.keyDown?.(a)},keyUp:()=>{mB(r,e.scope)&&e.keyUp?.()},isDown:!1})}),l.forEach(e=>{if(e.keyName.includes(\"+\")){let a=(a,r)=>{if(o&&a.preventDefault(),\"keydown\"===a.type){if(e.isDown)return;mU(a)&&e.keyDown?.(a),e.isDown=!0}if(\"keyup\"===a.type){if(!e.isDown)return;mU(a)&&e.keyUp?.(),e.isDown=!1}};(0,mH.Z)(e.keyName,{scope:t,element:n,capture:i,keyup:!0},a),s.push(()=>{mH.Z.unbind(e.keyName,t,a)})}});let u=(a,r)=>{o&&a.preventDefault(),\"keyup\"===a.type&&(mH.Z.shift&&\"Shift\"===a.key&&mV(e,\"shift\",l),mH.Z.alt&&\"Alt\"===a.key&&mV(e,\"alt\",l),mH.Z.control&&\"Control\"===a.key&&mV(e,\"control\",l)),\"keydown\"===a.type&&\"Meta\"===a.key&&(d=!0),\"keyup\"===a.type&&\"Meta\"===a.key&&(d=!1),d&&\"Meta\"===a.key&&pj()&&p(),l.forEach(e=>{var r;if(r=e.keyName,r in mq){if(\"keydown\"===a.type&&(mq[e.keyName]===a.key?.toLowerCase()||mq[e.keyName]===a.code?.toLowerCase())){if(e.isDown||pj()&&d)return;mU(a)&&e.keyDown?.(a),e.isDown=!0}if(\"keyup\"===a.type&&(mq[e.keyName]===a.key?.toLowerCase()||mq[e.keyName]===a.code?.toLowerCase())){if(!e.isDown)return;mU(a)&&e.keyUp?.(),e.isDown=!1}}})};(0,mH.Z)(\"*\",{scope:t,element:n,capture:i,keyup:!0},u),s.push(()=>{mH.Z.unbind(\"*\",t,u)});let p=()=>{l.forEach(e=>{e.isDown&&e.keyUp&&(e.keyUp(),e.isDown=!1)}),r&&r({isReset:!0})},m=()=>{d&&(d=!1),p()},h=()=>{s.forEach(e=>e()),r&&r({isReset:!0})};return window.addEventListener(\"blur\",m),window.addEventListener(\"focus\",p),window.addEventListener(\"contextmenu\",p),window.addEventListener(\"fullscreenchange\",p),window.addEventListener(\"visibilitychange\",p),()=>{var e;e=c,Object.values(window.$HotkeyScopeState).forEach(a=>{a?.[e]&&delete a[e]}),window.removeEventListener(\"blur\",m),window.removeEventListener(\"focus\",p),window.removeEventListener(\"contextmenu\",p),window.removeEventListener(\"fullscreenchange\",p),window.removeEventListener(\"visibilitychange\",p),h()}}([{keyName:[su.esc],keyDown:()=>{if(!!f$.EscIgnoreOrigins.includes(this.origin))this.clearAllMode(),this.toggleActiveOperation(this.operationActive.value)}},{keyName:[su.backspace],keyDown:()=>{if(this.origin!==c2.tT.map&&this.origin!==c2.tT.wayline)return;let e=this.editor.activeElement;if(!(e&&pw.isElementTransforming(e)))e?this.emit(\"removeElement\",e):this.hover.hoveringElement&&this.emit(\"removeElement\",this.hover.hoveringElement)}},{keyName:[su.delete],keyDown:()=>{if(this.origin!==c2.tT.map&&this.origin!==c2.tT.wayline)return;let e=this.editor.activeElement;if(!(e&&pw.isElementTransforming(e)))e?this.emit(\"removeElement\",e):this.hover.hoveringElement&&this.emit(\"removeElement\",this.hover.hoveringElement)}},{keyName:[su.enter],keyDown:()=>{fQ(this.origin)&&(this.mode.edit?this.editor.exitEdit():this.mode.draw&&this.drawer.finishDrawing())}},{keyName:[su.numEnter],keyDown:()=>{fQ(this.origin)&&(this.mode.edit?this.editor.exitEdit():this.mode.draw&&this.drawer.finishDrawing())}},{keyName:[su.v],keyDown:()=>{(this.origin===c2.tT.map||this.origin===c2.tT.wayline)&&this.screenSpaceCameraController.toggleFpsMode()}},{keyName:[su.shift],keyDown:()=>{this.drawer.withShift=!0,this.editor.withShift=!0},keyUp:()=>{this.drawer.withShift=!1,this.editor.withShift=!1}},{keyName:[su.up],keyDown:e=>{e.preventDefault(),!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.up,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.up)}},{keyName:[su.down],keyDown:e=>{e.preventDefault(),!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.down,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.down)}},{keyName:[su.left],keyDown:e=>{e.preventDefault(),!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.left,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.left)}},{keyName:[su.right],keyDown:e=>{e.preventDefault(),!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.right,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.right)}},{keyName:[su.minus],keyDown:e=>{!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.minus,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.minus)}},{keyName:[su.numSubtract],keyDown:e=>{!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.minus,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.minus)}},{keyName:[su.equal],keyDown:e=>{!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.equal,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.equal)}},{keyName:[su.numAdd],keyDown:e=>{!(this.hotKeyWidget.disableTravelBy.length>0)&&this.screenSpaceCameraController.handleKeyDown(su.equal,e)},keyUp:()=>{this.screenSpaceCameraController.handleKeyUp(su.equal)}}])}unBindHotKeyListener;unBindHotKey(){this.unBindHotKeyListener?.()}cameraPan(e){let a,r;let t=this.viewer,n=this.viewer.camera,i=new uf.Cartesian2,o=new uf.Cartesian2(t.canvas.clientWidth/2,t.canvas.clientHeight/2),s=uf.Cartesian2.add(o,uf.Cartesian2.multiplyComponents(e,uf.Cartesian2.multiplyByScalar(o,.02,i),i),i),l=n.pickEllipsoid(o),d=n.pickEllipsoid(s);if(!(0,pg.ri)(l)||!(0,pg.ri)(d))return;l=n.worldToCameraCoordinatesPoint(l,l),d=n.worldToCameraCoordinatesPoint(d,d);let c=n.constrainedAxis;if(!c)return;let u=uf.Cartesian3.mostOrthogonalAxis(c,new uf.Cartesian3);uf.Cartesian3.cross(u,c,u),uf.Cartesian3.normalize(u,u);let p=uf.Cartesian3.cross(c,u,new uf.Cartesian3),m=uf.Cartesian3.magnitude(l),h=uf.Cartesian3.dot(c,l),g=window.Math.acos(h/m),f=uf.Cartesian3.multiplyByScalar(c,h,new uf.Cartesian3);uf.Cartesian3.subtract(l,f,f),uf.Cartesian3.normalize(f,f);let _=uf.Cartesian3.magnitude(d),b=uf.Cartesian3.dot(c,d),k=window.Math.acos(b/_),v=uf.Cartesian3.multiplyByScalar(c,b,new uf.Cartesian3);uf.Cartesian3.subtract(d,v,v),uf.Cartesian3.normalize(v,v);let z=window.Math.acos(uf.Cartesian3.dot(f,u));0>uf.Cartesian3.dot(f,p)&&(z=uf.Math.TWO_PI-z);let w=window.Math.acos(uf.Cartesian3.dot(v,u));0>uf.Cartesian3.dot(v,p)&&(w=uf.Math.TWO_PI-w);let y=z-w;a=uf.Cartesian3.equalsEpsilon(c,n.position,uf.Math.EPSILON2)?n.right:uf.Cartesian3.cross(c,n.position,new uf.Cartesian3);let S=uf.Cartesian3.cross(c,a,new uf.Cartesian3),j=uf.Cartesian3.dot(S,uf.Cartesian3.subtract(l,c,new uf.Cartesian3)),D=uf.Cartesian3.dot(S,uf.Cartesian3.subtract(d,c,new uf.Cartesian3));r=j>0&&D>0?k-g:j>0&&D<=0?uf.Cartesian3.dot(n.position,c)>0?-g-k:g+k:g-k,n.rotateRight(y),n.rotateUp(r),this.screenSpaceCameraController.adjustHeightForTerrain()}osmBuildingPrimitive;osmAdding;async addOsmBuilding(){if(this.viewer&&!this.osmBuildingPrimitive){this.osmAdding=!0;let e=await uf.IonResource.fromAssetId(96188);if(!this.osmAdding)return;this.osmAdding=!1;let a=new gu({category:se.environment,url:e,maximumScreenSpaceError:16,lockMaximumScreenSpaceError:!0,customStyle:{color:`Boolean(\\${feature['cesium#color']}) ? color(\\${feature['cesium#color']}) : ${uf.Color.WHITE.toCssColorString()}`}},this.collection);return this.osmBuildingPrimitive=a,a}}removeOsmBuilding(){this.osmAdding=!1,this.osmBuildingPrimitive&&(this.osmBuildingPrimitive.destroy(),this.osmBuildingPrimitive=void 0)}cameraMoving;startCameraMove(e){if(!this.cameraMoving){switch(e){case\"heading-left\":fr.mq(this,!0);break;case\"heading-right\":fr.mq(this,!1);break;case\"pitch-up\":fr.gK(this,!0);break;case\"pitch-down\":fr.gK(this,!1);break;case\"zoom-out\":fr.jR(this,!0);break;case\"zoom-in\":fr.jR(this,!1);break;default:return}this.cameraMoving=e}}async cameraMoveNorth(e,a){!this.cameraMoving&&(this.cameraMoving=\"due-north\",await (0,fr.F5)(this,e,a),this.cameraMoving=\"\")}stopCameraMove(){\"reset\"!==this.cameraMoving&&\"recenter\"!==this.cameraMoving&&(fr.p_(),this.cameraMoving=\"\")}async cameraResetMove(){!this.cameraMoving&&(this.cameraMoving=\"reset\",await (0,fr._3)(this),this.cameraMoving=\"\")}mode;get onEditingOrDrawing(){return this.mode.edit||this.mode.draw||this.mode.pin}origin;isDrawingLayerLocked;setDrawingLayerLocked(e){this.isDrawingLayerLocked=e,this.emit(\"drawingLayerLockedChange\")}setMode(e,a){if(a&&(this.origin=a),[\"draw\",\"pin\"].includes(e)){let r=this.findOperation(this.operationActive.value);r&&r.type!==sr.ActivateDraw&&a!==c2.tT.CustomFlyPolygonArea&&a!==c2.tT.CustomLimitPolygonArea&&a!==c2.tT.CustomFlyCircleArea&&a!==c2.tT.CustomLimitCircleArea&&a!==c2.tT.NoLandingZone&&this.toggleActiveOperation(),this.emit(\"doodleModeChange\",e)}if(\"draw\"===e)switch(this.piner.exitPinning(),this.drawer.getDrawingMode()){case c2.oO.line:this.hover.setCursor(\"polyline\");break;case c2.oO.polygon:case c2.oO.polygon3d:case c2.oO.prism:case c2.oO.closedLine:this.hover.setCursor(\"polygon\");break;case c2.oO.circle:case c2.oO.cylinder:this.hover.setCursor(\"circle\")}else\"pin\"===e&&(this.drawer.exitDrawing(),this.hover.setCursor(\"pin\"));this.mode[e]=!0,this.onEditingOrDrawing?this.setHotKeyTips(su.esc,uP(\"web.map.exit_annotation_edit\")):this.setHotKeyTips(su.esc,\"\"),this.emit(\"modeChange\",e)}clearMode(e){this.mode[e]&&[\"draw\",\"pin\"].includes(e)&&(this.hover.setCursor(\"\"),this.emit(\"doodleModeChange\",\"\")),this.mode[e]=!1,!this.onEditingOrDrawing&&this.setHotKeyTips(su.esc,\"\"),this.emit(\"modeChange\",\"\")}drawingElementProps;setDrawingElementProps(e,a){a&&(this.drawingElementProps[e]=a)}clearDrawingElementProps(){Object.keys(this.drawingElementProps).forEach(e=>{this.drawingElementProps[e]={}})}clearAllMode(e=!1){this.mode.pin&&this.piner.exitPinning(),this.mode.draw&&this.drawer.exitDrawing(),!e&&this.mode.edit&&this.editor.exitEdit(),this.setHotKeyTips(su.esc,\"\")}computedPositionTerrainHeightOfApi(e){return fn({lat:e.latitude,lng:e.longitude}).then(e=>e.data.elevation)}async computedDestinationOfRectangle(e,a=!1){let r=[uf.Rectangle.center(e),uf.Rectangle.southeast(e),uf.Rectangle.southwest(e),uf.Rectangle.northeast(e),uf.Rectangle.northwest(e)],t=this.viewer.camera.getRectangleCameraCoordinates(e),n=this.viewer.scene.mapProjection.ellipsoid,i=n.cartesianToCartographic(t),o=(await this.computedPositionTerrainHeight(r,a)).filter(e=>\"number\"==typeof e);return o.length>0&&(i.height+=window.Math.max(...o)),n.cartographicToCartesian(i)}async computedPositionTerrainHeight(e,a=!1){let r;if(r=a?e.map(()=>void 0):await this.picker.sampleHeightsMostDetailed(e),this.useModelPostStage){let a=[];for(let t=0;t<r.length;t++){let n=r[t];void 0===n?a.push(e[t]):e[t].height=n}if(this.customTerrainProvider.globalTerrainProvider||this.customTerrainProvider.customTerrains.length>0){let e;e=this.customTerrainProvider.terrainShow?await (0,uf.sampleTerrainMostDetailed)(this.viewer.scene.globe.terrainProvider,a):a.map(e=>(e.height=0,e));for(let r=0;r<a.length;r++)a[r].height=e[r].height}}else if(this.customTerrainProvider.globalTerrainProvider||this.customTerrainProvider.customTerrains.length>0){let a;a=this.customTerrainProvider.terrainShow?await (0,uf.sampleTerrainMostDetailed)(this.viewer.scene.globe.terrainProvider,e):e.map(e=>(e.height=0,e));for(let t=0;t<a.length;t++){let n=r[t];n&&n>=a[t].height?e[t].height=n:e[t].height=a[t].height}}return e.map(e=>e.height)}async getPositionHeight(e,a=!1){try{let r=(0,pg.i9)(e),[t]=await this.computedPositionTerrainHeight([r],a);if(!(0,pg.ri)(t))throw Error(\"computedPositionTerrainHeight undefined\");return t}catch{return await this.computedPositionTerrainHeightOfApi(e)}}async flyTo(e){\"first-view\"!==this.screenSpaceCameraController.mode&&await new Promise(a=>{let r=e.complete;e.complete=function(){a(),r?.()};let t=e.cancel;e.cancel=function(){a(),t?.()},this.viewer.camera.flyTo(e)})}async flyToRectangle(e,a=0){if(\"first-view\"===this.screenSpaceCameraController.mode)return;let{east:r,west:t,north:n,south:i}=e;if(!gV(t,r,i,n))return;let o=uf.Rectangle.fromDegrees(t,i,r,n);0===a?this.viewer.camera.setView({destination:o}):a>0&&this.viewer.camera.flyTo({destination:o,duration:a})}async centerLatLngPosition(e,a=!1){if(this.cameraMoving=\"recenter\",this.viewer.isDestroyed())return;if(a){let a=1500;try{let r=await this.getPositionHeight(e,!0);(0,pg.ri)(r)&&(a=r+1500)}catch{}let r=(0,pg.jL)({...e,height:a});await this.flyTo({destination:r,duration:1}),this.cameraMoving=\"\";return}let r=hu.clone(e);if(!r.height||0===r.height)try{let a=await this.getPositionHeight(e,!0);r.height=(0,pg.ri)(a)?a:0}catch{}let t=(0,pg.jL)(r),{destination:n,orientation:i}=await fY(t,this);await this.flyTo({destination:n,duration:1,orientation:i,maximumHeight:20}),this.cameraMoving=\"\"}worldToCanvas(e){try{return this.viewer.scene.cartesianToCanvasCoordinates(e)}catch(e){fW(e);return}}getCameraDistance(e){let a=this.viewer.camera.positionWC;if(a)return uf.Cartesian3.distance(a,e)}checkRectangle(e){let a=uf.Math.toDegrees(e.east-e.west),r=uf.Math.toDegrees(e.north-e.south);if(window.Math.abs(a)>65.7||window.Math.abs(r)>44.3)throw sg.MAX_RECTANGLE}async flyToPositions(e,a=1,r=!1,t=1){this.cameraMoving=\"recenter\";let n=uf.Rectangle.fromCartographicArray(e.map(pg.i9));if(r){this.checkRectangle(n);let e=(0,pg.E8)(n,t);await this.flyTo({destination:e,duration:a}),this.cameraMoving=\"\";return}let i=2;if(n.width<35e-6&&n.height<35e-6){let e=7e-5,a=7e-5/n.width,r=e/n.height;i=a<r?a:r}this.checkRectangle(n);let o=(0,pg.E8)(n,i);try{o=await this.computedDestinationOfRectangle(o,!0)}catch{}await this.flyTo({destination:o,duration:a}),this.cameraMoving=\"\"}lookAtPositions(e,a=5){let r=e.map(e=>(0,pg.jL)(e));if(r.length&&r.length>=3){let e=uf.Cartesian3.subtract(r[1],r[0],new uf.Cartesian3),t=uf.Cartesian3.subtract(r[2],r[1],new uf.Cartesian3),n=uf.Cartesian3.cross(e,t,new uf.Cartesian3),i=uf.Cartesian3.normalize(n,new uf.Cartesian3),o=ms(r),s=uf.Transforms.eastNorthUpToFixedFrame(o,uf.Ellipsoid.WGS84,new uf.Matrix4),l=uf.Matrix4.inverse(s,new uf.Matrix4),d=uf.Cartesian3.add(o,i,new uf.Cartesian3),c=uf.Matrix4.multiplyByPoint(l,d,new uf.Cartesian3);if(c.z<0){c.z=0;let e=uf.Cartesian3.normalize(c,new uf.Cartesian3),a=uf.Matrix4.multiplyByPoint(s,e,new uf.Cartesian3),r=uf.Cartesian3.subtract(a,o,new uf.Cartesian3);i=uf.Cartesian3.normalize(r,new uf.Cartesian3)}let u=uf.BoundingSphere.fromPoints(r),p=uf.Cartesian3.multiplyByScalar(i,u.radius*a,new uf.Cartesian3),m=uf.Cartesian3.add(o,p,new uf.Cartesian3),h=uf.Matrix4.multiplyByPoint(l,m,new uf.Cartesian3);this.viewer.scene.camera.lookAt(o,h),this.viewer.camera.lookAtTransform(uf.Matrix4.IDENTITY)}}async flyToBoundingSphere(e){\"first-view\"!==this.screenSpaceCameraController.mode&&(this.cameraMoving=\"recenter\",e.radius=3*e.radius,await new Promise(a=>{this.viewer.camera.flyToBoundingSphere(e,{offset:new uf.HeadingPitchRange(0,uf.Math.toRadians(-90),0),duration:1,complete(){a()},cancel(){a()}})}),this.cameraMoving=\"\")}get2DBoundingSphere(e){let{start_lng:a,start_lat:r,end_lng:t,end_lat:n}=e;return uf.BoundingSphere.fromPoints([uf.Cartesian3.fromDegrees(a,r),uf.Cartesian3.fromDegrees(a,n),uf.Cartesian3.fromDegrees(t,n),uf.Cartesian3.fromDegrees(t,r)])}get3DBoundingSphere(e){let{half_x:a,half_y:r,half_z:t,latitude:n,longitude:i,altitude:o}=e,s=uf.Cartesian3.fromDegrees(i,n,o),l=s.clone();l.x=l.x-a;let d=s.clone();d.x=d.x+a;let c=s.clone();c.y=c.y-r;let u=s.clone();u.y=u.y+r;let p=s.clone();p.z=p.z-t;let m=s.clone();return m.z=m.z+t,uf.BoundingSphere.fromPoints([l,d,c,u,p,m])}globeShow;clipEnabled;setGlobe(e){let{show:a,color:r,clipPoints:t,clipEnabled:n,terrainEnabled:i,relativeHeightAboveEllipsoid:o}=e;if(!(0,lL.isNil)(a)&&(this.globeShow=a,this.viewer.scene.globe.show=this.globeShow,this.viewer.scene.skyBox.show=this.globeShow,this.viewer.scene.sun.show=this.globeShow,this.viewer.scene.moon.show=this.globeShow,this.openSwitchFrustum(a),this.toggleModelStageForChanged(),this.theme.value=a?\"\":\"dark\"),r&&(\"unset\"===r?this.baseMapProvider.updateBaseMapColor():this.viewer.scene.globe.baseColor=uf.Color.fromCssColorString(r)),t&&(this.setClippingPlanes(t),this.viewer.scene.skyAtmosphere.show=!1),!(0,lL.isNil)(n)){this.clipEnabled=n;let e=this.viewer.scene.globe.clippingPlanes;e&&(e.enabled=n)}!(0,lL.isNil)(o)&&this.setRelativeHeightAboveEllipsoid(o),!(0,lL.isNil)(i)&&this.customTerrainProvider.setTerrain(i)}setRelativeHeightAboveEllipsoid(e=0){let a;if(0===e)a=uf.Ellipsoid.WGS84;else{let r=uf.Ellipsoid.WGS84.radii.x,t=uf.Ellipsoid.WGS84.radii.y,n=uf.Ellipsoid.WGS84.radii.z;a=new uf.Ellipsoid(r+e,t+e,n+e)}this.customTerrainProvider.noTerrainProvider=new uf.EllipsoidTerrainProvider({ellipsoid:a}),this.customTerrainProvider.setTerrain(0===e)}setSceneEnvironment(e){let{globeOptions:a,skyBox:r,atmosphere:t}=e,{scene:n}=this.viewer,{globe:i}=n;if(a&&this.setGlobe(a),r&&(n.skyBox.show=r.enabled),t){let{enabled:e,groundLightIntensity:a}=t;!(0,lL.isNil)(e)&&(n.skyAtmosphere.show=e),!(0,lL.isNil)(a)&&(\"unset\"===a?i.atmosphereLightIntensity=10:i.atmosphereLightIntensity=a)}}needCheckDsm;setNeedCheckDsm(e){this.needCheckDsm.value=e}setClippingPlanes(e){try{if(e.length>2){let a=e.map(e=>(0,pg.jL)(e));this.viewer.scene.globe.clippingPlanes=this.generateClippingPlaneCollection(a)}else!e.length&&(this.viewer.scene.globe.clippingPlanes=new uf.ClippingPlaneCollection)}catch(e){fW(e)}}generateClippingPlaneCollection(e){let a=e.length,r=[];for(let t=0;t<a;++t){let n=(t+1)%a,i=uf.Cartesian3.add(e[t],e[n],new uf.Cartesian3);i=uf.Cartesian3.multiplyByScalar(i,.5,i);let o=uf.Cartesian3.normalize(i,new uf.Cartesian3),s=uf.Cartesian3.subtract(e[n],i,new uf.Cartesian3);s=uf.Cartesian3.normalize(s,s);let l=uf.Cartesian3.cross(s,o,new uf.Cartesian3);l=uf.Cartesian3.normalize(l,l),l=uf.Cartesian3.negate(l,new uf.Cartesian3);let d=new uf.Plane(l,0),c=uf.Plane.getPointDistance(d,i);r.push(new uf.ClippingPlane(l,c))}return new uf.ClippingPlaneCollection({planes:r,edgeWidth:1,edgeColor:uf.Color.WHITE,unionClippingRegions:!0,enabled:this.clipEnabled})}baseImageryShow;setBaseImageryShow(e){this.baseImageryShow=e;let a=this.viewer.scene.globe.imageryLayers,r=a.length;for(let t=0;t<r;t++)a.get(t).show=e;this.theme.value=e?\"\":\"dark\"}setTheme(e){this.theme.value=e}getElement({id:e,primitive:a}){let r;let t=e instanceof uf.Entity?e.id:e;if(t){let e=this.elements.getWithId(t);if(e){if(e instanceof hm&&a instanceof uf.Label)return;r=e}}if(!r){if(!a)return;let t=this.elements.getWithPrimitive(a,e);if(!t)return;r=t}if(!r.disableInteractive){if(r instanceof hW&&!r.canPick(a))return;return r}}selectElementPickMapping(e){return e.map(([e,a])=>{let r=[e[0],a];return a instanceof gs&&(r[0]=gs.getPickResultByOrder(e)),r})}getElements(e){let a=[];e.forEach(e=>{let r=this.getElement(e);if(r){let t=a.findIndex(([,e])=>e===r);-1!==t?a[t][0].push(e):a.push([[e],r])}});let r=this.selectElementPickMapping(a);return r.sort((e,a)=>{let[r,t]=e,[n,i]=a;if(t.constructor!==i.constructor){let e=\"interactLevel\"in t?t.interactLevel:0;return(\"interactLevel\"in i?i.interactLevel:0)-e}if(t instanceof hW&&i instanceof hW){let e=r.primitive instanceof uf.GroundPolylinePrimitive;return Number(n.primitive instanceof uf.GroundPolylinePrimitive)-Number(e)}return 0}),r}doodleWidget;changeDoodleColor(e,a){this.doodleWidget.color[e]=a,this.emit(\"doodleColorChange\",e,a)}centerWidget;centerWidgetClick;navigationWidget;airSenseWidget;changeAirSenseCheckbox(e){this.airSenseWidget.checkbox=e,this.emit(\"airSenseCheckboxChange\",e)}operationsWidget;searchWidget;operationActive;operations;findOperation(e,a=this.operations.value){for(let r=0;r<a.length;r++){let t=a[r];if(Array.isArray(t)){let a=this.findOperation(e,t);if(a)return a}else if((t.type===sr.ActivatePop||t.type===sr.Activate||t.type===sr.ActivateDraw)&&t.key===e)return t}}onOperationActivate(e){if(!e)return;e.onActivate?.();let{type:a,disabled:r}=e;if(a===sr.ActivateDraw&&!r){let{drawingConfig:a}=e;if(a){let r={};a.cssColor&&(r.cssColor=a.cssColor),a.useSpaceDraw&&(r.clampToGround=!a.useSpaceDraw),a.measureType&&(r.measureType=a.measureType),this.drawer.enterDrawing(e.drawingMode,e.drawingOrigin,r)}else this.drawer.enterDrawing(e.drawingMode,e.drawingOrigin)}}toggleActiveOperation(e){let a=e||this.operationActive.value,r=this.operationActive.value;if(this.clearAllMode(!0),r){let a=this.findOperation(r);a&&(a.onInactivate?.(r===e),a.type===sr.ActivateDraw&&this.drawer.exitDrawing())}if(r!==a){let r=this.findOperation(a);r&&this.onOperationActivate(r),this.operationActive.value=a,e?.includes(\"add-fly-to\")&&(this.origin=c2.tT.flyTo)}else this.operationActive.value=\"\"}operationPopActive;applyDefaultPopActive(e=this.operations.value){e.forEach(e=>{Array.isArray(e)?this.applyDefaultPopActive(e):e.type===sr.ActivatePop&&!this.operationPopActive.value[e.key]&&(this.operationPopActive.value={...this.operationPopActive.value,[e.key]:e.defaultPopActive||e.popItems[0]?.key||\"\"})})}guideWidget;widgetShow;hotkeys;setHotKeyTips(e,a){if(a)this.hotkeys.value={...this.hotkeys.value,[e]:a};else if(this.hotkeys.value[e]){let a=(0,lL.cloneDeep)(this.hotkeys.value);delete a[e],this.hotkeys.value=a}}removePrimitives(){if(!this.viewer.isDestroyed())return;let e=this.viewer.scene.primitives;this.nameLabelCollection&&e.remove(this.nameLabelCollection),Object.values(this.primitiveContainers).forEach(a=>{e.remove(a)})}clean(){this.screenSpaceCameraController.destroy(),this.picker.destroy(),this.elements.removeListener(\"tilesetUpdate\",this.toggleModelStageForChanged),this.elements.removeListener(\"elementUpdate\",this.onElementUpdate),this.removePrimitives(),this.viewer.destroy(),this.removeAllListeners(),this.unBindHotKey()}getCameraInfo(){let e=this.getCameraPosition(),a=this.getCameraAttitude(),{frustum:r}=this.viewer.camera,t=\"perspective\",n=60;if(r instanceof uf.OrthographicFrustum)t=\"orthographic\";else if(r instanceof uf.PerspectiveFrustum)n=r.fov*uf.Math.DEGREES_PER_RADIAN;else{let{right:e,left:a,near:t}=r;n=2*window.Math.atan2(e-a,2*t)*uf.Math.DEGREES_PER_RADIAN}return{position:e,altitude:a,mode:t,fov:n}}getBasemapInfo(){return this.baseMapProvider.getBasemapInfo()}highlightMaskCount;addHighlightMask(e){this.highlightMaskCount+=1;let a=function(e,a){let{viewer:r}=e,t=new uf.PrimitiveCollection;r.scene.primitives.add(t);let{position:n,animateDirection:i,cssColor:o,height:s,radius:l,show:d=!0,topRadius:c=.1*l,speedRate:u=.001,thickness:p=.03,density:m=10}=a,h=(0,pg.jL)(n),g=uf.Color.fromCssColorString(o),f=uf.Transforms.eastNorthUpToFixedFrame(h),_=uf.Matrix4.multiplyByTranslation(f,new uf.Cartesian3(0,0,.5*s),new uf.Matrix4),b=new uf.CylinderGeometry({length:s,topRadius:c,bottomRadius:l,vertexFormat:uf.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat}),k=new uf.GeometryInstance({geometry:b,modelMatrix:_}),v=new uf.Material({fabric:{uniforms:{color:g,repeat:m,offset:6,thickness:p},source:fG},translucent:!0}),z=new uf.MaterialAppearance({material:v,faceForward:!1,closed:!0}),w=new uf.Primitive({show:d,allowPicking:!1,geometryInstances:[k],asynchronous:!1,appearance:z});t.add(w);let y=[],S=n.height||0;for(let e=0;e<64;e++){let a=2*Math.PI*e/64,r=l*Math.cos(a),t=l*Math.sin(a),n=new uf.Cartesian3;uf.Matrix4.multiplyByPoint(f,new uf.Cartesian3(r,t,0),n),y.push(n)}y.push(y[0]);let j=new uf.PolygonGeometry({polygonHierarchy:new uf.PolygonHierarchy(y),extrudedHeight:s+S,closeTop:!1,closeBottom:!1,vertexFormat:uf.PerInstanceColorAppearance.VERTEX_FORMAT,height:S}),D=new uf.GeometryInstance({geometry:j,attributes:{color:uf.ColorGeometryInstanceAttribute.fromColor(g.withAlpha(.2))}}),I=new uf.Primitive({show:d,geometryInstances:[D],allowPicking:!1,asynchronous:!1,appearance:new uf.PerInstanceColorAppearance({closed:!0})});t.add(I);let A=\"up\"===i?1:-1,C=()=>{let e=w.appearance.material.uniforms.offset;(e+=A*u)>1&&(e=0),w.appearance.material.uniforms.offset=e};return r.scene.preUpdate.addEventListener(C),{setShow:e=>{t.show=e},destroy:()=>{e.highlightMaskCount-=1;let a=r.scene.primitives.remove(t);return r.scene.preUpdate.removeEventListener(C),0===e.highlightMaskCount&&(r.scene.requestRenderMode=!0),a},changeAnimateDirection:e=>{A=\"up\"===e?1:-1}}}(this,e);return this.viewer.scene.requestRenderMode=!1,a}}class fX{color;geometryInstances=[];id;owner;constructor(e,a,r=(0,uW.k)()){this.color=e,this.id=r,this.owner=a}}class f0{elements=new Set;dirty=!1;leadlineColorBatches=new Set;bottomOutlineColorBatches=new Set;bottomColorBatches=new Set;leadlineDFColorBatches=new Set;bottomOutlineDFColorBatches=new Set;bottomColorDFBatches=new Set;pyramidPrimitiveCollection;static depthFailedColor=uf.Color.ORANGERED.withAlpha(.6);static bottomColorOpacity=.5;static lineColorOpacity=.9;constructor(){this.pyramidPrimitiveCollection=new uf.PrimitiveCollection}get statistics(){let e=this.pyramidPrimitiveCollection?this.pyramidPrimitiveCollection.length:0;return{totalPrimitiveCount:e,totalBatchesCount:this.leadlineColorBatches.size+this.leadlineDFColorBatches.size+this.bottomColorBatches.size+this.bottomColorDFBatches.size+this.bottomOutlineColorBatches.size+this.bottomOutlineDFColorBatches.size,leadlineBatchesCount:this.leadlineColorBatches.size,leadlineDepthFailedBatchesCount:this.leadlineDFColorBatches.size,bottomBatchesCount:this.bottomColorBatches.size,bottomDepthFailedBatchesCount:this.bottomColorDFBatches.size,bottomOutlineBatchesCount:this.bottomOutlineColorBatches.size,bottomOutlineDepthFailedBatchesCount:this.bottomOutlineDFColorBatches.size,pyramidCount:this.elements.size}}update(e){if(!this.dirty)return;if(this.pyramidPrimitiveCollection.isDestroyed()){this.pyramidPrimitiveCollection=new uf.PrimitiveCollection;return}this.clearAllBatches(),this.processAllElementToBatch();let a=e.viewer.scene.primitives;!a.contains(this.pyramidPrimitiveCollection)&&a.add(this.pyramidPrimitiveCollection);let r=(e,a=!1)=>r=>{let t=r.color,n={asynchronous:!1,geometryInstances:r.geometryInstances};if(\"bottom\"===e){let e=uf.Color.clone(t).withAlpha(f0.bottomColorOpacity);n.appearance=new uf.MaterialAppearance({flat:!0,material:this.createColorMaterial(e)}),a&&(n.depthFailAppearance=new uf.MaterialAppearance({flat:!0,material:this.createColorMaterial(f0.depthFailedColor)}))}else{let e=uf.Color.clone(t).withAlpha(f0.lineColorOpacity);n.appearance=new uf.PolylineMaterialAppearance({material:this.createColorMaterial(e)}),a&&(n.depthFailAppearance=new uf.PolylineMaterialAppearance({material:this.createColorMaterial(f0.depthFailedColor)}))}let i=new uf.Primitive(n);this.pyramidPrimitiveCollection.add(i),r.owner.bindPrimitive(e,i)};this.pyramidPrimitiveCollection.removeAll(),this.leadlineColorBatches.forEach(r(\"leadline\")),this.bottomColorBatches.forEach(r(\"bottom\")),this.bottomOutlineColorBatches.forEach(r(\"bottomOutline\")),this.leadlineDFColorBatches.forEach(r(\"leadline\",!0)),this.bottomColorDFBatches.forEach(r(\"bottom\",!0)),this.bottomOutlineDFColorBatches.forEach(r(\"bottomOutline\",!0)),this.dirty=!1}processAllElementToBatch(){this.elements.forEach(e=>{if(!e.dirty)return;let{color:a,activeColor:r,useDepthFailedAppearance:t,geometryInstance:n}=e.getUpdateInfo(),i=void 0!==r?r:a;n.leadline&&this.addColorGeometryInstances(\"leadline\",e,i,n.leadline,t),n.bottom&&this.addColorGeometryInstances(\"bottom\",e,i,[n.bottom],t),n.bottomOutline&&this.addColorGeometryInstances(\"bottomOutline\",e,i,[n.bottomOutline],t)})}createDashLineMaterial(e,a){return uf.Material.fromType(\"PolylineDash\",{color:e,dashPattern:a})}createColorMaterial(e){return uf.Material.fromType(\"Color\",{color:e})}findBatch(e,a){let r=null;return e.forEach(e=>{e.color.equals(a)&&(r=e)}),r}addElement(e){this.elements.add(e),this.dirty=!0}removeElement(e){this.elements.has(e)&&(this.elements.delete(e),this.dirty=!0)}addColorGeometryInstances(e,a,r,t,n=!1){\"leadline\"===e&&(n?this.addGeometryInstanceToBatch(this.leadlineDFColorBatches,a,r,t):this.addGeometryInstanceToBatch(this.leadlineColorBatches,a,r,t)),\"bottomOutline\"===e&&(n?this.addGeometryInstanceToBatch(this.bottomOutlineDFColorBatches,a,r,t):this.addGeometryInstanceToBatch(this.bottomOutlineColorBatches,a,r,t)),\"bottom\"===e&&(n?this.addGeometryInstanceToBatch(this.bottomColorDFBatches,a,r,t):this.addGeometryInstanceToBatch(this.bottomColorBatches,a,r,t))}addGeometryInstanceToBatch(e,a,r,t){let n=this.findBatch(e,r);return!n&&(n=new fX(r,a),e.add(n)),n.geometryInstances.push(...t),n}clearAllBatches(){this.leadlineColorBatches.clear(),this.bottomColorBatches.clear(),this.bottomOutlineColorBatches.clear(),this.leadlineDFColorBatches.clear(),this.bottomColorDFBatches.clear(),this.bottomOutlineDFColorBatches.clear()}destroy(){this.pyramidPrimitiveCollection.removeAll(),this.elements.clear(),this.clearAllBatches()}}class f1 extends ub(){set=new Set;idMap=new Map;pyramidVisualizer=new f0;handleSceneChangeThrottled=(0,lL.throttle)((e,a)=>{let r=e.getSceneInstantState();this.set.forEach(t=>{this.handleElSceneChange(t,e,a,r)})},100);handleElSceneChange(e,a,r,t){(e instanceof mv||e instanceof hD||e instanceof hG||e instanceof hC||e instanceof hW||e instanceof h8||e instanceof mX||e instanceof hY||e instanceof gr||e instanceof g_)&&e.onSceneChange(a,t)}add(e,a,r){this.set.add(a),\"3dModel\"===e&&this.tilesetAdd(a),\"pyramid\"===e&&this.pyramidVisualizer.addElement(a),r.forEach(e=>e&&this.idMap.set(e,a)),this.emit(\"elementUpdate\",{eventType:\"added\",el:a})}delete(e){this.set.delete(e),this.tilesetDelete(e),this.idMap.forEach((a,r)=>{a===e&&this.idMap.delete(r)}),this.emit(\"elementUpdate\",{eventType:\"deleted\",el:e})}has(e){return this.set.has(e)}setWithId(e,a){this.set.add(a),this.idMap.set(e,a)}getWithId(e){return this.idMap.get(e)}getWithPrimitive(e,a){let r;return this.set.forEach(t=>{t.isPrimitiveElement&&(t.hasPrimitive?.(e)||t.uid===a)&&(r=t)}),r}getAllModels(){return Array.from(this.set).filter(e=>e instanceof gu||e instanceof hk||e instanceof hj)}tilesetSet=new Set;tilesetAdd(e){this.tilesetSet.add(e),this.emit(\"tilesetUpdate\",e,\"add\")}tilesetDelete(e){this.tilesetSet.has(e)&&(this.tilesetSet.delete(e),this.emit(\"tilesetUpdate\",e,\"delete\"))}getTilesets(){return Array.from(this.tilesetSet)}onManagerAdd(e,a){Array.from(this.set).forEach(r=>{pm(r,a)&&r.onManagerAdd?.(e)})}onManagerRemove(e){Array.from(this.set).forEach(a=>{a.onManagerRemove?.(e)})}onManagerUpdate(e){Array.from(this.set).forEach(a=>{a.onManagerUpdate?.(e)})}}class f2 extends u_.EventEmitter{datasets=new Set;datasetDict=new Map;add(e,a){this.datasets.add(e),0===a.length&&a.push(e.id),a.forEach(a=>this.datasetDict.set(a,e)),this.emit(\"dataset-add\",{collection:this,dataset:e})}has(e){return this.datasets.has(e)}hasId(e){return this.datasetDict.has(e)}get(e){if(this.hasId(e))return this.datasetDict.get(e)}remove(e){this.datasets.delete(e)&&this.emit(\"dataset-remove\",{collection:this,dataset:e})}removeId(e){let a=this.get(e);if(!!a)this.remove(a)}onManagerAdd(e,a){this.datasets.forEach(a=>{a.onManagerAdd(e)})}onManagerRemove(e){this.datasets.forEach(a=>{a.onManagerRemove(e)})}onManagerUpdate(e){this.datasets.forEach(a=>{a.onManagerUpdate(e)})}}let f3=`main-${(0,uW.k)()}`;function f4(e,a){return e.type===a}function f5(e,a){return e.type===a}class f6 extends ub(){resolve;readyPromise;ready=!1;constructor(){super(),this.generatePromise()}cesiumManager;generatePromise(){this.ready=!1,this.readyPromise=new Promise(e=>{this.resolve=a=>{a.ready=!0,e(a)}})}dispatchEvent(e){this.cesiumManager&&this.cesiumManager?.viewer?.canvas.dispatchEvent(e)}mount(e){let a=new f$(e,this.managers,f3);return this.cesiumManager=a,this.managers._add(f3,a),a.readyPromise.then(()=>{this.resolve?.(this)}),this.triggerEvent(),a}unmount(){this.managers._remove(f3),this.cesiumManager?.clean(),this.cesiumManager=void 0,window.setTimeout(()=>{this.generatePromise()})}managers=(function(){let e=new f1,a=new f2,r=py({},{elements:e,datasets:a});return r.eventBus.on(\"onCollectionChange\",(t,n)=>{if(\"add\"===t){let t=r._get(n);t&&(e.onManagerAdd(n,t),a.onManagerAdd(n,t))}else\"remove\"===t?(e.onManagerRemove(n),a.onManagerRemove(n)):\"update\"===t&&(e.onManagerUpdate(n),a.onManagerUpdate(n))}),r})();addAlternateViewer(e,a=sa.normal){let r=new f$(e,this.managers,(0,uW.k)(),a);return r.hotKeyWidget.disableTravelBy.push(\"alternate\"),this.managers._add(r.id,r),this.triggerEvent(r.id),[r.id,r]}removeAlternateViewer(e){this.managers.eventBus.emit(\"onCollectionChange\",\"remove\",e);let a=this.managers._get(e);this.managers._remove(e),a?.clean()}getAlternateViewerLength(){return this.managers._keys().length-1}getElementCollection(){return this.managers._options.elements}setType(e,a=f3){let r=this.managers._get(a);r&&(r.type=e,this.managers.eventBus.emit(\"onCollectionChange\",\"update\",a))}setPartialShow(e){this.cesiumManager&&(this.cesiumManager.partialShow.value=e)}triggerEvent(e=f3){let a=this.managers._get(e),r=e===f3?\"\":e;a&&(a.on(\"terrainChange\",e=>{this.emit(\"demShowChange\",r,1!==e)}),a.on(\"terrainDataChange\",()=>{this.emit(\"terrainDataChange\",r)}),a.on(\"zoomDelta\",e=>{this.emit(\"zoomDelta\",r,e)}),a.on(\"tilesLoaded\",()=>{this.emit(\"tilesLoaded\",r)}),a.on(\"cameraAttitudeChange\",e=>{this.emit(\"cameraAttitudeChange\",r,e)}),a.on(\"cameraPositionChange\",e=>{this.emit(\"cameraPositionChange\",r,e)}),a.on(\"hotKeyPress\",e=>{this.emit(\"hotKeyPress\",r,e)}),a.on(\"hotKeyDown\",e=>{this.emit(\"hotKeyDown\",r,e)}),a.on(\"hotKeyUp\",e=>{this.emit(\"hotKeyUp\",r,e)}),a.on(\"cameraChange\",()=>{this.emit(\"cameraChange\",r),this.managers._options.elements.handleSceneChangeThrottled(a,e)}),a.on(\"terrainDataChange\",()=>{this.emit(\"terrainDataChange\",r),this.managers._options.elements.handleSceneChangeThrottled(a,e)}),a.on(\"tilesLoaded\",()=>{this.emit(\"tilesLoaded\",r),this.managers._options.elements.handleSceneChangeThrottled(a,e)}),a.on(\"postRender\",()=>{this.emit(\"postRender\",r)}),a.on(\"fpsChange\",e=>{this.emit(\"fpsChange\",r,e)}),a.on(\"pinAt\",(e,a)=>{this.emit(\"pin\",r,e,a)}),a.on(\"finishDraw\",e=>{e.type===c2.oO.line?this.emit(\"drawLine\",r,e.shape,e.element,e.origin):e.type===c2.oO.polygon?this.emit(\"drawPolygon\",r,e.shape,e.element,e.origin):e.type===c2.oO.circle?this.emit(\"drawCircle\",r,e.shape,e.element,e.origin):e.type===c2.oO.polygon3d?this.emit(\"drawPolygon3D\",r,e.shape,e.element,e.origin):e.type===c2.oO.prism?this.emit(\"drawPrism\",r,e.shape,e.element,e.origin):e.type===c2.oO.cylinder?this.emit(\"drawCylinder\",r,e.shape,e.element,e.origin):e.type===c2.oO.closedLine&&this.emit(\"drawClosedLine\",r,e.shape,e.element,e.origin)}),a.on(\"onDrawStateChange\",e=>{this.emit(\"drawStateChange\",r,e.type,e.state,e.origin)}),a.on(\"onDrawStart\",e=>{this.emit(\"drawStart\",r,e.type,e.origin)}),a.on(\"finishEdit\",e=>{this.emit(\"editEntity\",r,e)}),a.on(\"exitEdit\",()=>{this.emit(\"exitEdit\",r)}),a.on(\"removeElement\",e=>{e?.onRemove&&\"function\"==typeof e.onRemove&&e.onRemove(),this.emit(\"removeElement\",r,e)}),a.on(\"sizeChange\",e=>{this.emit(\"sizeChange\",r,e)}),a.on(\"hover\",(e,a)=>{this.emit(\"hoverEntities\",r,e,a)}),a.on(\"click\",(e,t,n,i)=>{let o=e[0];if(o?.onClick&&\"function\"==typeof o.onClick&&o.onClick(),o?.preventClickEvent)return;a.operationActive.value&&(e=e.filter(e=>!(e instanceof hW||e instanceof h8||e instanceof hG||e instanceof mX||e instanceof hp||e instanceof gs||e instanceof hY||e instanceof gr||e instanceof pZ)));let s=e.map(e=>{var a;return(a=e)instanceof mv?{type:\"billboard\",element:a}:a instanceof mX?{type:\"circle\",element:a}:a instanceof hp?{element:a,type:\"cylinder\"}:a instanceof hG?{element:a,type:\"pin\"}:a instanceof hW?{element:a,type:\"polygon\"}:a instanceof h8?{element:a,type:\"polyline\"}:a instanceof gr?{element:a,type:\"polyline3d\"}:a instanceof hY?{element:a,type:\"polygon3d\"}:a instanceof pZ?{element:a,type:\"polyline-group\"}:a instanceof gs?{element:a,type:\"prism\"}:a instanceof gN?{element:a,type:\"polyline-profile\"}:a instanceof gG?{element:a,type:\"point-collection\"}:a instanceof gd?{element:a,type:\"pyramid\"}:null}).filter(e=>null!==e);this.emit(\"clickEntities\",r,e,t,n),this.emit(\"clickTypedElements\",r,s,{mouse:t,modifier:n,partId:i})}),a.on(\"doubleClick\",(e,a,t)=>{let n=e[0];n?.onClick&&\"function\"==typeof n.onClick&&n.onDoubleClick(),this.emit(\"doubleClickEntities\",r,e,a,t)}),a.on(\"leftDown\",e=>{let r=(a.getElements(e).map(([,e])=>e)||[])[0];r?.onLeftDown&&\"function\"==typeof r.onLeftDown&&r.onLeftDown()}),a.on(\"rightClick\",(e,a,t,n)=>{let i=e[0];i?.onRightClick&&\"function\"==typeof i.onRightClick&&i.onRightClick(t),this.emit(\"rightClickEntities\",r,e,a,t,n)}),a.on(\"contextmenuClick\",(a,t,n,i)=>{\"element\"===a&&\"remove\"===t&&n&&this.managers._get(e)?.emit(\"removeElement\",n),this.emit(\"contextmenu\",r,a,t,n,i)}),a.on(\"doodleColorChange\",(e,a)=>{this.emit(\"doodleColorChange\",r,e,a)}),a.on(\"doodleModeChange\",e=>{this.emit(\"doodleModeChange\",r,e)}),a.on(\"elementSelfIntersection\",(e,a,t)=>{this.emit(\"elementSelfIntersection\",r,e,a,t)}),a.on(\"elementAreaOversize\",(e,a)=>{this.emit(\"elementAreaOversize\",r,e,a)}),a.on(\"onPolygon3DIntersectChange\",(e,a)=>{this.emit(\"onPolygon3DIntersectChange\",r,e,a)}),a.on(\"onPolygon3DAreaExceedChange\",(e,a)=>{this.emit(\"onPolygon3DAreaExceedChange\",r,e,a)}),a.on(\"onExitDrawing\",()=>{this.emit(\"onExitDrawing\",r)}),a.on(\"airSenseCheckboxChange\",e=>{this.emit(\"airSenseCheckboxChange\",r,e)}),a.on(\"hoverCleared\",()=>{this.emit(\"hoverCleared\",r)}),a.on(\"onEditingMouseMove\",e=>{this.emit(\"onEditingMouseMove\",r,e)}),a.on(\"onDrawingMouseMove\",e=>{this.emit(\"onDrawingMouseMove\",r,e)}),a.on(\"datasetLoading\",e=>{this.emit(\"datasetLoading\",r,e)}),a.on(\"editPointClick\",e=>{this.emit(\"editPointClick\",r,e)}))}addElement(e,a=f3){let r=null,t=this.managers._get(a);return t&&f4(e,\"pop\")&&(r=new gt(e,t)),f4(e,\"3dModel\")&&(r=new gu(e,this.managers)),f4(e,\"billboard\")&&(r=new mv(e,this.managers)),f4(e,\"point\")&&(r=new hH(e,this.managers)),f4(e,\"label\")&&(r=new hD(e,this.managers)),f4(e,\"polyline\")&&(r=new h8(e,this.managers)),f4(e,\"polygon\")&&(r=new hW(e,this.managers)),f4(e,\"polygon3d\")&&(r=new hY(e,this.managers)),f4(e,\"model\")&&(r=new hx(e,this.managers)),f4(e,\"model-next\")&&(r=new hM(e,this.managers)),f4(e,\"pin\")&&(r=new hG(e,this.managers)),f4(e,\"2dModel\")&&(r=new hj(e,this.managers)),f4(e,\"locating-line\")&&(r=new hC(e,this.managers)),f4(e,\"frustum\")&&(r=new hf(e,this.managers)),f4(e,\"pyramid\")&&(r=new gd(e,this.managers)),f4(e,\"terrain\")&&(r=new hk(e,this.managers)),f4(e,\"grid\")&&(r=new h_(e,this.managers)),f4(e,\"wall\")&&(r=new gp(e,this.managers)),f4(e,\"circle\")&&(r=new mX(e,this.managers)),f4(e,\"prism\")&&(r=new gs(e,this.managers)),f4(e,\"cylinder\")&&(r=new hp(e,this.managers)),f4(e,\"polyline3d\")&&(r=new gr(e,this.managers)),f4(e,\"scanArea\")&&(r=new g_(e,this.managers)),f4(e,\"groundImage\")&&(r=new gz(e,this.managers)),f4(e,\"volume\")&&(r=new gD(e,this.managers)),f4(e,\"polyline-group\")&&(r=new pZ(e,this.managers)),f4(e,\"polyline-triangle\")&&(r=new gR(e,this.managers)),f4(e,\"polyline-slope\")&&(r=new gx(e,this.managers)),f4(e,\"polyline-profile\")&&(r=new gN(e,this.managers)),f4(e,\"point-collection\")&&(r=new gG(e,this.managers)),this.managers.render?.(),r}updateElement(e,a){e.update(a),this.managers.render?.()}removeElement(e){e?.destroy?.(),this.managers.render?.()}toggleElementDimension(e){e instanceof pZ&&(e.toggleDimension(),this.managers.render?.())}addDataset(e){let a=null;if(\"Dxf\"===e.type)a=new gK(e,this.managers);if(\"Shp\"===e.type)a=new gW(e,this.managers);return a}updateDataset(e,a){e.update(a),this.managers.render?.()}removeDataset(e){e.destroy?.(),this.managers.render?.()}async recenterDataset(e,a=0,r=f3){let t=this.managers._get(r);if(!!t){if((e instanceof gK||e instanceof gW)&&(await e.readyPromise,e.rectangle))return t.flyToRectangle(e.rectangle,a)}}async initView(e,a=f3){let r=this.managers._get(a);return!!r&&await r.initViewFrom(e)}async recenterMap(e,a=0,r=!1,t=!0,n=1,i=f3){let o;let s=this.managers._get(i);if(!!s){if(Array.isArray(e)){let i=e[0];if(e.length>1&&!e.every(e=>uf.Math.equalsEpsilon(e.longitude,i?.longitude,uf.Math.EPSILON8)&&uf.Math.equalsEpsilon(e.latitude,i?.latitude,uf.Math.EPSILON8))&&t)return await s.flyToPositions(e,a,r,n);if(e.length>1&&!t)return s.lookAtPositions(e);else 0!==e.length&&(o=e[0])}else o=e;if(o)return await s.centerLatLngPosition(o)}}async recenterElement(e,a=f3){let r,t;let n=this.managers._get(a);if(!n)return;let i=!0;if(e instanceof hG||e instanceof mv||e instanceof hH||e instanceof hD?(r=e.position,e.clampToGround&&r&&((r=hu.clone(r)).height=0)):e instanceof h8&&e.clampToGround||e instanceof gr&&e.grounded||e instanceof hW?r=e.positions:e instanceof g_?r=e.polygonsPositions?.reduce((e,a)=>e.concat(a),[]):e instanceof hY?(r=e.positions,i=e.category!==se.wayline):e instanceof mX?r=e.circleEdgePointsPos:((e"
}