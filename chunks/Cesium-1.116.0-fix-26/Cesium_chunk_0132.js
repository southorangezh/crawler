{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 132,
    "total_chunks": 194,
    "chunk_size": 62582,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.730Z"
  },
  "content": "n=t.readyImagery.rectangle,i=e.rectangle;if(t.useWebMercatorT){let c=t.readyImagery.imageryLayer.imageryProvider.tilingScheme;n=c.rectangleToNativeRectangle(n,Hbe),i=c.rectangleToNativeRectangle(i,Kbe)}let o=i.width,r=i.height,s=o/n.width,a=r/n.height;return new se(s*(i.west-n.west)/o,a*(i.south-n.south)/r,s,a)};pi.prototype._requestImagery=function(e){let t=this._imageryProvider,n=this;function i(s){if(!l(s))return o();e.image=s,e.state=$n.RECEIVED,e.request=void 0,So.reportSuccess(n._requestImageError),n.requestEvent.raiseEvent(\"success\")}function o(s){if(s===rw.BaiduError){e.state=$n.FAILED,e.request=void 0;return}if(e.request.state===Qn.CANCELLED){e.state=$n.UNLOADED,e.request=void 0;return}e.state=$n.FAILED,e.request=void 0,n.requestEvent.raiseEvent(\"failure\");let a=`Failed to obtain image tile X: ${e.x} Y: ${e.y} Level: ${e.level}.`;n._requestImageError=So.reportError(n._requestImageError,t,t.errorEvent,a,e.x,e.y,e.level,s),n._requestImageError.retry&&r()}function r(){let s=new Do({throttle:!1,throttleByServer:!0,type:is.IMAGERY});e.request=s,e.state=$n.TRANSITIONING;let a=t.requestImage(e.x,e.y,e.level,s);if(!l(a)){e.state=$n.UNLOADED,e.request=void 0;return}l(t.getTileCredits)&&(e.credits=t.getTileCredits(e.x,e.y,e.level)),a.then(function(c){i(c)}).catch(function(c){o(c)})}r()};pi.prototype._createTextureWebGL=function(e,t){let n=new mn({minificationFilter:this.minificationFilter,magnificationFilter:this.magnificationFilter}),i=t.image;return l(i.internalFormat)?new Ft({context:e,pixelFormat:i.internalFormat,width:i.width,height:i.height,source:{arrayBufferView:i.bufferView},sampler:n}):new Ft({context:e,source:i,pixelFormat:this._imageryProvider.hasAlphaChannel?at.RGBA:at.RGB,sampler:n})};pi.prototype._createTexture=function(e,t){let n=this._imageryProvider,i=t.image;if(l(n.tileDiscardPolicy)){let r=n.tileDiscardPolicy;if(l(r)){if(!r.isReady()){t.state=$n.RECEIVED;return}if(r.shouldDiscardImage(i)){t.state=$n.INVALID;return}}}let o=this._createTextureWebGL(e,t);n.tilingScheme.projection instanceof Li?t.textureWebMercator=o:t.texture=o,t.image=void 0,t.state=$n.TEXTURE_LOADED};function zbe(e,t,n){return`${e}:${t}:${n}`}pi.prototype._finalizeReprojectTexture=function(e,t){let n=this.minificationFilter,i=this.magnificationFilter;if(n===dn.LINEAR&&i===yi.LINEAR&&!at.isCompressedFormat(t.pixelFormat)&&P.isPowerOfTwo(t.width)&&P.isPowerOfTwo(t.height)){n=dn.LINEAR_MIPMAP_LINEAR;let r=Yt.maximumTextureFilterAnisotropy,s=Math.min(r,g(this._maximumAnisotropy,r)),a=zbe(n,i,s),c=e.cache.imageryLayerMipmapSamplers;l(c)||(c={},e.cache.imageryLayerMipmapSamplers=c);let d=c[a];l(d)||(d=c[a]=new mn({wrapS:En.CLAMP_TO_EDGE,wrapT:En.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i,maximumAnisotropy:s})),t.generateMipmap(Kh.NICEST),t.sampler=d}else{let r=zbe(n,i,0),s=e.cache.imageryLayerNonMipmapSamplers;l(s)||(s={},e.cache.imageryLayerNonMipmapSamplers=s);let a=s[r];l(a)||(a=s[r]=new mn({wrapS:En.CLAMP_TO_EDGE,wrapT:En.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i})),t.sampler=a}};pi.prototype._reprojectTexture=function(e,t,n){let i=t.textureWebMercator||t.texture,o=t.rectangle,r=e.context;if(n=g(n,!0),n&&!(this._imageryProvider.tilingScheme.projection instanceof Ci)&&o.width/i.width>1e-5){let s=this;t.addReference();let a=new iu({persists:!0,owner:this,preExecute:function(c){vrt(c,r,i,t.rectangle)},postExecute:function(c){t.texture=c,s._finalizeReprojectTexture(r,c),t.state=$n.READY,t.releaseReference()},canceled:function(){t.state=$n.TEXTURE_LOADED,t.releaseReference()}});this._reprojectComputeCommands.push(a)}else n&&(t.texture=i),this._finalizeReprojectTexture(r,i),t.state=$n.READY};pi.prototype.queueReprojectionCommands=function(e){let t=this._reprojectComputeCommands,n=t.length;for(let i=0;i<n;++i)e.commandList.push(t[i]);t.length=0};pi.prototype.cancelReprojections=function(){this._reprojectComputeCommands.forEach(function(e){l(e.canceled)&&e.canceled()}),this._reprojectComputeCommands.length=0};pi.prototype.getImageryFromCache=function(e,t,n,i){let o=Jbe(e,t,n),r=this._imageryCache[o];return l(r)||(r=new IV(this,e,t,n,i),this._imageryCache[o]=r),r.addReference(),r};pi.prototype.removeImageryFromCache=function(e){let t=Jbe(e.x,e.y,e.level);delete this._imageryCache[t]};function Jbe(e,t,n){return JSON.stringify([e,t,n])}var lD={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},textureDimensions:new D,texture:void 0},Prt=Ut.supportsTypedArrays()?new Float32Array(2*64):void 0;function vrt(e,t,n,i){let o=t.cache.imageryLayer_reproject;if(!l(o)){o=t.cache.imageryLayer_reproject={vertexArray:void 0,shaderProgram:void 0,sampler:void 0,destroy:function(){l(this.framebuffer)&&this.framebuffer.destroy(),l(this.vertexArray)&&this.vertexArray.destroy(),l(this.shaderProgram)&&this.shaderProgram.destroy()}};let _=new Float32Array(2*64*2),C=0;for(let X=0;X<64;++X){let v=X/63;_[C++]=0,_[C++]=v,_[C++]=1,_[C++]=v}let V={position:0,webMercatorT:1},L=Jr.getRegularGridIndices(2,64),R=pt.createIndexBuffer({context:t,typedArray:L,usage:Me.STATIC_DRAW,indexDatatype:Ae.UNSIGNED_SHORT});o.vertexArray=new ti({context:t,attributes:[{index:V.position,vertexBuffer:pt.createVertexBuffer({context:t,typedArray:_,usage:Me.STATIC_DRAW}),componentsPerAttribute:2},{index:V.webMercatorT,vertexBuffer:pt.createVertexBuffer({context:t,sizeInBytes:64*2*4,usage:Me.STREAM_DRAW}),componentsPerAttribute:1}],indexBuffer:R});let G=new Ue({sources:[$v]});o.shaderProgram=Ht.fromCache({context:t,vertexShaderSource:G,fragmentShaderSource:qv,attributeLocations:V}),o.sampler=new mn({wrapS:En.CLAMP_TO_EDGE,wrapT:En.CLAMP_TO_EDGE,minificationFilter:dn.LINEAR,magnificationFilter:yi.LINEAR})}n.sampler=o.sampler;let r=n.width,s=n.height;lD.textureDimensions.x=r,lD.textureDimensions.y=s,lD.texture=n;let a=Math.sin(i.south),c=.5*Math.log((1+a)/(1-a));a=Math.sin(i.north);let u=1/(.5*Math.log((1+a)/(1-a))-c),m=new Ft({context:t,width:r,height:s,pixelFormat:n.pixelFormat,pixelDatatype:n.pixelDatatype,preMultiplyAlpha:n.preMultiplyAlpha});P.isPowerOfTwo(r)&&P.isPowerOfTwo(s)&&m.generateMipmap(Kh.NICEST);let p=i.south,b=i.north,f=Prt,x=0;for(let _=0;_<64;++_){let C=_/63,V=P.lerp(p,b,C);a=Math.sin(V);let R=(.5*Math.log((1+a)/(1-a))-c)*u;f[x++]=R,f[x++]=R}o.vertexArray.getAttribute(1).vertexBuffer.copyFromArrayView(f),e.shaderProgram=o.shaderProgram,e.outputTexture=m,e.uniformMap=lD,e.vertexArray=o.vertexArray}function wrt(e,t,n){let i=e._imageryProvider,o=i.tilingScheme,r=o.ellipsoid,s=e._imageryProvider.tilingScheme.projection instanceof Ci?1:Math.cos(n),a=o.rectangle,d=r.maximumRadius*a.width*s/(i.tileWidth*o.getNumberOfXTilesAtLevel(0))/t,u=Math.log(d)/Math.log(2);return Math.round(u)|0}function Frt(e,t){e.numberOfListeners>0?e.raiseEvent(t):console.error(t)}async function Art(e,t){let n;try{if(n=await Promise.resolve(t),e.isDestroyed())return;e._imageryProvider=n,e._readyEvent.raiseEvent(n)}catch(i){Frt(e._errorEvent,i)}}var ha=pi;var hCi=T(S(),1);var BSi=T(S(),1),Mrt={WEST:0,NORTH:1,EAST:2,SOUTH:3,NORTHWEST:4,NORTHEAST:5,SOUTHWEST:6,SOUTHEAST:7},gn=Mrt;var OSi=T(S(),1),Qbe={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(e){return e>=Qbe.RENDERED_AND_KICKED},originalResult:function(e){return e&3},kick:function(e){return e|4}},Kn=Qbe;function wV(e){this.tile=e,this.frameLastUpdated=void 0,this.westMeshes=[],this.westTiles=[],this.southMeshes=[],this.southTiles=[],this.eastMeshes=[],this.eastTiles=[],this.northMeshes=[],this.northTiles=[],this.southwestMesh=void 0,this.southwestTile=void 0,this.southeastMesh=void 0,this.southeastTile=void 0,this.northwestMesh=void 0,this.northwestTile=void 0,this.northeastMesh=void 0,this.northeastTile=void 0,this.changedThisFrame=!0,this.visitedFrame=void 0,this.enqueuedFrame=void 0,this.mesh=void 0,this.vertexArray=void 0,this.waterMaskTexture=void 0,this.waterMaskTranslationAndScale=new se}wV.prototype.update=function(e,t,n){this.changedThisFrame&&(iye(e,t,this.tile,n),this.changedThisFrame=!1)};wV.prototype.destroy=function(e){this._destroyVertexArray(e),l(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,this.waterMaskTexture.referenceCount===0&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)};wV.prototype._destroyVertexArray=function(e){l(this.vertexArray)&&(l(e)?e.push(this.vertexArray):ju._freeVertexArray(this.vertexArray),this.vertexArray=void 0)};var Nrt=new Zy;wV.updateFillTiles=function(e,t,n,i){let o=e._quadtree,r=o._levelZeroTiles,s=o._lastSelectionFrameNumber,a=Nrt;a.clear();for(let d=0;d<t.length;++d){let u=t[d];l(u.data.vertexArray)&&a.enqueue(t[d])}let c=a.dequeue();for(;c!==void 0;){let d=c.findTileToWest(r),u=c.findTileToSouth(r),m=c.findTileToEast(r),p=c.findTileToNorth(r);Ls(e,n,c,d,s,gn.EAST,!1,a,i),Ls(e,n,c,u,s,gn.NORTH,!1,a,i),Ls(e,n,c,m,s,gn.WEST,!1,a,i),Ls(e,n,c,p,s,gn.SOUTH,!1,a,i);let b=d.findTileToNorth(r),f=d.findTileToSouth(r),x=m.findTileToNorth(r),_=m.findTileToSouth(r);Ls(e,n,c,b,s,gn.SOUTHEAST,!1,a,i),Ls(e,n,c,x,s,gn.SOUTHWEST,!1,a,i),Ls(e,n,c,f,s,gn.NORTHEAST,!1,a,i),Ls(e,n,c,_,s,gn.NORTHWEST,!1,a,i),c=a.dequeue()}};function Ls(e,t,n,i,o,r,s,a,c){if(i===void 0)return;let d=i;for(;d&&(d._lastSelectionResultFrame!==o||Kn.wasKicked(d._lastSelectionResult)||Kn.originalResult(d._lastSelectionResult)===Kn.CULLED);){if(s)return;let u=d.parent;if(r>=gn.NORTHWEST&&u!==void 0)switch(r){case gn.NORTHWEST:d=d===u.northwestChild?u:void 0;break;case gn.NORTHEAST:d=d===u.northeastChild?u:void 0;break;case gn.SOUTHWEST:d=d===u.southwestChild?u:void 0;break;case gn.SOUTHEAST:d=d===u.southeastChild?u:void 0;break}else d=u}if(d!==void 0){if(d._lastSelectionResult===Kn.RENDERED){if(l(d.data.vertexArray))return;krt(e,t,n,d,r,o,a,c);return}if(Kn.originalResult(i._lastSelectionResult)!==Kn.CULLED)switch(r){case gn.WEST:Ls(e,t,n,i.northwestChild,o,r,!0,a,c),Ls(e,t,n,i.southwestChild,o,r,!0,a,c);break;case gn.EAST:Ls(e,t,n,i.southeastChild,o,r,!0,a,c),Ls(e,t,n,i.northeastChild,o,r,!0,a,c);break;case gn.SOUTH:Ls(e,t,n,i.southwestChild,o,r,!0,a,c),Ls(e,t,n,i.southeastChild,o,r,!0,a,c);break;case gn.NORTH:Ls(e,t,n,i.northeastChild,o,r,!0,a,c),Ls(e,t,n,i.northwestChild,o,r,!0,a,c);break;case gn.NORTHWEST:Ls(e,t,n,i.northwestChild,o,r,!0,a,c);break;case gn.NORTHEAST:Ls(e,t,n,i.northeastChild,o,r,!0,a,c);break;case gn.SOUTHWEST:Ls(e,t,n,i.southwestChild,o,r,!0,a,c);break;case gn.SOUTHEAST:Ls(e,t,n,i.southeastChild,o,r,!0,a,c);break;default:throw new fe(\"Invalid edge\")}}}function krt(e,t,n,i,o,r,s,a){let c=i.data;if(c.fill===void 0)c.fill=new wV(i);else if(c.fill.visitedFrame===r)return;c.fill.enqueuedFrame!==r&&(c.fill.enqueuedFrame=r,c.fill.changedThisFrame=!1,s.enqueue(i)),Urt(e,t,n,i,o,a)}function Urt(e,t,n,i,o,r){let s=i.data.fill,a,c=n.data.fill;l(c)?(c.visitedFrame=t.frameNumber,c.changedThisFrame&&(iye(e,t,n,r),c.changedThisFrame=!1),a=n.data.fill.mesh):a=n.data.mesh;let d,u;switch(o){case gn.WEST:d=s.westMeshes,u=s.westTiles;break;case gn.SOUTH:d=s.southMeshes,u=s.southTiles;break;case gn.EAST:d=s.eastMeshes,u=s.eastTiles;break;case gn.NORTH:d=s.northMeshes,u=s.northTiles;break;case gn.NORTHWEST:s.changedThisFrame=s.changedThisFrame||s.northwestMesh!==a,s.northwestMesh=a,s.northwestTile=n;return;case gn.NORTHEAST:s.changedThisFrame=s.changedThisFrame||s.northeastMesh!==a,s.northeastMesh=a,s.northeastTile=n;return;case gn.SOUTHWEST:s.changedThisFrame=s.changedThisFrame||s.southwestMesh!==a,s.southwestMesh=a,s.southwestTile=n;return;case gn.SOUTHEAST:s.changedThisFrame=s.changedThisFrame||s.southeastMesh!==a,s.southeastMesh=a,s.southeastTile=n;return}if(n.level<=i.level){s.changedThisFrame=s.changedThisFrame||d[0]!==a||d.length!==1,d[0]=a,u[0]=n,d.length=1,u.length=1;return}let m,p,b,f,x=n.rectangle,_,C=i.rectangle;switch(o){case gn.WEST:for(_=(C.north-C.south)*P.EPSILON5,m=0;m<u.length&&(b=u[m],f=b.rectangle,!P.greaterThan(x.north,f.south,_));++m);for(p=m;p<u.length&&(b=u[p],f=b.rectangle,!P.greaterThanOrEquals(x.south,f.north,_));++p);break;case gn.SOUTH:for(_=(C.east-C.west)*P.EPSILON5,m=0;m<u.length&&(b=u[m],f=b.rectangle,!P.lessThan(x.west,f.east,_));++m);for(p=m;p<u.length&&(b=u[p],f=b.rectangle,!P.lessThanOrEquals(x.east,f.west,_));++p);break;case gn.EAST:for(_=(C.north-C.south)*P.EPSILON5,m=0;m<u.length&&(b=u[m],f=b.rectangle,!P.lessThan(x.south,f.north,_));++m);for(p=m;p<u.length&&(b=u[p],f=b.rectangle,!P.lessThanOrEquals(x.north,f.south,_));++p);break;case gn.NORTH:for(_=(C.east-C.west)*P.EPSILON5,m=0;m<u.length&&(b=u[m],f=b.rectangle,!P.greaterThan(x.east,f.west,_));++m);for(p=m;p<u.length&&(b=u[p],f=b.rectangle,!P.greaterThanOrEquals(x.west,f.east,_));++p);break}p-m===1?(s.changedThisFrame=s.changedThisFrame||d[m]!==a,d[m]=a,u[m]=n):(s.changedThisFrame=!0,d.splice(m,p-m,a),u.splice(m,p-m,n))}var xT=new he,Drt=new he,vV=new h,W4=new h,E4=new D,X4=new D,Ud=new D;function bD(){this.height=0,this.encodedNormal=new D}function dD(e,t,n,i,o,r,s,a,c){if(l(o))return o;let d;if(l(r)&&l(s))d=(r.height+s.height)*.5;else if(l(r))d=r.height;else if(l(s))d=s.height;else if(l(a))d=a.height;else{let m=e.tile.data.tileBoundingRegion,p=0,b=0;l(m)&&(p=m.minimumHeight,b=m.maximumHeight),d=(p+b)*.5}return oye(e,t,n,i,d,c),c}var Brt={minimumHeight:0,maximumHeight:0},Yrt=new h,jbe=new bD,qbe=new bD,$be=new bD,eye=new bD,Ort=typeof Uint8Array<\"u\"?new Uint8Array(9*9):void 0,zrt={tilingScheme:void 0,x:0,y:0,level:0,exaggeration:1,exaggerationRelativeHeight:0};function iye(e,t,n,i){ju.initialize(n,e.terrainProvider,e._imageryLayers);let o=n.data,r=o.fill,s=n.rectangle,a=t.verticalExaggeration,c=t.verticalExaggerationRelativeHeight,d=a!==1,u=n.tilingScheme.ellipsoid,m=mD(r,u,0,1,r.northwestTile,r.northwestMesh,r.northTiles,r.northMeshes,r.westTiles,r.westMeshes,$be),p=mD(r,u,0,0,r.southwestTile,r.southwestMesh,r.westTiles,r.westMeshes,r.southTiles,r.southMeshes,jbe),b=mD(r,u,1,0,r.southeastTile,r.southeastMesh,r.southTiles,r.southMeshes,r.eastTiles,r.eastMeshes,qbe),f=mD(r,u,1,1,r.northeastTile,r.northeastMesh,r.eastTiles,r.eastMeshes,r.northTiles,r.northMeshes,eye);m=dD(r,u,0,1,m,p,f,b,$be),p=dD(r,u,0,0,p,m,b,f,jbe),b=dD(r,u,1,1,b,p,f,m,qbe),f=dD(r,u,1,1,f,b,m,p,eye);let x=p.height,_=b.height,C=m.height,V=f.height,L=Math.min(x,_,C,V),R=Math.max(x,_,C,V),G=(L+R)*.5,X,v,W=e.getLevelMaximumGeometricError(n.level),F=u.maximumRadius-W,A=Math.acos(F/u.maximumRadius)*4;if(A*=1.5,s.width>A&&R-L<=W){let E=new Fa({width:9,height:9,buffer:Ort,structure:{heightOffset:R}}),I=zrt;I.tilingScheme=n.tilingScheme,I.x=n.x,I.y=n.y,I.level=n.level,I.exaggeration=a,I.exaggerationRelativeHeight=c,r.mesh=E._createMeshSync(I)}else{let E=d,I=le.center(s,Drt);I.height=G;let w=u.cartographicToCartesian(I,Yrt),k=new gc(w,void 0,void 0,void 0,void 0,!0,!0,E,a,c),B=5,U;for(U=r.westMeshes,X=0,v=U.length;X<v;++X)B+=U[X].eastIndicesNorthToSouth.length;for(U=r.southMeshes,X=0,v=U.length;X<v;++X)B+=U[X].northIndicesWestToEast.length;for(U=r.eastMeshes,X=0,v=U.length;X<v;++X)B+=U[X].westIndicesSouthToNorth.length;for(U=r.northMeshes,X=0,v=U.length;X<v;++X)B+=U[X].southIndicesEastToWest.length;let Y=Brt;Y.minimumHeight=L,Y.maximumHeight=R;let N=k.stride,J=new Float32Array(B*N),z=0,ee=z;z=uD(u,s,k,J,z,0,1,m.height,m.encodedNormal,1,Y),z=fD(r,u,k,J,z,r.westTiles,r.westMeshes,gn.EAST,Y);let H=z;z=uD(u,s,k,J,z,0,0,p.height,p.encodedNormal,0,Y),z=fD(r,u,k,J,z,r.southTiles,r.southMeshes,gn.NORTH,Y);let j=z;z=uD(u,s,k,J,z,1,0,b.height,b.encodedNormal,0,Y),z=fD(r,u,k,J,z,r.eastTiles,r.eastMeshes,gn.WEST,Y);let q=z;z=uD(u,s,k,J,z,1,1,f.height,f.encodedNormal,1,Y),z=fD(r,u,k,J,z,r.northTiles,r.northMeshes,gn.SOUTH,Y),L=Y.minimumHeight,R=Y.maximumHeight;let pe=Zn.fromRectangle(s,L,R,n.tilingScheme.ellipsoid),_e=Li.geodeticLatitudeToMercatorAngle(s.south),ae=1/(Li.geodeticLatitudeToMercatorAngle(s.north)-_e),ye=(Li.geodeticLatitudeToMercatorAngle(I.latitude)-_e)*ae,Te=u.geodeticSurfaceNormalCartographic(xT,W4),Le=wn.octEncode(Te,E4),Re=z;k.encode(J,z*N,pe.center,D.fromElements(.5,.5,Ud),G,Le,ye,Te),++z;let ke=z,rt=ke<256?1:2,yt=(ke-1)*3,Dt=yt*rt,it=(J.length-ke*N)*Float32Array.BYTES_PER_ELEMENT,Ie;if(it>=Dt){let Ve=ke*N*Float32Array.BYTES_PER_ELEMENT;Ie=ke<256?new Uint8Array(J.buffer,Ve,yt):new Uint16Array(J.buffer,Ve,yt)}else Ie=ke<256?new Uint8Array(yt):new Uint16Array(yt);J=new Float32Array(J.buffer,0,ke*N);let ft=0;for(X=0;X<ke-2;++X)Ie[ft++]=Re,Ie[ft++]=X,Ie[ft++]=X+1;Ie[ft++]=Re,Ie[ft++]=X,Ie[ft++]=0;let Ke=[];for(X=H;X>=ee;--X)Ke.push(X);let ct=[];for(X=j;X>=H;--X)ct.push(X);let Jt=[];for(X=q;X>=j;--X)Jt.push(X);let be=[];for(be.push(0),X=Re-1;X>=q;--X)be.push(X);r.mesh=new Qu(k.center,J,Ie,yt,ke,L,R,ce.fromOrientedBoundingBox(pe),$rt(e,pe.center,s,L,R),k.stride,pe,k,Ke,ct,Jt,be)}let y=t.context;r._destroyVertexArray(i),r.vertexArray=ju._createVertexArrayForMesh(y,r.mesh),o.processImagery(n,e.terrainProvider,t,!0);let Z=r.waterMaskTexture;if(r.waterMaskTexture=void 0,e.terrainProvider.hasWaterMask){let E=o._findAncestorTileWithTerrainData(n);l(E)&&l(E.data.waterMaskTexture)&&(r.waterMaskTexture=E.data.waterMaskTexture,++r.waterMaskTexture.referenceCount,o._computeWaterMaskTranslationAndScale(n,E,r.waterMaskTranslationAndScale))}l(Z)&&(--Z.referenceCount,Z.referenceCount===0&&Z.destroy())}function uD(e,t,n,i,o,r,s,a,c,d,u){let m=xT;m.longitude=P.lerp(t.west,t.east,r),m.latitude=P.lerp(t.south,t.north,s),m.height=a;let p=e.cartographicToCartesian(m,vV),b;n.hasGeodeticSurfaceNormals&&(b=e.geodeticSurfaceNormal(p,W4));let f=X4;return f.x=r,f.y=s,n.encode(i,o*n.stride,p,f,a,c,d,b),u.minimumHeight=Math.min(u.minimumHeight,a),u.maximumHeight=Math.max(u.maximumHeight,a),o+1}var pD=new le;function sw(e,t,n,i){let o=e.rectangle,r=t.rectangle;t.x===0&&n.x===1&&e.x===e.tilingScheme.getNumberOfXTilesAtLevel(e.level)-1?(o=le.clone(e.rectangle,pD),o.west-=P.TWO_PI,o.east-=P.TWO_PI):e.x===0&&n.x===0&&t.x===t.tilingScheme.getNumberOfXTilesAtLevel(t.level)-1&&(o=le.clone(e.rectangle,pD),o.west+=P.TWO_PI,o.east+=P.TWO_PI);let s=o.east-o.west,a=(r.west-o.west)/s,c=(r.east-o.west)/s,d=o.north-o.south,u=(r.south-o.south)/d,m=(r.north-o.south)/d,p=(n.x-a)/(c-a),b=(n.y-u)/(m-u);return Math.abs(p)<Math.EPSILON5?p=0:Math.abs(p-1)<Math.EPSILON5&&(p=1),Math.abs(b)<Math.EPSILON5?b=0:Math.abs(b-1)<Math.EPSILON5&&(b=1),i.x=p,i.y=b,i}var Hrt=new D;function I4(e,t,n,i,o){let r=e.encoding,s=e.vertices;if(o.height=r.decodeHeight(s,t),r.hasVertexNormals)r.getOctEncodedNormal(s,t,o.encodedNormal);else{let a=o.encodedNormal;a.x=0,a.y=0}}var Krt=new D,Jrt=new h;function Qrt(e,t,n,i,o,r,s,a,c,d){let u=i.encoding,m=i.vertices,p=sw(t,n,u.decodeTextureCoordinates(m,o,Ud),Ud),b=sw(t,n,u.decodeTextureCoordinates(m,r,X4),X4),f;c?f=(s-p.x)/(b.x-p.x):f=(a-p.y)/(b.y-p.y);let x=u.decodeHeight(m,o),_=u.decodeHeight(m,r),C=n.rectangle;xT.longitude=P.lerp(C.west,C.east,s),xT.latitude=P.lerp(C.south,C.north,a),d.height=xT.height=P.lerp(x,_,f);let V;if(u.hasVertexNormals){let L=u.getOctEncodedNormal(m,o,Hrt),R=u.getOctEncodedNormal(m,r,Krt),G=wn.octDecode(L.x,L.y,vV),X=wn.octDecode(R.x,R.y,Jrt);V=h.lerp(G,X,f,vV),h.normalize(V,V),wn.octEncode(V,d.encodedNormal)}else V=e.geodeticSurfaceNormalCartographic(xT,vV),wn.octEncode(V,d.encodedNormal)}function oye(e,t,n,i,o,r){r.height=o;let s=t.geodeticSurfaceNormalCartographic(xT,vV);wn.octEncode(s,r.encodedNormal)}function mD(e,t,n,i,o,r,s,a,c,d,u){if(nye(e,t,a,s,!1,n,i,u)||nye(e,t,d,c,!0,n,i,u))return u;let p;if(P4(o,r))return n===0?i===0?p=r.eastIndicesNorthToSouth[0]:p=r.southIndicesEastToWest[0]:i===0?p=r.northIndicesWestToEast[0]:p=r.westIndicesSouthToNorth[0],I4(r,p,n,i,u),u;let b;if(n===0?i===0?b=hD(e.westMeshes,e.westTiles,gn.EAST,e.southMeshes,e.southTiles,gn.NORTH,n,i):b=hD(e.northMeshes,e.northTiles,gn.SOUTH,e.westMeshes,e.westTiles,gn.EAST,n,i):i===0?b=hD(e.southMeshes,e.southTiles,gn.NORTH,e.eastMeshes,e.eastTiles,gn.WEST,n,i):b=hD(e.eastMeshes,e.eastTiles,gn.WEST,e.northMeshes,e.northTiles,gn.SOUTH,n,i),l(b))return oye(e,t,n,i,b,u),u}function hD(e,t,n,i,o,r,s,a){let c=tye(e,t,!1,n,s,a),d=tye(i,o,!0,r,s,a);return l(c)&&l(d)?(c+d)*.5:l(c)?c:d}function fD(e,t,n,i,o,r,s,a,c){for(let d=0;d<r.length;++d)o=jrt(e,t,n,i,o,r[d],s[d],a,c);return o}function jrt(e,t,n,i,o,r,s,a,c){let d=r.rectangle;a===gn.EAST&&e.tile.x===0?(d=le.clone(r.rectangle,pD),d.west-=P.TWO_PI,d.east-=P.TWO_PI):a===gn.WEST&&r.x===0&&(d=le.clone(r.rectangle,pD),d.west+=P.TWO_PI,d.east+=P.TWO_PI);let u=e.tile.rectangle,m,p;o>0&&(n.decodeTextureCoordinates(i,o-1,Ud),m=Ud.x,p=Ud.y);let b,f;switch(a){case gn.WEST:b=s.westIndicesSouthToNorth,f=!1;break;case gn.NORTH:b=s.northIndicesWestToEast,f=!0;break;case gn.EAST:b=s.eastIndicesNorthToSouth,f=!1;break;case gn.SOUTH:b=s.southIndicesEastToWest,f=!0;break}let x=r,_=e.tile,C=s.encoding,V=s.vertices,L=n.stride,R,G;C.hasWebMercatorT&&(R=Li.geodeticLatitudeToMercatorAngle(u.south),G=1/(Li.geodeticLatitudeToMercatorAngle(u.north)-R));for(let X=0;X<b.length;++X){let v=b[X],W=C.decodeTextureCoordinates(V,v,Ud);sw(x,_,W,W);let F=W.x,A=W.y,y=f?F:A;if(y<0||y>1||Math.abs(F-m)<P.EPSILON5&&Math.abs(A-p)<P.EPSILON5)continue;let Z=Math.abs(F)<P.EPSILON5||Math.abs(F-1)<P.EPSILON5,E=Math.abs(A)<P.EPSILON5||Math.abs(A-1)<P.EPSILON5;if(Z&&E)continue;let I=C.decodePosition(V,v,vV),w=C.decodeHeight(V,v),k;C.hasVertexNormals?k=C.getOctEncodedNormal(V,v,E4):(k=E4,k.x=0,k.y=0);let B=A;if(C.hasWebMercatorT){let Y=P.lerp(u.south,u.north,A);B=(Li.geodeticLatitudeToMercatorAngle(Y)-R)*G}let U;n.hasGeodeticSurfaceNormals&&(U=t.geodeticSurfaceNormal(I,W4)),n.encode(i,o*L,I,W,w,k,B,U),c.minimumHeight=Math.min(c.minimumHeight,w),c.maximumHeight=Math.max(c.maximumHeight,w),++o}return o}function tye(e,t,n,i,o,r){let s,a,c;n?(s=0,a=e.length,c=1):(s=e.length-1,a=-1,c=-1);for(let d=s;d!==a;d+=c){let u=e[d],m=t[d];if(!P4(m,u))continue;let p;switch(i){case gn.WEST:p=u.westIndicesSouthToNorth;break;case gn.SOUTH:p=u.southIndicesEastToWest;break;case gn.EAST:p=u.eastIndicesNorthToSouth;break;case gn.NORTH:p=u.northIndicesWestToEast;break}let b=p[n?0:p.length-1];if(l(b))return u.encoding.decodeHeight(u.vertices,b)}}function P4(e,t){return l(t)&&(!l(e.data.fill)||!e.data.fill.changedThisFrame)}function nye(e,t,n,i,o,r,s,a){let c,d,u,m,p,b=i[o?0:n.length-1],f=n[o?0:n.length-1];if(P4(b,f)&&(r===0?s===0?(c=o?f.northIndicesWestToEast:f.eastIndicesNorthToSouth,d=o,u=o):(c=o?f.eastIndicesNorthToSouth:f.southIndicesEastToWest,d=!o,u=!1):s===0?(c=o?f.westIndicesSouthToNorth:f.northIndicesWestToEast,d=!o,u=!0):(c=o?f.southIndicesEastToWest:f.westIndicesSouthToNorth,d=o,u=!o),c.length>0)){m=o?0:c.length-1,p=c[m],f.encoding.decodeTextureCoordinates(f.vertices,p,Ud);let x=sw(b,e.tile,Ud,Ud);if(x.x===r&&x.y===s)return I4(f,p,r,s,a),!0;if(m=Lo(c,d?r:s,function(_,C){f.encoding.decodeTextureCoordinates(f.vertices,_,Ud);let V=sw(b,e.tile,Ud,Ud);return u?d?V.x-r:V.y-s:d?r-V.x:s-V.y}),m<0){if(m=~m,m>0&&m<c.length)return Qrt(t,b,e.tile,f,c[m-1],c[m],r,s,d,a),!0}else return I4(f,c[m],r,s,a),!0}return!1}var qrt=[new h,new h,new h,new h];function $rt(e,t,n,i,o,r){let s=e.quadtree._occluders.ellipsoid,a=s.ellipsoid,c=qrt;return h.fromRadians(n.west,n.south,o,a,c[0]),h.fromRadians(n.east,n.south,o,a,c[1]),h.fromRadians(n.west,n.north,o,a,c[2]),h.fromRadians(n.east,n.north,o,a,c[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,c,i,r)}var FV=wV;function qo(e){this.lightingFadeOutDistance=65e5,this.lightingFadeInDistance=9e6,this.hasWaterMask=!1,this.oceanNormalMap=void 0,this.zoomedOutOceanSpecularIntensity=.5,this.enableLighting=!1,this.dynamicAtmosphereLighting=!1,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!1,this.shadows=_n.RECEIVE_ONLY,this.enableOrthographicOccludersJudge=!1,this.vertexShadowDarkness=.3,this.fillHighlightColor=void 0,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.undergroundColor=void 0,this.undergroundColorAlphaByDistance=void 0,this.lambertDiffuseMultiplier=0,this.materialUniformMap=void 0,this._materialUniformMap=void 0,this._quadtree=void 0,this._terrainProvider=e.terrainProvider,this._imageryLayers=e.imageryLayers,this._surfaceShaderSet=e.surfaceShaderSet,this._renderState=void 0,this._blendRenderState=void 0,this._disableCullingRenderState=void 0,this._disableCullingBlendRenderState=void 0,this._errorEvent=new ge,this._removeLayerAddedListener=this._imageryLayers.layerAdded.addEventListener(qo.prototype._onLayerAdded,this),this._removeLayerRemovedListener=this._imageryLayers.layerRemoved.addEventListener(qo.prototype._onLayerRemoved,this),this._removeLayerMovedListener=this._imageryLayers.layerMoved.addEventListener(qo.prototype._onLayerMoved,this),this._removeLayerShownListener=this._imageryLayers.layerShownOrHidden.addEventListener(qo.prototype._onLayerShownOrHidden,this),this._imageryLayersUpdatedEvent=new ge,this._layerOrderChanged=!1,this._tilesToRenderByTextureCount=[],this._drawCommands=[],this._uniformMaps=[],this._usedDrawCommands=0,this._vertexArraysToDestroy=[],this._debug={wireframe:!1,boundingSphereTile:void 0},this._baseColor=void 0,this._firstPassInitialColor=void 0,this.baseColor=new O(0,0,.5,1),this._clippingPlanes=void 0,this.cartographicLimitRectangle=le.clone(le.MAX_VALUE),this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1,this._oldVerticalExaggeration=void 0,this._oldVerticalExaggerationRelativeHeight=void 0}Object.defineProperties(qo.prototype,{baseColor:{get:function(){return this._baseColor},set:function(e){this._baseColor=e,this._firstPassInitialColor=se.fromColor(e,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(e){this._quadtree=e}},tilingScheme:{get:function(){if(l(this._terrainProvider))return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){this._terrainProvider!==e&&(this._terrainProvider=e,l(this._quadtree)&&this._quadtree.invalidateAllTiles())}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){fs.setOwner(e,this,\"_clippingPlanes\")}}});function est(e,t){let n=e.loadingImagery;l(n)||(n=e.readyImagery);let i=t.loadingImagery;return l(i)||(i=t.readyImagery),n.imageryLayer._layerIndex-i.imageryLayer._layerIndex}qo.prototype.update=function(e){this._imageryLayers._update()};function tst(e,t){let n=t.creditDisplay,i=e._terrainProvider;l(i)&&l(i.credit)&&n.addCreditToNextFrame(i.credit);let o=e._imageryLayers;for(let r=0,s=o.length;r<s;++r){let a=o.get(r);a.ready&&a.show&&l(a.imageryProvider.credit)&&n.addCreditToNextFrame(a.imageryProvider.credit)}}qo.prototype.initialize=function(e){this._imageryLayers.queueReprojectionCommands(e),this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile(function(i){i.data.imagery.sort(est)})),tst(this,e);let t=this._vertexArraysToDestroy,n=t.length;for(let i=0;i<n;++i)ju._freeVertexArray(t[i]);t.length=0};qo.prototype.beginUpdate=function(e){let t=this._tilesToRenderByTextureCount;for(let i=0,o=t.length;i<o;++i){let r=t[i];l(r)&&(r.length=0)}let n=this._clippingPlanes;l(n)&&n.enabled&&n.update(e),this._usedDrawCommands=0,this._hasLoadedTilesThisFrame=!1,this._hasFillTilesThisFrame=!1};qo.prototype.endUpdate=function(e){if(!l(this._renderState)){this._renderState=Ne.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:tc.LESS}}),this._blendRenderState=Ne.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:tc.LESS_OR_EQUAL},blending:un.ALPHA_BLEND});let s=Oe(this._renderState,!0);s.cull.enabled=!1,this._disableCullingRenderState=Ne.fromCache(s),s=Oe(this._blendRenderState,!0),s.cull.enabled=!1,this._disableCullingBlendRenderState=Ne.fromCache(s)}this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&FV.updateFillTiles(this,this._quadtree._tilesToRender,e,this._vertexArraysToDestroy);let t=this.quadtree,n=e.verticalExaggeration,i=e.verticalExaggerationRelativeHeight,o=this._oldVerticalExaggeration!==n||this._oldVerticalExaggerationRelativeHeight!==i;this._oldVerticalExaggeration=n,this._oldVerticalExaggerationRelativeHeight=i,o&&t.forEachLoadedTile(function(s){s.data.updateExaggeration(s,e,t)});let r=this._tilesToRenderByTextureCount;for(let s=0,a=r.length;s<a;++s){let c=r[s];if(l(c))for(let d=0,u=c.length;d<u;++d){let m=c[d],p=m.data.tileBoundingRegion;Lst(this,m,e),e.minimumTerrainHeight=Math.min(e.minimumTerrainHeight,p.minimumHeight)}}};function lye(e,t){let n=t.globeTranslucencyState;if(n.translucent){let i=e.renderState.blending.enabled;n.pushDerivedCommands(e,i,t)}else t.commandList.push(e)}qo.prototype.updateForPick=function(e){let t=this._drawCommands;for(let n=0,i=this._usedDrawCommands;n<i;++n)lye(t[n],e)};qo.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()};qo.prototype.getLevelMaximumGeometricError=function(e){return l(this._terrainProvider)?this._terrainProvider.getLevelMaximumGeometricError(e):0};qo.prototype.loadTile=function(e,t){let n=t.data,i=!0,o;l(n)&&(i=n.boundingVolumeSourceTile!==t||t._lastSelectionResult===Kn.CULLED_BUT_NEEDED,o=n.terrainState),ju.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i),n=t.data,i&&o!==t.data.terrainState&&this.computeTileVisibility(t,e,this.quadtree.occluders)!==lr.NONE&&n.boundingVolumeSourceTile===t&&(i=!1,ju.processStateMachine(t,e,this.terrainProvider,this._imageryLayers,this.quadtree,this._vertexArraysToDestroy,i))};var nst=new ce,dye=new le,ist=new le,ost=new he;function gD(e,t){if(t.west<t.east)return t;let n=le.clone(t,ist);return le.center(e,ost).longitude>0?n.east=P.PI:n.west=-P.PI,n}function uye(e,t){if(t.cameraUnderground||t.globeTranslucencyState.translucent)return!0;if(e.backFaceCulling)return!1;let n=e._clippingPlanes;return!!(l(n)&&n.enabled||!le.equals(e.cartographicLimitRectangle,le.MAX_VALUE))}qo.prototype.computeTileVisibility=function(e,t,n){let i=this.computeDistanceToTile(e,t);e._distance=i;let o=uye(this,t);if(t.fog.enabled&&!o&&P.fog(i,t.fog.density)>=1)return lr.NONE;let r=e.data,s=r.tileBoundingRegion;if(r.boundingVolumeSourceTile===void 0)return lr.PARTIAL;let a=t.cullingVolume,c=s.boundingVolume;l(c)||(c=s.boundingSphere),r.clippedByBoundaries=!1;let d=gD(e.rectangle,this.cartographicLimitRectangle),u=le.simpleIntersection(d,e.rectangle,dye);if(!l(u))return lr.NONE;if(le.equals(u,e.rectangle)||(r.clippedByBoundaries=!0),t.mode!==ie.SCENE3D&&(c=nst,ce.fromRectangleWithHeights2D(e.rectangle,t.mapProjection,s.minimumHeight,s.maximumHeight,c),h.fromElements(c.center.z,c.center.x,c.center.y,c.center),t.mode===ie.MORPHING&&l(r.renderedMesh)&&(c=ce.union(s.boundingSphere,c,c))),!l(c))return lr.PARTIAL;let m=this._clippingPlanes;if(l(m)&&m.enabled){let x=m.computeIntersectionWithBoundingVolume(c);if(e.isClipped=x!==nn.INSIDE,x===nn.OUTSIDE)return lr.NONE}let p,b=a.computeVisibility(c);if(b===nn.OUTSIDE?p=lr.NONE:b===nn.INTERSECTING?p=lr.PARTIAL:b===nn.INSIDE&&(p=lr.FULL),p===lr.NONE)return p;let f=t.mode===ie.SCENE3D&&t.camera.frustum instanceof rn;if(t.mode===ie.SCENE3D&&(!f||this.enableOrthographicOccludersJudge)&&l(n)&&!o){let x=r.occludeePointInScaledSpace;return!l(x)||n.ellipsoid.isScaledSpacePointVisiblePossiblyUnderEllipsoid(x,s.minimumHeight)?p:lr.NONE}return p};qo.prototype.canRefine=function(e){return l(e.data.terrainData)?!0:this.terrainProvider.getTileDataAvailable(e.x*2,e.y*2,e.level+1)!==void 0};var rst=[],sst=[];qo.prototype.canRenderWithoutLosingDetail=function(e,t){let n=e.data,i=rst;i.length=this._imageryLayers.length;let o=!1,r=!1,s;l(n)&&(o=n.terrainState===co.READY,r=!0,s=n.imagery);let a,c;for(a=0,c=i.length;a<c;++a)i[a]=r;if(l(s))for(a=0,c=s.length;a<c;++a){let m=s[a],p=m.loadingImagery,b=!l(p)||p.state===$n.FAILED||p.state===$n.INVALID,f=(m.loadingImagery||m.readyImagery).imageryLayer._layerIndex;i[f]=b&&i[f]}let d=this.quadtree._lastSelectionFrameNumber,u=sst;for(u.length=0,u.push(e.southwestChild,e.southeastChild,e.northwestChild,e.northeastChild);u.length>0;){let m=u.pop(),p=m._lastSelectionResultFrame===d?m._lastSelectionResult:Kn.NONE;if(p===Kn.RENDERED){let b=m.data;if(!l(b))continue;if(!o&&m.data.terrainState===co.READY)return!1;let f=m.data.imagery;for(a=0,c=f.length;a<c;++a){let x=f[a],_=x.loadingImagery,C=!l(_)||_.state===$n.FAILED||_.state===$n.INVALID,V=(x.loadingImagery||x.readyImagery).imageryLayer._layerIndex;if(C&&!i[V])return!1}}else p===Kn.REFINED&&u.push(m.southwestChild,m.southeastChild,m.northwestChild,m.northeastChild)}return!0};var ast=new h;qo.prototype.computeTileLoadPriority=function(e,t){let n=e.data;if(n===void 0)return 0;let i=n.tileBoundingRegion.boundingVolume;if(i===void 0)return 0;let o=t.camera.positionWC,r=t.camera.directionWC,s=h.subtract(i.center,o,ast),a=h.magnitude(s);return a<P.EPSILON5?0:(h.divideByScalar(s,a,s),(1-h.dot(s,r))*e._distance)};var rye=new M,yD=new M,cst=new se,lst=new se,dst=new se,ust=new h,sye=new h,mst=new h,hst=new h;qo.prototype.showTileThisFrame=function(e,t){let n=0,i=e.data.imagery;for(let a=0,c=i.length;a<c;++a){let d=i[a];l(d.readyImagery)&&d.readyImagery.imageryLayer.alpha!==0&&++n}let o=this._tilesToRenderByTextureCount[n];l(o)||(o=[],this._tilesToRenderByTextureCount[n]=o),o.push(e);let r=e.data;l(r.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;let s=this._debug;++s.tilesRendered,s.texturesRendered+=n};var fst=[new h,new h,new h,new h];function aye(e,t,n,i,o,r){let s=e.quadtree._occluders.ellipsoid,a=s.ellipsoid,c=fst;return h.fromRadians(n.west,n.south,o,a,c[0]),h.fromRadians(n.east,n.south,o,a,c[1]),h.fromRadians(n.west,n.north,o,a,c[2]),h.fromRadians(n.east,n.north,o,a,c[3]),s.computeHorizonCullingPointPossiblyUnderEllipsoid(t,c,i,r)}qo.prototype.computeDistanceToTile=function(e,t){pst(e,this,t);let n=e.data;if(n.boundingVolumeSourceTile===void 0)return 9999999999;let o=n.tileBoundingRegion,r=o.minimumHeight,s=o.maximumHeight;if(n.boundingVolumeSourceTile!==e){let c=t.camera.positionCartographic.height,d=Math.abs(c-r),u=Math.abs(c-s);d>u?(o.minimumHeight=r,o.maximumHeight=r):(o.minimumHeight=s,o.maximumHeight=s)}let a=o.distanceToCamera(t);return o.minimumHeight=r,o.maximumHeight=s,a};function pst(e,t,n){let i=e.data;i===void 0&&(i=e.data=new ju);let o=e.tilingScheme.ellipsoid;i.tileBoundingRegion===void 0&&(i.tileBoundingRegion=new Iu({computeBoundingVolumes:!1,rectangle:e.rectangle,ellipsoid:o,minimumHeight:0,maximumHeight:0}));let r=i.tileBoundingRegion,s=r.minimumHeight,a=r.maximumHeight,c=!1,d=e,u=i.mesh,m=i.terrainData;if(u!==void 0&&u.minimumHeight!==void 0&&u.maximumHeight!==void 0)r.minimumHeight=u.minimumHeight,r.maximumHeight=u.maximumHeight,c=!0;else if(m!==void 0&&m._minimumHeight!==void 0&&m._maximumHeight!==void 0)r.minimumHeight=m._minimumHeight,r.maximumHeight=m._maximumHeight;else{r.minimumHeight=Number.NaN,r.maximumHeight=Number.NaN;let p=e.parent;for(;p!==void 0;){let b=p.data;if(b!==void 0){let f=b.mesh,x=b.terrainData;if(f!==void 0&&f.minimumHeight!==void 0&&f.maximumHeight!==void 0){r.minimumHeight=f.minimumHeight,r.maximumHeight=f.maximumHeight;break}else if(x!==void 0&&x._minimumHeight!==void 0&&x._maximumHeight!==void 0){r.minimumHeight=x._minimumHeight,r.maximumHeight=x._maximumHeight;break}}p=p.parent}d=p}if(d!==void 0){let p=n.verticalExaggeration,b=n.verticalExaggerationRelativeHeight;if(p!==1&&(c=!1,r.minimumHeight=pr.getHeight(r.minimumHeight,p,b),r.maximumHeight=pr.getHeight(r.maximumHeight,p,b)),c)i.boundingVolumeIsFromMesh||(r._orientedBoundingBox=Zn.clone(u.orientedBoundingBox,r._orientedBoundingBox),r._boundingSphere=ce.clone(u.boundingSphere3D,r._boundingSphere),i.occludeePointInScaledSpace=h.clone(u.occludeePointInScaledSpace,i.occludeePointInScaledSpace),l(i.occludeePointInScaledSpace)||(i.occludeePointInScaledSpace=aye(t,r._orientedBoundingBox.center,e.rectangle,r.minimumHeight,r.maximumHeight,i.occludeePointInScaledSpace)));else{let x=r._orientedBoundingBox===void 0||r._boundingSphere===void 0;(r.minimumHeight!==s||r.maximumHeight!==a||x)&&(r.computeBoundingVolumes(o),i.occludeePointInScaledSpace=aye(t,r._orientedBoundingBox.center,e.rectangle,r.minimumHeight,r.maximumHeight,i.occludeePointInScaledSpace))}i.boundingVolumeSourceTile=d,i.boundingVolumeIsFromMesh=c}else i.boundingVolumeSourceTile=void 0,i.boundingVolumeIsFromMesh=!1}qo.prototype.isDestroyed=function(){return!1};qo.prototype.destroy=function(){return this._tileProvider=this._tileProvider&&this._tileProvider.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),this._removeLayerAddedListener=this._removeLayerAddedListener&&this._removeLayerAddedListener(),this._removeLayerRemovedListener=this._removeLayerRemovedListener&&this._removeLayerRemovedListener(),this._removeLayerMovedListener=this._removeLayerMovedListener&&this._removeLayerMovedListener(),this._removeLayerShownListener=this._removeLayerShownListener&&this._removeLayerShownListener(),me(this)};function bst(e,t,n){return function(i){let o,r,s=-1,a=i.data.imagery,c=a.length,d;for(d=0;d<c;++d)if(o=a[d],r=g(o.readyImagery,o.loadingImagery),r.imageryLayer===t){s=d;break}if(s!==-1){let u=s+e;if(o=a[u],r=l(o)?g(o.readyImagery,o.loadingImagery):void 0,!l(r)||r.imageryLayer!==t)return!t._createTileImagerySkeletons(i,n,u);for(d=s;d<u;++d)a[d].freeResources();a.splice(s,e)}return!0}}qo.prototype._onLayerAdded=function(e,t){if(!this.isDestroyed()&&e.show){let n=this._terrainProvider,i=this,o=this._imageryLayersUpdatedEvent,r=function(){e._imageryCache={},i._quadtree.forEachLoadedTile(function(s){if(l(s._loadedCallbacks[e._layerIndex]))return;let a,c=s.data.imagery,d=c.length,u=-1,m=0;for(a=0;a<d;++a){let b=c[a];if(g(b.readyImagery,b.loadingImagery).imageryLayer===e)u===-1&&(u=a),++m;else if(u!==-1)break}if(u===-1)return;let p=u+m;e._createTileImagerySkeletons(s,n,p)&&(s._loadedCallbacks[e._layerIndex]=bst(m,e,n),s.state=zs.LOADING)})};if(e.ready){let s=e.imageryProvider;s._reload=r}this._quadtree.forEachLoadedTile(function(s){e._createTileImagerySkeletons(s,n)&&(s.state=zs.LOADING,s.level!==0&&(s._lastSelectionResultFrame!==i.quadtree._lastSelectionFrameNumber||s._lastSelectionResult!==Kn.RENDERED)&&(s.renderable=!1))}),this._layerOrderChanged=!0,o.raiseEvent()}};qo.prototype._onLayerRemoved=function(e,t){this._quadtree.forEachLoadedTile(function(n){let i=n.data.imagery,o=-1,r=0;for(let s=0,a=i.length;s<a;++s){let c=i[s],d=c.loadingImagery;if(l(d)||(d=c.readyImagery),d.imageryLayer===e)o===-1&&(o=s),c.freeResources(),++r;else if(o!==-1)break}o!==-1&&i.splice(o,r)}),l(e.imageryProvider)&&(e.imageryProvider._reload=void 0),this._imageryLayersUpdatedEvent.raiseEvent()};qo.prototype._onLayerMoved=function(e,t,n){this._layerOrderChanged=!0,this._imageryLayersUpdatedEvent.raiseEvent()};qo.prototype._onLayerShownOrHidden=function(e,t,n){n?this._onLayerAdded(e,t):this._onLayerRemoved(e,t)};var yst=new M,gst=new M;function cye(e,t){let n={u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_atmosphereLightIntensity:function(){return this.properties.atmosphereLightIntensity},u_atmosphereRayleighCoefficient:function(){return this.properties.atmosphereRayleighCoefficient},u_atmosphereMieCoefficient:function(){return this.properties.atmosphereMieCoefficient},u_atmosphereRayleighScaleHeight:function(){return this.properties.atmosphereRayleighScaleHeight},u_atmosphereMieScaleHeight:function(){return this.properties.atmosphereMieScaleHeight},u_atmosphereMieAnisotropy:function(){return this.properties.atmosphereMieAnisotropy},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_verticalExaggerationAndRelativeHeight:function(){return this.properties.verticalExaggerationAndRelativeHeight},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){let i=e.context.uniformState.view,o=M.multiplyByPoint(i,this.properties.rtc,sye);return M.setTranslation(i,o,rye),rye},u_modifiedModelViewProjection:function(){let i=e.context.uniformState.view,o=e.context.uniformState.projection,r=M.multiplyByPoint(i,this.properties.rtc,sye);return M.setTranslation(i,r,yD),M.multiply(o,yD,yD),yD},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_dayTextureNightAlpha:function(){return this.properties.dayTextureNightAlpha},u_dayTextureDayAlpha:function(){return this.properties.dayTextureDayAlpha},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){let i=t._clippingPlanes;return l(i)&&l(i.texture)?i.texture:e.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){let i=t._clippingPlanes,o=l(i)?M.multiply(e.context.uniformState.view,i.modelMatrix,yst):M.IDENTITY;return M.inverseTranspose(o,gst)},u_clippingPlanesEdgeStyle:function(){let i=this.properties.clippingPlanesEdgeColor;return i.alpha=this.properties.clippingPlanesEdgeWidth,i},u_minimumBrightness:function(){return e.fog.minimumBrightness},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},u_frontFaceAlphaByDistance:function(){return this.properties.frontFaceAlphaByDistance},u_backFaceAlphaByDistance:function(){return this.properties.backFaceAlphaByDistance},u_translucencyRectangle:function(){return this.properties.localizedTranslucencyRectangle},u_undergroundColor:function(){return this.properties.undergroundColor},u_undergroundColorAlphaByDistance:function(){return this.properties.undergroundColorAlphaByDistance},u_lambertDiffuseMultiplier:function(){return this.properties.lambertDiffuseMultiplier},u_vertexShadowDarkness:function(){return this.properties.vertexShadowDarkness},u_dayTileUVCorrections:function(){return this.properties.dayTileUVCorrections},properties:{initialColor:new se(0,0,.5,1),fillHighlightColor:new O(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new D(65e5,9e6),nightFadeDistance:new D(1e7,4e7),atmosphereLightIntensity:10,atmosphereRayleighCoefficient:new h(55e-7,13e-6,284e-7),atmosphereMieCoefficient:new h(21e-6,21e-6,21e-6),atmosphereRayleighScaleHeight:1e4,atmosphereMieScaleHeight:3200,atmosphereMieAnisotropy:.9,hsbShift:new h,center3D:void 0,rtc:new h,modifiedModelView:new M,tileRectangle:new se,verticalExaggerationAndRelativeHeight:new D(1,0),dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new D,southMercatorYAndOneOverHeight:new D,waterMask:void 0,waterMaskTranslationAndScale:new se,minMaxHeight:new D,scaleAndBias:new M,clippingPlanesEdgeColor:O.clone(O.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new se,frontFaceAlphaByDistance:new se,backFaceAlphaByDistance:new se,localizedTranslucencyRectangle:new se,undergroundColor:O.clone(O.TRANSPARENT),undergroundColorAlphaByDistance:new se,lambertDiffuseMultiplier:0,vertexShadowDarkness:0,dayTileUVCorrections:[]}};return l(t.materialUniformMap)?Ct(n,t.materialUniformMap):n}function xst(e,t,n){let i=n.data,o,r;if(l(i.vertexArray)?(o=i.mesh,r=i.vertexArray):l(i.fill)&&l(i.fill.vertexArray)&&(o=i.fill.mesh,r=i.fill.vertexArray),!(!l(o)||!l(r))){if(l(i.wireframeVertexArray)){if(i.wireframeVertexArray.mesh===o)return;i.wireframeVertexArray.destroy(),i.wireframeVertexArray=void 0}i.wireframeVertexArray=_st(e,r,o),i.wireframeVertexArray.mesh=o}}function _st(e,t,n){let o={indices:n.indices,primitiveType:we.TRIANGLES};An.toWireframe(o);let r=o.indices,s=pt.createIndexBuffer({context:e,typedArray:r,usage:Me.STATIC_DRAW,indexDatatype:Ae.fromSizeInBytes(r.BYTES_PER_ELEMENT)});return new ti({context:e,attributes:t._attributes,indexBuffer:s})}var mye,hye,xD;(function(){let e=new Vt({geometry:Tm.fromDimensions({dimensions:new h(2,2,2)})}),t=new Vt({geometry:new p0({radius:1})}),n=new M,i,o;function r(s){return new Rn({geometryInstances:s,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})}mye=function(s,a){return s===i||(xD(),i=s,n=M.fromRotationTranslation(s.halfAxes,s.center,n),e.modelMatrix=n,e.attributes.color=Ot.fromColor(a),o=r(e)),o},hye=function(s,a){return s===i||(xD(),i=s,n=M.fromTranslation(s.center,n),n=M.multiplyByUniformScale(n,s.radius,n),t.modelMatrix=n,t.attributes.color=Ot.fromColor(a),o=r(t)),o},xD=function(){l(o)&&(o.destroy(),o=void 0,i=void 0)}})();var Tst=new se(0,0,0,0),Sst={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0,hasGeodeticSurfaceNormals:void 0,hasExaggeration:void 0,applyTileUVCorrection:void 0},Cst=O.TRANSPARENT,Vst=new At;function Lst(e,t,n){let i=t.data;l(i.vertexArray)||(i.fill===void 0&&(i.fill=new FV(t)),i.fill.update(e,n));let o=n.creditDisplay,r=i.terrainData;if(l(r)&&l(r.credits)){let be=r.credits;for(let Ve=0,Bt=be.length;Ve<Bt;++Ve)o.addCreditToNextFrame(be[Ve])}let s=Yt.maximumTextureImageUnits,a=i.waterMaskTexture,c=i.waterMaskTranslationAndScale;!l(a)&&l(i.fill)&&(a=i.fill.waterMaskTexture,c=i.fill.waterMaskTranslationAndScale);let d=n.cameraUnderground,u=n.globeTranslucencyState,m=u.translucent,p=u.frontFaceAlphaByDistance,b=u.backFaceAlphaByDistance,f=u.rectangle,x=g(e.undergroundColor,Cst),_=g(e.undergroundColorAlphaByDistance,Vst),C=uye(e,n)&&n.mode===ie.SCENE3D&&x.alpha>0&&(_.nearValue>0||_.farValue>0),V=e.lambertDiffuseMultiplier,L=e.vertexShadowDarkness,R=e.hasWaterMask&&l(a),G=e.oceanNormalMap,X=R&&l(G),v=e.terrainProvider,W=l(v)&&e.terrainProvider.hasVertexNormals,F=n.fog.enabled&&n.fog.renderable&&!d,A=e.showGroundAtmosphere&&n.mode===ie.SCENE3D,y=_n.castShadows(e.shadows)&&!m,Z=_n.receiveShadows(e.shadows)&&!m,E=e.hueShift,I=e.saturationShift,w=e.brightnessShift,k=!(P.equalsEpsilon(E,0,P.EPSILON7)&&P.equalsEpsilon(I,0,P.EPSILON7)&&P.equalsEpsilon(w,0,P.EPSILON7)),B=!1;if(A){let be=h.magnitude(n.camera.positionWC),Ve=e.nightFadeOutDistance;B=be>Ve}R&&--s,X&&--s,l(n.shadowState)&&n.shadowState.shadowsEnabled&&--s,l(e.clippingPlanes)&&e.clippingPlanes.enabled&&--s,s-=u.numberOfTextureUniforms;let U=i.renderedMesh,Y=U.center,N=U.encoding,J=i.tileBoundingRegion,z=n.verticalExaggeration,ee=n.verticalExaggerationRelativeHeight,H=z!==1,j=N.hasGeodeticSurfaceNormals,q=cst,pe=0,_e=0,ae=0,ye=0,Te=!1;if(n.mode!==ie.SCENE3D){let be=n.mapProjection,Ve=be.project(le.southwest(t.rectangle),mst),Bt=be.project(le.northeast(t.rectangle),hst);if(q.x=Ve.x,q.y=Ve.y,q.z=Bt.x,q.w=Bt.y,n.mode!==ie.MORPHING&&(Y=ust,Y.x=0,Y.y=(q.z+q.x)*.5,Y.z=(q.w+q.y)*.5,q.x-=Y.y,q.y-=Y.z,q.z-=Y.y,q.w-=Y.z),n.mode===ie.SCENE2D&&N.quantization===Os.BITS12){let mt=1/(Math.pow(2,12)-1)*.5,Pi=(q.z-q.x)*mt,Co=(q.w-q.y)*mt;q.x-=Pi,q.y-=Co,q.z+=Pi,q.w+=Co}be instanceof Li&&(pe=t.rectangle.south,_e=t.rectangle.north,ae=Li.geodeticLatitudeToMercatorAngle(pe),ye=1/(Li.geodeticLatitudeToMercatorAngle(_e)-ae),Te=!0)}let Le=Sst;Le.frameState=n,Le.surfaceTile=i,Le.showReflectiveOcean=R,Le.showOceanWaves=X,Le.enableLighting=e.enableLighting,Le.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,Le.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,Le.showGroundAtmosphere=A,Le.atmosphereLightIntensity=e.atmosphereLightIntensity,Le.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,Le.atmosphereMieCoefficient=e.atmosphereMieCoefficient,Le.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,Le.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,Le.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,Le.perFragmentGroundAtmosphere=B,Le.hasVertexNormals=W,Le.useWebMercatorProjection=Te,Le.clippedByBoundaries=i.clippedByBoundaries,Le.hasGeodeticSurfaceNormals=j,Le.hasExaggeration=H;let Re=i.imagery,ke=0,rt=Re.length,yt=e.showSkirts&&!d&&!m,Dt=e.backFaceCulling&&!d&&!m,it=Dt?e._renderState:e._disableCullingRenderState,Ie=Dt?e._blendRenderState:e._disableCullingBlendRenderState,ft=it,Ke=e._firstPassInitialColor,ct=n.context;if(l(e._debug.boundingSphereTile)||xD(),e._materialUniformMap!==e.materialUniformMap){e._materialUniformMap=e.materialUniformMap;let be=e._drawCommands.length;for(let Ve=0;Ve<be;++Ve)e._uniformMaps[Ve]=cye(n,e)}do{let be=0,Ve,Bt;if(e._drawCommands.length<=e._usedDrawCommands?(Ve=new je,Ve.owner=t,Ve.cull=!1,Ve.boundingVolume=new ce,Ve.orientedBoundingBox=void 0,Bt=cye(n,e),e._drawCommands.push(Ve),e._uniformMaps.push(Bt)):(Ve=e._drawCommands[e._usedDrawCommands],Bt=e._uniformMaps[e._usedDrawCommands]),Ve.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){let vi=J.boundingVolume,ga=J.boundingSphere;l(vi)?mye(vi,O.RED).update(n):l(ga)&&hye(ga,O.RED).update(n)}let mt=Bt.properties;se.clone(Ke,mt.initialColor),mt.oceanNormalMap=G,mt.lightingFadeDistance.x=e.lightingFadeOutDistance,mt.lightingFadeDistance.y=e.lightingFadeInDistance,mt.nightFadeDistance.x=e.nightFadeOutDistance,mt.nightFadeDistance.y=e.nightFadeInDistance,mt.atmosphereLightIntensity=e.atmosphereLightIntensity,mt.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,mt.atmosphereMieCoefficient=e.atmosphereMieCoefficient,mt.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,mt.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,mt.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,mt.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;let Pi=d?b:p,Co=d?p:b;l(Pi)&&(se.fromElements(Pi.near,Pi.nearValue,Pi.far,Pi.farValue,mt.frontFaceAlphaByDistance),se.fromElements(Co.near,Co.nearValue,Co.far,Co.farValue,mt.backFaceAlphaByDistance)),se.fromElements(_.near,_.nearValue,_.far,_.farValue,mt.undergroundColorAlphaByDistance),O.clone(x,mt.undergroundColor),mt.lambertDiffuseMultiplier=V,mt.vertexShadowDarkness=L;let Es=!l(i.vertexArray)&&l(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;Es&&O.clone(e.fillHighlightColor,mt.fillHighlightColor),mt.verticalExaggerationAndRelativeHeight.x=z,mt.verticalExaggerationAndRelativeHeight.y=ee,mt.center3D=U.center,h.clone(Y,mt.rtc),se.clone(q,mt.tileRectangle),mt.southAndNorthLatitude.x=pe,mt.southAndNorthLatitude.y=_e,mt.southMercatorYAndOneOverHeight.x=ae,mt.southMercatorYAndOneOverHeight.y=ye;let $r=lst,Nr=gD(t.rectangle,e.cartographicLimitRectangle),Qs=dst,De=gD(t.rectangle,f);h.fromElements(E,I,w,mt.hsbShift);let et=t.rectangle,qe=1/et.width,Ye=1/et.height;$r.x=(Nr.west-et.west)*qe,$r.y=(Nr.south-et.south)*Ye,$r.z=(Nr.east-et.west)*qe,$r.w=(Nr.north-et.south)*Ye,se.clone($r,mt.localizedCartographicLimitRectangle),Qs.x=(De.west-et.west)*qe,Qs.y=(De.south-et.south)*Ye,Qs.z=(De.east-et.west)*qe,Qs.w=(De.north-et.south)*Ye,se.clone(Qs,mt.localizedTranslucencyRectangle);let gt=F&&P.fog(t._distance,n.fog.density)>P.EPSILON3;k=k&&(gt||A);let zt=!1,Gn=!1,Vo=!1,tr=!1,Da=!1,nr=!1,ir=!1,zi=!1,ds=!1,es=!1;for(Le.applyTileUVCorrection=!1;be<s&&ke<rt;){let vi=Re[ke],ga=vi.readyImagery;if(++ke,!l(ga)||ga.imageryLayer.alpha===0)continue;let Tr=vi.useWebMercatorT?ga.textureWebMercator:ga.texture,kr=ga.imageryLayer;l(vi.textureTranslationAndScale)||(vi.textureTranslationAndScale=kr._calculateTextureTranslationAndScale(t,vi)),mt.dayTextures[be]=Tr,mt.dayTextureTranslationAndScale[be]=vi.textureTranslationAndScale,mt.dayTextureTexCoordsRectangle[be]=vi.textureCoordinateRectangle,mt.dayTextureUseWebMercatorT[be]=vi.useWebMercatorT,mt.dayTextureAlpha[be]=kr.alpha,nr=nr||mt.dayTextureAlpha[be]!==1,mt.dayTextureNightAlpha[be]=kr.nightAlpha,ir=ir||mt.dayTextureNightAlpha[be]!==1,mt.dayTextureDayAlpha[be]=kr.dayAlpha,ir=ir||mt.dayTextureDayAlpha[be]!==1,mt.dayTextureBrightness[be]=kr.brightness,zt=zt||mt.dayTextureBrightness[be]!==ha.DEFAULT_BRIGHTNESS,mt.dayTextureContrast[be]=kr.contrast,Gn=Gn||mt.dayTextureContrast[be]!==ha.DEFAULT_CONTRAST,mt.dayTextureHue[be]=kr.hue,Vo=Vo||mt.dayTextureHue[be]!==ha.DEFAULT_HUE,mt.dayTextureSaturation[be]=kr.saturation,tr=tr||mt.dayTextureSaturation[be]!==ha.DEFAULT_SATURATION,mt.dayTextureOneOverGamma[be]=1/kr.gamma,Da=Da||mt.dayTextureOneOverGamma[be]!==1/ha.DEFAULT_GAMMA,mt.dayTextureSplit[be]=kr.splitDirection,zi=zi||mt.dayTextureSplit[be]!==0;let po=mt.dayTextureCutoutRectangles[be];if(l(po)||(po=mt.dayTextureCutoutRectangles[be]=new se),se.clone(se.ZERO,po),l(kr.cutoutRectangle)){let _a=gD(et,kr.cutoutRectangle),um=le.simpleIntersection(_a,et,dye);ds=l(um)||ds,po.x=(_a.west-et.west)*qe,po.y=(_a.south-et.south)*Ye,po.z=(_a.east-et.west)*qe,po.w=(_a.north-et.south)*Ye}let xa=mt.colorsToAlpha[be];l(xa)||(xa=mt.colorsToAlpha[be]=new se);let yb=l(kr.colorToAlpha)&&kr.colorToAlphaThreshold>0;if(es=es||yb,yb){let _a=kr.colorToAlpha;xa.x=_a.red,xa.y=_a.green,xa.z=_a.blue,xa.w=kr.colorToAlphaThreshold}else xa.w=-1;if(l(ga.credits)){let _a=ga.credits;for(let um=0,mm=_a.length;um<mm;++um)o.addCreditToNextFrame(_a[um])}$.equalsEpsilon(vi.correctionMatrix,$.ZERO)||(mt.dayTileUVCorrections[be]=vi.correctionMatrix,Le.applyTileUVCorrection=!0),++be}mt.dayTextures.length=be,mt.dayTileUVCorrections.length=be,mt.waterMask=a,se.clone(c,mt.waterMaskTranslationAndScale),mt.minMaxHeight.x=N.minimumHeight,mt.minMaxHeight.y=N.maximumHeight,M.clone(N.matrix,mt.scaleAndBias);let dl=e._clippingPlanes,Uo=l(dl)&&dl.enabled&&t.isClipped;Uo&&(mt.clippingPlanesEdgeColor=O.clone(dl.edgeColor,mt.clippingPlanesEdgeColor),mt.clippingPlanesEdgeWidth=dl.edgeWidth),Le.numberOfDayTextures=be,Le.applyBrightness=zt,Le.applyContrast=Gn,Le.applyHue=Vo,Le.applySaturation=tr,Le.applyGamma=Da,Le.applyAlpha=nr,Le.applyDayNightAlpha=ir,Le.applySplit=zi,Le.enableFog=gt,Le.enableClippingPlanes=Uo,Le.clippingPlanes=dl,Le.hasImageryLayerCutout=ds,Le.colorCorrect=k,Le.highlightFillTile=Es,Le.colorToAlpha=es,Le.showUndergroundColor=C,Le.translucent=m;let ur=i.renderedMesh.indices.length;yt||(ur=i.renderedMesh.indexCountWithoutSkirts),Ve.shaderProgram=e._surfaceShaderSet.getShaderProgram(Le),Ve.castShadows=y,Ve.receiveShadows=Z,Ve.renderState=ft,Ve.primitiveType=we.TRIANGLES,Ve.vertexArray=i.vertexArray||i.fill.vertexArray,Ve.count=ur,Ve.uniformMap=Bt,Ve.pass=Ze.GLOBE,e._debug.wireframe&&(xst(ct,e,t),l(i.wireframeVertexArray)&&(Ve.vertexArray=i.wireframeVertexArray,Ve.primitiveType=we.LINES,Ve.count=ur*2));let Ec=Ve.boundingVolume,ul=Ve.orientedBoundingBox;n.mode!==ie.SCENE3D?(ce.fromRectangleWithHeights2D(t.rectangle,n.mapProjection,J.minimumHeight,J.maximumHeight,Ec),h.fromElements(Ec.center.z,Ec.center.x,Ec.center.y,Ec.center),n.mode===ie.MORPHING&&(Ec=ce.union(J.boundingSphere,Ec,Ec))):(Ve.boundingVolume=ce.clone(J.boundingSphere,Ec),Ve.orientedBoundingBox=Zn.clone(J.boundingVolume,ul)),Ve.dirty=!0,m&&u.updateDerivedCommands(Ve,n),lye(Ve,n),ft=Ie,Ke=Tst}while(ke<rt)}var aw=qo;var x1i=T(S(),1);function fye(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=le.clone(le.MAX_VALUE)}Object.defineProperties(fye.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){this._frontFaceAlphaByDistance=At.clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){this._backFaceAlphaByDistance=At.clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(e){l(e)||(e=le.clone(le.MAX_VALUE)),le.clone(e,this._rectangle)}}});var cw=fye;var G1i=T(S(),1);function Zs(){this._layers=[],this.layerAdded=new ge,this.layerRemoved=new ge,this.layerMoved=new ge,this.layerShownOrHidden=new ge}Object.defineProperties(Zs.prototype,{length:{get:function(){return this._layers.length}}});Zs.prototype.add=function(e,t){l(t)?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t);let i=e.readyEvent.addEventListener(()=>{this.layerShownOrHidden.raiseEvent(e,e._layerIndex,e.show),i()})};Zs.prototype.addImageryProvider=function(e,t){let n=new ha(e);return this.add(n,t),n};Zs.prototype.remove=function(e,t){t=g(t,!0);let n=this._layers.indexOf(e);return n!==-1?(this._layers.splice(n,1),this._update(),this.layerRemoved.raiseEvent(e,n),t&&e.destroy(),!0):!1};Zs.prototype.removeAll=function(e){e=g(e,!0);let t=this._layers;for(let n=0,i=t.length;n<i;n++){let o=t[n];this.layerRemoved.raiseEvent(o,n),e&&o.destroy()}this._layers=[]};Zs.prototype.contains=function(e){return this.indexOf(e)!==-1};Zs.prototype.indexOf=function(e){return this._layers.indexOf(e)};Zs.prototype.get=function(e){return this._layers[e]};function _D(e,t){return e.indexOf(t)}function pye(e,t,n){let i=e._layers;if(t=P.clamp(t,0,i.length-1),n=P.clamp(n,0,i.length-1),t===n)return;let o=i[t];i[t]=i[n],i[n]=o,e._update(),e.layerMoved.raiseEvent(o,n,t)}Zs.prototype.raise=function(e){let t=_D(this._layers,e);pye(this,t,t+1)};Zs.prototype.lower=function(e){let t=_D(this._layers,e);pye(this,t,t-1)};Zs.prototype.raiseToTop=function(e){let t=_D(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))};Zs.prototype.lowerToBottom=function(e){let t=_D(this._layers,e);t!==0&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};var Zst=new le;function bye(e,t,n,i){let o=e.globe._surface._tilesToRender,r;for(let a=0;!l(r)&&a<o.length;++a){let c=o[a];le.contains(c.rectangle,t)&&(r=c)}if(!l(r))return;let s=r.data.imagery;for(let a=s.length-1;a>=0;--a){let c=s[a],d=c.readyImagery;if(!l(d)||!d.imageryLayer.ready)continue;let u=d.imageryLayer.imageryProvider;if(n&&!l(u.pickFeatures)||!le.contains(d.rectangle,t))continue;let m=Zst,p=1/1024;m.west=P.lerp(r.rectangle.west,r.rectangle.east,c.textureCoordinateRectangle.x-p),m.east=P.lerp(r.rectangle.west,r.rectangle.east,c.textureCoordinateRectangle.z+p),m.south=P.lerp(r.rectangle.south,r.rectangle.north,c.textureCoordinateRectangle.y-p),m.north=P.lerp(r.rectangle.south,r.rectangle.north,c.textureCoordinateRectangle.w+p),le.contains(m,t)&&i(d)}}Zs.prototype.pickImageryLayers=function(e,t){let n=t.globe.pick(e,t);if(!l(n))return;let i=t.globe.ellipsoid.cartesianToCartographic(n),o=[];if(bye(t,i,!1,function(r){o.push(r.imageryLayer)}),o.length!==0)return o};Zs.prototype.pickImageryLayerFeatures=function(e,t){let n=t.globe.pick(e,t);if(!l(n))return;let i=t.globe.ellipsoid.cartesianToCartographic(n),o=[],r=[];if(bye(t,i,!0,function(s){if(!s.imageryLayer.ready)return;let c=s.imageryLayer.imageryProvider.pickFeatures(s.x,s.y,s.level,i.longitude,i.latitude);l(c)&&(o.push(c),r.push(s.imageryLayer))}),o.length!==0)return Promise.all(o).then(function(s){let a=[];for(let c=0;c<s.length;++c){let d=s[c],u=r[c];if(l(d)&&d.length>0)for(let m=0;m<d.length;++m){let p=d[m];p.imageryLayer=u,l(p.position)||(p.position=i),a.push(p)}}return a})};Zs.prototype.queueReprojectionCommands=function(e){let t=this._layers;for(let n=0,i=t.length;n<i;++n)t[n].queueReprojectionCommands(e)};Zs.prototype.cancelReprojections=function(){let e=this._layers;for(let t=0,n=e.length;t<n;++t)e[t].cancelReprojections()};Zs.prototype.isDestroyed=function(){return!1};Zs.prototype.destroy=function(){return this.removeAll(!0),me(this)};Zs.prototype._update=function(){let e=!0,t=this._layers,n,i,o,r;for(o=0,r=t.length;o<r;++o)i=t[o],i._layerIndex=o,i.show?(i._isBaseLayer=e,e=!1):i._isBaseLayer=!1,i.show!==i._show&&(l(i._show)&&(l(n)||(n=[]),n.push(i)),i._show=i.show);if(l(n))for(o=0,r=n.length;o<r;++o)i=n[o],this.layerShownOrHidden.raiseEvent(i,i._layerIndex,i.show)};var lw=Zs;var cVi=T(S(),1);var W1i=T(S(),1);function yye(e){this._ellipsoid=new L0(e.ellipsoid,h.ZERO)}Object.defineProperties(yye.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var dw=yye;var M1i=T(S(),1);function il(e){this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void"
}