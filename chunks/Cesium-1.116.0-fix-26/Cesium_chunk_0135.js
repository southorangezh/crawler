{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 135,
    "total_chunks": 194,
    "chunk_size": 30947,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.732Z"
  },
  "content": "vertex shader to avoid being overwritten; however, this creates // artifacts since some fragments can be alpha blended twice. This is solved by only rendering // the ellipsoid in the closest frustum to the viewer. gl_Position.z = clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far); czm_vertexLogDepth(); } `;var k4={position:0};function VD(e){e=g(e,g.EMPTY_OBJECT),this.center=h.clone(g(e.center,h.ZERO)),this._center=new h,this.radii=h.clone(e.radii),this._radii=new h,this._oneOverEllipsoidRadiiSquared=new h,this._boundingSphere=new ce,this.modelMatrix=M.clone(g(e.modelMatrix,M.IDENTITY)),this._modelMatrix=new M,this._computedModelMatrix=new M,this.show=g(e.show,!0),this.material=g(e.material,ki.fromType(ki.ColorType)),this._material=void 0,this._translucent=void 0,this.id=e.id,this._id=void 0,this.debugShowBoundingVolume=g(e.debugShowBoundingVolume,!1),this.onlySunLighting=g(e.onlySunLighting,!1),this._onlySunLighting=!1,this._depthTestEnabled=g(e.depthTestEnabled,!0),this._useLogDepth=!1,this._sp=void 0,this._rs=void 0,this._va=void 0,this._pickSP=void 0,this._pickId=void 0,this._colorCommand=new je({owner:g(e._owner,this)}),this._pickCommand=new je({owner:g(e._owner,this),pickOnly:!0});let t=this;this._uniforms={u_radii:function(){return t.radii},u_oneOverEllipsoidRadiiSquared:function(){return t._oneOverEllipsoidRadiiSquared}},this._pickUniforms={czm_pickColor:function(){return t._pickId.color}}}function oat(e){let t=e.cache.ellipsoidPrimitive_vertexArray;if(l(t))return t;let n=Tl.createGeometry(Tl.fromDimensions({dimensions:new h(2,2,2),vertexFormat:Pe.POSITION_ONLY}));return t=ti.fromGeometry({context:e,geometry:n,attributeLocations:k4,bufferUsage:Me.STATIC_DRAW,interleave:!0}),e.cache.ellipsoidPrimitive_vertexArray=t,t}VD.prototype.update=function(e){if(!this.show||e.mode!==ie.SCENE3D||!l(this.center)||!l(this.radii))return;let t=e.context,n=this.material.isTranslucent(),i=this._translucent!==n;(!l(this._rs)||i)&&(this._translucent=n,this._rs=Ne.fromCache({cull:{enabled:!0,face:mi.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!n&&t.fragmentDepth,blending:n?un.ALPHA_BLEND:void 0})),l(this._va)||(this._va=oat(t));let o=!1,r=this.radii;if(!h.equals(this._radii,r)){h.clone(r,this._radii);let x=this._oneOverEllipsoidRadiiSquared;x.x=1/(r.x*r.x),x.y=1/(r.y*r.y),x.z=1/(r.z*r.z),o=!0}(!M.equals(this.modelMatrix,this._modelMatrix)||!h.equals(this.center,this._center))&&(M.clone(this.modelMatrix,this._modelMatrix),h.clone(this.center,this._center),M.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),o=!0),o&&(h.clone(h.ZERO,this._boundingSphere.center),this._boundingSphere.radius=h.maximumComponent(r),ce.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));let s=this._material!==this.material;this._material=this.material,this._material.update(t);let a=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;let c=e.useLogDepth,d=this._useLogDepth!==c;this._useLogDepth=c;let u=this._colorCommand,m,p;(s||a||i||d)&&(m=new Ue({sources:[NV]}),p=new Ue({sources:[this.material.shaderSource,MV]}),this.onlySunLighting&&p.defines.push(\"ONLY_SUN_LIGHTING\"),!n&&t.fragmentDepth&&p.defines.push(\"WRITE_DEPTH\"),this._useLogDepth&&(m.defines.push(\"LOG_DEPTH\"),p.defines.push(\"LOG_DEPTH\")),this._sp=Ht.replaceCache({context:t,shaderProgram:this._sp,vertexShaderSource:m,fragmentShaderSource:p,attributeLocations:k4}),u.vertexArray=this._va,u.renderState=this._rs,u.shaderProgram=this._sp,u.uniformMap=Ct(this._uniforms,this.material._uniforms),u.executeInClosestFrustum=n);let b=e.commandList,f=e.passes;if(f.render&&(u.boundingVolume=this._boundingSphere,u.debugShowBoundingVolume=this.debugShowBoundingVolume,u.modelMatrix=this._computedModelMatrix,u.pass=n?Ze.TRANSLUCENT:Ze.OPAQUE,b.push(u)),f.pick){let x=this._pickCommand;(!l(this._pickId)||this._id!==this.id)&&(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=t.createPickId({primitive:this,id:this.id})),(s||a||!l(this._pickSP)||d)&&(m=new Ue({sources:[NV]}),p=new Ue({sources:[this.material.shaderSource,MV],pickColorQualifier:\"uniform\"}),this.onlySunLighting&&p.defines.push(\"ONLY_SUN_LIGHTING\"),!n&&t.fragmentDepth&&p.defines.push(\"WRITE_DEPTH\"),this._useLogDepth&&(m.defines.push(\"LOG_DEPTH\"),p.defines.push(\"LOG_DEPTH\")),this._pickSP=Ht.replaceCache({context:t,shaderProgram:this._pickSP,vertexShaderSource:m,fragmentShaderSource:p,attributeLocations:k4}),x.vertexArray=this._va,x.renderState=this._rs,x.shaderProgram=this._pickSP,x.uniformMap=Ct(Ct(this._uniforms,this._pickUniforms),this.material._uniforms),x.executeInClosestFrustum=n),x.boundingVolume=this._boundingSphere,x.modelMatrix=this._computedModelMatrix,x.pass=n?Ze.TRANSLUCENT:Ze.OPAQUE,b.push(x)}};VD.prototype.isDestroyed=function(){return!1};VD.prototype.destroy=function(){return this._sp=this._sp&&this._sp.destroy(),this._pickSP=this._pickSP&&this._pickSP.destroy(),this._pickId=this._pickId&&this._pickId.destroy(),me(this)};var Tw=VD;function Sw(e){e=g(e,g.EMPTY_OBJECT);let t=e.textureUrl;l(t)||(t=on(\"Assets/Textures/moonSmall.jpg\")),this.show=g(e.show,!0),this.textureUrl=t,this._ellipsoid=g(e.ellipsoid,oe.MOON),this.onlySunLighting=g(e.onlySunLighting,!0),this._ellipsoidPrimitive=new Tw({radii:this.ellipsoid.radii,material:ki.fromType(ki.ImageType),depthTestEnabled:!1,_owner:this}),this._ellipsoidPrimitive.material.translucent=!1,this._axes=new _w}Object.defineProperties(Sw.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var LD=new $,rat=new $,sat=new h,ZD=[];Sw.prototype.update=function(e){if(!this.show)return;let t=this._ellipsoidPrimitive;t.material.uniforms.image=this.textureUrl,t.onlySunLighting=this.onlySunLighting;let n=e.time;l(Wt.computeIcrfToFixedMatrix(n,LD))||Wt.computeTemeToPseudoFixedMatrix(n,LD);let i=this._axes.evaluate(n,rat);$.transpose(i,i),$.multiply(LD,i,i);let o=Eb.computeMoonPositionInEarthInertialFrame(n,sat);$.multiplyByVector(LD,o,o),M.fromRotationTranslation(i,o,t.modelMatrix);let r=e.commandList;return e.commandList=ZD,ZD.length=0,t.update(e),e.commandList=r,ZD.length===1?ZD[0]:void 0};Sw.prototype.isDestroyed=function(){return!1};Sw.prototype.destroy=function(){return this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy(),me(this)};var Cw=Sw;var IUi=T(S(),1);var KLi=T(S(),1);var U4=[],D4=[];function aat(e,t,n,i,o,r){let s=o-i+1,a=r-o,c=U4,d=D4,u,m;for(u=0;u<s;++u)c[u]=e[i+u];for(m=0;m<a;++m)d[m]=e[o+m+1];u=0,m=0;for(let p=i;p<=r;++p){let b=c[u],f=d[m];u<s&&(m>=a||t(b,f,n)<=0)?(e[p]=b,++u):m<a&&(e[p]=f,++m)}}function B4(e,t,n,i,o){if(i>=o)return;let r=Math.floor((i+o)*.5);B4(e,t,n,i,r),B4(e,t,n,r+1,o),aat(e,t,n,i,r,o)}function cat(e,t,n){let i=e.length,o=Math.ceil(i*.5);U4.length=o,D4.length=o,B4(e,t,n,0,i-1),U4.length=0,D4.length=0}var eb=cat;var oZi=T(S(),1);function _c(e,t){this._occluderPosition=h.clone(e.center),this._occluderRadius=e.radius,this._horizonDistance=0,this._horizonPlaneNormal=void 0,this._horizonPlanePosition=void 0,this._cameraPosition=void 0,this.cameraPosition=t}var RD=new h;Object.defineProperties(_c.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(e){e=h.clone(e,this._cameraPosition);let t=h.subtract(this._occluderPosition,e,RD),n=h.magnitudeSquared(t),i=this._occluderRadius*this._occluderRadius,o,r,s;if(n>i){o=Math.sqrt(n-i),n=1/Math.sqrt(n),r=h.multiplyByScalar(t,n,RD);let a=o*o*n;s=h.add(e,h.multiplyByScalar(r,a,RD),RD)}else o=Number.MAX_VALUE;this._horizonDistance=o,this._horizonPlaneNormal=r,this._horizonPlanePosition=s,this._cameraPosition=e}}});_c.fromBoundingSphere=function(e,t,n){return l(n)?(h.clone(e.center,n._occluderPosition),n._occluderRadius=e.radius,n.cameraPosition=t,n):new _c(e,t)};var Nye=new h;_c.prototype.isPointVisible=function(e){if(this._horizonDistance!==Number.MAX_VALUE){let t=h.subtract(e,this._occluderPosition,Nye),n=this._occluderRadius;if(n=h.magnitudeSquared(t)-n*n,n>0)return n=Math.sqrt(n)+this._horizonDistance,t=h.subtract(e,this._cameraPosition,t),n*n>h.magnitudeSquared(t)}return!1};var lat=new h;_c.prototype.isBoundingSphereVisible=function(e){let t=h.clone(e.center,lat),n=e.radius;if(this._horizonDistance!==Number.MAX_VALUE){let i=h.subtract(t,this._occluderPosition,Nye),o=this._occluderRadius-n;if(o=h.magnitudeSquared(i)-o*o,n<this._occluderRadius)return o>0?(o=Math.sqrt(o)+this._horizonDistance,i=h.subtract(t,this._cameraPosition,i),o*o+n*n>h.magnitudeSquared(i)):!1;if(o>0){i=h.subtract(t,this._cameraPosition,i);let r=h.magnitudeSquared(i),s=this._occluderRadius*this._occluderRadius,a=n*n;return(this._horizonDistance*this._horizonDistance+s)*a>r*s?!0:(o=Math.sqrt(o)+this._horizonDistance,o*o+a>r)}return!0}return!1};var dat=new h;_c.prototype.computeVisibility=function(e){let t=h.clone(e.center),n=e.radius;if(n>this._occluderRadius)return lr.FULL;if(this._horizonDistance!==Number.MAX_VALUE){let i=h.subtract(t,this._occluderPosition,dat),o=this._occluderRadius-n,r=h.magnitudeSquared(i);if(o=r-o*o,o>0){o=Math.sqrt(o)+this._horizonDistance,i=h.subtract(t,this._cameraPosition,i);let s=h.magnitudeSquared(i);return o*o+n*n<s?lr.NONE:(o=this._occluderRadius+n,o=r-o*o,o>0?(o=Math.sqrt(o)+this._horizonDistance,s<o*o+n*n?lr.FULL:lr.PARTIAL):(i=h.subtract(t,this._horizonPlanePosition,i),h.dot(i,this._horizonPlaneNormal)>-n?lr.PARTIAL:lr.FULL))}}return lr.NONE};var GD=new h;_c.computeOccludeePoint=function(e,t,n){let i=h.clone(t),o=h.clone(e.center),r=e.radius,s=n.length,a=h.normalize(h.subtract(i,o,GD),GD),c=-h.dot(a,o),d=_c._anyRotationVector(o,a,c),u=_c._horizonToPlaneNormalDotProduct(e,a,c,d,n[0]);if(!u)return;let m;for(let b=1;b<s;++b){if(m=_c._horizonToPlaneNormalDotProduct(e,a,c,d,n[b]),!m)return;m<u&&(u=m)}if(u<.0017453283658983088)return;let p=r/u;return h.add(o,h.multiplyByScalar(a,p,GD),GD)};var uat=[];_c.computeOccludeePointFromRectangle=function(e,t){t=g(t,oe.WGS84);let n=le.subsample(e,t,0,uat),i=ce.fromPoints(n),o=h.ZERO;if(!h.equals(o,i.center))return _c.computeOccludeePoint(new ce(o,t.minimumRadius),i.center,n)};var mat=new h;_c._anyRotationVector=function(e,t,n){let i=h.abs(t,mat),o=i.x>i.y?0:1;(o===0&&i.z>i.x||o===1&&i.z>i.y)&&(o=2);let r=new h,s;o===0?(i.x=e.x,i.y=e.y+1,i.z=e.z+1,s=h.UNIT_X):o===1?(i.x=e.x+1,i.y=e.y,i.z=e.z+1,s=h.UNIT_Y):(i.x=e.x+1,i.y=e.y+1,i.z=e.z,s=h.UNIT_Z);let a=(h.dot(t,i)+n)/-h.dot(t,s);return h.normalize(h.subtract(h.add(i,h.multiplyByScalar(s,a,r),i),e,i),i)};var hat=new h;_c._rotationVector=function(e,t,n,i,o){let r=h.subtract(i,e,hat);if(r=h.normalize(r,r),h.dot(t,r)<.9999999847691291){let s=h.cross(t,r,r);if(h.magnitude(s)>P.EPSILON13)return h.normalize(s,new h)}return o};var Y4=new h,fat=new h,ED=new h,Mye=new h;_c._horizonToPlaneNormalDotProduct=function(e,t,n,i,o){let r=h.clone(o,Y4),s=h.clone(e.center,fat),a=e.radius,c=h.subtract(s,r,ED),d=h.magnitudeSquared(c),u=a*a;if(d<u)return!1;let m=d-u,p=Math.sqrt(m),f=1/Math.sqrt(d),_=p*f*p;c=h.normalize(c,c);let C=h.add(r,h.multiplyByScalar(c,_,Mye),Mye),V=Math.sqrt(m-_*_),L=this._rotationVector(s,t,n,r,i),R=h.fromElements(L.x*L.x*c.x+(L.x*L.y-L.z)*c.y+(L.x*L.z+L.y)*c.z,(L.x*L.y+L.z)*c.x+L.y*L.y*c.y+(L.y*L.z-L.x)*c.z,(L.x*L.z-L.y)*c.x+(L.y*L.z+L.x)*c.y+L.z*L.z*c.z,Y4);R=h.normalize(R,R);let G=h.multiplyByScalar(R,V,Y4);L=h.normalize(h.subtract(h.add(C,G,ED),s,ED),ED);let X=h.dot(t,L);L=h.normalize(h.subtract(h.subtract(C,G,L),s,L),L);let v=h.dot(t,L);return X<v?X:v};var Vw=_c;var xZi=T(S(),1);var hZi=T(S(),1);function Bf(e){e=g(e,g.EMPTY_OBJECT),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=g(e.near,1),this._near=this.near,this.far=g(e.far,5e8),this._far=this.far,this._cullingVolume=new os,this._perspectiveMatrix=new M,this._infinitePerspective=new M}function O4(e){let t=e.top,n=e.bottom,i=e.right,o=e.left,r=e.near,s=e.far;(t!==e._top||n!==e._bottom||o!==e._left||i!==e._right||r!==e._near||s!==e._far)&&(e._left=o,e._right=i,e._top=t,e._bottom=n,e._near=r,e._far=s,e._perspectiveMatrix=M.computePerspectiveOffCenter(o,i,n,t,r,s,e._perspectiveMatrix),e._infinitePerspective=M.computeInfinitePerspectiveOffCenter(o,i,n,t,r,e._infinitePerspective))}Object.defineProperties(Bf.prototype,{projectionMatrix:{get:function(){return O4(this),this._perspectiveMatrix}},infiniteProjectionMatrix:{get:function(){return O4(this),this._infinitePerspective}}});var pat=new h,bat=new h,yat=new h,gat=new h;Bf.prototype.computeCullingVolume=function(e,t,n){let i=this._cullingVolume.planes,o=this.top,r=this.bottom,s=this.right,a=this.left,c=this.near,d=this.far,u=h.cross(t,n,pat),m=bat;h.multiplyByScalar(t,c,m),h.add(e,m,m);let p=yat;h.multiplyByScalar(t,d,p),h.add(e,p,p);let b=gat;h.multiplyByScalar(u,a,b),h.add(m,b,b),h.subtract(b,e,b),h.normalize(b,b),h.cross(b,n,b),h.normalize(b,b);let f=i[0];return l(f)||(f=i[0]=new se),f.x=b.x,f.y=b.y,f.z=b.z,f.w=-h.dot(b,e),h.multiplyByScalar(u,s,b),h.add(m,b,b),h.subtract(b,e,b),h.cross(n,b,b),h.normalize(b,b),f=i[1],l(f)||(f=i[1]=new se),f.x=b.x,f.y=b.y,f.z=b.z,f.w=-h.dot(b,e),h.multiplyByScalar(n,r,b),h.add(m,b,b),h.subtract(b,e,b),h.cross(u,b,b),h.normalize(b,b),f=i[2],l(f)||(f=i[2]=new se),f.x=b.x,f.y=b.y,f.z=b.z,f.w=-h.dot(b,e),h.multiplyByScalar(n,o,b),h.add(m,b,b),h.subtract(b,e,b),h.cross(b,u,b),h.normalize(b,b),f=i[3],l(f)||(f=i[3]=new se),f.x=b.x,f.y=b.y,f.z=b.z,f.w=-h.dot(b,e),f=i[4],l(f)||(f=i[4]=new se),f.x=t.x,f.y=t.y,f.z=t.z,f.w=-h.dot(t,m),h.negate(t,b),f=i[5],l(f)||(f=i[5]=new se),f.x=b.x,f.y=b.y,f.z=b.z,f.w=-h.dot(b,p),this._cullingVolume};Bf.prototype.getPixelDimensions=function(e,t,n,i,o){O4(this);let r=1/this.near,s=this.top*r,a=2*i*n*s/t;s=this.right*r;let c=2*i*n*s/e;return o.x=c,o.y=a,o};Bf.prototype.clone=function(e){return l(e)||(e=new Bf),e.right=this.right,e.left=this.left,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e._left=void 0,e._right=void 0,e._top=void 0,e._bottom=void 0,e._near=void 0,e._far=void 0,e};Bf.prototype.equals=function(e){return l(e)&&e instanceof Bf&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far};Bf.prototype.equalsEpsilon=function(e,t,n){return e===this||l(e)&&e instanceof Bf&&P.equalsEpsilon(this.right,e.right,t,n)&&P.equalsEpsilon(this.left,e.left,t,n)&&P.equalsEpsilon(this.top,e.top,t,n)&&P.equalsEpsilon(this.bottom,e.bottom,t,n)&&P.equalsEpsilon(this.near,e.near,t,n)&&P.equalsEpsilon(this.far,e.far,t,n)};var ol=Bf;function Kl(e){e=g(e,g.EMPTY_OBJECT),this._offCenterFrustum=new ol,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=g(e.near,1),this._near=this.near,this.far=g(e.far,5e8),this._far=this.far,this.xOffset=g(e.xOffset,0),this._xOffset=this.xOffset,this.yOffset=g(e.yOffset,0),this._yOffset=this.yOffset}Kl.packedLength=6;Kl.pack=function(e,t,n){return n=g(n,0),t[n++]=e.fov,t[n++]=e.aspectRatio,t[n++]=e.near,t[n++]=e.far,t[n++]=e.xOffset,t[n]=e.yOffset,t};Kl.unpack=function(e,t,n){return t=g(t,0),l(n)||(n=new Kl),n.fov=e[t++],n.aspectRatio=e[t++],n.near=e[t++],n.far=e[t++],n.xOffset=e[t++],n.yOffset=e[t],n};function Ch(e){let t=e._offCenterFrustum;(e.fov!==e._fov||e.aspectRatio!==e._aspectRatio||e.near!==e._near||e.far!==e._far||e.xOffset!==e._xOffset||e.yOffset!==e._yOffset)&&(e._aspectRatio=e.aspectRatio,e._fov=e.fov,e._fovy=e.aspectRatio<=1?e.fov:Math.atan(Math.tan(e.fov*.5)/e.aspectRatio)*2,e._near=e.near,e._far=e.far,e._sseDenominator=2*Math.tan(.5*e._fovy),e._xOffset=e.xOffset,e._yOffset=e.yOffset,t.top=e.near*Math.tan(.5*e._fovy),t.bottom=-t.top,t.right=e.aspectRatio*t.top,t.left=-t.right,t.near=e.near,t.far=e.far,t.right+=e.xOffset,t.left+=e.xOffset,t.top+=e.yOffset,t.bottom+=e.yOffset)}Object.defineProperties(Kl.prototype,{projectionMatrix:{get:function(){return Ch(this),this._offCenterFrustum.projectionMatrix}},infiniteProjectionMatrix:{get:function(){return Ch(this),this._offCenterFrustum.infiniteProjectionMatrix}},fovy:{get:function(){return Ch(this),this._fovy}},sseDenominator:{get:function(){return Ch(this),this._sseDenominator}},offCenterFrustum:{get:function(){return Ch(this),this._offCenterFrustum}}});Kl.prototype.computeCullingVolume=function(e,t,n){return Ch(this),this._offCenterFrustum.computeCullingVolume(e,t,n)};Kl.prototype.getPixelDimensions=function(e,t,n,i,o){return Ch(this),this._offCenterFrustum.getPixelDimensions(e,t,n,i,o)};Kl.prototype.clone=function(e){return l(e)||(e=new Kl),e.aspectRatio=this.aspectRatio,e.fov=this.fov,e.near=this.near,e.far=this.far,e._aspectRatio=void 0,e._fov=void 0,e._near=void 0,e._far=void 0,this._offCenterFrustum.clone(e._offCenterFrustum),e};Kl.prototype.equals=function(e){return!l(e)||!(e instanceof Kl)?!1:(Ch(this),Ch(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this._offCenterFrustum.equals(e._offCenterFrustum))};Kl.prototype.equalsEpsilon=function(e,t,n){return!l(e)||!(e instanceof Kl)?!1:(Ch(this),Ch(e),P.equalsEpsilon(this.fov,e.fov,t,n)&&P.equalsEpsilon(this.aspectRatio,e.aspectRatio,t,n)&&this._offCenterFrustum.equalsEpsilon(e._offCenterFrustum,t,n))};var _i=Kl;var LZi=T(S(),1);var TZi=T(S(),1),Lw={NONE:0,SCENE_LIGHT:1,SUNLIGHT:2};Lw.fromGlobeFlags=function(e){return e.enableLighting&&e.dynamicAtmosphereLighting?e.dynamicAtmosphereLightingFromSun?Lw.SUNLIGHT:Lw.SCENE_LIGHT:Lw.NONE};var _T=Object.freeze(Lw);function xat(){this.lightIntensity=10,this.rayleighCoefficient=new h(55e-7,13e-6,284e-7),this.mieCoefficient=new h(21e-6,21e-6,21e-6),this.rayleighScaleHeight=1e4,this.mieScaleHeight=3200,this.mieAnisotropy=.9,this.hueShift=0,this.saturationShift=0,this.brightnessShift=0,this.dynamicLighting=_T.NONE}var Zw=xat;var NZi=T(S(),1);var RZi=T(S(),1),Rw=`in vec2 v_textureCoordinates; const float M_PI = 3.141592653589793; float vdcRadicalInverse(int i) { float r; float base = 2.0; float value = 0.0; float invBase = 1.0 / base; float invBi = invBase; for (int x = 0; x < 100; x++) { if (i <= 0) { break; } r = mod(float(i), base); value += r * invBi; invBi *= invBase; i = int(float(i) * invBase); } return value; } vec2 hammersley2D(int i, int N) { return vec2(float(i) / float(N), vdcRadicalInverse(i)); } vec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N) { float a = roughness * roughness; float phi = 2.0 * M_PI * xi.x; float cosTheta = sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y)); float sinTheta = sqrt(1.0 - cosTheta * cosTheta); vec3 H = vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta); vec3 upVector = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0); vec3 tangentX = normalize(cross(upVector, N)); vec3 tangentY = cross(N, tangentX); return tangentX * H.x + tangentY * H.y + N * H.z; } float G1_Smith(float NdotV, float k) { return NdotV / (NdotV * (1.0 - k) + k); } float G_Smith(float roughness, float NdotV, float NdotL) { float k = roughness * roughness / 2.0; return G1_Smith(NdotV, k) * G1_Smith(NdotL, k); } vec2 integrateBrdf(float roughness, float NdotV) { vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV); float A = 0.0; float B = 0.0; const int NumSamples = 1024; for (int i = 0; i < NumSamples; i++) { vec2 xi = hammersley2D(i, NumSamples); vec3 H = importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0)); vec3 L = 2.0 * dot(V, H) * H - V; float NdotL = clamp(L.z, 0.0, 1.0); float NdotH = clamp(H.z, 0.0, 1.0); float VdotH = clamp(dot(V, H), 0.0, 1.0); if (NdotL > 0.0) { float G = G_Smith(roughness, NdotV, NdotL); float G_Vis = G * VdotH / (NdotH * NdotV); float Fc = pow(1.0 - VdotH, 5.0); A += (1.0 - Fc) * G_Vis; B += Fc * G_Vis; } } return vec2(A, B) / float(NumSamples); } void main() { out_FragColor = vec4(integrateBrdf(v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0); } `;function Gw(){this._colorTexture=void 0,this._drawCommand=void 0}Object.defineProperties(Gw.prototype,{colorTexture:{get:function(){return this._colorTexture}}});function _at(e,t,n){let i=t.createViewportQuadCommand(Rw,{framebuffer:n,renderState:Ne.fromCache({viewport:new ze(0,0,256,256)})});e._drawCommand=i}Gw.prototype.update=function(e){if(!l(this._colorTexture)){let t=e.context,n=new Ft({context:t,width:256,height:256,pixelFormat:at.RGBA,pixelDatatype:Qe.UNSIGNED_BYTE,sampler:mn.NEAREST});this._colorTexture=n;let i=new $s({context:t,colorTextures:[n],destroyAttachments:!1});_at(this,t,i),this._drawCommand.execute(t),i.destroy(),this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}};Gw.prototype.isDestroyed=function(){return!1};Gw.prototype.destroy=function(){return this._colorTexture=this._colorTexture&&this._colorTexture.destroy(),me(this)};var Ew=Gw;var ERi=T(S(),1);var jZi=T(S(),1);var Bye={};function Tat(e,t,n){let i,o,r;if(e instanceof _i){let s=Math.tan(.5*e.fovy);return i=e.near,o=e.near*s,r=e.aspectRatio*o,Math.max(t*i/r,n*i/o)}else if(e instanceof ol)return i=e.near,o=e.top,r=e.right,Math.max(t*i/r,n*i/o);return Math.max(t,n)}var Sat=new h,kye=new h;function Yye(e,t,n,i){if(l(i)&&n(.5)>i){let o=n(0),r=n(1),s=n(.5),a=s-o,c=s-r;return function(d){let u=n(d);if(d<=.5){let p=(u-o)/a;return P.lerp(e,-P.PI_OVER_TWO,p)}let m=(u-r)/c;return P.lerp(-P.PI_OVER_TWO,t,1-m)}}return function(o){return P.lerp(e,t,o)}}function H4(e,t,n,i,o){let r=o,s=Math.max(n,i);if(!l(r)){let a=e.position,c=t,d=e.up,u=e.right,m=e.frustum,p=h.subtract(a,c,Sat),b=h.magnitude(h.multiplyByScalar(d,h.dot(p,d),kye)),f=h.magnitude(h.multiplyByScalar(u,h.dot(p,u),kye));r=Math.min(Tat(m,b,f)*.2,1e9)}if(s<r){let d=-Math.pow((r-n)*1e6,.125),u=Math.pow((r-i)*1e6,1/8);return function(m){let p=m*(u-d)+d;return-Math.pow(p,8)/1e6+r}}return function(a){return P.lerp(n,i,a)}}function Xw(e,t){return P.equalsEpsilon(e,P.TWO_PI,P.EPSILON11)&&(e=0),t>e+Math.PI?e+=P.TWO_PI:t<e-Math.PI&&(e-=P.TWO_PI),e}var Oye=new h;function Cat(e,t,n,i,o,r,s,a){let c=e.camera,d=h.clone(c.position,Oye),u=c.pitch,m=Xw(c.heading,i),p=Xw(c.roll,r),b=H4(c,n,d.z,n.z,s),f=Yye(u,o,b,a);function x(_){let C=_.time/t;c.setView({orientation:{heading:P.lerp(m,i,C),pitch:f(C),roll:P.lerp(p,r,C)}}),D.lerp(d,n,C,c.position),c.position.z=b(C)}return x}function Vat(e,t){e.longitude<t.longitude?e.longitude+=P.TWO_PI:t.longitude+=P.TWO_PI}function Lat(e,t){let n=e.longitude-t.longitude;n<-P.PI?e.longitude+=P.TWO_PI:n>P.PI&&(t.longitude+=P.TWO_PI)}var Zat=new he,Rat=new he;function Gat(e,t,n,i,o,r,s,a,c,d){let u=e.camera,p=e.mapProjection.ellipsoid,b=he.clone(u.positionCartographic,Zat),f=u.pitch,x=Xw(u.heading,i),_=Xw(u.roll,r),C=p.cartesianToCartographic(n,Rat);b.longitude=P.zeroToTwoPi(b.longitude),C.longitude=P.zeroToTwoPi(C.longitude);let V=!1;if(l(a)){let X=P.zeroToTwoPi(a),v=Math.min(b.longitude,C.longitude),W=Math.max(b.longitude,C.longitude),F=X>=v&&X<=W;if(l(c)){let A=Math.abs(b.longitude-C.longitude),y=P.TWO_PI-A;(F?A:y)<(F?y:A)*c&&!F&&(V=!0)}else F||(V=!0)}V?Vat(b,C):Lat(b,C);let L=H4(u,n,b.height,C.height,s),R=Yye(f,o,L,d);function G(){let X=b.longitude,v=C.longitude,W=b.latitude,F=C.latitude;return function(y){let Z=y.time/t,E=h.fromRadians(P.lerp(X,v,Z),P.lerp(W,F,Z),L(Z),p);u.setView({destination:E,orientation:{heading:P.lerp(x,i,Z),pitch:R(Z),roll:P.lerp(_,r,Z)}})}}return G()}function Eat(e,t,n,i,o,r,s){let a=e.camera,c=h.clone(a.position,Oye),d=Xw(a.heading,i),u=a.frustum.right-a.frustum.left,m=H4(a,n,u,n.z,s);function p(b){let f=b.time/t;a.setView({orientation:{heading:P.lerp(d,i,f)}}),D.lerp(c,n,f,a.position);let x=m(f),_=a.frustum,C=_.top/_.right,V=(x-(_.right-_.left))*.5;_.right+=V,_.left-=V,_.top=C*_.right,_.bottom=-_.top}return p}var Uye=new he,Xat=new h;function z4(e,t){return{startObject:{},stopObject:{},duration:0,complete:e,cancel:t}}function Dye(e,t){function n(){typeof t==\"function\"&&t(),e.enableInputs=!0}return n}Bye.createTween=function(e,t){t=g(t,g.EMPTY_OBJECT);let n=t.destination,i=e.mode;if(i===ie.MORPHING)return z4();let o=g(t.convert,!0),r=e.mapProjection,s=r.ellipsoid,a=t.maximumHeight,c=t.flyOverLongitude,d=t.flyOverLongitudeWeight,u=t.pitchAdjustHeight,m=t.easingFunction;o&&i!==ie.SCENE3D&&(s.cartesianToCartographic(n,Uye),n=r.project(Uye,Xat));let p=e.camera,b=t.endTransform;l(b)&&p._setTransform(b);let f=t.duration;l(f)||(f=Math.ceil(h.distance(p.position,n)/1e6)+2,f=Math.min(f,3));let x=g(t.heading,0),_=g(t.pitch,-P.PI_OVER_TWO),C=g(t.roll,0),V=e.screenSpaceCameraController;V.enableInputs=!1;let L=Dye(V,t.complete),R=Dye(V,t.cancel),G=p.frustum,X=e.mode===ie.SCENE2D;if(X=X&&D.equalsEpsilon(p.position,n,P.EPSILON6),X=X&&P.equalsEpsilon(Math.max(G.right-G.left,G.top-G.bottom),n.z,P.EPSILON6),X=X||e.mode!==ie.SCENE2D&&h.equalsEpsilon(n,p.position,P.EPSILON10),X=X&&P.equalsEpsilon(P.negativePiToPi(x),P.negativePiToPi(p.heading),P.EPSILON10)&&P.equalsEpsilon(P.negativePiToPi(_),P.negativePiToPi(p.pitch),P.EPSILON10)&&P.equalsEpsilon(P.negativePiToPi(C),P.negativePiToPi(p.roll),P.EPSILON10),X)return z4(L,R);let v=new Array(4);if(v[ie.SCENE2D]=Eat,v[ie.SCENE3D]=Gat,v[ie.COLUMBUS_VIEW]=Cat,f<=0)return z4(function(){v[i](e,1,n,x,_,C,a,c,d,u)({time:1}),typeof L==\"function\"&&L()},R);let W=v[i](e,f,n,x,_,C,a,c,d,u);if(!l(m)){let F=p.positionCartographic.height,A=i===ie.SCENE3D?s.cartesianToCartographic(n).height:n.z;F>A&&F>11500?m=Ar.CUBIC_OUT:m=Ar.QUINTIC_IN_OUT}return{duration:f,easingFunction:m,startObject:{time:0},stopObject:{time:f},update:W,complete:L,cancel:R}};var Iw=Bye;var $Zi=T(S(),1),Iat={ROTATE:0,INFINITE_SCROLL:1},Jl=Object.freeze(Iat);function en(e){this._scene=e,this._transform=M.clone(M.IDENTITY),this._invTransform=M.clone(M.IDENTITY),this._actualTransform=M.clone(M.IDENTITY),this._actualInvTransform=M.clone(M.IDENTITY),this._transformChanged=!1,this.position=new h,this._position=new h,this._positionWC=new h,this._positionCartographic=new he,this._oldPositionWC=void 0,this.positionWCDeltaMagnitude=0,this.positionWCDeltaMagnitudeLastFrame=0,this.timeSinceMoved=0,this._lastMovedTimestamp=0,this.direction=new h,this._direction=new h,this._directionWC=new h,this.up=new h,this._up=new h,this._upWC=new h,this.right=new h,this._right=new h,this._rightWC=new h,this.frustum=new _i,this.frustum.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,this.frustum.fov=P.toRadians(60),this.defaultMoveAmount=1e5,this.defaultLookAmount=Math.PI/60,this.defaultRotateAmount=Math.PI/3600,this.defaultZoomAmount=1e5,this.constrainedAxis=void 0,this.maximumZoomFactor=1.5,this._moveStart=new ge,this._moveEnd=new ge,this._changed=new ge,this._changedPosition=void 0,this._changedDirection=void 0,this._changedFrustum=void 0,this._changedHeading=void 0,this._changedRoll=void 0,this.percentageChanged=.5,this._viewMatrix=new M,this._invViewMatrix=new M,$ye(this),this._mode=ie.SCENE3D,this._modeChanged=!0;let t=e.mapProjection;this._projection=t,this._maxCoord=t.project(new he(Math.PI,P.PI_OVER_TWO)),this._max2Dfrustum=void 0,uge(this,en.DEFAULT_VIEW_RECTANGLE,this.position,!0);let n=h.magnitude(this.position);n+=n*en.DEFAULT_VIEW_FACTOR,h.normalize(this.position,this.position),h.multiplyByScalar(this.position,n,this.position)}en.TRANSFORM_2D=new M(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);en.TRANSFORM_2D_INVERSE=M.inverseTransformation(en.TRANSFORM_2D,new M);en.DEFAULT_VIEW_RECTANGLE=le.fromDegrees(-95,-20,-70,90);en.DEFAULT_VIEW_FACTOR=.5;en.DEFAULT_OFFSET=new Ou(0,-P.PI_OVER_FOUR,0);function $ye(e){M.computeView(e._position,e._direction,e._up,e._right,e._viewMatrix),M.multiply(e._viewMatrix,e._actualInvTransform,e._viewMatrix),M.inverseTransformation(e._viewMatrix,e._invViewMatrix)}function Wat(e){if(!l(e._oldPositionWC))e._oldPositionWC=h.clone(e.positionWC,e._oldPositionWC);else{e.positionWCDeltaMagnitudeLastFrame=e.positionWCDeltaMagnitude;let t=h.subtract(e.positionWC,e._oldPositionWC,e._oldPositionWC);e.positionWCDeltaMagnitude=h.magnitude(t),e._oldPositionWC=h.clone(e.positionWC,e._oldPositionWC),e.positionWCDeltaMagnitude>0?(e.timeSinceMoved=0,e._lastMovedTimestamp=fi()):e.timeSinceMoved=Math.max(fi()-e._lastMovedTimestamp,0)/1e3}}en.prototype.canPreloadFlight=function(){return l(this._currentFlight)&&this._mode!==ie.SCENE2D};en.prototype._updateCameraChanged=function(){let e=this;if(Wat(e),e._changed.numberOfListeners===0)return;let t=e.percentageChanged,n=e.heading;l(e._changedHeading)||(e._changedHeading=n);let i=Math.abs(e._changedHeading-n)%P.TWO_PI;i=i>P.PI?P.TWO_PI-i:i;let o=i/Math.PI;o>t&&(e._changedHeading=n);let r=e.roll;l(e._changedRoll)||(e._changedRoll=r);let s=Math.abs(e._changedRoll-r)%P.TWO_PI;s=s>P.PI?P.TWO_PI-s:s;let a=s/Math.PI;if(a>t&&(e._changedRoll=r),(a>t||o>t)&&e._changed.raiseEvent(Math.max(a,o)),e._mode===ie.SCENE2D){if(!l(e._changedFrustum)){e._changedPosition=h.clone(e.position,e._changedPosition),e._changedFrustum=e.frustum.clone();return}let p=e.position,b=e._changedPosition,f=e.frustum,x=e._changedFrustum,_=p.x+f.left,C=p.x+f.right,V=b.x+x.left,L=b.x+x.right,R=p.y+f.bottom,G=p.y+f.top,X=b.y+x.bottom,v=b.y+x.top,W=Math.max(_,V),F=Math.min(C,L),A=Math.max(R,X),y=Math.min(G,v),Z;if(W>=F||A>=G)Z=1;else{let E=x;_<V&&C>L&&R<X&&G>v&&(E=f),Z=1-(F-W)*(y-A)/((E.right-E.left)*(E.top-E.bottom))}Z>t&&(e._changed.raiseEvent(Z),e._changedPosition=h.clone(e.position,e._changedPosition),e._changedFrustum=e.frustum.clone(e._changedFrustum));return}if(!l(e._changedDirection)){e._changedPosition=h.clone(e.positionWC,e._changedPosition),e._changedDirection=h.clone(e.directionWC,e._changedDirection);return}let c=P.acosClamped(h.dot(e.directionWC,e._changedDirection)),d;l(e.frustum.fovy)?d=c/(e.frustum.fovy*.5):d=c;let m=h.distance(e.positionWC,e._changedPosition)/e.positionCartographic.height;(d>t||m>t)&&(e._changed.raiseEvent(Math.max(d,m)),e._changedPosition=h.clone(e.positionWC,e._changedPosition),e._changedDirection=h.clone(e.directionWC,e._changedDirection))};function Pat(e){Wt.basisTo2D(e._projection,e._transform,e._actualTransform)}var vat=new he,wat=new h,XD=new h,Fat=new se,Aat=new se,Mat=new se,Nat=new se,kat=new se;function Uat(e){let t=e._projection,n=t.ellipsoid,i=M.getColumn(e._transform,3,Fat),o=n.cartesianToCartographic(i,vat),r=t.project(o,wat),s=Aat;s.x=r.z,s.y=r.x,s.z=r.y,s.w=1;let a=se.clone(se.UNIT_X,kat),c=se.add(M.getColumn(e._transform,0,XD),i,XD);n.cartesianToCartographic(c,o),t.project(o,r);let d=Mat;d.x=r.z,d.y=r.x,d.z=r.y,d.w=0,h.subtract(d,s,d),d.x=0;let u=Nat;if(h.magnitudeSquared(d)>P.EPSILON10)h.cross(a,d,u);else{let m=se.add(M.getColumn(e._transform,1,XD),i,XD);n.cartesianToCartographic(m,o),t.project(o,r),u.x=r.z,u.y=r.x,u.z=r.y,u.w=0,h.subtract(u,s,u),u.x=0,h.magnitudeSquared(u)<P.EPSILON10&&(se.clone(se.UNIT_Y,d),se.clone(se.UNIT_Z,u))}h.cross(u,a,d),h.normalize(d,d),h.cross(a,d,u),h.normalize(u,u),M.setColumn(e._actualTransform,0,d,e._actualTransform),M.setColumn(e._actualTransform,1,u,e._actualTransform),M.setColumn(e._actualTransform,2,a,e._actualTransform),M.setColumn(e._actualTransform,3,s,e._actualTransform)}var K4=new"
}