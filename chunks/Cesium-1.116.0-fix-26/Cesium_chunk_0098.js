{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 98,
    "total_chunks": 194,
    "chunk_size": 27773,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.704Z"
  },
  "content": "i=[\"DISTANCE_DISPLAY_CONDITION\"];n&&i.push(\"VECTOR_TILE\"),this.material.shaderSource.search(/in\\s+float\\s+v_polylineAngle;/g)!==-1&&i.push(\"POLYLINE_DASH\"),Ut.isInternetExplorer()||i.push(\"CLIP_POLYLINE\");let o=new Ue({defines:i,sources:[`in vec4 v_pickColor; `,this.material.shaderSource,Cx]}),r=t.getVertexShaderCallback()(qW),s=new Ue({defines:i,sources:[dd,r]});this.shaderProgram=Ht.fromCache({context:e,vertexShaderSource:s,fragmentShaderSource:o,attributeLocations:wl})};function bce(e){return h.dot(h.UNIT_X,e._boundingVolume.center)<0||e._boundingVolume.intersectPlane(an.ORIGIN_ZX_PLANE)===nn.INTERSECTING}ff.prototype.getPolylinePositionsLength=function(e){let t;if(this.mode===ie.SCENE3D||!bce(e))return t=e._actualPositions.length,t*4-4;let n=0,i=e._segments.lengths;t=i.length;for(let o=0;o<t;++o)n+=i[o]*4-4;return n};var ys=new h,Lu=new h,Zu=new h,EN=new h,AOe=new se,MOe=new D;ff.prototype.write=function(e,t,n,i,o,r,s,a){let c=this.mode,d=a.ellipsoid.maximumRadius*P.PI,u=this.polylines,m=u.length;for(let p=0;p<m;++p){let b=u[p],f=b.width,x=b.show&&f>0,_=b._index,C=this.getSegments(b,a),V=C.positions,L=C.lengths,R=V.length,G=b.getPickId(s).color,X=0,v=0,W;for(let B=0;B<R;++B){B===0?b._loop?W=V[R-2]:(W=EN,h.subtract(V[0],V[1],W),h.add(V[0],W,W)):W=V[B-1],h.clone(W,Lu),h.clone(V[B],ys),B===R-1?b._loop?W=V[1]:(W=EN,h.subtract(V[R-1],V[R-2],W),h.add(V[R-1],W,W)):W=V[B+1],h.clone(W,Zu);let U=L[X];B===v+U&&(v+=U,++X);let Y=B-v===0,N=B===v+L[X]-1;c===ie.SCENE2D&&(Lu.z=0,ys.z=0,Zu.z=0),(c===ie.SCENE2D||c===ie.MORPHING)&&(Y||N)&&d-Math.abs(ys.x)<1&&((ys.x<0&&Lu.x>0||ys.x>0&&Lu.x<0)&&h.clone(ys,Lu),(ys.x<0&&Zu.x>0||ys.x>0&&Zu.x<0)&&h.clone(ys,Zu));let J=Y?2:0,z=N?2:4;for(let ee=J;ee<z;++ee){Yn.writeElements(ys,e,n),Yn.writeElements(Lu,e,n+6),Yn.writeElements(Zu,e,n+12);let H=ee-2<0?-1:1;t[o]=B/(R-1),t[o+1]=2*(ee%2)-1,t[o+2]=H,t[o+3]=_,n+=6*3,o+=4}}let F=AOe;F.x=O.floatToByte(G.red),F.y=O.floatToByte(G.green),F.z=O.floatToByte(G.blue),F.w=O.floatToByte(G.alpha);let A=MOe;A.x=f,A.y=x?1:0;let y=c===ie.SCENE2D?b._boundingVolume2D:b._boundingVolumeWC,Z=Yn.fromCartesian(y.center,uce),E=Z.high,I=se.fromElements(Z.low.x,Z.low.y,Z.low.z,y.radius,mce),w=hce;w.x=0,w.y=Number.MAX_VALUE;let k=b.distanceDisplayCondition;l(k)&&(w.x=k.near,w.y=k.far),r.setBatchedAttribute(_,0,A),r.setBatchedAttribute(_,1,F),r.attributes.length>2&&(r.setBatchedAttribute(_,2,E),r.setBatchedAttribute(_,3,I),r.setBatchedAttribute(_,4,w))}};var NOe=new h,kOe=new h,UOe=new h,ace=new h;ff.prototype.writeForMorph=function(e,t){let n=this.modelMatrix,i=this.polylines,o=i.length;for(let r=0;r<o;++r){let s=i[r],a=s._segments.positions,c=s._segments.lengths,d=a.length,u=0,m=0;for(let p=0;p<d;++p){let b;p===0?s._loop?b=a[d-2]:(b=ace,h.subtract(a[0],a[1],b),h.add(a[0],b,b)):b=a[p-1],b=M.multiplyByPoint(n,b,kOe);let f=M.multiplyByPoint(n,a[p],NOe),x;p===d-1?s._loop?x=a[1]:(x=ace,h.subtract(a[d-1],a[d-2],x),h.add(a[d-1],x,x)):x=a[p+1],x=M.multiplyByPoint(n,x,UOe);let _=c[u];p===m+_&&(m+=_,++u);let C=p-m===0,V=p===m+c[u]-1,L=C?2:0,R=V?2:4;for(let G=L;G<R;++G)Yn.writeElements(f,e,t),Yn.writeElements(b,e,t+6),Yn.writeElements(x,e,t+12),t+=6*3}}};var DOe=new Array(1);ff.prototype.updateIndices=function(e,t,n,i){let o=n.length-1,r=new yH(0,i,this);n[o].push(r);let s=0,a=e[e.length-1],c=0;a.length>0&&(c=a[a.length-1]+1);let d=this.polylines,u=d.length;for(let m=0;m<u;++m){let p=d[m];p._locatorBuckets=[];let b;if(this.mode===ie.SCENE3D){b=DOe;let x=p._actualPositions.length;if(x>0)b[0]=x;else continue}else b=p._segments.lengths;let f=b.length;if(f>0){let x=0;for(let _=0;_<f;++_){let C=b[_]-1;for(let V=0;V<C;++V)c+4>P.SIXTY_FOUR_KILOBYTES&&(p._locatorBuckets.push({locator:r,count:x}),x=0,t.push(4),a=[],e.push(a),c=0,r.count=s,s=0,i=0,r=new yH(0,0,this),n[++o]=[r]),a.push(c,c+2,c+1),a.push(c+1,c+2,c+3),x+=6,s+=6,i+=6,c+=4}p._locatorBuckets.push({locator:r,count:x}),c+4>P.SIXTY_FOUR_KILOBYTES&&(t.push(0),a=[],e.push(a),c=0,r.count=s,i=0,s=0,r=new yH(0,0,this),n[++o]=[r])}p._clean()}return r.count=s,i};ff.prototype.getPolylineStartIndex=function(e){let t=this.polylines,n=0,i=t.length;for(let o=0;o<i;++o){let r=t[o];if(r===e)break;n+=r._actualLength}return n};var zC={positions:void 0,lengths:void 0},cce=new Array(1),BOe=new h,YOe=new he;ff.prototype.getSegments=function(e,t){let n=e._actualPositions;if(this.mode===ie.SCENE3D)return cce[0]=n.length,zC.positions=n,zC.lengths=cce,zC;bce(e)&&(n=e._segments.positions);let i=t.ellipsoid,o=[],r=this.modelMatrix,s=n.length,a,c=BOe;for(let d=0;d<s;++d)a=n[d],c=M.multiplyByPoint(r,a,c),o.push(t.project(i.cartesianToCartographic(c,YOe)));if(o.length>0){e._boundingVolume2D=ce.fromPoints(o,e._boundingVolume2D);let d=e._boundingVolume2D.center;e._boundingVolume2D.center=new h(d.z,d.x,d.y)}return zC.positions=o,zC.lengths=e._segments.lengths,zC};var lce;ff.prototype.writeUpdate=function(e,t,n,i){let o=this.mode,r=i.ellipsoid.maximumRadius*P.PI,s=t._actualLength;if(s){e+=this.getPolylineStartIndex(t);let a=lce,c=6*s*3;!l(a)||a.length<c?a=lce=new Float32Array(c):a.length>c&&(a=new Float32Array(a.buffer,0,c));let d=this.getSegments(t,i),u=d.positions,m=d.lengths,p=0,b=0,f=0,x;s=u.length;for(let _=0;_<s;++_){_===0?t._loop?x=u[s-2]:(x=EN,h.subtract(u[0],u[1],x),h.add(u[0],x,x)):x=u[_-1],h.clone(x,Lu),h.clone(u[_],ys),_===s-1?t._loop?x=u[1]:(x=EN,h.subtract(u[s-1],u[s-2],x),h.add(u[s-1],x,x)):x=u[_+1],h.clone(x,Zu);let C=m[b];_===f+C&&(f+=C,++b);let V=_-f===0,L=_===f+m[b]-1;o===ie.SCENE2D&&(Lu.z=0,ys.z=0,Zu.z=0),(o===ie.SCENE2D||o===ie.MORPHING)&&(V||L)&&r-Math.abs(ys.x)<1&&((ys.x<0&&Lu.x>0||ys.x>0&&Lu.x<0)&&h.clone(ys,Lu),(ys.x<0&&Zu.x>0||ys.x>0&&Zu.x<0)&&h.clone(ys,Zu));let R=V?2:0,G=L?2:4;for(let X=R;X<G;++X)Yn.writeElements(ys,a,p),Yn.writeElements(Lu,a,p+6),Yn.writeElements(Zu,a,p+12),p+=6*3}n.copyFromArrayView(a,6*3*Float32Array.BYTES_PER_ELEMENT*e)}};var zm=Om;function Sy(e){this._positions=e.positions,this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._rectangle=e.rectangle,this._minHeight=e.minimumHeight,this._maxHeight=e.maximumHeight,this._billboardCollection=new yd({batchTable:e.batchTable}),this._labelCollection=new hf({batchTable:e.batchTable}),this._polylineCollection=new zm,this._polylineCollection._useHighlightColor=!0,this._packedBuffer=void 0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(Sy.prototype,{ready:{get:function(){return this._ready}},pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){let e=this._billboardCollection.textureAtlas.texture.sizeInBytes,t=this._labelCollection._textureAtlas.texture.sizeInBytes;return e+t}}});function OOe(e,t){let n=e._rectangle,i=e._minHeight,o=e._maxHeight,r=2+le.packedLength+oe.packedLength,s=new Float64Array(r),a=0;return s[a++]=i,s[a++]=o,le.pack(n,s,a),a+=le.packedLength,oe.pack(t,s,a),s}var zOe=new di(\"createVectorTilePoints\",5),HOe=new h;function KOe(e,t){let n=e._positions,i=e._packedBuffer;l(i)||(n=e._positions=n.slice(),e._batchIds=e._batchIds.slice(),i=e._packedBuffer=OOe(e,t));let o=[n.buffer,i.buffer],r={positions:n.buffer,packedBuffer:i.buffer},s=zOe.scheduleTask(r,o);if(l(s))return s.then(a=>{if(e.isDestroyed())return;e._positions=new Float64Array(a.positions);let c=e._billboardCollection,d=e._labelCollection,u=e._polylineCollection;n=e._positions;let m=e._batchIds,p=n.length/3;for(let b=0;b<p;++b){let f=m[b],x=h.unpack(n,b*3,HOe),_=c.add();_.position=x,_._batchIndex=f;let C=d.add();C.text=\" \",C.position=x,C._batchIndex=f;let V=u.add();V.positions=[h.clone(x),h.clone(x)]}e._positions=void 0,e._packedBuffer=void 0,e._ready=!0}).catch(a=>{e.isDestroyed()||(e._error=a)})}Sy.prototype.createFeatures=function(e,t){let n=this._billboardCollection,i=this._labelCollection,o=this._polylineCollection,r=this._batchIds,s=r.length;for(let a=0;a<s;++a){let c=r[a],d=n.get(a),u=i.get(a),m=o.get(a);t[c]=new o0(e,c,d,u,m)}};Sy.prototype.applyDebugSettings=function(e,t){e?(O.clone(t,this._billboardCollection._highlightColor),O.clone(t,this._labelCollection._highlightColor),O.clone(t,this._polylineCollection._highlightColor)):(O.clone(O.WHITE,this._billboardCollection._highlightColor),O.clone(O.WHITE,this._labelCollection._highlightColor),O.clone(O.WHITE,this._polylineCollection._highlightColor))};function JOe(e,t){let n=e._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.show=!0,s.pointSize=o0.defaultPointSize,s.color=o0.defaultColor,s.pointOutlineColor=o0.defaultPointOutlineColor,s.pointOutlineWidth=o0.defaultPointOutlineWidth,s.labelColor=O.WHITE,s.labelOutlineColor=O.WHITE,s.labelOutlineWidth=1,s.font=\"30px sans-serif\",s.labelStyle=wo.FILL,s.labelText=void 0,s.backgroundColor=new O(.165,.165,.165,.8),s.backgroundPadding=new D(7,5),s.backgroundEnabled=!1,s.scaleByDistance=void 0,s.translucencyByDistance=void 0,s.distanceDisplayCondition=void 0,s.heightOffset=0,s.anchorLineEnabled=!1,s.anchorLineColor=O.WHITE,s.image=void 0,s.disableDepthTestDistance=0,s.horizontalOrigin=ui.CENTER,s.verticalOrigin=Wn.CENTER,s.labelHorizontalOrigin=ui.RIGHT,s.labelVerticalOrigin=Wn.BASELINE}}var QOe=new O,jOe=new O,qOe=new O,$Oe=new O,eze=new O,tze=new O,n2=new At,i2=new At,TH=new It;Sy.prototype.applyStyle=function(e,t){if(!l(e)){JOe(this,t);return}let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];if(l(e.show)&&(s.show=e.show.evaluate(s)),l(e.pointSize)&&(s.pointSize=e.pointSize.evaluate(s)),l(e.color)&&(s.color=e.color.evaluateColor(s,QOe)),l(e.pointOutlineColor)&&(s.pointOutlineColor=e.pointOutlineColor.evaluateColor(s,jOe)),l(e.pointOutlineWidth)&&(s.pointOutlineWidth=e.pointOutlineWidth.evaluate(s)),l(e.labelColor)&&(s.labelColor=e.labelColor.evaluateColor(s,qOe)),l(e.labelOutlineColor)&&(s.labelOutlineColor=e.labelOutlineColor.evaluateColor(s,$Oe)),l(e.labelOutlineWidth)&&(s.labelOutlineWidth=e.labelOutlineWidth.evaluate(s)),l(e.font)&&(s.font=e.font.evaluate(s)),l(e.labelStyle)&&(s.labelStyle=e.labelStyle.evaluate(s)),l(e.labelText)?s.labelText=e.labelText.evaluate(s):s.labelText=void 0,l(e.backgroundColor)&&(s.backgroundColor=e.backgroundColor.evaluateColor(s,eze)),l(e.backgroundPadding)&&(s.backgroundPadding=e.backgroundPadding.evaluate(s)),l(e.backgroundEnabled)&&(s.backgroundEnabled=e.backgroundEnabled.evaluate(s)),l(e.scaleByDistance)){let a=e.scaleByDistance.evaluate(s);l(a)?(n2.near=a.x,n2.nearValue=a.y,n2.far=a.z,n2.farValue=a.w,s.scaleByDistance=n2):s.scaleByDistance=void 0}else s.scaleByDistance=void 0;if(l(e.translucencyByDistance)){let a=e.translucencyByDistance.evaluate(s);l(a)?(i2.near=a.x,i2.nearValue=a.y,i2.far=a.z,i2.farValue=a.w,s.translucencyByDistance=i2):s.translucencyByDistance=void 0}else s.translucencyByDistance=void 0;if(l(e.distanceDisplayCondition)){let a=e.distanceDisplayCondition.evaluate(s);l(a)?(TH.near=a.x,TH.far=a.y,s.distanceDisplayCondition=TH):s.distanceDisplayCondition=void 0}else s.distanceDisplayCondition=void 0;l(e.heightOffset)&&(s.heightOffset=e.heightOffset.evaluate(s)),l(e.anchorLineEnabled)&&(s.anchorLineEnabled=e.anchorLineEnabled.evaluate(s)),l(e.anchorLineColor)&&(s.anchorLineColor=e.anchorLineColor.evaluateColor(s,tze)),l(e.image)?s.image=e.image.evaluate(s):s.image=void 0,l(e.disableDepthTestDistance)&&(s.disableDepthTestDistance=e.disableDepthTestDistance.evaluate(s)),l(e.horizontalOrigin)&&(s.horizontalOrigin=e.horizontalOrigin.evaluate(s)),l(e.verticalOrigin)&&(s.verticalOrigin=e.verticalOrigin.evaluate(s)),l(e.labelHorizontalOrigin)&&(s.labelHorizontalOrigin=e.labelHorizontalOrigin.evaluate(s)),l(e.labelVerticalOrigin)&&(s.labelVerticalOrigin=e.labelVerticalOrigin.evaluate(s))}};Sy.prototype.update=function(e){if(!this._ready){if(l(this._promise)||(this._promise=KOe(this,e.mapProjection.ellipsoid)),l(this._error)){let t=this._error;throw this._error=void 0,t}return}this._polylineCollection.update(e),this._billboardCollection.update(e),this._labelCollection.update(e)};Sy.prototype.isDestroyed=function(){return!1};Sy.prototype.destroy=function(){return this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy(),this._labelCollection=this._labelCollection&&this._labelCollection.destroy(),this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy(),me(this)};var o2=Sy;var j2n=T(S(),1);function a0(e){this._batchTable=e.batchTable,this._batchIds=e.batchIds,this._positions=e.positions,this._counts=e.counts,this._indices=e.indices,this._indexCounts=e.indexCounts,this._indexOffsets=void 0,this._batchTableColors=void 0,this._packedBuffer=void 0,this._batchedPositions=void 0,this._transferrableBatchIds=void 0,this._vertexBatchIds=void 0,this._ellipsoid=g(e.ellipsoid,oe.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._polygonMinimumHeights=e.polygonMinimumHeights,this._polygonMaximumHeights=e.polygonMaximumHeights,this._center=g(e.center,h.ZERO),this._rectangle=e.rectangle,this._center=void 0,this._boundingVolume=e.boundingVolume,this._boundingVolumes=void 0,this._batchedIndices=void 0,this._ready=!1,this._promise=void 0,this._error=void 0,this._primitive=void 0,this.debugWireframe=!1,this.forceRebatch=!1,this.classificationType=Un.BOTH}Object.defineProperties(a0.prototype,{trianglesLength:{get:function(){return l(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return l(this._primitive)?this._primitive.geometryByteLength:0}},ready:{get:function(){return this._ready}}});function nze(e){let t=new Float64Array(3+h.packedLength+oe.packedLength+le.packedLength),n=0;return t[n++]=e._indices.BYTES_PER_ELEMENT,t[n++]=e._minimumHeight,t[n++]=e._maximumHeight,h.pack(e._center,t,n),n+=h.packedLength,oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,le.pack(e._rectangle,t,n),t}function ize(e,t){let n=1,i=t[n++],o=e._boundingVolumes=new Array(i);for(let a=0;a<i;++a)o[a]=Zn.unpack(t,n),n+=Zn.packedLength;let r=t[n++],s=e._batchedIndices=new Array(r);for(let a=0;a<r;++a){let c=O.unpack(t,n);n+=O.packedLength;let d=t[n++],u=t[n++],m=t[n++],p=new Array(m);for(let b=0;b<m;++b)p[b]=t[n++];s[a]=new nf({color:c,offset:d,count:u,batchIds:p})}}var oze=new di(\"createVectorTilePolygons\",5),rze=new O;function sze(e){if(l(e._primitive))return;let t=e._positions,n=e._counts,i=e._indexCounts,o=e._indices,r=e._transferrableBatchIds,s=e._batchTableColors,a=e._packedBuffer;if(!l(s)){t=e._positions=e._positions.slice(),n=e._counts=e._counts.slice(),i=e._indexCounts=e._indexCounts.slice(),o=e._indices=e._indices.slice(),e._center=e._ellipsoid.cartographicToCartesian(le.center(e._rectangle)),r=e._transferrableBatchIds=new Uint32Array(e._batchIds),s=e._batchTableColors=new Uint32Array(r.length);let b=e._batchTable,f=s.length;for(let x=0;x<f;++x){let _=b.getColor(x,rze);s[x]=_.toRgba()}a=e._packedBuffer=nze(e)}let c=[t.buffer,n.buffer,i.buffer,o.buffer,r.buffer,s.buffer,a.buffer],d={packedBuffer:a.buffer,positions:t.buffer,counts:n.buffer,indexCounts:i.buffer,indices:o.buffer,batchIds:r.buffer,batchTableColors:s.buffer},u=e._polygonMinimumHeights,m=e._polygonMaximumHeights;l(u)&&l(m)&&(u=u.slice(),m=m.slice(),c.push(u.buffer,m.buffer),d.minimumHeights=u,d.maximumHeights=m);let p=oze.scheduleTask(d,c);if(l(p))return p.then(b=>{if(e.isDestroyed())return;e._positions=void 0,e._counts=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0;let f=new Float64Array(b.packedBuffer),x=f[0];ize(e,f),e._indices=Ae.getSizeInBytes(x)===2?new Uint16Array(b.indices):new Uint32Array(b.indices),e._indexOffsets=new Uint32Array(b.indexOffsets),e._indexCounts=new Uint32Array(b.indexCounts),e._batchedPositions=new Float32Array(b.positions),e._vertexBatchIds=new Uint16Array(b.batchIds),aze(e),e._ready=!0}).catch(b=>{e.isDestroyed()||(e._error=b)})}function aze(e){l(e._primitive)||(e._primitive=new Dx({batchTable:e._batchTable,positions:e._batchedPositions,batchIds:e._batchIds,vertexBatchIds:e._vertexBatchIds,indices:e._indices,indexOffsets:e._indexOffsets,indexCounts:e._indexCounts,batchedIndices:e._batchedIndices,boundingVolume:e._boundingVolume,boundingVolumes:e._boundingVolumes,center:e._center}),e._batchTable=void 0,e._batchIds=void 0,e._positions=void 0,e._counts=void 0,e._indices=void 0,e._indexCounts=void 0,e._indexOffsets=void 0,e._batchTableColors=void 0,e._packedBuffer=void 0,e._batchedPositions=void 0,e._transferrableBatchIds=void 0,e._vertexBatchIds=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._polygonMinimumHeights=void 0,e._polygonMaximumHeights=void 0,e._center=void 0,e._rectangle=void 0,e._boundingVolume=void 0,e._boundingVolumes=void 0,e._batchedIndices=void 0)}a0.prototype.createFeatures=function(e,t){this._primitive.createFeatures(e,t)};a0.prototype.applyDebugSettings=function(e,t){this._primitive.applyDebugSettings(e,t)};a0.prototype.applyStyle=function(e,t){this._primitive.applyStyle(e,t)};a0.prototype.updateCommands=function(e,t){this._primitive.updateCommands(e,t)};a0.prototype.update=function(e){if(!this._ready){if(l(this._promise)||(this._promise=sze(this)),l(this._error)){let t=this._error;throw this._error=void 0,t}return}this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(e)};a0.prototype.isDestroyed=function(){return!1};a0.prototype.destroy=function(){return this._primitive=this._primitive&&this._primitive.destroy(),me(this)};var r2=a0;var LPn=T(S(),1);var $2n=T(S(),1),s2=`in vec4 currentPosition; in vec4 previousPosition; in vec4 nextPosition; in vec2 expandAndWidth; in float a_batchId; uniform mat4 u_modifiedModelView; void main() { float expandDir = expandAndWidth.x; float width = abs(expandAndWidth.y) + 0.5; bool usePrev = expandAndWidth.y < 0.0; vec4 p = u_modifiedModelView * currentPosition; vec4 prev = u_modifiedModelView * previousPosition; vec4 next = u_modifiedModelView * nextPosition; float angle; vec4 positionWC = getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle); gl_Position = czm_viewportOrthographic * positionWC; } `;function Hm(e){this._positions=e.positions,this._widths=e.widths,this._counts=e.counts,this._batchIds=e.batchIds,this._ellipsoid=g(e.ellipsoid,oe.WGS84),this._minimumHeight=e.minimumHeight,this._maximumHeight=e.maximumHeight,this._center=e.center,this._rectangle=e.rectangle,this._boundingVolume=e.boundingVolume,this._batchTable=e.batchTable,this._va=void 0,this._sp=void 0,this._rs=void 0,this._uniformMap=void 0,this._command=void 0,this._transferrableBatchIds=void 0,this._packedBuffer=void 0,this._keepDecodedPositions=e.keepDecodedPositions,this._decodedPositions=void 0,this._decodedPositionOffsets=void 0,this._currentPositions=void 0,this._previousPositions=void 0,this._nextPositions=void 0,this._expandAndWidth=void 0,this._vertexBatchIds=void 0,this._indices=void 0,this._constantColor=O.clone(O.WHITE),this._highlightColor=this._constantColor,this._trianglesLength=0,this._geometryByteLength=0,this._ready=!1,this._promise=void 0,this._error=void 0}Object.defineProperties(Hm.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}}});function cze(e){let t=e._rectangle,n=e._minimumHeight,i=e._maximumHeight,o=e._ellipsoid,r=e._center,s=2+le.packedLength+oe.packedLength+h.packedLength,a=new Float64Array(s),c=0;return a[c++]=n,a[c++]=i,le.pack(t,a,c),c+=le.packedLength,oe.pack(o,a,c),c+=oe.packedLength,h.pack(r,a,c),a}var lze=new di(\"createVectorTilePolylines\",5),HC={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4};function dze(e,t){if(l(e._va))return;let n=e._positions,i=e._widths,o=e._counts,r=e._transferrableBatchIds,s=e._packedBuffer;l(s)||(n=e._positions=n.slice(),i=e._widths=i.slice(),o=e._counts=o.slice(),r=e._transferrableBatchIds=e._batchIds.slice(),s=e._packedBuffer=cze(e));let a=[n.buffer,i.buffer,o.buffer,r.buffer,s.buffer],c={positions:n.buffer,widths:i.buffer,counts:o.buffer,batchIds:r.buffer,packedBuffer:s.buffer,keepDecodedPositions:e._keepDecodedPositions},d=lze.scheduleTask(c,a);if(l(d))return d.then(function(u){if(e.isDestroyed())return;e._keepDecodedPositions&&(e._decodedPositions=new Float64Array(u.decodedPositions),e._decodedPositionOffsets=new Uint32Array(u.decodedPositionOffsets)),e._currentPositions=new Float32Array(u.currentPositions),e._previousPositions=new Float32Array(u.previousPositions),e._nextPositions=new Float32Array(u.nextPositions),e._expandAndWidth=new Float32Array(u.expandAndWidth),e._vertexBatchIds=new Uint16Array(u.batchIds);let m=u.indexDatatype;e._indices=m===Ae.UNSIGNED_SHORT?new Uint16Array(u.indices):new Uint32Array(u.indices),uze(e,t),e._ready=!0}).catch(u=>{e.isDestroyed()||(e._error=u)})}function uze(e,t){if(!l(e._va)){let n=e._currentPositions,i=e._previousPositions,o=e._nextPositions,r=e._expandAndWidth,s=e._vertexBatchIds,a=e._indices,c=i.byteLength+n.byteLength+o.byteLength;c+=r.byteLength+s.byteLength+a.byteLength,e._trianglesLength=a.length/3,e._geometryByteLength=c;let d=pt.createVertexBuffer({context:t,typedArray:i,usage:Me.STATIC_DRAW}),u=pt.createVertexBuffer({context:t,typedArray:n,usage:Me.STATIC_DRAW}),m=pt.createVertexBuffer({context:t,typedArray:o,usage:Me.STATIC_DRAW}),p=pt.createVertexBuffer({context:t,typedArray:r,usage:Me.STATIC_DRAW}),b=pt.createVertexBuffer({context:t,typedArray:s,usage:Me.STATIC_DRAW}),f=pt.createIndexBuffer({context:t,typedArray:a,usage:Me.STATIC_DRAW,indexDatatype:a.BYTES_PER_ELEMENT===2?Ae.UNSIGNED_SHORT:Ae.UNSIGNED_INT}),x=[{index:HC.previousPosition,vertexBuffer:d,componentDatatype:Q.FLOAT,componentsPerAttribute:3},{index:HC.currentPosition,vertexBuffer:u,componentDatatype:Q.FLOAT,componentsPerAttribute:3},{index:HC.nextPosition,vertexBuffer:m,componentDatatype:Q.FLOAT,componentsPerAttribute:3},{index:HC.expandAndWidth,vertexBuffer:p,componentDatatype:Q.FLOAT,componentsPerAttribute:2},{index:HC.a_batchId,vertexBuffer:b,componentDatatype:Q.UNSIGNED_SHORT,componentsPerAttribute:1}];e._va=new ti({context:t,attributes:x,indexBuffer:f}),e._positions=void 0,e._widths=void 0,e._counts=void 0,e._ellipsoid=void 0,e._minimumHeight=void 0,e._maximumHeight=void 0,e._rectangle=void 0,e._transferrableBatchIds=void 0,e._packedBuffer=void 0,e._currentPositions=void 0,e._previousPositions=void 0,e._nextPositions=void 0,e._expandAndWidth=void 0,e._vertexBatchIds=void 0,e._indices=void 0}}var a2=new M,yce=new h;function mze(e,t){l(e._uniformMap)||(e._uniformMap={u_modifiedModelView:function(){let n=t.uniformState.view;return M.clone(n,a2),M.multiplyByPoint(a2,e._center,yce),M.setTranslation(a2,yce,a2),a2},u_highlightColor:function(){return e._highlightColor}})}function hze(e){if(l(e._rs))return;let t={enabled:!0,factor:-5,units:-5};e._rs=Ne.fromCache({blending:un.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:t})}var fze=`uniform vec4 u_highlightColor; void main() { out_FragColor = u_highlightColor; } `;function pze(e,t){if(l(e._sp))return;let n=e._batchTable,i=n.getVertexShaderCallback(!1,\"a_batchId\",void 0)(s2),o=n.getFragmentShaderCallback(!1,void 0,!1)(fze),r=new Ue({defines:[\"VECTOR_TILE\",Ut.isInternetExplorer()?\"\":\"CLIP_POLYLINE\"],sources:[dd,i]}),s=new Ue({defines:[\"VECTOR_TILE\"],sources:[o]});e._sp=Ht.fromCache({context:t,vertexShaderSource:r,fragmentShaderSource:s,attributeLocations:HC})}function bze(e,t){if(!l(e._command)){let n=e._batchTable.getUniformMapCallback()(e._uniformMap);e._command=new je({owner:e,vertexArray:e._va,renderState:e._rs,shaderProgram:e._sp,uniformMap:n,boundingVolume:e._boundingVolume,pass:Ze.TRANSLUCENT,pickId:e._batchTable.getPickId()})}t.commandList.push(e._command)}Hm.getPolylinePositions=function(e,t){let n=e._batchIds,i=e._decodedPositions,o=e._decodedPositionOffsets;if(!l(n)||!l(i))return;let r,s,a=n.length,c=0,d=0;for(r=0;r<a;++r)n[r]===t&&(c+=o[r+1]-o[r]);if(c===0)return;let u=new Float64Array(c*3);for(r=0;r<a;++r)if(n[r]===t){let m=o[r],p=o[r+1]-m;for(s=0;s<p;++s){let b=(m+s)*3;u[d++]=i[b],u[d++]=i[b+1],u[d++]=i[b+2]}}return u};Hm.prototype.getPositions=function(e){return Hm.getPolylinePositions(this,e)};Hm.prototype.createFeatures=function(e,t){let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o];t[r]=new Fs(e,r)}};Hm.prototype.applyDebugSettings=function(e,t){this._highlightColor=e?t:this._constantColor};function yze(e,t){let n=e._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.show=!0,s.color=O.WHITE}}var gze=new O,xze=O.WHITE,_ze=!0;Hm.prototype.applyStyle=function(e,t){if(!l(e)){yze(this,t);return}let n=this._batchIds,i=n.length;for(let o=0;o<i;++o){let r=n[o],s=t[r];s.color=l(e.color)?e.color.evaluateColor(s,gze):xze,s.show=l(e.show)?e.show.evaluate(s):_ze}};Hm.prototype.update=function(e){let t=e.context;if(!this._ready){if(l(this._promise)||(this._promise=dze(this,t)),l(this._error)){let i=this._error;throw this._error=void 0,i}return}mze(this,t),pze(this,t),hze(this);let n=e.passes;(n.render||n.pick)&&bze(this,e)};Hm.prototype.isDestroyed=function(){return!1};Hm.prototype.destroy=function(){return this._va=this._va&&this._va.destroy(),this._sp=this._sp&&this._sp.destroy(),me(this)};var y_=Hm;var uvn=T(S(),1);var RPn=T(S(),1),c2=`in vec3 startEllipsoidNormal; in vec3 endEllipsoidNormal; in vec4 startPositionAndHeight; in vec4 endPositionAndHeight; in vec4 startFaceNormalAndVertexCorner; in vec4 endFaceNormalAndHalfWidth; in float a_batchId; uniform mat4 u_modifiedModelView; uniform vec2 u_minimumMaximumVectorHeights; out vec4 v_startPlaneEC; out vec4 v_endPlaneEC; out vec4 v_rightPlaneEC; out float v_halfWidth; out vec3 v_volumeUpEC; void main() { // vertex corner IDs // 3-----------7 // /| left /| // / | 1 / | // 2-----------6 5 end // | / | / // start |/ right |/ // 0-----------4 // float isEnd = floor(startFaceNormalAndVertexCorner.w * 0.251); // 0 for front, 1 for end float isTop = floor(startFaceNormalAndVertexCorner.w * mix(0.51, 0.19, isEnd)); // 0 for bottom, 1 for top vec3 forward = endPositionAndHeight.xyz - startPositionAndHeight.xyz; vec3 right = normalize(cross(forward, startEllipsoidNormal)); vec4 position = vec4(startPositionAndHeight.xyz, 1.0); position.xyz += forward * isEnd; v_volumeUpEC = czm_normal * normalize(cross(right, forward)); // Push for volume height float offset; vec3 ellipsoidNormal = mix(startEllipsoidNormal, endEllipsoidNormal, isEnd); // offset height to create volume offset = mix(startPositionAndHeight.w, endPositionAndHeight.w, isEnd); offset = mix(u_minimumMaximumVectorHeights.y, u_minimumMaximumVectorHeights.x, isTop) - offset; position.xyz += offset * ellipsoidNormal; // move from RTC to EC position = u_modifiedModelView * position; right = czm_normal * right; // Push for width in a direction that is in the start or end plane and in a plane with right // N = normalEC (\"right-facing\" direction for push) // R = right // p = angle between N and R // w = distance to push along R if R == N // d = distance to push along N // // N R // { p| } * cos(p) = dot(N, R) = w / d // d | |w * d = w / dot(N, R) // { | } // o---------- polyline segment ----> // vec3 scratchNormal = mix(-startFaceNormalAndVertexCorner.xyz, endFaceNormalAndHalfWidth.xyz, isEnd); scratchNormal = cross(scratchNormal, mix(startEllipsoidNormal, endEllipsoidNormal, isEnd)); vec3 miterPushNormal = czm_normal * normalize(scratchNormal); offset = 2.0 * endFaceNormalAndHalfWidth.w * max(0.0, czm_metersPerPixel(position)); // offset = widthEC offset = offset / dot(miterPushNormal, right); position.xyz += miterPushNormal * (offset * sign(0.5 - mod(startFaceNormalAndVertexCorner.w, 2.0))); gl_Position = czm_depthClamp(czm_projection * position); position = u_modifiedModelView * vec4(startPositionAndHeight.xyz, 1.0); vec3 startNormalEC"
}