{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 101,
    "total_chunks": 194,
    "chunk_size": 51412,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.706Z"
  },
  "content": "f=h.cross(a,b,Oce);h.normalize(f,e.northNormal)}var PHe=new h,vHe=new h,wHe=new h(0,-1,0),FHe=new h(0,0,-1),Hce=new h;function AHe(e,t){let n=t.camera,i=n.positionWC,o=n.positionCartographic,r=0;if(!le.contains(e.rectangle,o)){let d=e.southwestCornerCartesian,u=e.northeastCornerCartesian,m=e.westNormal,p=e.southNormal,b=e.eastNormal,f=e.northNormal;t.mode!==ie.SCENE3D&&(d=t.mapProjection.project(le.southwest(e.rectangle),PHe),d.z=d.y,d.y=d.x,d.x=0,u=t.mapProjection.project(le.northeast(e.rectangle),vHe),u.z=u.y,u.y=u.x,u.x=0,m=wHe,b=h.UNIT_Y,p=FHe,f=h.UNIT_Z);let x=h.subtract(i,d,Hce),_=h.dot(x,m),C=h.dot(x,p),V=h.subtract(i,u,Hce),L=h.dot(V,b),R=h.dot(V,f);_>0?r+=_*_:L>0&&(r+=L*L),C>0?r+=C*C:R>0&&(r+=R*R)}let s,a,c;if(t.mode===ie.SCENE3D?(s=o.height,a=e.minimumHeight,c=e.maximumHeight):(s=i.x,a=0,c=0),s>c){let d=s-c;r+=d*d}else if(s<a){let d=a-s;r+=d*d}return Math.sqrt(r)}e1.prototype.distanceToCamera=function(e){let t=AHe(this,e);if(e.mode===ie.SCENE3D&&l(this._orientedBoundingBox)){let n=Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC));return Math.max(t,n)}return t};e1.prototype.intersectPlane=function(e){return this._orientedBoundingBox.intersectPlane(e)};e1.prototype.createDebugVolume=function(e){let t=new M.clone(M.IDENTITY),n=new S_({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight}),i=new Vt({geometry:n,id:\"outline\",modelMatrix:t,attributes:{color:Ot.fromColor(e)}});return new Rn({geometryInstances:i,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var Iu=e1;var LAn=T(S(),1);var aAn=T(S(),1);var p9n=T(S(),1);var T2={},MHe=new h,Kce=new h,Jce=new h,Qce=new h,jce=new Zn;T2.validOutline=function(e){let n=Zn.fromPoints(e,jce).halfAxes,i=$.getColumn(n,0,Kce),o=$.getColumn(n,1,Jce),r=$.getColumn(n,2,Qce),s=h.magnitude(i),a=h.magnitude(o),c=h.magnitude(r);return!(s===0&&(a===0||c===0)||a===0&&c===0)};T2.computeProjectTo2DArguments=function(e,t,n,i){let o=Zn.fromPoints(e,jce),r=o.halfAxes,s=$.getColumn(r,0,Kce),a=$.getColumn(r,1,Jce),c=$.getColumn(r,2,Qce),d=h.magnitude(s),u=h.magnitude(a),m=h.magnitude(c),p=Math.min(d,u,m);if(d===0&&(u===0||m===0)||u===0&&m===0)return!1;let b,f;return(p===u||p===m)&&(b=s),p===d?b=a:p===m&&(f=a),(p===d||p===u)&&(f=c),h.normalize(b,n),h.normalize(f,i),h.clone(o.center,t),!0};function qce(e,t,n,i,o){let r=h.subtract(e,t,MHe),s=h.dot(n,r),a=h.dot(i,r);return D.fromElements(s,a,o)}T2.createProjectPointsTo2DFunction=function(e,t,n){return function(i){let o=new Array(i.length);for(let r=0;r<i.length;r++)o[r]=qce(i[r],e,t,n);return o}};T2.createProjectPointTo2DFunction=function(e,t,n){return function(i,o){return qce(i,e,t,n,o)}};var h0=T2;var Y9n=T(S(),1);var y9n=T(S(),1);function Ly(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(Ly.prototype,{length:{get:function(){return this._length}}});Ly.prototype.enqueue=function(e){this._array.push(e),this._length++};Ly.prototype.dequeue=function(){if(this._length===0)return;let e=this._array,t=this._offset,n=e[t];return e[t]=void 0,t++,t>10&&t*2>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,n};Ly.prototype.peek=function(){if(this._length!==0)return this._array[this._offset]};Ly.prototype.contains=function(e){return this._array.indexOf(e)!==-1};Ly.prototype.clear=function(){this._array.length=this._offset=this._length=0};Ly.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var Zy=Ly;var Ko={};Ko.computeHierarchyPackedLength=function(e,t){let n=0,i=[e];for(;i.length>0;){let o=i.pop();if(!l(o))continue;n+=2;let r=o.positions,s=o.holes;if(l(r)&&r.length>0&&(n+=r.length*t.packedLength),l(s)){let a=s.length;for(let c=0;c<a;++c)i.push(s[c])}}return n};Ko.packPolygonHierarchy=function(e,t,n,i){let o=[e];for(;o.length>0;){let r=o.pop();if(!l(r))continue;let s=r.positions,a=r.holes;if(t[n++]=l(s)?s.length:0,t[n++]=l(a)?a.length:0,l(s)){let c=s.length;for(let d=0;d<c;++d,n+=i.packedLength)i.pack(s[d],t,n)}if(l(a)){let c=a.length;for(let d=0;d<c;++d)o.push(a[d])}}return n};Ko.unpackPolygonHierarchy=function(e,t,n){let i=e[t++],o=e[t++],r=new Array(i),s=o>0?new Array(o):void 0;for(let a=0;a<i;++a,t+=n.packedLength)r[a]=n.unpack(e,t);for(let a=0;a<o;++a)s[a]=Ko.unpackPolygonHierarchy(e,t,n),t=s[a].startingIndex,delete s[a].startingIndex;return{positions:r,holes:s,startingIndex:t}};var C_=new D;function tle(e,t,n,i){return D.subtract(t,e,C_),D.multiplyByScalar(C_,n/i,C_),D.add(e,C_,C_),[C_.x,C_.y]}var Ry=new h;function NHe(e,t,n,i){return h.subtract(t,e,Ry),h.multiplyByScalar(Ry,n/i,Ry),h.add(e,Ry,Ry),[Ry.x,Ry.y,Ry.z]}Ko.subdivideLineCount=function(e,t,n){let o=h.distance(e,t)/n,r=Math.max(0,Math.ceil(P.log2(o)));return Math.pow(2,r)};var AN=new he,MN=new he,kHe=new he,UHe=new h,FN=new Za;Ko.subdivideRhumbLineCount=function(e,t,n,i){let o=e.cartesianToCartographic(t,AN),r=e.cartesianToCartographic(n,MN),a=new Za(o,r,e).surfaceDistance/i,c=Math.max(0,Math.ceil(P.log2(a)));return Math.pow(2,c)};Ko.subdivideTexcoordLine=function(e,t,n,i,o,r){let s=Ko.subdivideLineCount(n,i,o),a=D.distance(e,t),c=a/s,d=r;d.length=s*2;let u=0;for(let m=0;m<s;m++){let p=tle(e,t,m*c,a);d[u++]=p[0],d[u++]=p[1]}return d};Ko.subdivideLine=function(e,t,n,i){let o=Ko.subdivideLineCount(e,t,n),r=h.distance(e,t),s=r/o;l(i)||(i=[]);let a=i;a.length=o*3;let c=0;for(let d=0;d<o;d++){let u=NHe(e,t,d*s,r);a[c++]=u[0],a[c++]=u[1],a[c++]=u[2]}return a};Ko.subdivideTexcoordRhumbLine=function(e,t,n,i,o,r,s){let a=n.cartesianToCartographic(i,AN),c=n.cartesianToCartographic(o,MN);FN.setEndPoints(a,c);let d=FN.surfaceDistance/r,u=Math.max(0,Math.ceil(P.log2(d))),m=Math.pow(2,u),p=D.distance(e,t),b=p/m,f=s;f.length=m*2;let x=0;for(let _=0;_<m;_++){let C=tle(e,t,_*b,p);f[x++]=C[0],f[x++]=C[1]}return f};Ko.subdivideRhumbLine=function(e,t,n,i,o){let r=e.cartesianToCartographic(t,AN),s=e.cartesianToCartographic(n,MN),a=new Za(r,s,e),c=a.surfaceDistance/i,d=Math.max(0,Math.ceil(P.log2(c))),u=Math.pow(2,d),m=a.surfaceDistance/u;l(o)||(o=[]);let p=o;p.length=u*3;let b=0;for(let f=0;f<u;f++){let x=a.interpolateUsingSurfaceDistance(f*m,kHe),_=e.cartographicToCartesian(x,UHe);p[b++]=_.x,p[b++]=_.y,p[b++]=_.z}return p};var DHe=new h,BHe=new h,YHe=new h,OHe=new h;Ko.scaleToGeodeticHeightExtruded=function(e,t,n,i,o){i=g(i,oe.WGS84);let r=DHe,s=BHe,a=YHe,c=OHe;if(l(e)&&l(e.attributes)&&l(e.attributes.position)){let d=e.attributes.position.values,u=d.length/2;for(let m=0;m<u;m+=3)h.fromArray(d,m,a),i.geodeticSurfaceNormal(a,r),c=i.scaleToGeodeticSurface(a,c),s=h.multiplyByScalar(r,n,s),s=h.add(c,s,s),d[m+u]=s.x,d[m+1+u]=s.y,d[m+2+u]=s.z,o&&(c=h.clone(a,c)),s=h.multiplyByScalar(r,t,s),s=h.add(c,s,s),d[m]=s.x,d[m+1]=s.y,d[m+2]=s.z}return e};Ko.polygonOutlinesFromHierarchy=function(e,t,n){let i=[],o=new Zy;o.enqueue(e);let r,s,a;for(;o.length!==0;){let c=o.dequeue(),d=c.positions;if(t)for(a=d.length,r=0;r<a;r++)n.scaleToGeodeticSurface(d[r],d[r]);if(d=yo(d,h.equalsEpsilon,!0),d.length<3)continue;let u=c.holes?c.holes.length:0;for(r=0;r<u;r++){let m=c.holes[r],p=m.positions;if(t)for(a=p.length,s=0;s<a;++s)n.scaleToGeodeticSurface(p[s],p[s]);if(p=yo(p,h.equalsEpsilon,!0),p.length<3)continue;i.push(p);let b=0;for(l(m.holes)&&(b=m.holes.length),s=0;s<b;s++)o.enqueue(m.holes[s])}i.push(d)}return i};var zHe=new he;function HHe(e,t,n){let i=n.cartesianToCartographic(e,AN),o=n.cartesianToCartographic(t,MN);if(Math.sign(i.latitude)===Math.sign(o.latitude))return;FN.setEndPoints(i,o);let r=FN.findIntersectionWithLatitude(0,zHe);if(!l(r))return;let s=Math.min(i.longitude,o.longitude),a=Math.max(i.longitude,o.longitude);if(Math.abs(a-s)>P.PI){let c=s;s=a,a=c}if(!(r.longitude<s||r.longitude>a))return n.cartographicToCartesian(r)}function KHe(e,t,n,i){if(i===$t.RHUMB)return HHe(e,t,n);let o=jn.lineSegmentPlane(e,t,an.ORIGIN_XY_PLANE);if(l(o))return n.scaleToGeodeticSurface(o,o)}var JHe=new he;function QHe(e,t,n){let i=[],o,r,s,a,c,d=0;for(;d<e.length;){o=e[d],r=e[(d+1)%e.length],s=P.sign(o.z),a=P.sign(r.z);let u=m=>t.cartesianToCartographic(m,JHe).longitude;if(s===0)i.push({position:d,type:s,visited:!1,next:a,theta:u(o)});else if(a!==0){if(c=KHe(o,r,t,n),++d,!l(c))continue;e.splice(d,0,c),i.push({position:d,type:s,visited:!1,next:a,theta:u(c)})}++d}return i}function nle(e,t,n,i,o,r,s){let a=[],c=r,d=m=>p=>p.position===m,u=[];do{let m=n[c];a.push(m);let p=i.findIndex(d(c)),b=i[p];if(!l(b)){++c;continue}let{visited:f,type:x,next:_}=b;if(b.visited=!0,x===0){if(_===0){let R=i[p-(s?1:-1)];if(R?.position===c+1)R.visited=!0;else{++c;continue}}if(!f&&s&&_>0||r===c&&!s&&_<0){++c;continue}}if(!(s?x>=0:x<=0)){++c;continue}f||u.push(c);let V=p+(s?1:-1),L=i[V];if(!l(L)){++c;continue}c=L.position}while(c<n.length&&c>=0&&c!==r&&a.length<n.length);e.splice(t,o,a);for(let m of u)t=nle(e,++t,n,i,0,m,!s);return t}Ko.splitPolygonsOnEquator=function(e,t,n,i){l(i)||(i=[]),i.splice(0,0,...e),i.length=e.length;let o=0;for(;o<i.length;){let r=i[o],s=r.slice();if(r.length<3){i[o]=s,++o;continue}let a=QHe(s,t,n);if(s.length===r.length||a.length<=1){i[o]=s,++o;continue}a.sort((d,u)=>d.theta-u.theta);let c=s[0].z>=0;o=nle(i,o,s,a,1,0,c)}return i};Ko.polygonsFromHierarchy=function(e,t,n,i,o,r){let s=[],a=[],c=new Zy;c.enqueue(e);let d=l(r);for(;c.length!==0;){let u=c.dequeue(),m=u.positions,p=u.holes,b,f;if(i)for(f=m.length,b=0;b<f;b++)o.scaleToGeodeticSurface(m[b],m[b]);if(t||(m=yo(m,h.equalsEpsilon,!0)),m.length<3)continue;let x=n(m);if(!l(x))continue;let _=[],C=si.computeWindingOrder2D(x);if(C===ns.CLOCKWISE&&(x.reverse(),m=m.slice().reverse()),d){d=!1;let X=[m];if(X=r(X,X),X.length>1){for(let v of X)c.enqueue(new Ra(v,p));continue}}let V=m.slice(),L=l(p)?p.length:0,R=[],G;for(b=0;b<L;b++){let X=p[b],v=X.positions;if(i)for(f=v.length,G=0;G<f;++G)o.scaleToGeodeticSurface(v[G],v[G]);if(t||(v=yo(v,h.equalsEpsilon,!0)),v.length<3)continue;let W=n(v);if(!l(W))continue;C=si.computeWindingOrder2D(W),C===ns.CLOCKWISE&&(W.reverse(),v=v.slice().reverse()),R.push(v),_.push(V.length),V=V.concat(v),x=x.concat(W);let F=0;for(l(X.holes)&&(F=X.holes.length),G=0;G<F;G++)c.enqueue(X.holes[G])}s.push({outerRing:m,holes:R}),a.push({positions:V,positions2D:x,holes:_})}return{hierarchy:s,polygons:a}};var jHe=new D,qHe=new h,$He=new Fe,eKe=new $;Ko.computeBoundingRectangle=function(e,t,n,i,o){let r=Fe.fromAxisAngle(e,i,$He),s=$.fromQuaternion(r,eKe),a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,d=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,m=n.length;for(let p=0;p<m;++p){let b=h.clone(n[p],qHe);$.multiplyByVector(s,b,b);let f=t(b,jHe);l(f)&&(a=Math.min(a,f.x),c=Math.max(c,f.x),d=Math.min(d,f.y),u=Math.max(u,f.y))}return o.x=a,o.y=d,o.width=c-a,o.height=u-d,o};Ko.createGeometryFromPositions=function(e,t,n,i,o,r,s){let a=si.triangulate(t.positions2D,t.holes);a.length<3&&(a=[0,1,2]);let c=t.positions,d=l(n),u=d?n.positions:void 0;if(o){let m=c.length,p=new Array(m*3),b=0;for(let _=0;_<m;_++){let C=c[_];p[b++]=C.x,p[b++]=C.y,p[b++]=C.z}let f={attributes:{position:new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:p})},indices:a,primitiveType:we.TRIANGLES};d&&(f.attributes.st=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:D.packArray(u)}));let x=new ut(f);return r.normal?An.computeNormal(x):x}if(s===$t.GEODESIC)return si.computeSubdivision(e,c,a,u,i);if(s===$t.RHUMB)return si.computeRhumbLineSubdivision(e,c,a,u,i)};var $ce=[],ele=[],tKe=new h,nKe=new h;Ko.computeWallGeometry=function(e,t,n,i,o,r){let s,a,c,d,u,m,p,b,f,x=e.length,_=0,C=0,V=l(t),L=V?t.positions:void 0;if(o)for(a=x*3*2,s=new Array(a*2),V&&(f=x*2*2,b=new Array(f*2)),c=0;c<x;c++)d=e[c],u=e[(c+1)%x],s[_]=s[_+a]=d.x,++_,s[_]=s[_+a]=d.y,++_,s[_]=s[_+a]=d.z,++_,s[_]=s[_+a]=u.x,++_,s[_]=s[_+a]=u.y,++_,s[_]=s[_+a]=u.z,++_,V&&(m=L[c],p=L[(c+1)%x],b[C]=b[C+f]=m.x,++C,b[C]=b[C+f]=m.y,++C,b[C]=b[C+f]=p.x,++C,b[C]=b[C+f]=p.y,++C);else{let W=P.chordLength(i,n.maximumRadius),F=0;if(r===$t.GEODESIC)for(c=0;c<x;c++)F+=Ko.subdivideLineCount(e[c],e[(c+1)%x],W);else if(r===$t.RHUMB)for(c=0;c<x;c++)F+=Ko.subdivideRhumbLineCount(n,e[c],e[(c+1)%x],W);for(a=(F+x)*3,s=new Array(a*2),V&&(f=(F+x)*2,b=new Array(f*2)),c=0;c<x;c++){d=e[c],u=e[(c+1)%x];let A,y;V&&(m=L[c],p=L[(c+1)%x]),r===$t.GEODESIC?(A=Ko.subdivideLine(d,u,W,ele),V&&(y=Ko.subdivideTexcoordLine(m,p,d,u,W,$ce))):r===$t.RHUMB&&(A=Ko.subdivideRhumbLine(n,d,u,W,ele),V&&(y=Ko.subdivideTexcoordRhumbLine(m,p,n,d,u,W,$ce)));let Z=A.length;for(let E=0;E<Z;++E,++_)s[_]=A[E],s[_+a]=A[E];if(s[_]=u.x,s[_+a]=u.x,++_,s[_]=u.y,s[_+a]=u.y,++_,s[_]=u.z,s[_+a]=u.z,++_,V){let E=y.length;for(let I=0;I<E;++I,++C)b[C]=y[I],b[C+f]=y[I];b[C]=p.x,b[C+f]=p.x,++C,b[C]=p.y,b[C+f]=p.y,++C}}}x=s.length;let R=Ae.createTypedArray(x/3,x-e.length*6),G=0;for(x/=6,c=0;c<x;c++){let W=c,F=W+1,A=W+x,y=A+1;d=h.fromArray(s,W*3,tKe),u=h.fromArray(s,F*3,nKe),!h.equalsEpsilon(d,u,P.EPSILON10,P.EPSILON10)&&(R[G++]=W,R[G++]=A,R[G++]=F,R[G++]=F,R[G++]=A,R[G++]=y)}let X={attributes:new hn({position:new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:s})}),indices:R,primitiveType:we.TRIANGLES};return V&&(X.attributes.st=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:b})),new ut(X)};var Dn=Ko;function iKe(e){let t=e.length,n=new Float64Array(t*3),i=Ae.createTypedArray(t,t*2),o=0,r=0;for(let a=0;a<t;a++){let c=e[a];n[o++]=c.x,n[o++]=c.y,n[o++]=c.z,i[r++]=a,i[r++]=(a+1)%t}let s=new hn({position:new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:n})});return new ut({attributes:s,indices:i,primitiveType:we.LINES})}function V_(e){e=g(e,g.EMPTY_OBJECT);let t=e.polygonHierarchy;this._polygonHierarchy=t,this._workerName=\"createCoplanarPolygonOutlineGeometry\",this.packedLength=Dn.computeHierarchyPackedLength(t,h)+1}V_.fromPositions=function(e){e=g(e,g.EMPTY_OBJECT);let t={polygonHierarchy:{positions:e.positions}};return new V_(t)};V_.pack=function(e,t,n){return n=g(n,0),n=Dn.packPolygonHierarchy(e._polygonHierarchy,t,n,h),t[n]=e.packedLength,t};var oKe={polygonHierarchy:{}};V_.unpack=function(e,t,n){t=g(t,0);let i=Dn.unpackPolygonHierarchy(e,t,h);t=i.startingIndex,delete i.startingIndex;let o=e[t];return l(n)||(n=new V_(oKe)),n._polygonHierarchy=i,n.packedLength=o,n};V_.createGeometry=function(e){let t=e._polygonHierarchy,n=t.positions;if(n=yo(n,h.equalsEpsilon,!0),n.length<3||!h0.validOutline(n))return;let o=Dn.polygonOutlinesFromHierarchy(t,!1);if(o.length===0)return;let r=[];for(let c=0;c<o.length;c++){let d=new Vt({geometry:iKe(o[c])});r.push(d)}let s=An.combineInstances(r)[0],a=ce.fromPoints(t.positions);return new ut({attributes:s.attributes,indices:s.indices,primitiveType:s.primitiveType,boundingSphere:a})};var Wu=V_;var NN=new he;function S2(e){let t=Mp.fromToken(e.token),n=g(e.minimumHeight,0),i=g(e.maximumHeight,0),o=g(e.ellipsoid,oe.WGS84);this.s2Cell=t,this.minimumHeight=n,this.maximumHeight=i,this.ellipsoid=o;let r=hKe(t,n,i,o);this._boundingPlanes=r;let s=yKe(r);this._vertices=s,this._edgeNormals=new Array(6),this._edgeNormals[0]=UH(r[0],s.slice(0,4));let a;for(a=0;a<4;a++)this._edgeNormals[0][a]=h.negate(this._edgeNormals[0][a],this._edgeNormals[0][a]);for(this._edgeNormals[1]=UH(r[1],s.slice(4,8)),a=0;a<4;a++)this._edgeNormals[2+a]=UH(r[2+a],[s[a%4],s[(a+1)%4],s[4+(a+1)%4],s[4+a]]);for(this._planeVertices=[this._vertices.slice(0,4),this._vertices.slice(4,8)],a=0;a<4;a++)this._planeVertices.push([this._vertices[a%4],this._vertices[(a+1)%4],this._vertices[4+(a+1)%4],this._vertices[4+a]]);let c=t.getCenter();NN=o.cartesianToCartographic(c,NN),NN.height=(i+n)/2,this.center=o.cartographicToCartesian(NN,c),this._boundingSphere=ce.fromPoints(s)}var rKe=new h,sKe=new he,aKe=new h,cKe=new he,lKe=new h,dKe=new h,uKe=new h,mKe=new h;function hKe(e,t,n,i){let o=new Array(6),r=e.getCenter(),s=i.geodeticSurfaceNormal(r,rKe),a=i.cartesianToCartographic(r,sKe);a.height=n;let c=i.cartographicToCartesian(a,aKe),d=an.fromPointNormal(c,s);o[0]=d;let u=0,m,p=[],b,f;for(m=0;m<4;m++){b=e.getVertex(m),p[m]=b,f=i.cartesianToCartographic(b,cKe),f.height=t;let _=an.getPointDistance(d,i.cartographicToCartesian(f,lKe));_<u&&(u=_)}let x=an.clone(d);for(x.normal=h.negate(x.normal,x.normal),x.distance=x.distance*-1+u,o[1]=x,m=0;m<4;m++){b=p[m];let _=p[(m+1)%4],C=i.geodeticSurfaceNormal(b,dKe),V=h.subtract(_,b,mKe),L=h.cross(V,C,uKe);L=h.normalize(L,L),o[2+m]=an.fromPointNormal(b,L)}return o}var L_=new h,Z_=new h,R_=new h,vH=new h,wH=new h,FH=new h,fKe=new h,pKe=new h,bKe=new h,AH=new h,MH=new h,NH=new h,Gy=new h,yf=new $;function ile(e,t,n){L_=e.normal,Z_=t.normal,R_=n.normal,vH=h.multiplyByScalar(e.normal,-e.distance,vH),wH=h.multiplyByScalar(t.normal,-t.distance,wH),FH=h.multiplyByScalar(n.normal,-n.distance,FH),AH=h.multiplyByScalar(h.cross(Z_,R_,fKe),h.dot(vH,L_),AH),MH=h.multiplyByScalar(h.cross(R_,L_,pKe),h.dot(wH,Z_),MH),NH=h.multiplyByScalar(h.cross(L_,Z_,bKe),h.dot(FH,R_),NH),yf[0]=L_.x,yf[1]=Z_.x,yf[2]=R_.x,yf[3]=L_.y,yf[4]=Z_.y,yf[5]=R_.y,yf[6]=L_.z,yf[7]=Z_.z,yf[8]=R_.z;let i=$.determinant(yf);return Gy=h.add(AH,MH,Gy),Gy=h.add(Gy,NH,Gy),new h(Gy.x/i,Gy.y/i,Gy.z/i)}function yKe(e){let t=new Array(8);for(let n=0;n<4;n++)t[n]=ile(e[0],e[2+(n+3)%4],e[2+n%4]),t[n+4]=ile(e[1],e[2+(n+3)%4],e[2+n%4]);return t}var kH=new h,t1=new h;function UH(e,t){let n=[];for(let i=0;i<4;i++)kH=h.subtract(t[(i+1)%4],t[i],kH),t1=h.cross(e.normal,kH,t1),t1=h.normalize(t1,t1),n[i]=h.clone(t1);return n}Object.defineProperties(S2.prototype,{boundingVolume:{get:function(){return this}},boundingSphere:{get:function(){return this._boundingSphere}}});var DH=new h;S2.prototype.distanceToCamera=function(e){let t=e.camera.positionWC,n=[],i=[],o;an.getPointDistance(this._boundingPlanes[0],t)>0?(n.push(0),i.push(this._planeVertices[0]),o=this._edgeNormals[0]):an.getPointDistance(this._boundingPlanes[1],t)>0&&(n.push(1),i.push(this._planeVertices[1]),o=this._edgeNormals[1]);let r,s;for(r=0;r<4;r++)s=2+r,an.getPointDistance(this._boundingPlanes[s],t)>0&&(n.push(s),i.push(this._planeVertices[s]),o=this._edgeNormals[s]);if(n.length===0)return 0;let a,c;if(n.length===1)return c=this._boundingPlanes[n[0]],a=BH(an.projectPointOntoPlane(c,t,DH),i[0],c,o),h.distance(a,t);if(n.length===2){if(n[0]===0){let p=[this._vertices[4*n[0]+(n[1]-2)],this._vertices[4*n[0]+(n[1]-2+1)%4]];return a=ole(t,p[0],p[1]),h.distance(a,t)}let u=Number.MAX_VALUE,m;for(r=0;r<2;r++)c=this._boundingPlanes[n[r]],a=BH(an.projectPointOntoPlane(c,t,DH),i[r],c,this._edgeNormals[n[r]]),m=h.distanceSquared(a,t),m<u&&(u=m);return Math.sqrt(u)}else if(n.length>3)return a=BH(an.projectPointOntoPlane(this._boundingPlanes[1],t,DH),this._planeVertices[1],this._boundingPlanes[1],this._edgeNormals[1]),h.distance(a,t);let d=n[1]===2&&n[2]===5?0:1;return n[0]===0?h.distance(t,this._vertices[(n[1]-2+d)%4]):h.distance(t,this._vertices[4+(n[1]-2+d)%4])};var gKe=new h,xKe=new h;function ole(e,t,n){let i=h.subtract(n,t,gKe),o=h.subtract(e,t,xKe),r=h.dot(i,o);if(r<=0)return t;let s=h.dot(i,i);return r>=s?n:(r=r/s,new h((1-r)*t.x+r*n.x,(1-r)*t.y+r*n.y,(1-r)*t.z+r*n.z))}var _Ke=new an(h.UNIT_X,0);function BH(e,t,n,i){let o=Number.MAX_VALUE,r,s,a;for(let c=0;c<t.length;c++){let d=an.fromPointNormal(t[c],i[c],_Ke);an.getPointDistance(d,e)<0||(a=ole(e,t[c],t[(c+1)%4]),r=h.distance(e,a),r<o&&(o=r,s=a))}return l(s)?s:e}S2.prototype.intersectPlane=function(e){let t=0,n=0;for(let i=0;i<this._vertices.length;i++)h.dot(e.normal,this._vertices[i])+e.distance<0?n++:t++;return t===this._vertices.length?nn.INSIDE:n===this._vertices.length?nn.OUTSIDE:nn.INTERSECTING};S2.prototype.createDebugVolume=function(e){let t=new M.clone(M.IDENTITY),n=new Wu({polygonHierarchy:{positions:this._planeVertices[0]}}),i=Wu.createGeometry(n),o=new Vt({geometry:i,id:\"outline\",modelMatrix:t,attributes:{color:Ot.fromColor(e)}}),r=new Wu({polygonHierarchy:{positions:this._planeVertices[1]}}),s=Wu.createGeometry(r),a=new Vt({geometry:s,id:\"outline\",modelMatrix:t,attributes:{color:Ot.fromColor(e)}}),c=[];for(let d=0;d<4;d++){let u=new Wu({polygonHierarchy:{positions:this._planeVertices[2+d]}}),m=Wu.createGeometry(u);c[d]=new Vt({geometry:m,id:\"outline\",modelMatrix:t,attributes:{color:Ot.fromColor(e)}})}return new Rn({geometryInstances:[c[0],c[1],c[2],c[3],a,o],appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var C2=S2;var iMn=T(S(),1);var zAn=T(S(),1);var kAn=T(S(),1);var TKe=new h(1,1,1),kN=Math.cos,UN=Math.sin;function n1(e){e=g(e,g.EMPTY_OBJECT);let t=g(e.radii,TKe),n=g(e.innerRadii,t),i=g(e.minimumClock,0),o=g(e.maximumClock,P.TWO_PI),r=g(e.minimumCone,0),s=g(e.maximumCone,P.PI),a=Math.round(g(e.stackPartitions,10)),c=Math.round(g(e.slicePartitions,8)),d=Math.round(g(e.subdivisions,128));this._radii=h.clone(t),this._innerRadii=h.clone(n),this._minimumClock=i,this._maximumClock=o,this._minimumCone=r,this._maximumCone=s,this._stackPartitions=a,this._slicePartitions=c,this._subdivisions=d,this._offsetAttribute=e.offsetAttribute,this._workerName=\"createEllipsoidOutlineGeometry\"}n1.packedLength=2*h.packedLength+8;n1.pack=function(e,t,n){return n=g(n,0),h.pack(e._radii,t,n),n+=h.packedLength,h.pack(e._innerRadii,t,n),n+=h.packedLength,t[n++]=e._minimumClock,t[n++]=e._maximumClock,t[n++]=e._minimumCone,t[n++]=e._maximumCone,t[n++]=e._stackPartitions,t[n++]=e._slicePartitions,t[n++]=e._subdivisions,t[n]=g(e._offsetAttribute,-1),t};var rle=new h,sle=new h,f0={radii:rle,innerRadii:sle,minimumClock:void 0,maximumClock:void 0,minimumCone:void 0,maximumCone:void 0,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0,offsetAttribute:void 0};n1.unpack=function(e,t,n){t=g(t,0);let i=h.unpack(e,t,rle);t+=h.packedLength;let o=h.unpack(e,t,sle);t+=h.packedLength;let r=e[t++],s=e[t++],a=e[t++],c=e[t++],d=e[t++],u=e[t++],m=e[t++],p=e[t];return l(n)?(n._radii=h.clone(i,n._radii),n._innerRadii=h.clone(o,n._innerRadii),n._minimumClock=r,n._maximumClock=s,n._minimumCone=a,n._maximumCone=c,n._stackPartitions=d,n._slicePartitions=u,n._subdivisions=m,n._offsetAttribute=p===-1?void 0:p,n):(f0.minimumClock=r,f0.maximumClock=s,f0.minimumCone=a,f0.maximumCone=c,f0.stackPartitions=d,f0.slicePartitions=u,f0.subdivisions=m,f0.offsetAttribute=p===-1?void 0:p,new n1(f0))};n1.createGeometry=function(e){let t=e._radii;if(t.x<=0||t.y<=0||t.z<=0)return;let n=e._innerRadii;if(n.x<=0||n.y<=0||n.z<=0)return;let i=e._minimumClock,o=e._maximumClock,r=e._minimumCone,s=e._maximumCone,a=e._subdivisions,c=oe.fromCartesian3(t),d=e._slicePartitions+1,u=e._stackPartitions+1;d=Math.round(d*Math.abs(o-i)/P.TWO_PI),u=Math.round(u*Math.abs(s-r)/P.PI),d<2&&(d=2),u<2&&(u=2);let m=0,p=1,b=n.x!==t.x||n.y!==t.y||n.z!==t.z,f=!1,x=!1;b&&(p=2,r>0&&(f=!0,m+=d),s<Math.PI&&(x=!0,m+=d));let _=a*p*(u+d),C=new Float64Array(_*3),V=2*(_+m-(d+u)*p),L=Ae.createTypedArray(_,V),R,G,X,v,W=0,F=new Array(u),A=new Array(u);for(R=0;R<u;R++)v=r+R*(s-r)/(u-1),F[R]=UN(v),A[R]=kN(v);let y=new Array(a),Z=new Array(a);for(R=0;R<a;R++)X=i+R*(o-i)/(a-1),y[R]=UN(X),Z[R]=kN(X);for(R=0;R<u;R++)for(G=0;G<a;G++)C[W++]=t.x*F[R]*Z[G],C[W++]=t.y*F[R]*y[G],C[W++]=t.z*A[R];if(b)for(R=0;R<u;R++)for(G=0;G<a;G++)C[W++]=n.x*F[R]*Z[G],C[W++]=n.y*F[R]*y[G],C[W++]=n.z*A[R];for(F.length=a,A.length=a,R=0;R<a;R++)v=r+R*(s-r)/(a-1),F[R]=UN(v),A[R]=kN(v);for(y.length=d,Z.length=d,R=0;R<d;R++)X=i+R*(o-i)/(d-1),y[R]=UN(X),Z[R]=kN(X);for(R=0;R<a;R++)for(G=0;G<d;G++)C[W++]=t.x*F[R]*Z[G],C[W++]=t.y*F[R]*y[G],C[W++]=t.z*A[R];if(b)for(R=0;R<a;R++)for(G=0;G<d;G++)C[W++]=n.x*F[R]*Z[G],C[W++]=n.y*F[R]*y[G],C[W++]=n.z*A[R];for(W=0,R=0;R<u*p;R++){let w=R*a;for(G=0;G<a-1;G++)L[W++]=w+G,L[W++]=w+G+1}let E=u*a*p;for(R=0;R<d;R++)for(G=0;G<a-1;G++)L[W++]=E+R+G*d,L[W++]=E+R+(G+1)*d;if(b)for(E=u*a*p+d*a,R=0;R<d;R++)for(G=0;G<a-1;G++)L[W++]=E+R+G*d,L[W++]=E+R+(G+1)*d;if(b){let w=u*a*p,k=w+a*d;if(f)for(R=0;R<d;R++)L[W++]=w+R,L[W++]=k+R;if(x)for(w+=a*d-d,k+=a*d-d,R=0;R<d;R++)L[W++]=w+R,L[W++]=k+R}let I=new hn({position:new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:C})});if(l(e._offsetAttribute)){let w=C.length,k=e._offsetAttribute===cn.NONE?0:1,B=new Uint8Array(w/3).fill(k);I.applyOffset=new Ee({componentDatatype:Q.UNSIGNED_BYTE,componentsPerAttribute:1,values:B})}return new ut({attributes:I,indices:L,primitiveType:we.LINES,boundingSphere:ce.fromEllipsoid(c),offsetAttribute:e._offsetAttribute})};var xd=n1;function i1(e){let t=g(e.radius,1),i={radii:new h(t,t,t),stackPartitions:e.stackPartitions,slicePartitions:e.slicePartitions,subdivisions:e.subdivisions};this._ellipsoidGeometry=new xd(i),this._workerName=\"createSphereOutlineGeometry\"}i1.packedLength=xd.packedLength;i1.pack=function(e,t,n){return xd.pack(e._ellipsoidGeometry,t,n)};var SKe=new xd,G_={radius:void 0,radii:new h,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0};i1.unpack=function(e,t,n){let i=xd.unpack(e,t,SKe);return G_.stackPartitions=i._stackPartitions,G_.slicePartitions=i._slicePartitions,G_.subdivisions=i._subdivisions,l(n)?(h.clone(i._radii,G_.radii),n._ellipsoidGeometry=new xd(G_),n):(G_.radius=i._radii.x,new i1(G_))};i1.createGeometry=function(e){return xd.createGeometry(e._ellipsoidGeometry)};var p0=i1;function o1(e,t){t===0&&(t=P.EPSILON7),this._boundingSphere=new ce(e,t)}Object.defineProperties(o1.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}});o1.prototype.distanceToCamera=function(e){let t=this._boundingSphere;return Math.max(0,h.distance(t.center,e.camera.positionWC)-t.radius)};o1.prototype.intersectPlane=function(e){return ce.intersectPlane(this._boundingSphere,e)};o1.prototype.update=function(e,t){h.clone(e,this._boundingSphere.center),this._boundingSphere.radius=t};o1.prototype.createDebugVolume=function(e){let t=new p0({radius:this.radius}),n=M.fromTranslation(this.center,new M.clone(M.IDENTITY)),i=new Vt({geometry:t,id:\"outline\",modelMatrix:n,attributes:{color:Ot.fromColor(e)}});return new Rn({geometryInstances:i,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var b0=o1;var bMn=T(S(),1);var CKe=new h,VKe=new h,LKe=new h,ZKe=new h;function E_(e,t,n){n=h.cross(e,t,n);let i=h.magnitude(n);return h.multiplyByScalar(n,P.EPSILON7/i,n)}function YH(e,t){let n=h.normalize(e,ZKe),i=h.equalsEpsilon(n,h.UNIT_X,P.EPSILON6)?h.UNIT_Y:h.UNIT_X;return E_(e,i,t)}function ale(e){let t=$.getColumn(e,0,CKe),n=$.getColumn(e,1,VKe),i=$.getColumn(e,2,LKe),o=h.equals(t,h.ZERO),r=h.equals(n,h.ZERO),s=h.equals(i,h.ZERO);return!o&&!r&&!s?e:o&&r&&s?(e[0]=P.EPSILON7,e[4]=P.EPSILON7,e[8]=P.EPSILON7,e):(o&&!r&&!s?t=E_(n,i,t):!o&&r&&!s?n=E_(t,i,n):!o&&!r&&s?i=E_(n,t,i):o?r?s||(t=YH(i,t),n=E_(i,t,n)):(t=YH(n,t),i=E_(n,t,i)):(n=YH(t,n),i=E_(n,t,i)),$.setColumn(e,0,t,e),$.setColumn(e,1,n,e),$.setColumn(e,2,i,e),e)}function r1(e,t){t=ale(t),this._orientedBoundingBox=new Zn(e,t),this._boundingSphere=ce.fromOrientedBoundingBox(this._orientedBoundingBox)}Object.defineProperties(r1.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});r1.prototype.distanceToCamera=function(e){return Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(e.camera.positionWC))};r1.prototype.intersectPlane=function(e){return this._orientedBoundingBox.intersectPlane(e)};r1.prototype.update=function(e,t){h.clone(e,this._orientedBoundingBox.center),t=ale(t),$.clone(t,this._orientedBoundingBox.halfAxes),ce.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)};r1.prototype.createDebugVolume=function(e){let t=new Tm({minimum:new h(-1,-1,-1),maximum:new h(1,1,1)}),n=M.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center),i=new Vt({geometry:t,id:\"outline\",modelMatrix:n,attributes:{color:Ot.fromColor(e)}});return new Rn({geometryInstances:i,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})};var _d=r1;function Jo(e,t,n,i){this._tileset=e,this._header=n;let o=l(n.contents),r=o&&n.contents.length>1||oi(n,\"3DTILES_multiple_contents\"),s=o&&!r?n.contents[0]:n.content;this._contentHeader=s,this.transform=l(n.transform)?M.unpack(n.transform):M.clone(M.IDENTITY);let a=l(i)?i.computedTransform:e.modelMatrix,c=M.multiply(a,this.transform,new M),d=l(i)?i._initialTransform:M.IDENTITY;this._initialTransform=M.multiply(d,this.transform,new M),this.computedTransform=c,this.metadata=b2(e,n),this._verticalExaggeration=1,this._verticalExaggerationRelativeHeight=0,this._boundingVolume=this.createBoundingVolume(n.boundingVolume,c),this._boundingVolume2D=void 0;let u;l(s)&&l(s.boundingVolume)&&(u=this.createBoundingVolume(s.boundingVolume,c)),this._contentBoundingVolume=u,this._contentBoundingVolume2D=void 0;let m;l(n.viewerRequestVolume)&&(m=this.createBoundingVolume(n.viewerRequestVolume,c)),this._viewerRequestVolume=m,this.geometricError=n.geometricError,this._geometricError=n.geometricError,l(this._geometricError)||(this._geometricError=l(i)?i._geometricError:e._geometricError,Jo._deprecationWarning(\"geometricErrorUndefined\",\"Required property geometricError is undefined for this tile. Using parent's geometric error instead.\")),this.updateGeometricErrorScale();let p;l(n.refine)?((n.refine===\"replace\"||n.refine===\"add\")&&Jo._deprecationWarning(\"lowercase-refine\",`This tile uses a lowercase refine \"${n.refine}\". Instead use \"${n.refine.toUpperCase()}\".`),p=n.refine.toUpperCase()===\"REPLACE\"?vo.REPLACE:vo.ADD):l(i)?p=i.refine:p=vo.REPLACE,this.refine=p,this.children=[],this.parent=i;let b,f=!1,x,_,C;if(t=Xe.createIfNeeded(t),r)x=Fo.UNLOADED,_=t.clone();else if(l(s)){let G=s.uri;l(s.url)&&(Jo._deprecationWarning(\"contentUrl\",'This tileset JSON uses the \"content.url\" property which has been deprecated. Use \"content.uri\" instead.'),G=s.url),G===\"\"?(Jo._deprecationWarning(\"contentUriEmpty\",\"content.uri property is an empty string, which creates a circular dependency, making this tileset invalid. Omit the content property instead\"),b=new KC(e,this),f=!0,x=Fo.READY):(x=Fo.UNLOADED,_=t.getDerivedResource({url:G}),C=Ja.getServerKey(_.getUrlComponent()))}else b=new KC(e,this),f=!0,x=Fo.READY;this._content=b,this._contentResource=_,this._contentState=x,this._expiredContent=void 0,this._serverKey=C,this.hasEmptyContent=f,this.hasTilesetContent=!1,this.hasImplicitContent=!1,this.hasImplicitContentMetadata=!1,this.hasMultipleContents=r,this.cacheNode=void 0;let V=n.expire,L,R;l(V)&&(L=V.duration,l(V.date)&&(R=te.fromIso8601(V.date))),this.expireDuration=L,this.expireDate=R,this.lastStyleTime=0,this._optimChildrenWithinParent=Ru.NOT_COMPUTED,this.clippingPlanesDirty=!1,this.priorityDeferred=!1,this.implicitTileset=void 0,this.implicitCoordinates=void 0,this.implicitSubtree=void 0,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._screenSpaceErrorProgressiveResolution=0,this._visibilityPlaneMask=0,this._visible=!1,this._inRequestVolume=!1,this._finalResolution=!0,this._depth=0,this._stackLength=0,this._selectionDepth=0,this._updatedVisibilityFrame=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._wasSelectedLastFrame=!1,this._requestedFrame=0,this._ancestorWithContent=void 0,this._ancestorWithContentAvailable=void 0,this._refines=!1,this._shouldSelect=!1,this._isClipped=!0,this._clippingPlanesState=0,this._debugBoundingVolume=void 0,this._debugContentBoundingVolume=void 0,this._debugViewerRequestVolume=void 0,this._debugColor=O.fromRandom({alpha:1}),this._debugColorizeTiles=!1,this._priority=0,this._priorityHolder=this,this._priorityProgressiveResolution=!1,this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1,this._priorityReverseScreenSpaceError=0,this._foveatedFactor=0,this._wasMinPriorityChild=!1,this._loadTimestamp=new te,this._commandsLength=0,this._color=void 0,this._colorDirty=!1,this._request=void 0}Jo._deprecationWarning=Is;Object.defineProperties(Jo.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return g(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},isVisible:{get:function(){return this._visible&&this._inRequestVolume}},extras:{get:function(){return this._header.extras}},color:{get:function(){return l(this._color)||(this._color=new O),O.clone(this._color)},set:function(e){this._color=O.clone(e,this._color),this._colorDirty=!0}},hasRenderableContent:{get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent&&!this.hasImplicitContent}},contentAvailable:{get:function(){return this.contentReady&&this.hasRenderableContent||l(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===Fo.READY}},contentUnloaded:{get:function(){return this._contentState===Fo.UNLOADED}},hasUnloadedRenderableContent:{get:function(){return this.hasRenderableContent&&this.contentUnloaded}},contentExpired:{get:function(){return this._contentState===Fo.EXPIRED}},contentFailed:{get:function(){return this._contentState===Fo.FAILED}},commandsLength:{get:function(){return this._commandsLength}}});var Ey=new h;function RKe(e,t){let{tileset:n,boundingSphere:i}=e,{radius:o,center:r}=i,{camera:s}=t,a=h.multiplyByScalar(s.directionWC,e._centerZDepth,Ey),c=h.add(s.positionWC,a,Ey),d=h.subtract(c,r,Ey);if(h.magnitude(d)>o){let R=h.normalize(d,Ey),G=h.multiplyByScalar(R,o,Ey),X=h.add(r,G,Ey),v=h.subtract(X,s.positionWC,Ey),W=h.normalize(v,Ey);e._foveatedFactor=1-Math.abs(h.dot(s.directionWC,W))}else e._foveatedFactor=0;let p=e.refine===vo.REPLACE,b=n.isSkippingLevelOfDetail;if(p&&!b||!n.foveatedScreenSpaceError||n.foveatedConeSize===1||e._priorityProgressiveResolution&&p&&b||n._pass===Io.PRELOAD_FLIGHT||n._pass===Io.PRELOAD)return!1;let f=1-Math.cos(s.frustum.fov*.5),x=n.foveatedConeSize*f;if(e._foveatedFactor<=x)return!1;let _=f-x,C=P.clamp((e._foveatedFactor-x)/_,0,1),V=n.foveatedInterpolationCallback(n.foveatedMinimumScreenSpaceErrorRelaxation,n.memoryAdjustedScreenSpaceError,C),L=e._screenSpaceError===0&&l(e.parent)?e.parent._screenSpaceError*.5:e._screenSpaceError;return n.memoryAdjustedScreenSpaceError-V<=L}var ule=new te;Jo.prototype.getScreenSpaceError=function(e,t,n){let i=this._tileset,o=g(n,1),r=l(this.parent)?this.parent.geometricError:i._scaledGeometricError,s=t?r:this.geometricError;if(s===0)return 0;let{camera:a,context:c}=e,d=a.frustum,u=c.drawingBufferWidth,m=c.drawingBufferHeight*o,p;if(e.mode===ie.SCENE2D||d instanceof rn){let b=d.offCenterFrustum;l(b)&&(d=b);let f=Math.max(d.top-d.bottom,d.right-d.left)/Math.max(u,m);p=s/f}else{let b=Math.max(this._distanceToCamera,P.EPSILON7),f=d.sseDenominator;if(p=s*m/(b*f),i.dynamicScreenSpaceError){let x=i._dynamicScreenSpaceErrorComputedDensity,_=i.dynamicScreenSpaceErrorFactor,C=P.fog(b,x)*_;p-=C}}return p/=e.pixelRatio,p};function GKe(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return!1;let n=e.memoryAdjustedScreenSpaceError,i=t._screenSpaceErrorProgressiveResolution>n;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;let o=t.parent,r=t._screenSpaceErrorProgressiveResolution<=n,s=l(o)&&o._screenSpaceErrorProgressiveResolution>n;return r&&s&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,i=!0),i}function EKe(e,t){let n=t.parent,o=l(n)&&(!e.isSkippingLevelOfDetail||t._screenSpaceError===0||n.hasTilesetContent||n.hasImplicitContent)?n._screenSpaceError:t._screenSpaceError;return e.root._screenSpaceError-o}Jo.prototype.updateVisibility=function(e){let{parent:t,tileset:n}=this;if(this._updatedVisibilityFrame===n._updatedVisibilityFrame)return;let i=l(t)?t.computedTransform:n.modelMatrix,o=l(t)?t._visibilityPlaneMask:os.MASK_INDETERMINATE;this.updateTransform(i,e),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,n.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,o),this._visible=this._visibilityPlaneMask!==os.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=EKe(n,this),this._priorityProgressiveResolution=GKe(n,this),this.priorityDeferred=RKe(this,e),this._updatedVisibilityFrame=n._updatedVisibilityFrame};Jo.prototype.updateExpiration=function(){if(l(this.expireDate)&&this.contentReady&&!this.hasEmptyContent&&!this.hasMultipleContents){let e=te.now(ule);te.lessThan(this.expireDate,e)&&(this._contentState=Fo.EXPIRED,this._expiredContent=this._content)}};function XKe(e){if(!l(e.expireDuration))return;let t=te.now(ule);te.addSeconds(t,e.expireDuration,t),l(e.expireDate)?te.lessThan(e.expireDate,t)&&te.clone(t,e.expireDate):e.expireDate=te.clone(t)}function IKe(e){return function(){return e._priority}}Jo.prototype.requestContent=function(){if(!this.hasEmptyContent)return this.hasMultipleContents?WKe(this):vKe(this)};function WKe(e){let t=e._content,n=e._tileset;if(!l(t)){let o=oi(e._header,\"3DTILES_multiple_contents\")?e._header.extensions[\"3DTILES_multiple_contents\"]:e._header;t=new y2(n,e,e._contentResource.clone(),o),e._content=t}let i=t.requestInnerContents();if(l(i))return e._contentState=Fo.LOADING,i.then(o=>{if(!e.isDestroyed()&&l(o))return e._contentState=Fo.PROCESSING,t}).catch(o=>{if(!e.isDestroyed())throw e._contentState=Fo.FAILED,o})}async function PKe(e,t,n,i,o){let r=e._contentState;e._contentState=Fo.LOADING,++t.statistics.numberOfPendingRequests;let s;try{s=await o}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;if(n.cancelled||n.state===Qn.CANCELLED){e._contentState=r,++t.statistics.numberOfAttemptedRequests;return}throw e._contentState=Fo.FAILED,a}if(e.isDestroyed()){--t.statistics.numberOfPendingRequests;return}if(n.cancelled||n.state===Qn.CANCELLED){e._contentState=r,--t.statistics.numberOfPendingRequests,++t.statistics.numberOfAttemptedRequests;return}try{let a=await wKe(e,s);return--t.statistics.numberOfPendingRequests,e.isDestroyed()?void 0:(i&&(e.expireDate=void 0),e._content=a,e._contentState=Fo.PROCESSING,a)}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;throw e._contentState=Fo.FAILED,a}}function vKe(e){let t=e._contentResource.clone(),n=e.contentExpired;n&&t.setQueryParameters({expired:e.expireDate.toString()});let i=new Do({throttle:!0,throttleByServer:!0,type:is.TILES3D,priorityFunction:IKe(e),serverKey:e._serverKey});e._request=i,t.request=i;let o=e._tileset,r=t.fetchArrayBuffer();if(!l(r)){++o.statistics.numberOfAttemptedRequests;return}return PKe(e,o,i,n,r)}async function wKe(e,t){let n=bf(t),i=e._tileset;i._disableSkipLevelOfDetail=i._disableSkipLevelOfDetail||n.contentType===gs.GEOMETRY||n.contentType===gs.VECTOR,(n.contentType===gs.IMPLICIT_SUBTREE||n.contentType===gs.IMPLICIT_SUBTREE_JSON)&&(e.hasImplicitContent=!0),n.contentType===gs.EXTERNAL_TILESET&&(e.hasTilesetContent=!0);let o,r=g_[n.contentType];if(e.isDestroyed())return;l(n.binaryPayload)?o=await Promise.resolve(r(i,e,e._contentResource,n.binaryPayload.buffer,0)):o=await Promise.resolve(r(i,e,e._contentResource,n.jsonPayload));let s=e._contentHeader;if(e.hasImplicitContentMetadata){let c=e.implicitSubtree,d=e.implicitCoordinates;o.metadata=c.getContentMetadataView(d,0)}else e.hasImplicitContent||(o.metadata=x_(i,s));let a=__(i,s);return l(a)&&(o.group=new Mx({metadata:a})),o}Jo.prototype.cancelRequests=function(){this.hasMultipleContents?this._content.cancelRequests():this._request.cancel()};Jo.prototype.unloadContent=function(){this.hasRenderableContent&&(this._content=this._content&&this._content.destroy(),this._contentState=Fo.UNLOADED,this.lastStyleTime=0,this.clippingPlanesDirty=this._clippingPlanesState===0,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var mle=new ce;function zH(e,t){if(t.mode!==ie.SCENE3D&&!l(e._boundingVolume2D)){let n=e._boundingVolume.boundingSphere,i=ce.projectTo2D(n,t.mapProjection,mle);e._boundingVolume2D=new b0(i.center,i.radius)}return t.mode!==ie.SCENE3D?e._boundingVolume2D:e._boundingVolume}function FKe(e,t){if(t.mode!==ie.SCENE3D&&!l(e._contentBoundingVolume2D)){let n=e._contentBoundingVolume.boundingSphere,i=ce.projectTo2D(n,t.mapProjection,mle);e._contentBoundingVolume2D=new b0(i.center,i.radius)}return t.mode!==ie.SCENE3D?e._contentBoundingVolume2D:e._contentBoundingVolume}Jo.prototype.visibility=function(e,t){let n=e.cullingVolume,i=zH(this,e),o=this._tileset,r=o.clippingPlanes;if(l(r)&&r.enabled){let s=r.computeIntersectionWithBoundingVolume(i,o.clippingPlanesOriginMatrix);if(this._isClipped=s!==nn.INSIDE,s===nn.OUTSIDE)return os.MASK_OUTSIDE}return n.computeVisibilityWithPlaneMask(i,t)};Jo.prototype.contentVisibility=function(e){if(!l(this._contentBoundingVolume))return nn.INSIDE;if(this._visibilityPlaneMask===os.MASK_INSIDE)return nn.INSIDE;let t=e.cullingVolume,n=FKe(this,e),i=this._tileset,o=i.clippingPlanes;if(l(o)&&o.enabled){let r=o.computeIntersectionWithBoundingVolume(n,i.clippingPlanesOriginMatrix);if(this._isClipped=r!==nn.INSIDE,r===nn.OUTSIDE)return nn.OUTSIDE}return t.computeVisibility(n)};Jo.prototype.distanceToTile=function(e){return zH(this,e).distanceToCamera(e)};var AKe=new h;Jo.prototype.distanceToTileCenter=function(e){let n=zH(this,e).boundingVolume,i=h.subtract(n.center,e.camera.positionWC,AKe);return h.dot(e.camera.directionWC,i)};Jo.prototype.insideViewerRequestVolume=function(e){let t=this._viewerRequestVolume;return!l(t)||t.distanceToCamera(e)===0};var hle=new $,fle=new h,MKe=new $,HH=new h,ple=new le,ble=new Zn,OH=new M;function NKe(e,t,n){let i=h.fromElements(e[0],e[1],e[2],HH),o=$.fromArray(e,3,MKe);i=M.multiplyByPoint(t,i,i);let r=M.getMatrix3(t,hle);return o=$.multiply(r,o,o),l(n)?(n.update(i,o),n):new _d(i,o)}function kKe(e,t,n,i){let o=le.unpack(e,0,ple),r=e[4],s=e[5],a=Zn.fromRectangle(o,r,s,oe.WGS84,ble),c=a.center,d=a.halfAxes;t=M.multiplyTransformation(t,M.inverseTransformation(n,OH),OH),c=M.multiplyByPoint(t,c,c);let u=M.getMatrix3(t,hle);return d=$.multiply(u,d,d),l(i)&&i instanceof _d?(i.update(c,d),i):new _d(c,d)}function UKe(e,t,n,i){if(!M.equalsEpsilon(t,n,P.EPSILON8))return kKe(e,t,n,i);let o=le.unpack(e,0,ple);return l(i)?(i.rectangle=le.clone(o,i.rectangle),i.minimumHeight=e[4],i.maximumHeight=e[5],i.computeBoundingVolumes(oe.WGS84),i):new Iu({rectangle:o,minimumHeight:e[4],maximumHeight:e[5]})}function DKe(e,t,n){let i=h.fromElements(e[0],e[1],e[2],HH),o=e[3];i=M.multiplyByPoint(t,i,i);let r=M.getScale(t,fle),s=h.maximumComponent(r);return o*=s,l(n)?(n.update(i,o),n):new b0(i,o)}Jo.prototype.createBoundingVolume=function(e,t,n){let i=this.metadata,o;if(l(i)&&(o=n_.parseBoundingVolumeSemantic(\"TILE\",i)),l(o)&&(e=o),!l(e))throw new ue(\"boundingVolume must be defined\");if(oi(e,\"3DTILES_bounding_volume_S2\"))return new C2(e.extensions[\"3DTILES_bounding_volume_S2\"]);let{box:r,region:s,sphere:a}=e;if(l(r)){let c=NKe(r,t,n);return this._verticalExaggeration!==1&&cle(c,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c}if(l(s)){let c=UKe(s,t,this._initialTransform,n);return this._verticalExaggeration===1||(c instanceof _d?cle(c,this._verticalExaggeration,this._verticalExaggerationRelativeHeight):(c.minimumHeight=pr.getHeight(c.minimumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c.maximumHeight=pr.getHeight(c.maximumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c.computeBoundingVolumes(oe.WGS84))),c}if(l(a)){let c=DKe(a,t,n);if(this._verticalExaggeration!==1){let d=pr.getPosition(c.center,oe.WGS84,this._verticalExaggeration,this._verticalExaggerationRelativeHeight,HH),u=c.radius*this._verticalExaggeration;c.update(d,u)}return c}throw new ue(\"boundingVolume must contain a sphere, region, or box\")};var BKe=h.unpackArray(new Array(8*3).fill(0));function cle(e,t,n){let i=e.boundingVolume.computeCorners(BKe).map(r=>pr.getPosition(r,oe.WGS84,t,n,r)),o=Zn.fromPoints(i,ble);e.update(o.center,o.halfAxes)}Jo.prototype.updateTransform=function(e,t){e=g(e,M.IDENTITY);let n=M.multiplyTransformation(e,this.transform,OH),i=!M.equals(n,this.computedTransform),o=l(t)&&(this._verticalExaggeration!==t.verticalExaggeration||this._verticalExaggerationRelativeHeight!==t.verticalExaggerationRelativeHeight);if(!i&&!o)return;i&&M.clone(n,this.computedTransform),o&&(this._verticalExaggeration=t.verticalExaggeration,this._verticalExaggerationRelativeHeight=t.verticalExaggerationRelativeHeight);let r=this._header,s=this._contentHeader;this._boundingVolume=this.createBoundingVolume(r.boundingVolume,this.computedTransform,this._boundingVolume),l(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(s.boundingVolume,this.computedTransform,this._contentBoundingVolume)),l(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(r.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()};Jo.prototype.updateGeometricErrorScale=function(){let e=M.getScale(this.computedTransform,fle),t=h.maximumComponent(e);if(this.geometricError=this._geometricError*t,!l(this.parent)){let n=this._tileset;n._scaledGeometricError=n._geometricError*t}};function YKe(e,t,n,i){if(!i.isRender)return;let o=l(e._contentHeader)&&l(e._contentHeader.boundingVolume),r=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!o;if(r){let c;e._finalResolution?e.hasRenderableContent?c=O.WHITE:c=O.DARKGRAY:c=O.YELLOW,l(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(c)),e._debugBoundingVolume.update(n);let d=e._debugBoundingVolume.getGeometryInstanceAttributes(\"outline\");d.color=Ot.toValue(c,d.color)}else!r&&l(e._debugBoundingVolume)&&(e._debugBoundingVolume=e._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&o?(l(e._debugContentBoundingVolume)||(e._debugContentBoundingVolume=e._contentBoundingVolume.createDebugVolume(O.BLUE)),e._debugContentBoundingVolume.update(n)):!t.debugShowContentBoundingVolume&&l(e._debugContentBoundingVolume)&&(e._debugContentBoundingVolume=e._debugContentBoundingVolume.destroy()),t.debugShowViewerRequestVolume&&l(e._viewerRequestVolume)?(l(e._debugViewerRequestVolume)||(e._debugViewerRequestVolume=e._viewerRequestVolume.createDebugVolume(O.YELLOW)),e._debugViewerRequestVolume.update(n)):!t.debugShowViewerRequestVolume&&l(e._debugViewerRequestVolume)&&(e._debugViewerRequestVolume=e._debugViewerRequestVolume.destroy());let s=t.debugColorizeTiles&&!e._debugColorizeTiles||l(t._heatmap.tilePropertyName),a=!t.debugColorizeTiles&&e._debugColorizeTiles;s?(t._heatmap.colorize(e,n),e._debugColorizeTiles=!0,e.color=e._debugColor):a&&(e._debugColorizeTiles=!1,e.color=O.WHITE),e._colorDirty&&(e._colorDirty=!1,e._content.applyDebugSettings(!0,e._color)),a&&t.makeStyleDirty()}function OKe(e,t,n){let i=e._expiredContent;if(!e.hasMultipleContents&&l(i)){if(!e.contentReady){try{i.update(t,n)}catch{}return}e._expiredContent.destroy(),e._expiredContent=void 0}if(l(e.content))try{e.content.update(t,n)}catch(o){throw e._contentState=Fo.FAILED,o}}function zKe(e,t){let n=t.clippingPlanes,i=0;l(n)&&e._isClipped&&n.enabled&&(i=n.clippingPlanesState),i!==e._clippingPlanesState&&(e._clippingPlanesState=i,e.clippingPlanesDirty=!0)}Jo.prototype.update=function(e,t,n){let{commandList:i}=t,o=i.length;zKe(this,e),YKe(this,e,t,n),OKe(this,e,t);let r=i.length;this._commandsLength=r-o;for(let s=o;s<r;++s){let a=i[s],c=a.pass===Ze.TRANSLUCENT;a.depthForTranslucentClassification=c}this.clippingPlanesDirty=!1};var lle=[];Jo.prototype.process=function(e,t){!this.contentExpired&&!this.contentReady&&this._content.ready&&(XKe(this),this._selectedFrame=0,this.lastStyleTime=0,te.now(this._loadTimestamp),this._contentState=Fo.READY,!this.hasTilesetContent&&!this.hasImplicitContent&&(e._statistics.incrementLoadCounts(this.content),++e._statistics.numberOfTilesWithContentReady,++e._statistics.numberOfLoadedTilesTotal,e._cache.add(this)));let n=t.commandList;t.commandList=lle;try{this._content.update(e,t)}catch(i){throw this._contentState=Fo.FAILED,i}lle.length=0,t.commandList=n};function dle(e,t,n){let i=e*Math.pow(10,t);return parseInt(i)*Math.pow(10,n)}function DN(e,t,n){return Math.max(P.normalize(e,t,n)-P.EPSILON7,0)}Jo.prototype.updatePriority=function(){let e=this.tileset,t=e.preferLeaves,n=e._minimumPriority,i=e._maximumPriority,o=4,r=1,s=0,a=o,c=s+a,d=o,u=c+d,m=r,p=Math.pow(10,u),b=u+m,f=r,x=Math.pow(10,b),_=b+f,C=Math.pow(10,_),V=DN(this._depth,n.depth,i.depth);V=t?1-V:V;let R=!e.isSkippingLevelOfDetail&&this.refine===vo.REPLACE?DN(this._priorityHolder._distanceToCamera,n.distance,i.distance):DN(this._priorityReverseScreenSpaceError,n.reverseScreenSpaceError,i.reverseScreenSpaceError),G=dle(R,a,s),X=this._priorityProgressiveResolution?0:p,v=DN(this._priorityHolder._foveatedFactor,n.foveatedFactor,i.foveatedFactor),W=dle(v,d,c),F=this.priorityDeferred?x:0,A=e._pass===Io.PRELOAD_FLIGHT?0:C;this._priority=V+G+X+W+F+A};Jo.prototype.isDestroyed=function(){return!1};Jo.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),me(this)};var Pu=Jo;var Z5n=T(S(),1);var p5n=T(S(),1);function y0(e){e=g(e,g.EMPTY_OBJECT);let t=e.id,n=e.group,i=e.class,o=l(n.properties)?n.properties:{};this._class=i,this._properties=o,this._id=t,this._extras=n.extras,this._extensions=n.extensions}Object.defineProperties(y0.prototype,{class:{get:function(){return this._class}},id:{get:function(){return this._id}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});y0.prototype.hasProperty=function(e){return Mn.hasProperty(e,this._properties,this._class)};y0.prototype.hasPropertyBySemantic=function(e){return Mn.hasPropertyBySemantic(e,this._properties,this._class)};y0.prototype.getPropertyIds=function(e){return Mn.getPropertyIds(this._properties,this._class,e)};y0.prototype.getProperty=function(e){return Mn.getProperty(e,this._properties,this._class)};y0.prototype.setProperty=function(e,t){return Mn.setProperty(e,t,this._properties,this._class)};y0.prototype.getPropertyBySemantic=function(e){return Mn.getPropertyBySemantic(e,this._properties,this._class)};y0.prototype.setPropertyBySemantic=function(e,t){return Mn.setPropertyBySemantic(e,t,this._properties,this._class)};var s1=y0;var _5n=T(S(),1);function"
}