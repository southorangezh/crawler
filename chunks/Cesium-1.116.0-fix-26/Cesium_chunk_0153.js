{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 153,
    "total_chunks": 194,
    "chunk_size": 50252,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.742Z"
  },
  "content": "rn?o=r.frustum.clone():(o=Fxe,o.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,o.fov=P.toRadians(60)),i.frustum=o;let s=Hxe(i);PF(this,s),Fj(this,e,i,s)}e===0&&l(this._completeMorph)&&this._completeMorph()}};FT.prototype.isDestroyed=function(){return!1};FT.prototype.destroy=function(){return t3(this),me(this)};function PF(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new Od(e._scene.canvas);let n=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=n,e._morphHandler.setInputAction(n,Tn.LEFT_DOWN),e._morphHandler.setInputAction(n,Tn.MIDDLE_DOWN),e._morphHandler.setInputAction(n,Tn.RIGHT_DOWN),e._morphHandler.setInputAction(n,Tn.WHEEL)}}function t3(e){let t=e._currentTweens;for(let n=0;n<t.length;++n)t[n].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}var fht=new he,pht=new h,bht=new M;function Axe(e,t){let n=e._scene,i=n.camera,o=Aj,r=o.position,s=o.direction,a=o.up,c=n.mapProjection.unproject(i.position,fht);t.cartographicToCartesian(c,r);let d=t.scaleToGeodeticSurface(r,pht),u=Wt.eastNorthUpToFixedFrame(d,t,bht);return M.multiplyByPointAsVector(u,i.direction,s),M.multiplyByPointAsVector(u,i.up,a),o}var yht=new h,ght=new h,xht=new h,_ht=new h,Tht=new h,Sht=new h;function Fj(e,t,n,i){t*=.5;let o=e._scene,r=o.camera,s=h.clone(r.position,yht),a=h.clone(r.direction,ght),c=h.clone(r.up,xht),d=M.multiplyByPoint(lo.TRANSFORM_2D_INVERSE,n.position,_ht),u=M.multiplyByPointAsVector(lo.TRANSFORM_2D_INVERSE,n.direction,Tht),m=M.multiplyByPointAsVector(lo.TRANSFORM_2D_INVERSE,n.up,Sht);function p(f){im(s,d,f.time,r.position),im(a,u,f.time,r.direction),im(c,m,f.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right)}let b=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){zxe(e,o,0,1,t,i)}});e._currentTweens.push(b)}var Cht=new rn,Mxe=new h,Nxe=new h,kxe=new h,Mj=new h,Uxe=new h,Dxe=new h;function Vht(e,t,n){t/=3;let i=e._scene,o=i.camera,r;t>0?(r=Aj,h.fromDegrees(0,0,5*n.maximumRadius,n,r.position),h.negate(r.position,r.direction),h.normalize(r.direction,r.direction),h.clone(h.UNIT_Z,r.up)):(o.position.z=o.frustum.right-o.frustum.left,r=Axe(e,n));let s;e._morphToOrthographic?(s=Cht,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.width=o.frustum.right-o.frustum.left):(s=Fxe,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.fov=P.toRadians(60)),r.frustum=s;let a=Hxe(r);PF(e,a);let c;e._morphToOrthographic?c=function(){Fj(e,t,r,a)}:c=function(){Yxe(e,t,r,function(){Fj(e,t,r,a)})},t>0?(i._mode=ie.SCENE2D,o.flyTo({duration:t,destination:h.fromDegrees(0,0,5*n.maximumRadius,n,Mj),complete:function(){i._mode=ie.MORPHING,c()}})):c()}function im(e,t,n,i){return h.lerp(e,t,n,i)}function Bxe(e,t,n,i,o){let r=e._scene,s=r.camera;if(s.frustum instanceof rn)return;let a=s.frustum.fov,c=P.RADIANS_PER_DEGREE*.5,d=n.position.z*Math.tan(a*.5);s.frustum.far=d/Math.tan(c*.5)+1e7;function u(p){s.frustum.fov=P.lerp(a,c,p.time);let b=d/Math.tan(s.frustum.fov*.5);i(s,b)}let m=r.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:u,complete:function(){s.frustum=n.frustum.clone(),o(e)}});e._currentTweens.push(m)}var Lht=new h,Zht=new h,Rht=new h,wj=new h,Ght=new h,Eht=new h,Xht=new Vr,Iht=new bn,Wht=new h,Pht={position:void 0,direction:void 0,up:void 0,frustum:void 0};function vht(e,t){t*=.5;let n=e._scene,i=n.camera,o=h.clone(i.position,Lht),r=h.clone(i.direction,Zht),s=h.clone(i.up,Rht),a=h.negate(h.UNIT_Z,Ght),c=h.clone(h.UNIT_Y,Eht),d=wj;if(t>0)h.clone(h.ZERO,wj),d.z=5*n.mapProjection.ellipsoid.maximumRadius;else{h.clone(o,wj);let _=Iht;M.multiplyByPoint(lo.TRANSFORM_2D,o,_.origin),M.multiplyByPointAsVector(lo.TRANSFORM_2D,r,_.direction);let C=n.globe;if(l(C)){let V=C.pickWorldCoordinates(_,n,!0,Wht);l(V)&&(M.multiplyByPoint(lo.TRANSFORM_2D_INVERSE,V,d),d.z+=h.distance(o,d))}}let u=Xht;u.right=d.z*.5,u.left=-u.right,u.top=u.right*(n.drawingBufferHeight/n.drawingBufferWidth),u.bottom=-u.top;let m=Pht;m.position=d,m.direction=a,m.up=c,m.frustum=u;let p=Kxe(m);PF(e,p);function b(_){im(o,d,_.time,i.position),im(r,a,_.time,i.direction),im(s,c,_.time,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i._adjustOrthographicFrustum(!0)}function f(_,C){_.position.z=C}let x=n.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:b,complete:function(){Bxe(e,t,m,f,p)}});e._currentTweens.push(x)}var wxe=new he,wht={position:new h,direction:new h,up:new h,position2D:new h,direction2D:new h,up2D:new h,frustum:new Vr},Fht={position:new h,direction:new h,up:new h,frustum:void 0},Aht=new h,Mht=new bn,Nht=new M,kht=new h;function Uht(e,t,n){t*=.5;let i=e._scene,o=i.camera,r=wht;if(t>0)h.clone(h.ZERO,r.position),r.position.z=5*n.maximumRadius,h.negate(h.UNIT_Z,r.direction),h.clone(h.UNIT_Y,r.up);else{n.cartesianToCartographic(o.positionWC,wxe),i.mapProjection.project(wxe,r.position),h.negate(h.UNIT_Z,r.direction),h.clone(h.UNIT_Y,r.up);let m=Mht;h.clone(r.position2D,m.origin);let p=h.clone(o.directionWC,m.direction),b=n.scaleToGeodeticSurface(o.positionWC,kht),f=Wt.eastNorthUpToFixedFrame(b,n,Nht);M.inverseTransformation(f,f),M.multiplyByPointAsVector(f,p,p),M.multiplyByPointAsVector(lo.TRANSFORM_2D,p,p);let x=i.globe;if(l(x)){let _=x.pickWorldCoordinates(m,i,!0,Aht);if(l(_)){let C=h.distance(r.position2D,_);_.x+=C,h.clone(_,r.position2D)}}}function s(m,p){m.position.x=p}M.multiplyByPoint(lo.TRANSFORM_2D,r.position,r.position2D),M.multiplyByPointAsVector(lo.TRANSFORM_2D,r.direction,r.direction2D),M.multiplyByPointAsVector(lo.TRANSFORM_2D,r.up,r.up2D);let a=r.frustum;a.right=r.position.z*.5,a.left=-a.right,a.top=a.right*(i.drawingBufferHeight/i.drawingBufferWidth),a.bottom=-a.top;let c=Fht;M.multiplyByPoint(lo.TRANSFORM_2D_INVERSE,r.position2D,c.position),h.clone(r.direction,c.direction),h.clone(r.up,c.up),c.frustum=a;let d=Kxe(c);PF(e,d);function u(){Bxe(e,t,r,s,d)}Oxe(e,t,r,u)}function Yxe(e,t,n,i){let o=e._scene,r=o.camera,s=r.frustum.right-r.frustum.left;r.frustum=n.frustum.clone();let a=r.frustum.fov,c=P.RADIANS_PER_DEGREE*.5,d=s*Math.tan(a*.5);r.frustum.far=d/Math.tan(c*.5)+1e7,r.frustum.fov=c;function u(p){r.frustum.fov=P.lerp(c,a,p.time),r.position.z=d/Math.tan(r.frustum.fov*.5)}let m=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:u,complete:function(){i(e)}});e._currentTweens.push(m)}function Dht(e,t,n,i){t*=.5;let o=e._scene,r=o.camera,s=h.clone(n.position,Mj),a=h.clone(n.direction,Uxe),c=h.clone(n.up,Dxe);o._mode=ie.MORPHING;function d(){r.frustum=n.frustum.clone();let u=h.clone(r.position,Mxe),m=h.clone(r.direction,Nxe),p=h.clone(r.up,kxe);u.z=s.z;function b(x){im(u,s,x.time,r.position),im(m,a,x.time,r.direction),im(p,c,x.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right)}let f=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:b,complete:function(){i(e)}});e._currentTweens.push(f)}e._morphToOrthographic?d():Yxe(e,0,n,d)}function Oxe(e,t,n,i){let o=e._scene,r=o.camera,s=h.clone(r.position,Mxe),a=h.clone(r.direction,Nxe),c=h.clone(r.up,kxe),d=h.clone(n.position2D,Mj),u=h.clone(n.direction2D,Uxe),m=h.clone(n.up2D,Dxe);function p(f){im(s,d,f.time,r.position),im(a,u,f.time,r.direction),im(c,m,f.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right),r._adjustOrthographicFrustum(!0)}let b=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){zxe(e,o,1,0,t,i)}});e._currentTweens.push(b)}function zxe(e,t,n,i,o,r){let s={object:t,property:\"morphTime\",startValue:n,stopValue:i,duration:o,easingFunction:Ar.QUARTIC_OUT};l(r)&&(s.complete=function(){r(e)});let a=t.tweens.addProperty(s);e._currentTweens.push(a)}function Hxe(e){return function(t){let n=t._scene;n._mode=ie.SCENE3D,n.morphTime=ie.getMorphTime(ie.SCENE3D),t3(t);let i=n.camera;(t._previousMode!==ie.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,h.clone(e.position,i.position),h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i.frustum=e.frustum.clone());let o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);let r=l(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ie.SCENE3D,r)}}function Kxe(e){return function(t){let n=t._scene;n._mode=ie.SCENE2D,n.morphTime=ie.getMorphTime(ie.SCENE2D),t3(t);let i=n.camera;h.clone(e.position,i.position),i.position.z=n.mapProjection.ellipsoid.maximumRadius*2,h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i.frustum=e.frustum.clone();let o=l(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ie.SCENE2D,o)}}function Bht(e){return function(t){let n=t._scene;n._mode=ie.COLUMBUS_VIEW,n.morphTime=ie.getMorphTime(ie.COLUMBUS_VIEW),t3(t);let i=n.camera;(t._previousModeMode!==ie.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,h.clone(e.position,i.position),h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right));let o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);let r=l(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ie.COLUMBUS_VIEW,r)}}var vF=FT;var S9i=T(S(),1);var NFi=T(S(),1);var EFi=T(S(),1),Yht={LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4},Ti=Object.freeze(Yht);function Na(e,t){let n=e;return l(t)&&(n+=`+${t}`),n}function Oht(e,t){D.clone(e.distance.startPosition,t.distance.startPosition),D.clone(e.distance.endPosition,t.distance.endPosition),D.clone(e.angleAndHeight.startPosition,t.angleAndHeight.startPosition),D.clone(e.angleAndHeight.endPosition,t.angleAndHeight.endPosition)}function Jxe(e,t,n){let i=Na(Ti.PINCH,t),o=e._update,r=e._isDown,s=e._eventStartPosition,a=e._pressTime,c=e._releaseTime;o[i]=!0,r[i]=!1,s[i]=new D;let d=e._movement[i];l(d)||(d=e._movement[i]={}),d.distance={startPosition:new D,endPosition:new D},d.angleAndHeight={startPosition:new D,endPosition:new D},d.prevAngle=0,e._eventHandler.setInputAction(function(u){e._buttonsDown++,r[i]=!0,a[i]=new Date,D.lerp(u.position1,u.position2,.5,s[i])},Tn.PINCH_START,t),e._eventHandler.setInputAction(function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[i]=!1,c[i]=new Date},Tn.PINCH_END,t),e._eventHandler.setInputAction(function(u){if(r[i]){o[i]?(Oht(u,d),o[i]=!1,d.prevAngle=d.angleAndHeight.startPosition.x):(D.clone(u.distance.endPosition,d.distance.endPosition),D.clone(u.angleAndHeight.endPosition,d.angleAndHeight.endPosition));let m=d.angleAndHeight.endPosition.x,p=d.prevAngle,b=Math.PI*2;for(;m>=p+Math.PI;)m-=b;for(;m<p-Math.PI;)m+=b;d.angleAndHeight.endPosition.x=-m*n.clientWidth/12,d.angleAndHeight.startPosition.x=-p*n.clientWidth/12}},Tn.PINCH_MOVE,t)}function Qxe(e,t){let n=Na(Ti.WHEEL,t),i=e._pressTime,o=e._releaseTime,r=e._update;r[n]=!0;let s=e._movement[n];l(s)||(s=e._movement[n]={});let a=e._lastMovement[n];l(a)||(a=e._lastMovement[n]={startPosition:new D,endPosition:new D,valid:!1}),s.startPosition=new D,D.clone(D.ZERO,s.startPosition),s.endPosition=new D,e._eventHandler.setInputAction(function(c){let d=7.5*P.toRadians(c);i[n]=o[n]=new Date,s.endPosition.x=0,s.endPosition.y=d,D.clone(s.endPosition,a.endPosition),a.valid=!0,r[n]=!1},Tn.WHEEL,t)}function HV(e,t,n){let i=Na(n,t),o=e._isDown,r=e._eventStartPosition,s=e._pressTime,a=e._releaseTime;o[i]=!1,r[i]=new D;let c=e._lastMovement[i];l(c)||(c=e._lastMovement[i]={startPosition:new D,endPosition:new D,valid:!1});let d,u;n===Ti.LEFT_DRAG?(d=Tn.LEFT_DOWN,u=Tn.LEFT_UP):n===Ti.RIGHT_DRAG?(d=Tn.RIGHT_DOWN,u=Tn.RIGHT_UP):n===Ti.MIDDLE_DRAG&&(d=Tn.MIDDLE_DOWN,u=Tn.MIDDLE_UP),e._eventHandler.setInputAction(function(m){e._buttonsDown++,c.valid=!1,o[i]=!0,s[i]=new Date,D.clone(m.position,r[i])},d,t),e._eventHandler.setInputAction(function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),o[i]=!1,a[i]=new Date},u,t)}function jxe(e,t){D.clone(e.startPosition,t.startPosition),D.clone(e.endPosition,t.endPosition)}function qxe(e,t){let n=e._update,i=e._movement,o=e._lastMovement,r=e._isDown;for(let s in Ti)if(Ti.hasOwnProperty(s)){let a=Ti[s];if(l(a)){let c=Na(a,t);n[c]=!0,l(e._lastMovement[c])||(e._lastMovement[c]={startPosition:new D,endPosition:new D,valid:!1}),l(e._movement[c])||(e._movement[c]={startPosition:new D,endPosition:new D})}}e._eventHandler.setInputAction(function(s){for(let a in Ti)if(Ti.hasOwnProperty(a)){let c=Ti[a];if(l(c)){let d=Na(c,t);r[d]&&(n[d]?(jxe(i[d],o[d]),o[d].valid=!0,jxe(s,i[d]),n[d]=!1):D.clone(s.endPosition,i[d].endPosition))}}D.clone(s.endPosition,e._currentMousePosition)},Tn.MOUSE_MOVE,t)}function om(e){this._eventHandler=new Od(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new D,Qxe(this,void 0),Jxe(this,void 0,e),HV(this,void 0,Ti.LEFT_DRAG),HV(this,void 0,Ti.RIGHT_DRAG),HV(this,void 0,Ti.MIDDLE_DRAG),qxe(this,void 0);for(let t in Rs)if(Rs.hasOwnProperty(t)){let n=Rs[t];l(n)&&(Qxe(this,n),Jxe(this,n,e),HV(this,n,Ti.LEFT_DRAG),HV(this,n,Ti.RIGHT_DRAG),HV(this,n,Ti.MIDDLE_DRAG),qxe(this,n))}}Object.defineProperties(om.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){let e=!this._update[Na(Ti.WHEEL)]||!this._update[Na(Ti.WHEEL,Rs.SHIFT)]||!this._update[Na(Ti.WHEEL,Rs.CTRL)]||!this._update[Na(Ti.WHEEL,Rs.ALT)]||!this._update[Na(Ti.WHEEL,Rs.META)];return this._buttonsDown>0||e}}});om.prototype.isMoving=function(e,t){let n=Na(e,t);return!this._update[n]};om.prototype.getMovement=function(e,t){let n=Na(e,t);return this._movement[n]};om.prototype.getLastMovement=function(e,t){let n=Na(e,t),i=this._lastMovement[n];if(i.valid)return i};om.prototype.isButtonDown=function(e,t){let n=Na(e,t);return this._isDown[n]};om.prototype.getStartMousePosition=function(e,t){if(e===Ti.WHEEL)return this._currentMousePosition;let n=Na(e,t);return this._eventStartPosition[n]};om.prototype.getButtonPressTime=function(e,t){let n=Na(e,t);return this._pressTime[n]};om.prototype.getButtonReleaseTime=function(e,t){let n=Na(e,t);return this._releaseTime[n]};om.prototype.reset=function(){for(let e in this._update)this._update.hasOwnProperty(e)&&(this._update[e]=!0)};om.prototype.isDestroyed=function(){return!1};om.prototype.destroy=function(){return this._eventHandler=this._eventHandler&&this._eventHandler.destroy(),me(this)};var wF=om;var KFi=T(S(),1);function n3(e,t,n,i,o,r,s,a,c,d){this._tweens=e,this._tweenjs=t,this._startObject=Oe(n),this._stopObject=Oe(i),this._duration=o,this._delay=r,this._easingFunction=s,this._update=a,this._complete=c,this.cancel=d,this.needsStart=!0}Object.defineProperties(n3.prototype,{startObject:{get:function(){return this._startObject}},stopObject:{get:function(){return this._stopObject}},duration:{get:function(){return this._duration}},delay:{get:function(){return this._delay}},easingFunction:{get:function(){return this._easingFunction}},update:{get:function(){return this._update}},complete:{get:function(){return this._complete}},tweenjs:{get:function(){return this._tweenjs}}});n3.prototype.cancelTween=function(){this._tweens.remove(this)};function Gh(){this._tweens=[]}Object.defineProperties(Gh.prototype,{length:{get:function(){return this._tweens.length}}});Gh.prototype.add=function(e){if(e=g(e,g.EMPTY_OBJECT),e.duration===0)return l(e.complete)&&e.complete(),new n3(this);let t=e.duration/Hn.SECONDS_PER_MILLISECOND,n=g(e.delay,0),i=n/Hn.SECONDS_PER_MILLISECOND,o=g(e.easingFunction,Ar.LINEAR_NONE),r=e.startObject,s=new G0e(r);s.to(Oe(e.stopObject),t),s.delay(i),s.easing(o),l(e.update)&&s.onUpdate(function(){e.update(r)}),s.onComplete(g(e.complete,null)),s.repeat(g(e._repeat,0));let a=new n3(this,s,e.startObject,e.stopObject,e.duration,n,o,e.update,e.complete,e.cancel);return this._tweens.push(a),a};Gh.prototype.addProperty=function(e){e=g(e,g.EMPTY_OBJECT);let t=e.object,n=e.property,i=e.startValue,o=e.stopValue;function r(s){t[n]=s.value}return this.add({startObject:{value:i},stopObject:{value:o},duration:g(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:r,complete:e.complete,cancel:e.cancel,_repeat:e._repeat})};Gh.prototype.addAlpha=function(e){e=g(e,g.EMPTY_OBJECT);let t=e.material,n=[];for(let o in t.uniforms)t.uniforms.hasOwnProperty(o)&&l(t.uniforms[o])&&l(t.uniforms[o].alpha)&&n.push(o);function i(o){let r=n.length;for(let s=0;s<r;++s)t.uniforms[n[s]].alpha=o.alpha}return this.add({startObject:{alpha:g(e.startValue,0)},stopObject:{alpha:g(e.stopValue,1)},duration:g(e.duration,3),delay:e.delay,easingFunction:e.easingFunction,update:i,complete:e.complete,cancel:e.cancel})};Gh.prototype.addOffsetIncrement=function(e){e=g(e,g.EMPTY_OBJECT);let n=e.material.uniforms;return this.addProperty({object:n,property:\"offset\",startValue:n.offset,stopValue:n.offset+1,duration:e.duration,delay:e.delay,easingFunction:e.easingFunction,update:e.update,cancel:e.cancel,_repeat:1/0})};Gh.prototype.remove=function(e){if(!l(e))return!1;let t=this._tweens.indexOf(e);return t!==-1?(e.tweenjs.stop(),l(e.cancel)&&e.cancel(),this._tweens.splice(t,1),!0):!1};Gh.prototype.removeAll=function(){let e=this._tweens;for(let t=0;t<e.length;++t){let n=e[t];n.tweenjs.stop(),l(n.cancel)&&n.cancel()}e.length=0};Gh.prototype.contains=function(e){return l(e)&&this._tweens.indexOf(e)!==-1};Gh.prototype.get=function(e){return this._tweens[e]};Gh.prototype.update=function(e){let t=this._tweens,n=0;for(e=l(e)?e/Hn.SECONDS_PER_MILLISECOND:fi();n<t.length;){let i=t[n],o=i.tweenjs;i.needsStart?(i.needsStart=!1,o.start(e)):o.update(e)?n++:(o.stop(),t.splice(n,1))}};var AT=Gh;function AF(e){this.enableInputs=!0,this.enableTranslate=!0,this.enableZoom=!0,this.enableRotate=!0,this.enableTilt=!0,this.enableLook=!0,this.inertiaSpin=.9,this.inertiaTranslate=.9,this.inertiaZoom=.8,this.maximumMovementRatio=.1,this.bounceAnimationTime=3,this.minimumZoomDistance=1,this.maximumZoomDistance=Number.POSITIVE_INFINITY,this.translateEventTypes=Ti.LEFT_DRAG,this.zoomEventTypes=[Ti.RIGHT_DRAG,Ti.WHEEL,Ti.PINCH],this.rotateEventTypes=Ti.LEFT_DRAG,this.tiltEventTypes=[Ti.MIDDLE_DRAG,Ti.PINCH,{eventType:Ti.LEFT_DRAG,modifier:Rs.CTRL},{eventType:Ti.RIGHT_DRAG,modifier:Rs.CTRL}],this.lookEventTypes={eventType:Ti.LEFT_DRAG,modifier:Rs.SHIFT},this.minimumPickingTerrainHeight=15e4,this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight,this.minimumPickingTerrainDistanceWithInertia=4e3,this.minimumCollisionTerrainHeight=15e3,this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight,this.minimumTrackBallHeight=75e5,this._minimumTrackBallHeight=this.minimumTrackBallHeight,this.enableCollisionDetection=!0,this.enableOrthographicFrustumZoomAdjustment=!0,this._scene=e,this._globe=void 0,this._ellipsoid=void 0,this._lastGlobeHeight=0,this._aggregator=new wF(e.canvas),this._lastInertiaSpinMovement=void 0,this._lastInertiaZoomMovement=void 0,this._lastInertiaTranslateMovement=void 0,this._lastInertiaTiltMovement=void 0,this._inertiaDisablers={_lastInertiaZoomMovement:[\"_lastInertiaSpinMovement\",\"_lastInertiaTranslateMovement\",\"_lastInertiaTiltMovement\"],_lastInertiaTiltMovement:[\"_lastInertiaSpinMovement\",\"_lastInertiaTranslateMovement\"]},this._tweens=new AT,this._tween=void 0,this._horizontalRotationAxis=void 0,this._tiltCenterMousePosition=new D(-1,-1),this._tiltCenter=new h,this._rotateMousePosition=new D(-1,-1),this._rotateStartPosition=new h,this._strafeStartPosition=new h,this._strafeMousePosition=new D,this._strafeEndMousePosition=new D,this._zoomMouseStart=new D(-1,-1),this._zoomWorldPosition=new h,this._useZoomWorldPosition=!1,this._panLastMousePosition=new D,this._panLastWorldPosition=new h,this._tiltCVOffMap=!1,this._looking=!1,this._rotating=!1,this._strafing=!1,this._zoomingOnVector=!1,this._zoomingUnderground=!1,this._rotatingZoom=!1,this._adjustedHeightForTerrain=!1,this._cameraUnderground=!1;let t=e.mapProjection;this._maxCoord=t.project(new he(Math.PI,P.PI_OVER_TWO)),this._zoomFactor=5,this._rotateFactor=void 0,this._rotateRateRangeAdjustment=void 0,this._maximumRotateRate=1.77,this._minimumRotateRate=1/5e3,this._minimumZoomRate=20,this._maximumZoomRate=5906376272e3,this._minimumUndergroundPickDistance=2e3,this._maximumUndergroundPickDistance=1e4}function zht(e,t){if(e<0)return 0;let n=(1-t)*25;return Math.exp(-n*e)}function Hht(e){return D.equalsEpsilon(e.startPosition,e.endPosition,P.EPSILON14)}var Kht=.4;function Jht(e,t,n,i,o,r,s){let a=r[s];l(a)||(a=r[s]={startPosition:new D,endPosition:new D,motion:new D,inertiaEnabled:!0});let c=e.getButtonPressTime(t,n),d=e.getButtonReleaseTime(t,n),u=c&&d&&(d.getTime()-c.getTime())/1e3,p=d&&(new Date().getTime()-d.getTime())/1e3;if(c&&d&&u<Kht){let b=zht(p,i),f=e.getLastMovement(t,n);if(!l(f)||Hht(f)||!a.inertiaEnabled||(a.motion.x=(f.endPosition.x-f.startPosition.x)*.5,a.motion.y=(f.endPosition.y-f.startPosition.y)*.5,a.startPosition=D.clone(f.startPosition,a.startPosition),a.endPosition=D.multiplyByScalar(a.motion,b,a.endPosition),a.endPosition=D.add(a.startPosition,a.endPosition,a.endPosition),isNaN(a.endPosition.x)||isNaN(a.endPosition.y)||D.distance(a.startPosition,a.endPosition)<.5))return;if(!e.isButtonDown(t,n)){let x=e.getStartMousePosition(t,n);o(r,x,a)}}}function Qht(e,t){if(l(t)){let n=e[t];l(n)&&(n.inertiaEnabled=!0);let i=e._inertiaDisablers[t];if(l(i)){let o=i.length;for(let r=0;r<o;++r)n=e[i[r]],l(n)&&(n.inertiaEnabled=!1)}}}var $xe=[];function al(e,t,n,i,o,r){if(!l(n))return;let s=e._aggregator;Array.isArray(n)||($xe[0]=n,n=$xe);let a=n.length;for(let c=0;c<a;++c){let d=n[c],u=l(d.eventType)?d.eventType:d,m=d.modifier,p=s.isMoving(u,m)&&s.getMovement(u,m),b=s.getStartMousePosition(u,m);e.enableInputs&&t&&(p?(i(e,b,p),Qht(e,r)):o<1&&Jht(s,u,m,o,i,e,r))}}var i3=new bn,jht=new h,qht=new D,$ht=new h,eft=new D,tft=new h,nft=new h,ift=new h,oft=new h,u_e=new h,rft=new h,sft=new h,aft=new h,cft=new h,lft=new h,dft=new h,uft=new h,mft=new h,hft=new h,fft=new h,MT=new h,e_e=new h,t_e=new h,Nj={orientation:new ja};function Hj(e,t,n,i,o,r){let s=1;l(r)&&(s=P.clamp(Math.abs(r),.25,1));let a=n.endPosition.y-n.startPosition.y,d=a>0?e.minimumZoomDistance*s:0,u=e.maximumZoomDistance,m=o-d,p=i*m;p=P.clamp(p,e._minimumZoomRate,e._maximumZoomRate);let b=a/e._scene.canvas.clientHeight;b=Math.min(b,e.maximumMovementRatio);let f=p*b;if(e.enableCollisionDetection||e.minimumZoomDistance===0||!l(e._globe)){if(f>0&&Math.abs(o-d)<1||f<0&&Math.abs(o-u)<1)return;o-f<d?f=o-d-1:o-f>u&&(f=o-u)}let x=e._scene,_=x.camera,C=x.mode,V=Nj.orientation;if(V.heading=_.heading,V.pitch=_.pitch,V.roll=_.roll,e.enableOrthographicFrustumZoomAdjustment&&_.frustum instanceof rn){Math.abs(f)>0&&(_.zoomIn(f),_._adjustOrthographicFrustum(!0));return}let L=g(n.inertiaEnabled,D.equals(t,e._zoomMouseStart)),R=e._zoomingOnVector,G=e._rotatingZoom,X;if(L||(e._zoomMouseStart=D.clone(t,e._zoomMouseStart),l(e._globe)&&C===ie.SCENE2D?(X=_.getPickRay(t,i3).origin,X=h.fromElements(X.y,X.z,X.x)):l(e._globe)&&(X=ab(e,t,jht)),l(X)?(e._useZoomWorldPosition=!0,e._zoomWorldPosition=h.clone(X,e._zoomWorldPosition)):e._useZoomWorldPosition=!1,R=e._zoomingOnVector=!1,G=e._rotatingZoom=!1,e._zoomingUnderground=e._cameraUnderground),!e._useZoomWorldPosition){_.zoomIn(f);return}let v=C===ie.COLUMBUS_VIEW;if(_.positionCartographic.height<2e6&&(G=!0),!L||G){if(C===ie.SCENE2D){let W=e._zoomWorldPosition,F=_.position;if(!h.equals(W,F)&&_.positionCartographic.height<e._maxCoord.x*2){let A=_.position.x,y=h.subtract(W,F,$ht);h.normalize(y,y);let Z=h.distance(W,F)*f/(_.getMagnitude()*.5);_.move(y,Z*.5),(_.position.x<0&&A>0||_.position.x>0&&A<0)&&(X=_.getPickRay(t,i3).origin,X=h.fromElements(X.y,X.z,X.x),e._zoomWorldPosition=h.clone(X,e._zoomWorldPosition))}}else if(C===ie.SCENE3D){let W=h.normalize(_.position,u_e);if(e._cameraUnderground||e._zoomingUnderground||_.positionCartographic.height<3e3&&Math.abs(h.dot(_.direction,W))<.6)v=!0;else{let F=x.canvas,A=eft;A.x=F.clientWidth/2,A.y=F.clientHeight/2;let y=ab(e,A,tft);if(!l(y))v=!0;else if(_.positionCartographic.height<1e6)if(h.dot(_.direction,W)>=-.5)v=!0;else{let Z=sft;h.clone(_.position,Z);let E=e._zoomWorldPosition,I=rft;if(I=h.normalize(E,I),h.dot(I,W)<0)return;let w=fft,k=lft;h.clone(_.direction,k),h.add(Z,h.multiplyByScalar(k,1e3,MT),w);let B=dft,U=uft;h.subtract(E,Z,B),h.normalize(B,U);let Y=h.dot(W,U);if(Y>=0){e._zoomMouseStart.x=-1;return}let N=Math.acos(-Y),J=h.magnitude(Z),z=h.magnitude(E),ee=J-f,H=h.magnitude(B),j=Math.asin(P.clamp(H/z*Math.sin(N),-1,1)),q=Math.asin(P.clamp(ee/z*Math.sin(N),-1,1)),pe=j-q+N,_e=aft;h.normalize(Z,_e);let ae=cft;ae=h.cross(U,_e,ae),ae=h.normalize(ae,ae),h.normalize(h.cross(_e,ae,MT),k),h.multiplyByScalar(h.normalize(w,MT),h.magnitude(w)-f,w),h.normalize(Z,Z),h.multiplyByScalar(Z,ee,Z);let ye=mft;h.multiplyByScalar(h.add(h.multiplyByScalar(_e,Math.cos(pe)-1,e_e),h.multiplyByScalar(k,Math.sin(pe),t_e),MT),ee,ye),h.add(Z,ye,Z),h.normalize(w,_e),h.normalize(h.cross(_e,ae,MT),k);let Te=hft;h.multiplyByScalar(h.add(h.multiplyByScalar(_e,Math.cos(pe)-1,e_e),h.multiplyByScalar(k,Math.sin(pe),t_e),MT),h.magnitude(w),Te),h.add(w,Te,w),h.clone(Z,_.position),h.normalize(h.subtract(w,Z,MT),_.direction),h.clone(_.direction,_.direction),h.cross(_.direction,_.up,_.right),h.cross(_.right,_.direction,_.up),_.setView(Nj);return}else{let Z=h.normalize(y,nft),E=h.normalize(e._zoomWorldPosition,ift),I=h.dot(E,Z);if(I>0&&I<1){let w=P.acosClamped(I),k=h.cross(E,Z,oft),B=Math.abs(w)>P.toRadians(20)?_.positionCartographic.height*.75:_.positionCartographic.height-f,U=f/B;_.rotate(k,w*U)}}}}e._rotatingZoom=!v}if(!L&&v||R){let W,F=Zi.wgs84ToWindowCoordinates(x,e._zoomWorldPosition,qht);C!==ie.COLUMBUS_VIEW&&D.equals(t,e._zoomMouseStart)&&l(F)?W=_.getPickRay(F,i3):W=_.getPickRay(t,i3);let A=W.direction;(C===ie.COLUMBUS_VIEW||C===ie.SCENE2D)&&h.fromElements(A.y,A.z,A.x,A),_.move(A,f),e._zoomingOnVector=!0}else _.zoomIn(f);e._cameraUnderground||_.setView(Nj)}var pft=new bn,bft=new bn,yft=new h;function gft(e,t,n){let o=e._scene.camera,r=o.getPickRay(n.startPosition,pft).origin,s=o.getPickRay(n.endPosition,bft).origin;r=h.fromElements(r.y,r.z,r.x,r),s=h.fromElements(s.y,s.z,s.x,s);let a=h.subtract(r,s,yft),c=h.magnitude(a);c>0&&(h.normalize(a,a),o.move(a,c))}function n_e(e,t,n){l(n.distance)&&(n=n.distance);let o=e._scene.camera;Hj(e,t,n,e._zoomFactor,o.getMagnitude())}var xft=new D,_ft=new D;function i_e(e,t,n){if(l(n.angleAndHeight)){Tft(e,t,n.angleAndHeight);return}let i=e._scene,o=i.camera,r=i.canvas,s=r.clientWidth,a=r.clientHeight,c=xft;c.x=2/s*n.startPosition.x-1,c.y=2/a*(a-n.startPosition.y)-1,c=D.normalize(c,c);let d=_ft;d.x=2/s*n.endPosition.x-1,d.y=2/a*(a-n.endPosition.y)-1,d=D.normalize(d,d);let u=P.acosClamped(c.x);c.y<0&&(u=P.TWO_PI-u);let m=P.acosClamped(d.x);d.y<0&&(m=P.TWO_PI-m);let p=m-u;o.twistRight(p)}function Tft(e,t,n){let i=e._rotateFactor*e._rotateRateRangeAdjustment;i>e._maximumRotateRate&&(i=e._maximumRotateRate),i<e._minimumRotateRate&&(i=e._minimumRotateRate);let o=e._scene,r=o.camera,s=o.canvas,a=(n.endPosition.x-n.startPosition.x)/s.clientWidth;a=Math.min(a,e.maximumMovementRatio);let c=i*a*Math.PI*4;r.twistRight(c)}function Sft(e){let t=e._scene.mapMode2D===Jl.ROTATE;M.equals(M.IDENTITY,e._scene.camera.transform)?(al(e,e.enableTranslate,e.translateEventTypes,gft,e.inertiaTranslate,\"_lastInertiaTranslateMovement\"),al(e,e.enableZoom,e.zoomEventTypes,n_e,e.inertiaZoom,\"_lastInertiaZoomMovement\"),t&&al(e,e.enableRotate,e.tiltEventTypes,i_e,e.inertiaSpin,\"_lastInertiaTiltMovement\")):(al(e,e.enableZoom,e.zoomEventTypes,n_e,e.inertiaZoom,\"_lastInertiaZoomMovement\"),t&&al(e,e.enableRotate,e.translateEventTypes,i_e,e.inertiaSpin,\"_lastInertiaSpinMovement\"))}var m_e=new bn,Cft=new h,Vft=new h;function ab(e,t,n){let i=e._scene,o=e._globe,r=i.camera,s;if(i.pickPositionSupported&&(s=i.pickPositionWorldCoordinates(t,Cft)),!l(o))return h.clone(s,n);let a=!e._cameraUnderground,c=r.getPickRay(t,m_e),d=o.pickWorldCoordinates(c,i,a,Vft),u=l(s)?h.distance(s,r.positionWC):Number.POSITIVE_INFINITY,m=l(d)?h.distance(d,r.positionWC):Number.POSITIVE_INFINITY;return u<m?h.clone(s,n):h.clone(d,n)}var Lft=new he;function d3(e){let t=e._ellipsoid,n=e._scene,i=n.camera,o=n.mode,r=0;if(o===ie.SCENE3D){let c=t.cartesianToCartographic(i.position,Lft);l(c)&&(r=c.height)}else r=i.position.z;let s=g(e._scene.globeHeight,0);return Math.abs(s-r)}var Zft=new h;function h_e(e,t){let n=t.origin,i=t.direction,o=d3(e),r=h.normalize(n,Zft),s=Math.abs(h.dot(r,i));return s=Math.max(s,.5)*2,o*s}function f_e(e,t,n,i){let o=h.distance(t.origin,n),r=d3(e),s=P.clamp(r*5,e._minimumUndergroundPickDistance,e._maximumUndergroundPickDistance);return o>s&&(o=Math.min(o,r/5),o=Math.max(o,100)),bn.getPoint(t,o,i)}function p_e(e,t,n,i){let o;return l(n)?(o=h.distance(t.origin,n),o>e._maximumUndergroundPickDistance&&(o=d3(e))):o=d3(e),bn.getPoint(t,o,i)}var Rft=new D;function b_e(e,t){let n=t.endPosition,i=D.subtract(t.endPosition,t.startPosition,Rft),o=e._strafeEndMousePosition;D.add(o,i,o),t.endPosition=o,Kj(e,t,e._strafeStartPosition),t.endPosition=n}var o_e=new bn,Gft=new bn,kj=new h,Eft=new h,Xft=new h,Ift=new h,Wft=new an(h.UNIT_X,0),Pft=new D,vft=new D;function wft(e,t,n){if(h.equals(t,e._translateMousePosition)||(e._looking=!1),h.equals(t,e._strafeMousePosition)||(e._strafing=!1),e._looking){Hd(e,t,n);return}if(e._strafing){b_e(e,n);return}let o=e._scene.camera,r=e._cameraUnderground,s=D.clone(n.startPosition,Pft),a=D.clone(n.endPosition,vft),c=o.getPickRay(s,o_e),d=h.clone(h.ZERO,Ift),u=h.UNIT_X,m;if(o.position.z<e._minimumPickingTerrainHeight&&(m=ab(e,s,kj),l(m)&&(d.x=m.x)),r||d.x>o.position.z&&l(m)){let L=m;r&&(L=p_e(e,c,m,kj)),D.clone(t,e._strafeMousePosition),D.clone(t,e._strafeEndMousePosition),h.clone(L,e._strafeStartPosition),e._strafing=!0,Kj(e,n,e._strafeStartPosition);return}let p=an.fromPointNormal(d,u,Wft);c=o.getPickRay(s,o_e);let b=jn.rayPlane(c,p,kj),f=o.getPickRay(a,Gft),x=jn.rayPlane(f,p,Eft);if(!l(b)||!l(x)){e._looking=!0,Hd(e,t,n),D.clone(t,e._translateMousePosition);return}let _=h.subtract(b,x,Xft),C=_.x;_.x=_.y,_.y=_.z,_.z=C;let V=h.magnitude(_);V>P.EPSILON6&&(h.normalize(_,_),o.move(_,V))}var y_e=new D,s3=new bn,a3=new h,Fft=new h,g_e=new M,Aft=new M,Mft=new h,Nft=new an(h.UNIT_X,0),Uj=new h,Yj=new he,x_e=new M,kft=new Fe,Uft=new $,c3=new h;function Dft(e,t,n){if(l(n.angleAndHeight)&&(n=n.angleAndHeight),D.equals(t,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1),e._looking){Hd(e,t,n);return}let o=e._scene.camera;e._tiltCVOffMap||!e.onMap()||Math.abs(o.position.z)>e._minimumPickingTerrainHeight?(e._tiltCVOffMap=!0,Bft(e,t,n)):Yft(e,t,n)}function Bft(e,t,n){let i=e._scene,o=i.camera,r=i.canvas,s=y_e;s.x=r.clientWidth/2,s.y=r.clientHeight/2;let a=o.getPickRay(s,s3),c=h.UNIT_X,d=a.origin,u=a.direction,m,p=h.dot(c,u);if(Math.abs(p)>P.EPSILON6&&(m=-h.dot(c,d)/p),!l(m)||m<=0){e._looking=!0,Hd(e,t,n),D.clone(t,e._tiltCenterMousePosition);return}let b=h.multiplyByScalar(u,m,a3);h.add(d,b,b);let f=i.mapProjection,x=f.ellipsoid;h.fromElements(b.y,b.z,b.x,b);let _=f.unproject(b,Yj);x.cartographicToCartesian(_,b);let C=Wt.eastNorthUpToFixedFrame(b,x,g_e),V=e._globe,L=e._ellipsoid;e._globe=void 0,e._ellipsoid=oe.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let R=M.clone(o.transform,x_e);o._setTransform(C),zd(e,t,n,h.UNIT_Z),o._setTransform(R),e._globe=V,e._ellipsoid=L;let G=L.maximumRadius;e._rotateFactor=1/G,e._rotateRateRangeAdjustment=G}function Yft(e,t,n){let i=e._scene,o=i.camera,r=e._cameraUnderground,s,a,c=h.UNIT_X;if(D.equals(t,e._tiltCenterMousePosition))s=h.clone(e._tiltCenter,a3);else{if(o.position.z<e._minimumPickingTerrainHeight&&(s=ab(e,t,a3)),!l(s)){a=o.getPickRay(t,s3);let y=a.origin,Z=a.direction,E,I=h.dot(c,Z);if(Math.abs(I)>P.EPSILON6&&(E=-h.dot(c,y)/I),!l(E)||E<=0){e._looking=!0,Hd(e,t,n),D.clone(t,e._tiltCenterMousePosition);return}s=h.multiplyByScalar(Z,E,a3),h.add(y,s,s)}r&&(l(a)||(a=o.getPickRay(t,s3)),f_e(e,a,s,s)),D.clone(t,e._tiltCenterMousePosition),h.clone(s,e._tiltCenter)}let d=i.canvas,u=y_e;u.x=d.clientWidth/2,u.y=e._tiltCenterMousePosition.y,a=o.getPickRay(u,s3);let m=h.clone(h.ZERO,Mft);m.x=s.x;let p=an.fromPointNormal(m,c,Nft),b=jn.rayPlane(a,p,Fft),f=o._projection,x=f.ellipsoid;h.fromElements(s.y,s.z,s.x,s);let _=f.unproject(s,Yj);x.cartographicToCartesian(_,s);let C=Wt.eastNorthUpToFixedFrame(s,x,g_e),V;l(b)?(h.fromElements(b.y,b.z,b.x,b),_=f.unproject(b,Yj),x.cartographicToCartesian(_,b),V=Wt.eastNorthUpToFixedFrame(b,x,Aft)):V=C;let L=e._globe,R=e._ellipsoid;e._globe=void 0,e._ellipsoid=oe.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let G=h.UNIT_Z,X=M.clone(o.transform,x_e);o._setTransform(C);let v=h.cross(h.UNIT_Z,h.normalize(o.position,Uj),Uj),W=h.dot(o.right,v);if(zd(e,t,n,G,!1,!0),o._setTransform(V),W<0){let y=n.startPosition.y-n.endPosition.y;(r&&y<0||!r&&y>0)&&(G=void 0);let Z=o.constrainedAxis;o.constrainedAxis=void 0,zd(e,t,n,G,!0,!1),o.constrainedAxis=Z}else zd(e,t,n,G,!0,!1);if(l(o.constrainedAxis)){let y=h.cross(o.direction,o.constrainedAxis,c3);h.equalsEpsilon(y,h.ZERO,P.EPSILON6)||(h.dot(y,o.right)<0&&h.negate(y,y),h.cross(y,o.direction,o.up),h.cross(o.direction,o.up,o.right),h.normalize(o.up,o.up),h.normalize(o.right,o.right))}o._setTransform(X),e._globe=L,e._ellipsoid=R;let F=R.maximumRadius;e._rotateFactor=1/F,e._rotateRateRangeAdjustment=F;let A=h.clone(o.positionWC,Uj);if(e.enableCollisionDetection&&jj(e,!0),!h.equals(o.positionWC,A)){o._setTransform(V),o.worldToCameraCoordinatesPoint(A,A);let y=h.magnitudeSquared(A);h.magnitudeSquared(o.position)>y&&(h.normalize(o.position,o.position),h.multiplyByScalar(o.position,Math.sqrt(y),o.position));let Z=h.angleBetween(A,o.position),E=h.cross(A,o.position,A);h.normalize(E,E);let I=Fe.fromAxisAngle(E,Z,kft),w=$.fromQuaternion(I,Uft);$.multiplyByVector(w,o.direction,o.direction),$.multiplyByVector(w,o.up,o.up),h.cross(o.direction,o.up,o.right),h.cross(o.right,o.direction,o.up),o._setTransform(X)}}var __e=new D,T_e=new bn,S_e=new h;function Oft(e,t,n){l(n.distance)&&(n=n.distance);let i=e._scene,o=i.camera,r=i.canvas,s=e._cameraUnderground,a;s?a=t:(a=__e,a.x=r.clientWidth/2,a.y=r.clientHeight/2);let c=o.getPickRay(a,T_e),d=c.origin,u=c.direction,m=o.position.z,p;m<e._minimumPickingTerrainHeight&&(p=ab(e,a,S_e));let b;if(l(p)&&(b=h.distance(d,p)),s){let f=h_e(e,c,m);l(b)?b=Math.min(b,f):b=f}if(!l(b)){let f=h.UNIT_X;b=-h.dot(f,d)/h.dot(f,u)}Hj(e,t,n,e._zoomFactor,b)}function zft(e){let n=e._scene.camera;if(!M.equals(M.IDENTITY,n.transform))al(e,e.enableRotate,e.rotateEventTypes,zd,e.inertiaSpin,\"_lastInertiaSpinMovement\"),al(e,e.enableZoom,e.zoomEventTypes,V_e,e.inertiaZoom,\"_lastInertiaZoomMovement\");else{let i=e._tweens;if(e._aggregator.anyButtonDown&&i.removeAll(),al(e,e.enableTilt,e.tiltEventTypes,Dft,e.inertiaSpin,\"_lastInertiaTiltMovement\"),al(e,e.enableTranslate,e.translateEventTypes,wft,e.inertiaTranslate,\"_lastInertiaTranslateMovement\"),al(e,e.enableZoom,e.zoomEventTypes,Oft,e.inertiaZoom,\"_lastInertiaZoomMovement\"),al(e,e.enableLook,e.lookEventTypes,Hd),!e._aggregator.anyButtonDown&&!i.contains(e._tween)){let o=n.createCorrectPositionTween(e.bounceAnimationTime);l(o)&&(e._tween=i.add(o))}i.update()}}var Hft=new bn,Kft=new an(h.UNIT_X,0),Jft=new h,Qft=new h;function Kj(e,t,n){let i=e._scene,o=i.camera,r=o.getPickRay(t.endPosition,Hft),s=h.clone(o.direction,Qft);i.mode===ie.COLUMBUS_VIEW&&h.fromElements(s.z,s.x,s.y,s);let a=an.fromPointNormal(n,s,Kft),c=jn.rayPlane(r,a,Jft);l(c)&&(s=h.subtract(n,c,s),i.mode===ie.COLUMBUS_VIEW&&h.fromElements(s.y,s.z,s.x,s),h.add(o.position,s,o.position))}var r_e=new h,C_e=new he,Oj=new h,zj=new oe,jft=new h,qft=new h,$ft=new h;function ept(e,t,n){let o=e._scene.camera,r=e._cameraUnderground,s=e._ellipsoid;if(!M.equals(o.transform,M.IDENTITY)){zd(e,t,n);return}let a,c,d=s.geodeticSurfaceNormal(o.position,jft);if(D.equals(t,e._rotateMousePosition)){if(e._looking)Hd(e,t,n,d);else if(e._rotating)zd(e,t,n);else if(e._strafing)b_e(e,n);else{if(h.magnitude(o.position)<h.magnitude(e._rotateStartPosition))return;a=h.magnitude(e._rotateStartPosition),c=Oj,c.x=c.y=c.z=a,s=oe.fromCartesian3(c,zj),Bj(e,t,n,s)}return}e._looking=!1,e._rotating=!1,e._strafing=!1;let u=s.cartesianToCartographic(o.positionWC,C_e).height,m=e._globe;if(l(m)&&u<e._minimumPickingTerrainHeight){let p=ab(e,n.startPosition,$ft);if(l(p)){let b=!1,f=o.getPickRay(n.startPosition,m_e);if(r)b=!0,p_e(e,f,p,p);else{let x=s.geodeticSurfaceNormal(p,qft);Math.abs(h.dot(f.direction,x))<.05?b=!0:b=h.magnitude(o.position)<h.magnitude(p)}b?(D.clone(t,e._strafeEndMousePosition),h.clone(p,e._strafeStartPosition),e._strafing=!0,Kj(e,n,e._strafeStartPosition)):(a=h.magnitude(p),c=Oj,c.x=c.y=c.z=a,s=oe.fromCartesian3(c,zj),Bj(e,t,n,s),h.clone(p,e._rotateStartPosition))}else e._looking=!0,Hd(e,t,n,d)}else l(o.pickEllipsoid(n.startPosition,e._ellipsoid,r_e))?(Bj(e,t,n,e._ellipsoid),h.clone(r_e,e._rotateStartPosition)):u>e._minimumTrackBallHeight?(e._rotating=!0,zd(e,t,n)):(e._looking=!0,Hd(e,t,n,d));D.clone(t,e._rotateMousePosition)}function zd(e,t,n,i,o,r){o=g(o,!1),r=g(r,!1);let s=e._scene,a=s.camera,c=s.canvas,d=a.constrainedAxis;l(i)&&(a.constrainedAxis=i);let u=h.magnitude(a.position),m=e._rotateFactor*(u-e._rotateRateRangeAdjustment);m>e._maximumRotateRate&&(m=e._maximumRotateRate),m<e._minimumRotateRate&&(m=e._minimumRotateRate);let p=(n.startPosition.x-n.endPosition.x)/c.clientWidth,b=(n.startPosition.y-n.endPosition.y)/c.clientHeight;p=Math.min(p,e.maximumMovementRatio),b=Math.min(b,e.maximumMovementRatio);let f=m*p*Math.PI*2,x=m*b*Math.PI;o||a.rotateRight(f),r||a.rotateUp(x),a.constrainedAxis=d}var Dj=se.clone(se.UNIT_W),s_e=se.clone(se.UNIT_W),o3=new h,KV=new h,r3=new h,a_e=new h,tpt=new D,npt=new D,ipt=new D,opt=new D,rpt=new bn;function Bj(e,t,n,i){let o=e._scene,r=o.camera,s=D.clone(n.startPosition,tpt),a=D.clone(n.endPosition,npt),c=i.cartesianToCartographic(r.positionWC,C_e).height,d,u;if(!n.inertiaEnabled&&c<e._minimumPickingTerrainHeight&&(d=h.clone(e._panLastWorldPosition,Dj),!l(e._globe)&&!D.equalsEpsilon(s,e._panLastMousePosition)&&(d=ab(e,s,Dj)),!l(e._globe)&&l(d))){let m=h.subtract(d,r.positionWC,KV),p=h.multiplyByScalar(r.directionWC,h.dot(r.directionWC,m),KV),b=h.magnitude(p),f=r.frustum.getPixelDimensions(o.drawingBufferWidth,o.drawingBufferHeight,b,o.pixelRatio,opt),x=D.subtract(a,s,ipt),_=h.multiplyByScalar(r.rightWC,x.x*f.x,KV),C=h.normalize(r.positionWC,u_e),V=r.getPickRay(a,rpt).direction,L=h.subtract(V,h.projectVector(V,r.rightWC,r3),r3),R=h.angleBetween(L,r.directionWC),G=1;l(r.frustum.fov)&&(G=Math.max(Math.tan(R),.1));let X=Math.abs(h.dot(r.directionWC,C)),v=-x.y*f.y*2/Math.sqrt(G)*(1-X),W=h.multiplyByScalar(V,v,r3);X=Math.abs(h.dot(r.upWC,C));let F=h.multiplyByScalar(r.upWC,-x.y*(1-X)*f.y,a_e);u=h.add(d,_,s_e),u=h.add(u,W,u),u=h.add(u,F,u),h.clone(u,e._panLastWorldPosition),D.clone(a,e._panLastMousePosition)}if((!l(d)||!l(u))&&(d=r.pickEllipsoid(s,i,Dj),u=r.pickEllipsoid(a,i,s_e)),!l(d)||!l(u)){e._rotating=!0,zd(e,t,n);return}if(d=r.worldToCameraCoordinates(d,d),u=r.worldToCameraCoordinates(u,u),l(r.constrainedAxis)){let m=r.constrainedAxis,p=h.mostOrthogonalAxis(m,o3);h.cross(p,m,p),h.normalize(p,p);let b=h.cross(m,p,KV),f=h.magnitude(d),x=h.dot(m,d),_=Math.acos(x/f),C=h.multiplyByScalar(m,x,r3);h.subtract(d,C,C),h.normalize(C,C);let V=h.magnitude(u),L=h.dot(m,u),R=Math.acos(L/V),G=h.multiplyByScalar(m,L,a_e);h.subtract(u,G,G),h.normalize(G,G);let X=Math.acos(h.dot(C,p));h.dot(C,b)<0&&(X=P.TWO_PI-X);let v=Math.acos(h.dot(G,p));h.dot(G,b)<0&&(v=P.TWO_PI-v);let W=X-v,F;h.equalsEpsilon(m,r.position,P.EPSILON2)?F=r.right:F=h.cross(m,r.position,o3);let A=h.cross(m,F,o3),y=h.dot(A,h.subtract(d,m,KV)),Z=h.dot(A,h.subtract(u,m,KV)),E;y>0&&Z>0?E=R-_:y>0&&Z<=0?h.dot(r.position,m)>0?E=-_-R:E=_+R:E=_-R,r.rotateRight(W),r.rotateUp(E)}else{h.normalize(d,d),h.normalize(u,u);let m=h.dot(d,u),p=h.cross(d,u,o3);if(m<1&&!h.equalsEpsilon(p,h.ZERO,P.EPSILON14)){let b=Math.acos(m);r.rotate(p,b)}}}var spt=new h,apt=new he,c_e=0;function V_e(e,t,n){l(n.distance)&&(n=n.distance);let i=n.inertiaEnabled,o=e._ellipsoid,r=e._scene,s=r.camera,a=r.canvas,c=e._cameraUnderground,d;c?d=t:(d=__e,d.x=a.clientWidth/2,d.y=a.clientHeight/2);let u=s.getPickRay(d,T_e),m,p=o.cartesianToCartographic(s.position,apt).height,b=Math.abs(c_e)<e.minimumPickingTerrainDistanceWithInertia;(i?b:p<e._minimumPickingTerrainHeight)&&(m=ab(e,d,S_e));let x;if(l(m)&&(x=h.distance(u.origin,m),c_e=x),c){let C=h_e(e,u,p);l(x)?x=Math.min(x,C):x=C}l(x)||(x=p);let _=h.normalize(s.position,spt);Hj(e,t,n,e._zoomFactor,x,h.dot(_,s.direction))}var L_e=new D,l3=new bn,FF=new h,cpt=new h,Z_e=new M,lpt=new M,R_e=new M,dpt=new Fe,upt=new $,Jj=new he,Qj=new h;function mpt(e,t,n){let o=e._scene.camera;if(!M.equals(o.transform,M.IDENTITY))return;if(l(n.angleAndHeight)&&(n=n.angleAndHeight),D.equals(t,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){let a=e._ellipsoid.geodeticSurfaceNormal(o.position,Qj);Hd(e,t,n,a);return}let s=e._ellipsoid.cartesianToCartographic(o.position,Jj);e._tiltOnEllipsoid||s.height>e._minimumCollisionTerrainHeight?(e._tiltOnEllipsoid=!0,fpt(e,t,n)):ppt(e,t,n)}var hpt=new he;function fpt(e,t,n){let i=e._ellipsoid,o=e._scene,r=o.camera,s=e.minimumZoomDistance*.25,a=i.cartesianToCartographic(r.positionWC,hpt).height;if(a-s-1<P.EPSILON3&&n.endPosition.y-n.startPosition.y<0)return;let c=o.canvas,d=L_e;d.x=c.clientWidth/2,d.y=c.clientHeight/2;let u=r.getPickRay(d,l3),m,p=jn.rayEllipsoid(u,i);if(l(p))m=bn.getPoint(u,p.start,FF);else if(a>e._minimumTrackBallHeight){let V=jn.grazingAltitudeLocation(u,i);if(!l(V))return;let L=i.cartesianToCartographic(V,Jj);L.height=0,m=i.cartographicToCartesian(L,FF)}else{e._looking=!0;let V=e._ellipsoid.geodeticSurfaceNormal(r.position,Qj);Hd(e,t,n,V),D.clone(t,e._tiltCenterMousePosition);return}let b=Wt.eastNorthUpToFixedFrame(m,i,Z_e),f=e._globe,x=e._ellipsoid;e._globe=void 0,e._ellipsoid=oe.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let _=M.clone(r.transform,R_e);r._setTransform(b),zd(e,t,n,h.UNIT_Z),r._setTransform(_),e._globe=f,e._ellipsoid=x;let C=x.maximumRadius;e._rotateFactor=1/C,e._rotateRateRangeAdjustment=C}function ppt(e,t,n){let i=e._ellipsoid,o=e._scene,r=o.camera,s=e._cameraUnderground,a,c,d;if(D.equals(t,e._tiltCenterMousePosition))a=h.clone(e._tiltCenter,FF);else{if(a=ab(e,t,FF),!l(a)){if(c=r.getPickRay(t,l3),d=jn.rayEllipsoid(c,i),!l(d)){if(i.cartesianToCartographic(r.position,Jj).height<=e._minimumTrackBallHeight){e._looking=!0;let Z=e._ellipsoid.geodeticSurfaceNormal(r.position,Qj);Hd(e,t,n,Z),D.clone(t,e._tiltCenterMousePosition)}return}a=bn.getPoint(c,d.start,FF)}s&&(l(c)||(c=r.getPickRay(t,l3)),f_e(e,c,a,a)),D.clone(t,e._tiltCenterMousePosition),h.clone(a,e._tiltCenter)}let u=o.canvas,m=L_e;m.x=u.clientWidth/2,m.y=e._tiltCenterMousePosition.y,c=r.getPickRay(m,l3);let p=h.magnitude(a),b=h.fromElements(p,p,p,Oj),f=oe.fromCartesian3(b,zj);if(d=jn.rayEllipsoid(c,f),!l(d))return;let x=h.magnitude(c.origin)>p?d.start:d.stop,_=bn.getPoint(c,x,cpt),C=Wt.eastNorthUpToFixedFrame(a,i,Z_e),V=Wt.eastNorthUpToFixedFrame(_,f,lpt),L=e._globe,R=e._ellipsoid;e._globe=void 0,e._ellipsoid=oe.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1;let G=h.UNIT_Z,X=M.clone(r.transform,R_e);r._setTransform(V);let v=h.cross(_,r.positionWC,c3);if(h.dot(r.rightWC,v)<0){let y=n.startPosition.y-n.endPosition.y;(s&&y<0||!s&&y>0)&&(G=void 0);let Z=r.constrainedAxis;r.constrainedAxis=void 0,zd(e,t,n,G,!0,!1),r.constrainedAxis=Z}else zd(e,t,n,G,!0,!1);if(r._setTransform(C),zd(e,t,n,G,!1,!0),l(r.constrainedAxis)){let y=h.cross(r.direction,r.constrainedAxis,c3);h.equalsEpsilon(y,h.ZERO,P.EPSILON6)||(h.dot(y,r.right)<0&&h.negate(y,y),h.cross(y,r.direction,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.up,r.up),h.normalize(r.right,r.right))}r._setTransform(X),e._globe=L,e._ellipsoid=R;let F=R.maximumRadius;e._rotateFactor=1/F,e._rotateRateRangeAdjustment=F;let A=h.clone(r.positionWC,c3);if(e.enableCollisionDetection&&jj(e,!0),!h.equals(r.positionWC,A)){r._setTransform(V),r.worldToCameraCoordinatesPoint(A,A);let y=h.magnitudeSquared(A);h.magnitudeSquared(r.position)>y&&(h.normalize(r.position,r.position),h.multiplyByScalar(r.position,Math.sqrt(y),r.position));let Z=h.angleBetween(A,r.position),E=h.cross(A,r.position,A);h.normalize(E,E);let I=Fe.fromAxisAngle(E,Z,dpt),w=$.fromQuaternion(I,upt);$.multiplyByVector(w,r.direction,r.direction),$.multiplyByVector(w,r.up,r.up),h.cross(r.direction,r.up,r.right),h.cross(r.right,r.direction,r.up),r._setTransform(X)}}var bpt=new D,ypt=new D,l_e=new bn,d_e=new bn,gpt=new h,xpt=new h;function Hd(e,t,n,i){let r=e._scene.camera,s=bpt;s.x=n.startPosition.x,s.y=0;let a=ypt;a.x=n.endPosition.x,a.y=0;let c=r.getPickRay(s,l_e),d=r.getPickRay(a,d_e),u=0,m,p;r.frustum instanceof rn?(m=c.origin,p=d.origin,h.add(r.direction,m,m),h.add(r.direction,p,p),h.subtract(m,r.position,m),h.subtract(p,r.position,p),h.normalize(m,m),h.normalize(p,p)):(m=c.direction,p=d.direction);let b=h.dot(m,p);b<1&&(u=Math.acos(b)),u=n.startPosition.x>n.endPosition.x?-u:u;let f=e._horizontalRotationAxis;if(l(i)?r.look(i,-u):l(f)?r.look(f,-u):r.lookLeft(u),s.x=0,s.y=n.startPosition.y,a.x=0,a.y=n.endPosition.y,c=r.getPickRay(s,l_e),d=r.getPickRay(a,d_e),u=0,r.frustum instanceof rn?(m=c.origin,p=d.origin,h.add(r.direction,m,m),h.add(r.direction,p,p),h.subtract(m,r.position,m),h.subtract(p,r.position,p),h.normalize(m,m),h.normalize(p,p)):(m=c.direction,p=d.direction),b=h.dot(m,p),b<1&&(u=Math.acos(b)),u=n.startPosition.y>n.endPosition.y?-u:u,i=g(i,f),l(i)){let x=r.direction,_=h.negate(i,gpt),C=h.equalsEpsilon(x,i,P.EPSILON2),V=h.equalsEpsilon(x,_,P.EPSILON2);if(!C&&!V){b=h.dot(x,i);let L=P.acosClamped(b);u>0&&u>L&&(u=L-P.EPSILON4),b=h.dot(x,_),L=P.acosClamped(b),u<0&&-u>L&&(u=-L+P.EPSILON4);let R=h.cross(i,x,xpt);r.look(R,u)}else(C&&u<0||V&&u>0)&&r.look(r.right,-u)}else r.lookUp(u)}function _pt(e){al(e,e.enableRotate,e.rotateEventTypes,ept,e.inertiaSpin,\"_lastInertiaSpinMovement\"),al(e,e.enableZoom,e.zoomEventTypes,V_e,e.inertiaZoom,\"_lastInertiaZoomMovement\"),al(e,e.enableTilt,e.tiltEventTypes,mpt,e.inertiaSpin,\"_lastInertiaTiltMovement\"),al(e,e.enableLook,e.lookEventTypes,Hd)}var Tpt=new M,Spt=new he;function jj(e,t){e._adjustedHeightForTerrain=!0;let n=e._scene,i=n.mode,o=n.globe;if(i===ie.SCENE2D||i===ie.MORPHING)return;let r=n.camera,s=g(o?.ellipsoid,oe.WGS84),a=n.mapProjection,c,d;M.equals(r.transform,M.IDENTITY)||(c=M.clone(r.transform,Tpt),d=h.magnitude(r.position),r._setTransform(M.IDENTITY));let u=Spt;i===ie.SCENE3D?s.cartesianToCartographic(r.position,u):a.unproject(r.position,u);let m=!1;if(u.height<e._minimumCollisionTerrainHeight){let p=e._scene.globeHeight;if(l(p)){let b=p+e.minimumZoomDistance,f=p-e._lastGlobeHeight,x=f/e._lastGlobeHeight;u.height<b&&(t||Math.abs(x)<=.1)&&(u.height=b,i===ie.SCENE3D?s.cartographicToCartesian(u,r.position):a.project(u,r.position),m=!0),t||Math.abs(x)<=.1?e._lastGlobeHeight=p:e._lastGlobeHeight+=f*.1}}l(c)&&(r._setTransform(c),m&&(h.normalize(r.position,r.position),h.negate(r.position,r.direction),h.multiplyByScalar(r.position,Math.max(d,e.minimumZoomDistance),r.position),h.normalize(r.direction,r.direction),h.cross(r.direction,r.up,r.right),h.cross(r.right,r.direction,r.up)))}AF.prototype.onMap=function(){let e=this._scene,t=e.mode,n=e.camera;return t===ie.COLUMBUS_VIEW?Math.abs(n.position.x)-this._maxCoord.x<0&&Math.abs(n.position.y)-this._maxCoord.y<0:!0};var Cpt=new h,Vpt=new h;AF.prototype.update=function(){let e=this._scene,{camera:t,globe:n,mode:i}=e;M.equals(t.transform,M.IDENTITY)?(this._globe=n,this._ellipsoid=l(this._globe)?this._globe.ellipsoid:e.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=oe.UNIT_SPHERE);let{verticalExaggeration:o,verticalExaggerationRelativeHeight:r}=e;this._minimumCollisionTerrainHeight=pr.getHeight(this.minimumCollisionTerrainHeight,o,r),this._minimumPickingTerrainHeight=pr.getHeight(this.minimumPickingTerrainHeight,o,r),this._minimumTrackBallHeight=pr.getHeight(this.minimumTrackBallHeight,o,r),this._cameraUnderground=e.cameraUnderground&&l(this._globe);let s=this._ellipsoid.maximumRadius;this._rotateFactor=1/s,this._rotateRateRangeAdjustment=s,this._adjustedHeightForTerrain=!1;let a=h.clone(t.positionWC,Cpt),c=h.clone(t.directionWC,Vpt);if(i===ie.SCENE2D?Sft(this):i===ie.COLUMBUS_VIEW?(this._horizontalRotationAxis=h.UNIT_Z,zft(this)):i===ie.SCENE3D&&(this._horizontalRotationAxis=void 0,_pt(this)),this.enableCollisionDetection&&!this._adjustedHeightForTerrain){let d=!h.equals(a,t.positionWC)||!h.equals(c,t.directionWC);jj(this,d)}this._aggregator.reset()};AF.prototype.isDestroyed=function(){return!1};AF.prototype.destroy=function(){return this._tweens.removeAll(),this._aggregator=this._aggregator&&this._aggregator.destroy(),me(this)};var MF=AF;var O9i=T(S(),1);var V9i=T(S(),1),NF=`uniform sampler2D colorTexture; uniform sampler2D colorTexture2; uniform vec2 center; uniform float radius; in vec2 v_textureCoordinates; void main() { vec4 color0 = texture(colorTexture, v_textureCoordinates); vec4 color1 = texture(colorTexture2, v_textureCoordinates); float x = length(gl_FragCoord.xy - center) / radius; float t = smoothstep(0.5, 0.8, x); out_FragColor = mix(color0 + color1, color1, t); } `;var Z9i=T(S(),1),kF=`uniform sampler2D colorTexture; uniform float avgLuminance; uniform float threshold; uniform float offset; in vec2 v_textureCoordinates; float key(float avg) { float guess = 1.5 - (1.5 / (avg * 0.1 + 1.0)); return max(0.0, guess) + 0.1; } // See section 9. \"The bright-pass filter\" of Realtime HDR Rendering // http://www.cg.tuwien.ac.at/research/publications/2007/Luksch_2007_RHR/Luksch_2007_RHR-RealtimeHDR%20.pdf void main() { vec4 color = texture(colorTexture, v_textureCoordinates); vec3 xyz = czm_RGBToXYZ(color.rgb); float luminance = xyz.r;"
}