{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 85,
    "total_chunks": 194,
    "chunk_size": 26210,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.696Z"
  },
  "content": "{ positionMC *= 0.0; } } void cpuStylingStage(inout vec3 positionMC, inout SelectedFeature feature) { float show = ceil(feature.color.a); positionMC *= show; #if defined(HAS_SELECTED_FEATURE_ID_ATTRIBUTE) && !defined(HAS_CLASSIFICATION) filterByPassType(positionMC, feature.color); #endif } `;var bSn=T(S(),1),HI=`void filterByPassType(vec4 featureColor) { bool styleTranslucent = (featureColor.a != 1.0); // Only render translucent features in the translucent pass (if the style or the original command has translucency). if (czm_pass == czm_passTranslucent && !styleTranslucent && !model_commandTranslucent) { // If the model has a translucent silhouette, it needs to render during the silhouette color command, // (i.e. the command where model_silhouettePass = true), even if the model isn't translucent. #ifdef HAS_SILHOUETTE if(!model_silhouettePass) { discard; } #else discard; #endif } // If the current pass is not the translucent pass and the style is not translucent, don't render the feature. else if (czm_pass != czm_passTranslucent && styleTranslucent) { discard; } } void cpuStylingStage(inout czm_modelMaterial material, SelectedFeature feature) { vec4 featureColor = feature.color; if (featureColor.a == 0.0) { discard; } // If a feature ID vertex attribute is used, the pass type filter is applied in the vertex shader. // So, we only apply in in the fragment shader if the feature ID texture is used. #if defined(HAS_SELECTED_FEATURE_ID_TEXTURE) && !defined(HAS_CLASSIFICATION) filterByPassType(featureColor); #endif featureColor = czm_gammaCorrect(featureColor); // Classification models compute the diffuse differently. #ifdef HAS_CLASSIFICATION material.diffuse = featureColor.rgb * featureColor.a; #else float highlight = ceil(model_colorBlend); material.diffuse *= mix(featureColor.rgb, vec3(1.0), highlight); #endif material.alpha *= featureColor.a; } `;var use={name:\"CPUStylingPipelineStage\"};use.process=function(e,t,n){let i=e.model,o=e.shaderBuilder;o.addVertexLines(zI),o.addFragmentLines(HI),o.addDefine(\"USE_CPU_STYLING\",void 0,Ce.BOTH),l(i.color)||(o.addUniform(\"float\",uy.COLOR_BLEND_UNIFORM_NAME,Ce.FRAGMENT),e.uniformMap[uy.COLOR_BLEND_UNIFORM_NAME]=function(){return ac.getColorBlend(i.colorBlendMode,i.colorBlendAmount)}),o.addUniform(\"bool\",\"model_commandTranslucent\",Ce.BOTH),e.uniformMap.model_commandTranslucent=function(){return e.alphaOptions.pass===Ze.TRANSLUCENT}};var KI=use;var RSn=T(S(),1),mse={MODIFY_MATERIAL:\"MODIFY_MATERIAL\",REPLACE_MATERIAL:\"REPLACE_MATERIAL\"};mse.getDefineName=function(e){return`CUSTOM_SHADER_${e}`};var n0=Object.freeze(mse);var VCn=T(S(),1);var ESn=T(S(),1),JI=`void customShaderStage( inout czm_modelVertexOutput vsOutput, inout ProcessedAttributes attributes, FeatureIds featureIds, Metadata metadata, MetadataClass metadataClass, MetadataStatistics metadataStatistics ) { // VertexInput and initializeInputStruct() are dynamically generated in JS, // see CustomShaderPipelineStage.js VertexInput vsInput; initializeInputStruct(vsInput, attributes); vsInput.featureIds = featureIds; vsInput.metadata = metadata; vsInput.metadataClass = metadataClass; vsInput.metadataStatistics = metadataStatistics; vertexMain(vsInput, vsOutput); attributes.positionMC = vsOutput.positionMC; } `;var ISn=T(S(),1),QI=`void customShaderStage( inout czm_modelMaterial material, ProcessedAttributes attributes, FeatureIds featureIds, Metadata metadata, MetadataClass metadataClass, MetadataStatistics metadataStatistics ) { // FragmentInput and initializeInputStruct() are dynamically generated in JS, // see CustomShaderPipelineStage.js FragmentInput fsInput; initializeInputStruct(fsInput, attributes); fsInput.featureIds = featureIds; fsInput.metadata = metadata; fsInput.metadataClass = metadataClass; fsInput.metadataStatistics = metadataStatistics; fragmentMain(fsInput, material); } `;var JSn=T(S(),1);var PSn=T(S(),1),jI=`void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes) { initializeFeatureIds(featureIds, attributes); initializeFeatureIdAliases(featureIds); } `;var wSn=T(S(),1),qI=`void featureIdStage(out FeatureIds featureIds, ProcessedAttributes attributes) { initializeFeatureIds(featureIds, attributes); initializeFeatureIdAliases(featureIds); setFeatureIdVaryings(); } `;var Fi={name:\"FeatureIdPipelineStage\",STRUCT_ID_FEATURE_IDS_VS:\"FeatureIdsVS\",STRUCT_ID_FEATURE_IDS_FS:\"FeatureIdsFS\",STRUCT_NAME_FEATURE_IDS:\"FeatureIds\",FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS:\"initializeFeatureIdsVS\",FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS:\"initializeFeatureIdsFS\",FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS:\"initializeFeatureIdAliasesVS\",FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS:\"initializeFeatureIdAliasesFS\",FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS:\"void initializeFeatureIds(out FeatureIds featureIds, ProcessedAttributes attributes)\",FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES:\"void initializeFeatureIdAliases(inout FeatureIds featureIds)\",FUNCTION_ID_SET_FEATURE_ID_VARYINGS:\"setFeatureIdVaryings\",FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS:\"void setFeatureIdVaryings()\"};Fi.process=function(e,t,n){let i=e.shaderBuilder;IUe(i);let o=e.runtimeNode.node.instances;l(o)&&WUe(e,o,n),PUe(e,t,n),i.addVertexLines(qI),i.addFragmentLines(jI)};function IUe(e){e.addStruct(Fi.STRUCT_ID_FEATURE_IDS_VS,Fi.STRUCT_NAME_FEATURE_IDS,Ce.VERTEX),e.addStruct(Fi.STRUCT_ID_FEATURE_IDS_FS,Fi.STRUCT_NAME_FEATURE_IDS,Ce.FRAGMENT),e.addFunction(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,Fi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,Ce.VERTEX),e.addFunction(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,Fi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_IDS,Ce.FRAGMENT),e.addFunction(Fi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,Fi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,Ce.VERTEX),e.addFunction(Fi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,Fi.FUNCTION_SIGNATURE_INITIALIZE_FEATURE_ID_ALIASES,Ce.FRAGMENT),e.addFunction(Fi.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,Fi.FUNCTION_SIGNATURE_SET_FEATURE_ID_VARYINGS,Ce.VERTEX)}function WUe(e,t,n){let i=t.featureIds,o=t.attributes[0].count;for(let r=0;r<i.length;r++){let s=i[r],a=s.positionalLabel;s instanceof Nt.FeatureIdAttribute?vUe(e,s,a):hse(e,s,a,o,1,n);let c=s.label;l(c)&&fse(e,a,c,Ce.BOTH)}}function PUe(e,t,n){let i=t.featureIds,r=qt.getAttributeBySemantic(t,St.POSITION).count;for(let s=0;s<i.length;s++){let a=i[s],c=a.positionalLabel,d=Ce.BOTH;a instanceof Nt.FeatureIdAttribute?wUe(e,a,c):a instanceof Nt.FeatureIdImplicitRange?hse(e,a,c,r,void 0,n):(FUe(e,a,c,s,n),d=Ce.FRAGMENT);let u=a.label;l(u)&&fse(e,c,u,d)}}function vUe(e,t,n){let i=e.shaderBuilder;i.addStructField(Fi.STRUCT_ID_FEATURE_IDS_VS,\"int\",n),i.addStructField(Fi.STRUCT_ID_FEATURE_IDS_FS,\"int\",n);let o=t.setIndex,r=n.replace(/_\\d+$/,\"_\"),s=`a_${r}${o}`,a=`v_${r}${o}`,c=`featureIds.${n} = int(czm_round(${s}));`,d=`featureIds.${n} = int(czm_round(${a}));`;i.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[c]),i.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[d]),i.addVarying(\"float\",a),i.addFunctionLines(Fi.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${a} = ${s};`])}function wUe(e,t,n){let i=e.shaderBuilder;i.addStructField(Fi.STRUCT_ID_FEATURE_IDS_VS,\"int\",n),i.addStructField(Fi.STRUCT_ID_FEATURE_IDS_FS,\"int\",n);let o=t.setIndex,r=n.replace(/_\\d+$/,\"_\"),s=[`featureIds.${n} = int(czm_round(attributes.${r}${o}));`];i.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,s),i.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,s)}function hse(e,t,n,i,o,r){AUe(e,t,i,o,r);let s=e.shaderBuilder,a=`a_implicit_${n}`;s.addAttribute(\"float\",a);let c=`v_implicit_${n}`;s.addVarying(\"float\",c),s.addStructField(Fi.STRUCT_ID_FEATURE_IDS_VS,\"int\",n),s.addStructField(Fi.STRUCT_ID_FEATURE_IDS_FS,\"int\",n),s.addFunctionLines(Fi.FUNCTION_ID_SET_FEATURE_ID_VARYINGS,[`${c} = ${a};`]),s.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_VS,[`featureIds.${n} = int(czm_round(${a}));`]),s.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[`featureIds.${n} = int(czm_round(${c}));`])}function FUe(e,t,n,i,o){let r=`u_featureIdTexture_${i}`,s=e.uniformMap,a=t.textureReader;s[r]=function(){return g(a.texture,o.context.defaultTexture)};let c=a.channels,d=e.shaderBuilder;d.addStructField(Fi.STRUCT_ID_FEATURE_IDS_FS,\"int\",n),d.addUniform(\"sampler2D\",r,Ce.FRAGMENT);let m=`v_texCoord_${a.texCoord}`,p=m,b=a.transform;if(l(b)&&!$.equals(b,$.IDENTITY)){let _=`${r}Transform`;d.addUniform(\"mat3\",_,Ce.FRAGMENT),s[_]=function(){return b},p=`vec2(${_} * vec3(${m}, 1.0))`}let f=`texture(${r}, ${p}).${c}`,x=`featureIds.${n} = czm_unpackUint(${f});`;d.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_IDS_FS,[x])}function fse(e,t,n,i){let o=e.shaderBuilder,r=Ce.includesVertexShader(i);r&&o.addStructField(Fi.STRUCT_ID_FEATURE_IDS_VS,\"int\",n),o.addStructField(Fi.STRUCT_ID_FEATURE_IDS_FS,\"int\",n);let s=[`featureIds.${n} = featureIds.${t};`];r&&o.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_VS,s),o.addFunctionLines(Fi.FUNCTION_ID_INITIALIZE_FEATURE_ID_ALIASES_FS,s)}function AUe(e,t,n,i,o){let r=e.model,s,a;if(l(t.repeat)){let d=MUe(t,n);s=pt.createVertexBuffer({context:o.context,typedArray:d,usage:Me.STATIC_DRAW}),s.vertexArrayDestroyable=!1,r._pipelineResources.push(s),r.statistics.addBuffer(s,!1)}else a=[t.offset];let c={index:e.attributeIndex++,instanceDivisor:i,value:a,vertexBuffer:s,normalize:!1,componentsPerAttribute:1,componentDatatype:Q.FLOAT,strideInBytes:Q.getSizeInBytes(Q.FLOAT),offsetInBytes:0};e.attributes.push(c)}function MUe(e,t){let n=e.offset,i=e.repeat,o=new Float32Array(t);for(let r=0;r<t;r++)o[r]=n+Math.floor(r/i);return o}var my=Fi;var cCn=T(S(),1);var jSn=T(S(),1),$I=`void metadataStage( out Metadata metadata, out MetadataClass metadataClass, out MetadataStatistics metadataStatistics, ProcessedAttributes attributes ) { initializeMetadata(metadata, metadataClass, metadataStatistics, attributes); } `;var $Sn=T(S(),1),eW=`void metadataStage( out Metadata metadata, out MetadataClass metadataClass, out MetadataStatistics metadataStatistics, ProcessedAttributes attributes ) { initializeMetadata(metadata, metadataClass, metadataStatistics, attributes); setMetadataVaryings(); } `;var xi={name:\"MetadataPipelineStage\",STRUCT_ID_METADATA_VS:\"MetadataVS\",STRUCT_ID_METADATA_FS:\"MetadataFS\",STRUCT_NAME_METADATA:\"Metadata\",STRUCT_ID_METADATA_CLASS_VS:\"MetadataClassVS\",STRUCT_ID_METADATA_CLASS_FS:\"MetadataClassFS\",STRUCT_NAME_METADATA_CLASS:\"MetadataClass\",STRUCT_ID_METADATA_STATISTICS_VS:\"MetadataStatisticsVS\",STRUCT_ID_METADATA_STATISTICS_FS:\"MetadataStatisticsFS\",STRUCT_NAME_METADATA_STATISTICS:\"MetadataStatistics\",FUNCTION_ID_INITIALIZE_METADATA_VS:\"initializeMetadataVS\",FUNCTION_ID_INITIALIZE_METADATA_FS:\"initializeMetadataFS\",FUNCTION_SIGNATURE_INITIALIZE_METADATA:\"void initializeMetadata(out Metadata metadata, out MetadataClass metadataClass, out MetadataStatistics metadataStatistics, ProcessedAttributes attributes)\",FUNCTION_ID_SET_METADATA_VARYINGS:\"setMetadataVaryings\",FUNCTION_SIGNATURE_SET_METADATA_VARYINGS:\"void setMetadataVaryings()\",METADATA_CLASS_FIELDS:[{specName:\"noData\",shaderName:\"noData\"},{specName:\"default\",shaderName:\"defaultValue\"},{specName:\"min\",shaderName:\"minValue\"},{specName:\"max\",shaderName:\"maxValue\"}],METADATA_STATISTICS_FIELDS:[{specName:\"min\",shaderName:\"minValue\"},{specName:\"max\",shaderName:\"maxValue\"},{specName:\"mean\",shaderName:\"mean\",type:\"float\"},{specName:\"median\",shaderName:\"median\"},{specName:\"standardDeviation\",shaderName:\"standardDeviation\",type:\"float\"},{specName:\"variance\",shaderName:\"variance\",type:\"float\"},{specName:\"sum\",shaderName:\"sum\"}]};xi.process=function(e,t,n){let{shaderBuilder:i,model:o}=e,{structuralMetadata:r={},content:s}=o,a=s?.tileset.metadataExtension?.statistics,c=NUe(r.propertyAttributes,t,a),d=UUe(r.propertyTextures,a),u=c.concat(d);BUe(i,u),zUe(i),i.addVertexLines(eW),i.addFragmentLines($I);for(let m=0;m<c.length;m++){let p=c[m];HUe(e,p)}for(let m=0;m<d.length;m++){let p=d[m];JUe(e,p)}};function NUe(e,t,n){return l(e)?e.flatMap(i=>kUe(i,t,n)):[]}function kUe(e,t,n){let{getAttributeByName:i,getAttributeInfo:o,sanitizeGlslIdentifier:r}=qt,s=e.class.id,a=n?.classes[s],c=Object.entries(e.properties),d=new Array(c.length);for(let u=0;u<c.length;u++){let[m,p]=c[u],b=i(t,p.attribute),{glslType:f,variableName:x}=o(b);d[u]={metadataVariable:r(m),property:p,type:p.classProperty.type,glslType:f,variableName:x,propertyStatistics:a?.properties[m],shaderDestination:Ce.BOTH}}return d}function UUe(e,t){return l(e)?e.flatMap(n=>DUe(n,t)):[]}function DUe(e,t){let{sanitizeGlslIdentifier:n}=qt,i=e.class.id,o=t?.classes[i],r=Object.entries(e.properties).filter(([a,c])=>c.isGpuCompatible()),s=new Array(r.length);for(let a=0;a<r.length;a++){let[c,d]=r[a];s[a]={metadataVariable:n(c),property:d,type:d.classProperty.type,glslType:d.getGlslType(),propertyStatistics:o?.properties[c],shaderDestination:Ce.FRAGMENT}}return s}function BUe(e,t){let n=new Set,i=new Set;for(let a=0;a<t.length;a++){let{type:c,glslType:d,propertyStatistics:u}=t[a];n.add(d),l(u)&&c!==Kt.ENUM&&i.add(d)}let o=xi.METADATA_CLASS_FIELDS;for(let a of n){let c=`${a}MetadataClass`;s(c,a,o)}let r=xi.METADATA_STATISTICS_FIELDS;for(let a of i){let c=`${a}MetadataStatistics`;s(c,a,r)}function s(a,c,d){e.addStruct(a,a,Ce.BOTH);for(let u=0;u<d.length;u++){let{shaderName:m}=d[u],p=d[u].type===\"float\"?OUe(c):c;e.addStructField(a,p,m)}}}var YUe={int:\"float\",ivec2:\"vec2\",ivec3:\"vec3\",ivec4:\"vec4\"};function OUe(e){let t=YUe[e];return l(t)?t:e}function zUe(e){e.addStruct(xi.STRUCT_ID_METADATA_VS,xi.STRUCT_NAME_METADATA,Ce.VERTEX),e.addStruct(xi.STRUCT_ID_METADATA_FS,xi.STRUCT_NAME_METADATA,Ce.FRAGMENT),e.addStruct(xi.STRUCT_ID_METADATA_CLASS_VS,xi.STRUCT_NAME_METADATA_CLASS,Ce.VERTEX),e.addStruct(xi.STRUCT_ID_METADATA_CLASS_FS,xi.STRUCT_NAME_METADATA_CLASS,Ce.FRAGMENT),e.addStruct(xi.STRUCT_ID_METADATA_STATISTICS_VS,xi.STRUCT_NAME_METADATA_STATISTICS,Ce.VERTEX),e.addStruct(xi.STRUCT_ID_METADATA_STATISTICS_FS,xi.STRUCT_NAME_METADATA_STATISTICS,Ce.FRAGMENT),e.addFunction(xi.FUNCTION_ID_INITIALIZE_METADATA_VS,xi.FUNCTION_SIGNATURE_INITIALIZE_METADATA,Ce.VERTEX),e.addFunction(xi.FUNCTION_ID_INITIALIZE_METADATA_FS,xi.FUNCTION_SIGNATURE_INITIALIZE_METADATA,Ce.FRAGMENT),e.addFunction(xi.FUNCTION_ID_SET_METADATA_VARYINGS,xi.FUNCTION_SIGNATURE_SET_METADATA_VARYINGS,Ce.VERTEX)}function HUe(e,t){KUe(e,t),pse(e.shaderBuilder,t),bse(e.shaderBuilder,t)}function KUe(e,t){let{shaderBuilder:n}=e,{metadataVariable:i,property:o,glslType:r}=t,s=gse({valueExpression:`attributes.${t.variableName}`,renderResources:e,glslType:r,metadataVariable:i,shaderDestination:Ce.BOTH,property:o});n.addStructField(xi.STRUCT_ID_METADATA_VS,r,i),n.addStructField(xi.STRUCT_ID_METADATA_FS,r,i);let a=`metadata.${i} = ${s};`;n.addFunctionLines(xi.FUNCTION_ID_INITIALIZE_METADATA_VS,[a]),n.addFunctionLines(xi.FUNCTION_ID_INITIALIZE_METADATA_FS,[a])}function JUe(e,t){QUe(e,t),pse(e.shaderBuilder,t),bse(e.shaderBuilder,t)}function QUe(e,t){let{shaderBuilder:n,uniformMap:i}=e,{metadataVariable:o,glslType:r,property:s}=t,{texCoord:a,channels:c,index:d,texture:u,transform:m}=s.textureReader,p=`u_propertyTexture_${d}`;i.hasOwnProperty(p)||(n.addUniform(\"sampler2D\",p,Ce.FRAGMENT),i[p]=()=>u),n.addStructField(xi.STRUCT_ID_METADATA_FS,r,o);let b=`attributes.texCoord_${a}`,f=b;if(l(m)&&!$.equals(m,$.IDENTITY)){let L=`${p}Transform`;n.addUniform(\"mat3\",L,Ce.FRAGMENT),i[L]=function(){return m},f=`vec2(${L} * vec3(${b}, 1.0))`}let x=`texture(${p}, ${f}).${c}`,_=s.unpackInShader(x),C=gse({valueExpression:_,renderResources:e,glslType:r,metadataVariable:o,shaderDestination:Ce.FRAGMENT,property:s}),V=`metadata.${o} = ${C};`;n.addFunctionLines(xi.FUNCTION_ID_INITIALIZE_METADATA_FS,[V])}function pse(e,t){let{classProperty:n}=t.property,{metadataVariable:i,glslType:o,shaderDestination:r}=t,s=yse(xi.METADATA_CLASS_FIELDS,n,`metadataClass.${i}`,o),a=`${o}MetadataClass`;e.addStructField(xi.STRUCT_ID_METADATA_CLASS_FS,a,i),e.addFunctionLines(xi.FUNCTION_ID_INITIALIZE_METADATA_FS,s),Ce.includesVertexShader(r)&&(e.addStructField(xi.STRUCT_ID_METADATA_CLASS_VS,a,i),e.addFunctionLines(xi.FUNCTION_ID_INITIALIZE_METADATA_VS,s))}function bse(e,t){let{propertyStatistics:n}=t;if(!l(n))return;let{metadataVariable:i,type:o,glslType:r}=t;if(o===Kt.ENUM)return;let s=xi.METADATA_STATISTICS_FIELDS,a=`metadataStatistics.${i}`,c=yse(s,n,a,r),d=`${r}MetadataStatistics`;e.addStructField(xi.STRUCT_ID_METADATA_STATISTICS_FS,d,i),e.addFunctionLines(xi.FUNCTION_ID_INITIALIZE_METADATA_FS,c),Ce.includesVertexShader(t.shaderDestination)&&(e.addStructField(xi.STRUCT_ID_METADATA_STATISTICS_VS,d,i),e.addFunctionLines(xi.FUNCTION_ID_INITIALIZE_METADATA_VS,c))}function yse(e,t,n,i){function o(r){let s=t[r.specName];if(l(s))return`${n}.${r.shaderName} = ${i}(${s});`}return l(t)?e.map(o).filter(l):[]}function gse(e){let{valueExpression:t,property:n}=e;if(!n.hasValueTransform)return t;let i=e.metadataVariable,o=`u_${i}_offset`,r=`u_${i}_scale`,{shaderBuilder:s,uniformMap:a}=e.renderResources,{glslType:c,shaderDestination:d}=e;s.addUniform(c,o,d),s.addUniform(c,r,d);let{offset:u,scale:m}=n;return a[o]=()=>u,a[r]=()=>m,`czm_valueTransform(${o}, ${r}, ${t})`}var gu=xi;var dCn=T(S(),1),jUe={INHERIT:0,OPAQUE:1,TRANSLUCENT:2},hy=Object.freeze(jUe);var oa={name:\"CustomShaderPipelineStage\",STRUCT_ID_ATTRIBUTES_VS:\"AttributesVS\",STRUCT_ID_ATTRIBUTES_FS:\"AttributesFS\",STRUCT_NAME_ATTRIBUTES:\"Attributes\",STRUCT_ID_VERTEX_INPUT:\"VertexInput\",STRUCT_NAME_VERTEX_INPUT:\"VertexInput\",STRUCT_ID_FRAGMENT_INPUT:\"FragmentInput\",STRUCT_NAME_FRAGMENT_INPUT:\"FragmentInput\",FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS:\"initializeInputStructVS\",FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS:\"void initializeInputStruct(out VertexInput vsInput, ProcessedAttributes attributes)\",FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS:\"initializeInputStructFS\",FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS:\"void initializeInputStruct(out FragmentInput fsInput, ProcessedAttributes attributes)\",_oneTimeWarning:wt};oa.process=function(e,t,n){let{shaderBuilder:i,model:o,alphaOptions:r}=e,{customShader:s}=o,{lightingModel:a,translucencyMode:c}=s;l(a)&&(e.lightingOptions.lightingModel=a),c===hy.TRANSLUCENT?r.pass=Ze.TRANSLUCENT:c===hy.OPAQUE&&(r.pass=void 0);let d=rDe(s,t);if(!d.customShaderEnabled)return;if(lDe(i,s,d),d.shouldComputePositionWC&&i.addDefine(\"COMPUTE_POSITION_WC_CUSTOM_SHADER\",void 0,Ce.BOTH),l(s.vertexShaderText)&&i.addDefine(\"HAS_CUSTOM_VERTEX_SHADER\",void 0,Ce.VERTEX),l(s.fragmentShaderText)){i.addDefine(\"HAS_CUSTOM_FRAGMENT_SHADER\",void 0,Ce.FRAGMENT);let p=n0.getDefineName(s.mode);i.addDefine(p,void 0,Ce.FRAGMENT)}let u=s.uniforms;for(let p in u)if(u.hasOwnProperty(p)){let b=u[p];i.addUniform(b.type,p)}let m=s.varyings;for(let p in m)if(m.hasOwnProperty(p)){let b=m[p];i.addVarying(b,p)}e.uniformMap=Ct(e.uniformMap,s.uniformMap)};function qUe(e){let t={};for(let n=0;n<e.length;n++){let i=qt.getAttributeInfo(e[n]);t[i.variableName]=i}return t}var $Ue={position:\"vec3\",normal:\"vec3\",tangent:\"vec3\",bitangent:\"vec3\",texCoord:\"vec2\",color:\"vec4\",joints:\"ivec4\",weights:\"vec4\"},eDe={position:\"vec3(0.0)\",normal:\"vec3(0.0, 0.0, 1.0)\",tangent:\"vec3(1.0, 0.0, 0.0)\",bitangent:\"vec3(0.0, 1.0, 0.0)\",texCoord:\"vec2(0.0)\",color:\"vec4(1.0)\",joints:\"ivec4(0)\",weights:\"vec4(0.0)\"};function xse(e){let t=e.replace(/_[0-9]+$/,\"\");t=t.replace(/(MC|EC)$/,\"\");let n=$Ue[t],i=eDe[t];if(l(n))return{attributeField:[n,e],value:i}}function tDe(e,t){if(!l(e.vertexShaderText))return{enabled:!1};let n=e.usedVariablesVertex.attributeSet,i=_se(t,n,!1),o=Tse(t,n,!1),r,s=[],a=[];for(let c in i){if(!i.hasOwnProperty(c))continue;let u=[i[c].glslType,c];s.push(u),r=`vsInput.attributes.${c} = attributes.${c};`,a.push(r)}for(let c=0;c<o.length;c++){let d=o[c],u=xse(d);if(!l(u))return oa._oneTimeWarning(\"CustomShaderPipelineStage.incompatiblePrimitiveVS\",`Primitive is missing attribute ${d}, disabling custom vertex shader`),{enabled:!1};s.push(u.attributeField),r=`vsInput.attributes.${d} = ${u.value};`,a.push(r)}return{enabled:!0,attributeFields:s,initializationLines:a}}function nDe(e){let t=[],n=[],i=e.usedVariablesFragment.attributeSet;return i.hasOwnProperty(\"positionWC\")&&(t.push([\"vec3\",\"positionWC\"]),n.push(\"fsInput.attributes.positionWC = attributes.positionWC;\")),i.hasOwnProperty(\"positionEC\")&&(t.push([\"vec3\",\"positionEC\"]),n.push(\"fsInput.attributes.positionEC = attributes.positionEC;\")),{attributeFields:t,initializationLines:n}}function iDe(e,t){if(!l(e.fragmentShaderText))return{enabled:!1};let n=e.usedVariablesFragment.attributeSet,i=_se(t,n,!0),o=Tse(t,n,!0),r,s=[],a=[];for(let d in i){if(!i.hasOwnProperty(d))continue;let m=[i[d].glslType,d];s.push(m),r=`fsInput.attributes.${d} = attributes.${d};`,a.push(r)}for(let d=0;d<o.length;d++){let u=o[d],m=xse(u);if(!l(m))return oa._oneTimeWarning(\"CustomShaderPipelineStage.incompatiblePrimitiveFS\",`Primitive is missing attribute ${u}, disabling custom fragment shader.`),{enabled:!1};s.push(m.attributeField),r=`fsInput.attributes.${u} = ${m.value};`,a.push(r)}let c=nDe(e);return{enabled:!0,attributeFields:s.concat(c.attributeFields),initializationLines:c.initializationLines.concat(a)}}var oDe={positionWC:!0,positionEC:!0};function _se(e,t,n){let i={};for(let o in e){if(!e.hasOwnProperty(o))continue;let r=e[o],s=o;n&&o===\"normalMC\"?s=\"normalEC\":n&&o===\"tangentMC\"&&(s=\"tangentEC\",r.glslType=\"vec3\"),t.hasOwnProperty(s)&&(i[s]=r)}return i}function Tse(e,t,n){let i=[];for(let o in t){if(!t.hasOwnProperty(o)||oDe.hasOwnProperty(o))continue;let r=o;n&&o===\"normalEC\"?r=\"normalMC\":n&&o===\"tangentEC\"&&(r=\"tangentMC\"),e.hasOwnProperty(r)||i.push(o)}return i}function rDe(e,t){let n=qUe(t.attributes),i=tDe(e,n),o=iDe(e,n),s=e.usedVariablesFragment.attributeSet.hasOwnProperty(\"positionWC\")&&o.enabled;return{vertexLines:i,fragmentLines:o,customShaderEnabled:i.enabled||o.enabled,shouldComputePositionWC:s}}function sDe(e,t){let n=oa.STRUCT_ID_ATTRIBUTES_VS;e.addStruct(n,oa.STRUCT_NAME_ATTRIBUTES,Ce.VERTEX);let{attributeFields:i,initializationLines:o}=t;for(let s=0;s<i.length;s++){let[a,c]=i[s];e.addStructField(n,a,c)}n=oa.STRUCT_ID_VERTEX_INPUT,e.addStruct(n,oa.STRUCT_NAME_VERTEX_INPUT,Ce.VERTEX),e.addStructField(n,oa.STRUCT_NAME_ATTRIBUTES,\"attributes\"),e.addStructField(n,my.STRUCT_NAME_FEATURE_IDS,\"featureIds\"),e.addStructField(n,gu.STRUCT_NAME_METADATA,\"metadata\"),e.addStructField(n,gu.STRUCT_NAME_METADATA_CLASS,\"metadataClass\"),e.addStructField(n,gu.STRUCT_NAME_METADATA_STATISTICS,\"metadataStatistics\");let r=oa.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_VS;e.addFunction(r,oa.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_VS,Ce.VERTEX),e.addFunctionLines(r,o)}function aDe(e,t){let n=oa.STRUCT_ID_ATTRIBUTES_FS;e.addStruct(n,oa.STRUCT_NAME_ATTRIBUTES,Ce.FRAGMENT);let{attributeFields:i,initializationLines:o}=t;for(let s=0;s<i.length;s++){let[a,c]=i[s];e.addStructField(n,a,c)}n=oa.STRUCT_ID_FRAGMENT_INPUT,e.addStruct(n,oa.STRUCT_NAME_FRAGMENT_INPUT,Ce.FRAGMENT),e.addStructField(n,oa.STRUCT_NAME_ATTRIBUTES,\"attributes\"),e.addStructField(n,my.STRUCT_NAME_FEATURE_IDS,\"featureIds\"),e.addStructField(n,gu.STRUCT_NAME_METADATA,\"metadata\"),e.addStructField(n,gu.STRUCT_NAME_METADATA_CLASS,\"metadataClass\"),e.addStructField(n,gu.STRUCT_NAME_METADATA_STATISTICS,\"metadataStatistics\");let r=oa.FUNCTION_ID_INITIALIZE_INPUT_STRUCT_FS;e.addFunction(r,oa.FUNCTION_SIGNATURE_INITIALIZE_INPUT_STRUCT_FS,Ce.FRAGMENT),e.addFunctionLines(r,o)}var cDe=[];function lDe(e,t,n){let{vertexLines:i,fragmentLines:o}=n,r=cDe;i.enabled&&(sDe(e,i),r.length=0,r.push(\"#line 0\",t.vertexShaderText,JI),e.addVertexLines(r)),o.enabled&&(aDe(e,o),r.length=0,r.push(\"#line 0\",t.fragmentShaderText,QI),e.addFragmentLines(r))}var tW=oa;var ICn=T(S(),1);var nW={name:\"DequantizationPipelineStage\",FUNCTION_ID_DEQUANTIZATION_STAGE_VS:\"dequantizationStage\",FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS:\"void dequantizationStage(inout ProcessedAttributes attributes)\"};nW.process=function(e,t,n){let i=e.shaderBuilder,o=e.model,r=l(o.classificationType);i.addDefine(\"USE_DEQUANTIZATION\",void 0,Ce.VERTEX),i.addFunction(nW.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,nW.FUNCTION_SIGNATURE_DEQUANTIZATION_STAGE_VS,Ce.VERTEX);let s=t.attributes;for(let a=0;a<s.length;a++){let c=s[a],d=c.quantization;if(!l(d))continue;let u=c.semantic===St.POSITION,m=c.semantic===St.TEXCOORD;if(r&&!u&&!m)continue;let p=qt.getAttributeInfo(c);uDe(i,p),dDe(e,p)}};function dDe(e,t){let n=e.shaderBuilder,i=e.uniformMap,o=t.variableName,r=t.attribute.quantization;if(r.octEncoded){let s=`model_normalizationRange_${o}`;n.addUniform(\"float\",s,Ce.VERTEX),i[s]=function(){return r.normalizationRange}}else{let s=`model_quantizedVolumeOffset_${o}`,a=`model_quantizedVolumeStepSize_${o}`,c=t.glslType;n.addUniform(c,s,Ce.VERTEX),n.addUniform(c,a,Ce.VERTEX);let d=r.quantizedVolumeOffset,u=r.quantizedVolumeStepSize;/^color_\\d+$/.test(o)&&(d=Sse(d,0),u=Sse(u,1)),i[s]=function(){return d},i[a]=function(){return u}}}function Sse(e,t){return e instanceof se?e:new se(e.x,e.y,e.z,t)}function uDe(e,t){let n=t.variableName,i=t.attribute.quantization,o;i.octEncoded?o=mDe(n,i):o=hDe(n),e.addFunctionLines(nW.FUNCTION_ID_DEQUANTIZATION_STAGE_VS,[o])}function mDe(e,t){let n=`attributes.${e}`,i=`a_quantized_${e}`,o=`model_normalizationRange_${e}`,r=t.octEncodedZXY?\".zxy\":\".xyz\";return`${n} = czm_octDecode(${i}, ${o})${r};`}function hDe(e){let t=`attributes.${e}`,n=`a_quantized_${e}`,i=`model_quantizedVolumeOffset_${e}`,o=`model_quantizedVolumeStepSize_${e}`;return`${t} = ${i} + ${n} * ${o};`}var iW=nW;var r1n=T(S(),1);var PCn=T(S(),1),oW=`void geometryStage(out ProcessedAttributes attributes) { attributes.positionMC = v_positionMC; attributes.positionEC = v_positionEC; #if defined(COMPUTE_POSITION_WC_CUSTOM_SHADER) || defined(COMPUTE_POSITION_WC_STYLE) || defined(COMPUTE_POSITION_WC_ATMOSPHERE) attributes.positionWC = v_positionWC; #endif #ifdef HAS_NORMALS // renormalize after interpolation attributes.normalEC = normalize(v_normalEC); #endif #ifdef HAS_TANGENTS attributes.tangentEC = normalize(v_tangentEC); #endif #ifdef HAS_BITANGENTS attributes.bitangentEC = normalize(v_bitangentEC); #endif // Everything else is dynamically generated in GeometryPipelineStage setDynamicVaryings(attributes); } `;var"
}