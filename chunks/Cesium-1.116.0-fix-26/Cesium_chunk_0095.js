{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 95,
    "total_chunks": 194,
    "chunk_size": 40105,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.702Z"
  },
  "content": "< globeDepth1) { vec4 pEC2 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp); float globeDepth2 = getGlobeDepth(pEC2); if (globeDepth2 != 0.0 && pEC2.z + depthsilon < globeDepth2) { vec4 pEC3 = addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp); float globeDepth3 = getGlobeDepth(pEC3); if (globeDepth3 != 0.0 && pEC3.z + depthsilon < globeDepth3) { positionEC.xyz = vec3(0.0); } } } } #endif positionEC = addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp); gl_Position = czm_projection * positionEC; v_textureCoordinates = textureCoordinates; #ifdef LOG_DEPTH czm_vertexLogDepth(); #endif #ifdef DISABLE_DEPTH_DISTANCE if (disableDepthTestDistance == 0.0 && czm_minimumDisableDepthTestDistance != 0.0) { disableDepthTestDistance = czm_minimumDisableDepthTestDistance; } if (disableDepthTestDistance != 0.0) { // Don't try to \"multiply both sides\" by w. Greater/less-than comparisons won't work for negative values of w. float zclip = gl_Position.z / gl_Position.w; bool clipped = (zclip < -1.0 || zclip > 1.0); if (!clipped && (disableDepthTestDistance < 0.0 || (lengthSq > 0.0 && lengthSq < disableDepthTestDistance))) { // Position z on the near plane. gl_Position.z = -gl_Position.w; #ifdef LOG_DEPTH v_depthFromNearPlusOne = 1.0; #endif } } #endif #ifdef FRAGMENT_DEPTH_CHECK if (sizeInMeters) { translate /= mpp; dimensions /= mpp; imageSize /= mpp; } #if defined(ROTATION) || defined(ALIGNED_AXIS) v_rotationMatrix = rotationMatrix; #else v_rotationMatrix = mat2(1.0, 0.0, 0.0, 1.0); #endif float enableDepthCheck = 0.0; if (lengthSq < disableDepthTestDistance) { enableDepthCheck = 1.0; } float dw = floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12)); float dh = floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12)); float iw = floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12)); float ih = floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12)); v_compressed.x = eyeDepth; v_compressed.y = applyTranslate * SHIFT_LEFT1 + enableDepthCheck; v_compressed.z = dw * SHIFT_LEFT12 + dh; v_compressed.w = iw * SHIFT_LEFT12 + ih; v_originTextureCoordinateAndTranslate.xy = depthOrigin; v_originTextureCoordinateAndTranslate.zw = translate; v_textureCoordinateBounds = textureCoordinateBoundsOrLabelTranslate; #endif #ifdef SDF vec4 outlineColor; float outlineWidth; temp = sdf.x; temp = temp * SHIFT_RIGHT8; outlineColor.b = (temp - floor(temp)) * SHIFT_LEFT8; temp = floor(temp) * SHIFT_RIGHT8; outlineColor.g = (temp - floor(temp)) * SHIFT_LEFT8; outlineColor.r = floor(temp); temp = sdf.y; temp = temp * SHIFT_RIGHT8; float temp3 = (temp - floor(temp)) * SHIFT_LEFT8; temp = floor(temp) * SHIFT_RIGHT8; outlineWidth = (temp - floor(temp)) * SHIFT_LEFT8; outlineColor.a = floor(temp); outlineColor /= 255.0; v_outlineWidth = outlineWidth / 255.0; v_outlineColor = outlineColor; v_outlineColor.a *= translucency; #ifdef DEPTH_FAIL_TRANSLUCENCY v_outlineColor.a *= depthFailTranslucency; #endif #endif v_pickColor = pickColor; v_color = color; v_color.a *= translucency; #ifdef DEPTH_FAIL_TRANSLUCENCY v_color.a *= depthFailTranslucency; #endif } `;var iXn=T(S(),1);function hi(e,t){e=g(e,g.EMPTY_OBJECT);let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,o=e.scaleByDistance,r=e.distanceDisplayCondition;l(n)&&(n=At.clone(n)),l(i)&&(i=At.clone(i)),l(o)&&(o=At.clone(o)),l(r)&&(r=It.clone(r)),this._show=g(e.show,!0),this._position=h.clone(g(e.position,h.ZERO)),this._actualPosition=h.clone(this._position),this._pixelOffset=D.clone(g(e.pixelOffset,D.ZERO)),this._translate=new D(0,0),this._eyeOffset=h.clone(g(e.eyeOffset,h.ZERO)),this._heightReference=g(e.heightReference,Je.NONE),this._verticalOrigin=g(e.verticalOrigin,Wn.CENTER),this._horizontalOrigin=g(e.horizontalOrigin,ui.CENTER),this._scale=g(e.scale,1),this._color=O.clone(g(e.color,O.WHITE)),this._rotation=g(e.rotation,0),this._alignedAxis=h.clone(g(e.alignedAxis,h.ZERO)),this._width=e.width,this._height=e.height,this._scaleByDistance=o,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._sizeInMeters=g(e.sizeInMeters,!1),this._distanceDisplayCondition=r,this._disableDepthTestDistance=e.disableDepthTestDistance,this._id=e.id,this._collection=g(e.collection,t),this._pickId=void 0,this._pickPrimitive=g(e._pickPrimitive,this),this._billboardCollection=t,this._dirty=!1,this._index=-1,this._batchIndex=void 0,this._depthFailTranslucency=void 0,this._imageIndex=-1,this._imageIndexPromise=void 0,this._imageId=void 0,this._image=void 0,this._imageSubRegion=void 0,this._imageWidth=void 0,this._imageHeight=void 0,this._labelDimensions=void 0,this._labelHorizontalOrigin=void 0,this._labelTranslate=void 0;let s=e.image,a=e.imageId;l(s)&&(l(a)||(typeof s==\"string\"?a=s:l(s.src)?a=s.src:a=Bn()),this._imageId=a,this._image=s),l(e.imageSubRegion)&&(this._imageId=a,this._imageSubRegion=e.imageSubRegion),l(this._billboardCollection._textureAtlas)&&this._loadImage(),this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=ie.SCENE3D,this._clusterShow=!0,this._outlineColor=O.clone(g(e.outlineColor,O.BLACK)),this._outlineWidth=g(e.outlineWidth,0),this._updateClamping()}var rae=hi.SHOW_INDEX=0,TN=hi.POSITION_INDEX=1,lae=hi.PIXEL_OFFSET_INDEX=2,jBe=hi.EYE_OFFSET_INDEX=3,qBe=hi.HORIZONTAL_ORIGIN_INDEX=4,$Be=hi.VERTICAL_ORIGIN_INDEX=5,eYe=hi.SCALE_INDEX=6,SN=hi.IMAGE_INDEX_INDEX=7,sae=hi.COLOR_INDEX=8,tYe=hi.ROTATION_INDEX=9,nYe=hi.ALIGNED_AXIS_INDEX=10,iYe=hi.SCALE_BY_DISTANCE_INDEX=11,oYe=hi.TRANSLUCENCY_BY_DISTANCE_INDEX=12,rYe=hi.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,sYe=hi.DISTANCE_DISPLAY_CONDITION=14,aYe=hi.DISABLE_DEPTH_DISTANCE=15;hi.TEXTURE_COORDINATE_BOUNDS=16;var aae=hi.SDF_INDEX=17,cYe=hi.DEPTH_FAIL_TRANSLUCENCY=18;hi.NUMBER_OF_PROPERTIES=19;function Xo(e,t){let n=e._billboardCollection;l(n)&&(n._updateBillboard(e,t),e._dirty=!0)}Object.defineProperties(hi.prototype,{show:{get:function(){return this._show},set:function(e){this._show!==e&&(this._show=e,Xo(this,rae))}},position:{get:function(){return this._position},set:function(e){let t=this._position;h.equals(t,e)||(h.clone(e,t),h.clone(e,this._actualPosition),this._updateClamping(),Xo(this,TN))}},heightReference:{get:function(){return this._heightReference},set:function(e){let t=this._heightReference;e!==t&&(this._heightReference=e,this._updateClamping(),Xo(this,TN))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){let t=this._pixelOffset;D.equals(t,e)||(D.clone(e,t),Xo(this,lae))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){let t=this._scaleByDistance;At.equals(t,e)||(this._scaleByDistance=At.clone(e,t),Xo(this,iYe))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){let t=this._translucencyByDistance;At.equals(t,e)||(this._translucencyByDistance=At.clone(e,t),Xo(this,oYe))}},depthFailTranslucency:{get:function(){return this._depthFailTranslucency},set:function(e){l(e)&&(bi.typeOf.number(\"value\",e),e<0&&(e=0),e>1&&(e=1)),this._depthFailTranslucency!==e&&(this._depthFailTranslucency=e,Xo(this,cYe))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){let t=this._pixelOffsetScaleByDistance;At.equals(t,e)||(this._pixelOffsetScaleByDistance=At.clone(e,t),Xo(this,rYe))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){let t=this._eyeOffset;h.equals(t,e)||(h.clone(e,t),Xo(this,jBe))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin!==e&&(this._horizontalOrigin=e,Xo(this,qBe))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){this._verticalOrigin!==e&&(this._verticalOrigin=e,Xo(this,$Be))}},scale:{get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e,Xo(this,eYe))}},color:{get:function(){return this._color},set:function(e){let t=this._color;O.equals(t,e)||(O.clone(e,t),Xo(this,sae))}},rotation:{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,Xo(this,tYe))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(e){let t=this._alignedAxis;h.equals(t,e)||(h.clone(e,t),Xo(this,nYe))}},width:{get:function(){return g(this._width,this._imageWidth)},set:function(e){this._width!==e&&(this._width=e,Xo(this,SN))}},height:{get:function(){return g(this._height,this._imageHeight)},set:function(e){this._height!==e&&(this._height=e,Xo(this,SN))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(e){this._sizeInMeters!==e&&(this._sizeInMeters=e,Xo(this,sae))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){It.equals(e,this._distanceDisplayCondition)||(this._distanceDisplayCondition=It.clone(e,this._distanceDisplayCondition),Xo(this,sYe))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){this._disableDepthTestDistance!==e&&(this._disableDepthTestDistance=e,Xo(this,aYe))}},id:{get:function(){return this._id},set:function(e){this._id=e,l(this._pickId)&&(this._pickId.object.id=e)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(e){this._pickPrimitive=e,l(this._pickId)&&(this._pickId.object.primitive=e)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(e){l(e)?typeof e==\"string\"?this.setImage(e,e):e instanceof Xe?this.setImage(e.url,e):l(e.src)?this.setImage(e.src,e):this.setImage(Bn(),e):(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=void 0,this._image=void 0,this._imageIndexPromise=void 0,Xo(this,SN))}},ready:{get:function(){return this._imageIndex!==-1}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=h.clone(e,this._actualClampedPosition),Xo(this,TN)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){this._clusterShow!==e&&(this._clusterShow=e,Xo(this,rae))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){let t=this._outlineColor;O.equals(t,e)||(O.clone(e,t),Xo(this,aae))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,Xo(this,aae))}}});hi.prototype.getPickId=function(e){return l(this._pickId)||(this._pickId=e.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id})),this._pickId};hi.prototype._updateClamping=function(){hi._updateClamping(this._billboardCollection,this)};var CN=new he;hi._updateClamping=function(e,t){let n=e._scene;if(!l(n))return;let i=n.globe,o=g(i?.ellipsoid,oe.WGS84),r=n.frameState.mode,s=r!==t._mode;if(t._mode=r,(t._heightReference===Je.NONE||s)&&l(t._removeCallbackFunc)&&(t._removeCallbackFunc(),t._removeCallbackFunc=void 0,t._clampedPosition=void 0),t._heightReference===Je.NONE||!l(t._position))return;l(t._removeCallbackFunc)&&t._removeCallbackFunc();let a=o.cartesianToCartographic(t._position);if(!l(a)){t._actualClampedPosition=void 0;return}function c(u){t._mode===ie.SCENE3D&&u.height<-2e3&&(u.height=0);let m=o.cartographicToCartesian(u,t._clampedPosition);DS(t._heightReference)&&(t._mode===ie.SCENE3D?(u.height+=a.height,o.cartographicToCartesian(u,m)):m.x+=a.height),t._clampedPosition=m}t._removeCallbackFunc=n.updateHeight(a,c,t._heightReference),he.clone(a,CN);let d=n.getHeight(a,t._heightReference);l(d)&&(CN.height=d),c(CN)};hi.prototype._loadImage=function(){let e=this._billboardCollection._textureAtlas,t=this._imageId,n=this._image,i=this._imageSubRegion,o,r=this;function s(c){if(r._imageId!==t||r._image!==n||!ze.equals(r._imageSubRegion,i))return;let d=e.textureCoordinates[c];r._imageWidth=e.texture.width*d.width,r._imageHeight=e.texture.height*d.height,r._imageIndex=c,r._ready=!0,r._image=void 0,r._imageIndexPromise=void 0,Xo(r,SN);let u=r._billboardCollection._scene;l(u)&&u.frameState.afterRender.push(()=>!0)}if(l(n)&&(o=e.addImage(t,n)),l(i)&&(o=e.addSubRegion(t,i)),this._imageIndexPromise=o,!l(o))return;let a=e.getImageIndex(t);if(l(a)&&!l(i)){s(a);return}o.then(s).catch(function(c){console.error(`Error loading image for billboard: ${c}`),r._imageIndexPromise=void 0})};hi.prototype.setImage=function(e,t){this._imageId!==e&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=e,this._image=t,l(this._billboardCollection._textureAtlas)&&this._loadImage())};hi.prototype.setImageSubRegion=function(e,t){this._imageId===e&&ze.equals(this._imageSubRegion,t)||(this._imageIndex=-1,this._imageId=e,this._imageSubRegion=ze.clone(t),l(this._billboardCollection._textureAtlas)&&this._loadImage())};hi.prototype._setTranslate=function(e){let t=this._translate;D.equals(t,e)||(D.clone(e,t),Xo(this,lae))};hi.prototype._getActualPosition=function(){return l(this._clampedPosition)?this._clampedPosition:this._actualPosition};hi.prototype._setActualPosition=function(e){l(this._clampedPosition)||h.clone(e,this._actualPosition),Xo(this,TN)};var cae=new se;hi._computeActualPosition=function(e,t,n,i){return l(e._clampedPosition)?(n.mode!==e._mode&&e._updateClamping(),e._clampedPosition):n.mode===ie.SCENE3D?t:(M.multiplyByPoint(i,t,cae),Zi.computeActualWgs84Position(n,cae))};var dae=new h;hi._computeScreenSpacePosition=function(e,t,n,i,o,r){let s=M.multiplyByPoint(e,t,dae),a=Zi.wgs84WithEyeOffsetToWindowCoordinates(o,s,n,r);if(l(a))return D.add(a,i,a),a};var _N=new D(0,0);hi.prototype.computeScreenSpacePosition=function(e,t){let n=this._billboardCollection;l(t)||(t=new D),D.clone(this._pixelOffset,_N),D.add(_N,this._translate,_N);let i=n.modelMatrix,o=this._position;if(l(this._clampedPosition)&&(o=this._clampedPosition,e.mode!==ie.SCENE3D)){let s=e.mapProjection,a=s.ellipsoid,c=s.unproject(o,CN);o=a.cartographicToCartesian(c,dae),i=M.IDENTITY}return hi._computeScreenSpacePosition(i,o,this._eyeOffset,_N,e,t)};hi.getScreenSpaceBoundingBox=function(e,t,n){let i=e.width,o=e.height,r=e.scale;i*=r,o*=r;let s=t.x;e.horizontalOrigin===ui.RIGHT?s-=i:e.horizontalOrigin===ui.CENTER&&(s-=i*.5);let a=t.y;return e.verticalOrigin===Wn.BOTTOM||e.verticalOrigin===Wn.BASELINE?a-=o:e.verticalOrigin===Wn.CENTER&&(a-=o*.5),l(n)||(n=new ze),n.x=s,n.y=a,n.width=i,n.height=o,n};hi.prototype.equals=function(e){return this===e||l(e)&&this._id===e._id&&h.equals(this._position,e._position)&&this._imageId===e._imageId&&this._show===e._show&&this._scale===e._scale&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&ze.equals(this._imageSubRegion,e._imageSubRegion)&&O.equals(this._color,e._color)&&D.equals(this._pixelOffset,e._pixelOffset)&&D.equals(this._translate,e._translate)&&h.equals(this._eyeOffset,e._eyeOffset)&&At.equals(this._scaleByDistance,e._scaleByDistance)&&At.equals(this._translucencyByDistance,e._translucencyByDistance)&&At.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&It.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._depthFailTranslucency===e._depthFailTranslucency&&this._disableDepthTestDistance===e._disableDepthTestDistance};hi.prototype._destroy=function(){l(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0),l(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this.image=void 0,this._pickId=this._pickId&&this._pickId.destroy(),this._billboardCollection=void 0};var ao=hi;var rXn=T(S(),1),lYe={OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2},Bi=Object.freeze(lYe);var aXn=T(S(),1),dYe={FONT_SIZE:48,PADDING:10,RADIUS:8,CUTOFF:.25},bs=Object.freeze(dYe);var _Xn=T(S(),1);function i0(e,t,n,i,o){this.bottomLeft=g(e,D.ZERO),this.topRight=g(t,D.ZERO),this.childNode1=n,this.childNode2=i,this.imageIndex=o}var uYe=new D(16,16);function gy(e){e=g(e,g.EMPTY_OBJECT);let t=g(e.borderWidthInPixels,1),n=g(e.initialSize,uYe);this._context=e.context,this._pixelFormat=g(e.pixelFormat,at.RGBA),this._borderWidthInPixels=t,this._textureCoordinates=[],this._guid=Bn(),this._idHash={},this._indexHash={},this._initialSize=n,this._root=void 0}Object.defineProperties(gy.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){return l(this._texture)||(this._texture=new Ft({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat})),this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}});function mYe(e,t){let n=e._context,i=e.numberOfImages,o=2,r=e._borderWidthInPixels;if(i>0){let s=e._texture.width,a=e._texture.height,c=o*(s+t.width+r),d=o*(a+t.height+r),u=s/c,m=a/d,p=new i0(new D(s+r,r),new D(c,a)),b=new i0(new D,new D(c,a),e._root,p),f=new i0(new D(r,a+r),new D(c,d)),x=new i0(new D,new D(c,d),b,f);for(let V=0;V<e._textureCoordinates.length;V++){let L=e._textureCoordinates[V];l(L)&&(L.x*=u,L.y*=m,L.width*=u,L.height*=m)}let _=new Ft({context:e._context,width:c,height:d,pixelFormat:e._pixelFormat}),C=new $s({context:n,colorTextures:[e._texture],destroyAttachments:!1});C._bind(),_.copyFromFramebuffer(0,0,0,0,c,d),C._unBind(),C.destroy(),e._texture=e._texture&&e._texture.destroy(),e._texture=_,e._root=x}else{let s=o*(t.width+2*r),a=o*(t.height+2*r);s<e._initialSize.x&&(s=e._initialSize.x),a<e._initialSize.y&&(a=e._initialSize.y),e._texture=e._texture&&e._texture.destroy(),e._texture=new Ft({context:e._context,width:s,height:a,pixelFormat:e._pixelFormat}),e._root=new i0(new D(r,r),new D(s,a))}}function VN(e,t,n){if(l(t)){if(!l(t.childNode1)&&!l(t.childNode2)){if(l(t.imageIndex))return;let i=t.topRight.x-t.bottomLeft.x,o=t.topRight.y-t.bottomLeft.y,r=i-n.width,s=o-n.height;if(r<0||s<0)return;if(r===0&&s===0)return t;if(r>s){t.childNode1=new i0(new D(t.bottomLeft.x,t.bottomLeft.y),new D(t.bottomLeft.x+n.width,t.topRight.y));let a=t.bottomLeft.x+n.width+e._borderWidthInPixels;a<t.topRight.x&&(t.childNode2=new i0(new D(a,t.bottomLeft.y),new D(t.topRight.x,t.topRight.y)))}else{t.childNode1=new i0(new D(t.bottomLeft.x,t.bottomLeft.y),new D(t.topRight.x,t.bottomLeft.y+n.height));let a=t.bottomLeft.y+n.height+e._borderWidthInPixels;a<t.topRight.y&&(t.childNode2=new i0(new D(t.bottomLeft.x,a),new D(t.topRight.x,t.topRight.y)))}return VN(e,t.childNode1,n)}return VN(e,t.childNode1,n)||VN(e,t.childNode2,n)}}function uae(e,t,n){let i=VN(e,e._root,t);if(l(i)){i.imageIndex=n;let o=e._texture.width,r=e._texture.height,s=i.topRight.x-i.bottomLeft.x,a=i.topRight.y-i.bottomLeft.y,c=i.bottomLeft.x/o,d=i.bottomLeft.y/r,u=s/o,m=a/r;e._textureCoordinates[n]=new ze(c,d,u,m),e._texture.copyFrom({source:t,xOffset:i.bottomLeft.x,yOffset:i.bottomLeft.y})}else mYe(e,t),uae(e,t,n);e._guid=Bn()}function mae(e,t){if(!l(e)||e.isDestroyed())return-1;let n=e.numberOfImages;return uae(e,t,n),n}gy.prototype.getImageIndex=function(e){return this._indexHash[e]};gy.prototype.addImageSync=function(e,t){let n=this._indexHash[e];return l(n)||(n=mae(this,t),this._idHash[e]=Promise.resolve(n),this._indexHash[e]=n),n};gy.prototype.addImage=function(e,t){let n=this._idHash[e];if(l(n))return n;typeof t==\"function\"?t=t(e):(typeof t==\"string\"||t instanceof Xe)&&(t=Xe.createIfNeeded(t).fetchImage());let i=this;return n=Promise.resolve(t).then(function(o){let r=mae(i,o);return i._indexHash[e]=r,r}),this._idHash[e]=n,n};gy.prototype.addSubRegion=function(e,t){let n=this._idHash[e];if(!l(n))throw new ue(`image with id \"${e}\" not found in the atlas.`);let i=this;return Promise.resolve(n).then(function(o){if(o===-1)return-1;let r=i._texture.width,s=i._texture.height,a=i._textureCoordinates[o],c=a.x+t.x/r,d=a.y+t.y/s,u=t.width/r,m=t.height/s,p=i._textureCoordinates.push(new ze(c,d,u,m))-1;return i._indexHash[e]=p,i._guid=Bn(),p})};gy.prototype.isDestroyed=function(){return!1};gy.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),me(this)};var xy=gy;var hYe=ao.SHOW_INDEX,HW=ao.POSITION_INDEX,fae=ao.PIXEL_OFFSET_INDEX,pae=ao.EYE_OFFSET_INDEX,fYe=ao.HORIZONTAL_ORIGIN_INDEX,pYe=ao.VERTICAL_ORIGIN_INDEX,bYe=ao.SCALE_INDEX,zW=ao.IMAGE_INDEX_INDEX,bae=ao.COLOR_INDEX,yYe=ao.ROTATION_INDEX,gYe=ao.ALIGNED_AXIS_INDEX,yae=ao.SCALE_BY_DISTANCE_INDEX,gae=ao.TRANSLUCENCY_BY_DISTANCE_INDEX,xae=ao.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,_ae=ao.DISTANCE_DISPLAY_CONDITION,xYe=ao.DISABLE_DEPTH_DISTANCE,_Ye=ao.TEXTURE_COORDINATE_BOUNDS,Tae=ao.SDF_INDEX,TYe=ao.DEPTH_FAIL_TRANSLUCENCY,dH=ao.NUMBER_OF_PROPERTIES,Qi,SYe={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,depthFailTranslucency:10,a_batchId:11,sdf:12},CYe={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,depthFailTranslucency:11,a_batchId:12,sdf:13};function Su(e){e=g(e,g.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._spDepthFail=void 0,this._spTranslucentDepthFail=void 0,this._rsDepthFail=Ne.fromCache({depthTest:{enabled:!0,func:ne.GREATER},blending:un.ALPHA_BLEND}),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(dH),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._allDepthFailTranslucencyNoValue=!0,this._baseVolume=new ce,this._baseVolumeWC=new ce,this._baseVolume2D=new ce,this._boundingVolume=new ce,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=g(e.show,!0),this.modelMatrix=M.clone(g(e.modelMatrix,M.IDENTITY)),this._modelMatrix=M.clone(M.IDENTITY),this.debugShowBoundingVolume=g(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=g(e.debugShowTextureAtlas,!1),this.blendOption=g(e.blendOption,Bi.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=ie.SCENE3D,this._buffersUsage=[Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW],this._highlightColor=O.clone(O.WHITE);let t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};let n=this._scene;l(n)&&l(n.terrainProviderChanged)&&(this._removeCallbackFunc=n.terrainProviderChanged.addEventListener(function(){let i=this._billboards,o=i.length;for(let r=0;r<o;++r)l(i[r])&&i[r]._updateClamping()},this))}Object.defineProperties(Su.prototype,{length:{get:function(){return uH(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}});function Sae(e){let t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}Su.prototype.add=function(e){let t=new ao(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t};Su.prototype.remove=function(e){return this.contains(e)?(this._billboards[e._index]=void 0,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1};Su.prototype.removeAll=function(){Sae(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0};function uH(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;let t=[],n=e._billboards,i=n.length;for(let o=0,r=0;o<i;++o){let s=n[o];l(s)&&(s._index=r++,t.push(s))}e._billboards=t}}Su.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]};Su.prototype.contains=function(e){return l(e)&&e._billboardCollection===this};Su.prototype.get=function(e){return uH(this),this._billboards[e]};var oH;function VYe(e){let n=e.cache.billboardCollection_indexBufferBatched;if(l(n))return n;let i=16384*6-6,o=new Uint16Array(i);for(let r=0,s=0;r<i;r+=6,s+=4)o[r]=s,o[r+1]=s+1,o[r+2]=s+2,o[r+3]=s+0,o[r+4]=s+2,o[r+5]=s+3;return n=pt.createIndexBuffer({context:e,typedArray:o,usage:Me.STATIC_DRAW,indexDatatype:Ae.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=n,n}function LYe(e){let t=e.cache.billboardCollection_indexBufferInstanced;return l(t)||(t=pt.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:Me.STATIC_DRAW,indexDatatype:Ae.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t),t}function ZYe(e){let t=e.cache.billboardCollection_vertexBufferInstanced;return l(t)||(t=pt.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:Me.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_vertexBufferInstanced=t),t}Su.prototype.computeNewBuffersUsage=function(){let e=this._buffersUsage,t=!1,n=this._propertiesChanged;for(let i=0;i<dH;++i){let o=n[i]===0?Me.STATIC_DRAW:Me.STREAM_DRAW;t=t||e[i]!==o,e[i]=o}return t};function RYe(e,t,n,i,o,r){let s=[{index:Qi.positionHighAndScale,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[HW]},{index:Qi.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[HW]},{index:Qi.compressedAttribute0,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[fae]},{index:Qi.compressedAttribute1,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[gae]},{index:Qi.compressedAttribute2,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[bae]},{index:Qi.eyeOffset,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[pae]},{index:Qi.scaleByDistance,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[yae]},{index:Qi.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[xae]},{index:Qi.compressedAttribute3,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[_ae]},{index:Qi.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[_Ye]},{index:Qi.depthFailTranslucency,componentsPerAttribute:1,componentDatatype:Q.FLOAT,usage:Me.STATIC_DRAW}];i&&s.push({index:Qi.direction,componentsPerAttribute:2,componentDatatype:Q.FLOAT,vertexBuffer:ZYe(e)}),l(o)&&s.push({index:Qi.a_batchId,componentsPerAttribute:1,componentDatatype:Q.FLOAT,bufferUsage:Me.STATIC_DRAW}),r&&s.push({index:Qi.sdf,componentsPerAttribute:2,componentDatatype:Q.FLOAT,usage:n[Tae]});let a=i?t:4*t;return new xp(e,s,a,i)}var rH=new Yn;function Cae(e,t,n,i,o){let r,s=i[Qi.positionHighAndScale],a=i[Qi.positionLowAndRotation],c=o._getActualPosition();e._mode===ie.SCENE3D&&(ce.expand(e._baseVolume,c,e._baseVolume),e._boundingVolumeDirty=!0),Yn.fromCartesian(c,rH);let d=o.scale,u=o.rotation;u!==0&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,d);let m=rH.high,p=rH.low;e._instanced?(r=o._index,s(r,m.x,m.y,m.z,d),a(r,p.x,p.y,p.z,u)):(r=o._index*4,s(r+0,m.x,m.y,m.z,d),s(r+1,m.x,m.y,m.z,d),s(r+2,m.x,m.y,m.z,d),s(r+3,m.x,m.y,m.z,d),a(r+0,p.x,p.y,p.z,u),a(r+1,p.x,p.y,p.z,u),a(r+2,p.x,p.y,p.z,u),a(r+3,p.x,p.y,p.z,u))}var Tu=new D,_u=32768,YC=65536,sH=4096,uf=256,GYe=128,EYe=32,XYe=8,Vae=4,IYe=1/256,Lae=0,Zae=2,Rae=3,Gae=1;function Eae(e,t,n,i,o){let r,s=i[Qi.compressedAttribute0],a=o.pixelOffset,c=a.x,d=a.y,u=o._translate,m=u.x,p=u.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(c+m),Math.abs(-d+p));let b=o.horizontalOrigin,f=o._verticalOrigin,x=o.show&&o.clusterShow;o.color.alpha===0&&(x=!1),f===Wn.BASELINE&&(f=Wn.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&b===ui.CENTER,e._allVerticalCenter=e._allVerticalCenter&&f===Wn.CENTER;let _=0,C=0,V=0,L=0,R=o._imageIndex;if(R!==-1){let B=n[R];_=B.x,C=B.y,V=B.width,L=B.height}let G=_+V,X=C+L,v=Math.floor(P.clamp(c,-_u,_u)+_u)*GYe;v+=(b+1)*EYe,v+=(f+1)*XYe,v+=(x?1:0)*Vae;let W=Math.floor(P.clamp(d,-_u,_u)+_u)*uf,F=Math.floor(P.clamp(m,-_u,_u)+_u)*uf,A=(P.clamp(p,-_u,_u)+_u)*IYe,y=Math.floor(A),Z=Math.floor((A-y)*uf);W+=y,F+=Z,Tu.x=_,Tu.y=C;let E=wn.compressTextureCoordinates(Tu);Tu.x=G;let I=wn.compressTextureCoordinates(Tu);Tu.y=X;let w=wn.compressTextureCoordinates(Tu);Tu.x=_;let k=wn.compressTextureCoordinates(Tu);e._instanced?(r=o._index,s(r,v,W,F,E)):(r=o._index*4,s(r+0,v+Lae,W,F,E),s(r+1,v+Zae,W,F,I),s(r+2,v+Rae,W,F,w),s(r+3,v+Gae,W,F,k))}function Xae(e,t,n,i,o){let r,s=i[Qi.compressedAttribute1],a=o.alignedAxis;h.equals(a,h.ZERO)||(e._shaderAlignedAxis=!0);let c=0,d=1,u=1,m=1,p=o.translucencyByDistance;l(p)&&(c=p.near,d=p.nearValue,u=p.far,m=p.farValue,(d!==1||m!==1)&&(e._shaderTranslucencyByDistance=!0));let b=0,f=o._imageIndex;f!==-1&&(b=n[f].width);let x=e._textureAtlas.texture.width,_=Math.round(g(o.width,x*b));e._maxSize=Math.max(e._maxSize,_);let C=P.clamp(_,0,YC),V=0;Math.abs(h.magnitudeSquared(a)-1)<P.EPSILON6&&(V=wn.octEncodeFloat(a)),d=P.clamp(d,0,1),d=d===1?255:d*255|0,C=C*uf+d,m=P.clamp(m,0,1),m=m===1?255:m*255|0,V=V*uf+m,e._instanced?(r=o._index,s(r,C,V,c,u)):(r=o._index*4,s(r+0,C,V,c,u),s(r+1,C,V,c,u),s(r+2,C,V,c,u),s(r+3,C,V,c,u))}function cH(e,t,n,i,o){let r,s=i[Qi.compressedAttribute2],a=o.color,c=l(e._batchTable)?O.WHITE:o.getPickId(t.context).color,d=o.sizeInMeters?1:0,u=Math.abs(h.magnitudeSquared(o.alignedAxis)-1)<P.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&d===1;let m=0,p=o._imageIndex;p!==-1&&(m=n[p].height);let b=e._textureAtlas.texture.dimensions,f=Math.round(g(o.height,b.y*m));e._maxSize=Math.max(e._maxSize,f);let x=g(o._labelHorizontalOrigin,-2);x+=2;let _=f*Vae+x,C=O.floatToByte(a.red),V=O.floatToByte(a.green),L=O.floatToByte(a.blue),R=C*YC+V*uf+L;C=O.floatToByte(c.red),V=O.floatToByte(c.green),L=O.floatToByte(c.blue);let G=C*YC+V*uf+L,X=O.floatToByte(a.alpha)*YC+O.floatToByte(c.alpha)*uf;X+=d*2+u,e._instanced?(r=o._index,s(r,R,G,X,_)):(r=o._index*4,s(r+0,R,G,X,_),s(r+1,R,G,X,_),s(r+2,R,G,X,_),s(r+3,R,G,X,_))}function lH(e,t,n,i,o){let r,s=i[Qi.eyeOffset],a=o.eyeOffset,c=a.z;if(o._heightReference!==Je.NONE&&(c*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(a.x),Math.abs(a.y),Math.abs(c)),e._instanced){let d=0,u=0,m=o._imageIndex;if(m!==-1){let b=n[m];d=b.width,u=b.height}Tu.x=d,Tu.y=u;let p=wn.compressTextureCoordinates(Tu);r=o._index,s(r,a.x,a.y,c,p)}else r=o._index*4,s(r+0,a.x,a.y,c,0),s(r+1,a.x,a.y,c,0),s(r+2,a.x,a.y,c,0),s(r+3,a.x,a.y,c,0)}function Iae(e,t,n,i,o){let r,s=i[Qi.scaleByDistance],a=0,c=1,d=1,u=1,m=o.scaleByDistance;l(m)&&(a=m.near,c=m.nearValue,d=m.far,u=m.farValue,(c!==1||u!==1)&&(e._shaderScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,c,d,u)):(r=o._index*4,s(r+0,a,c,d,u),s(r+1,a,c,d,u),s(r+2,a,c,d,u),s(r+3,a,c,d,u))}function Wae(e,t,n,i,o){let r,s=i[Qi.pixelOffsetScaleByDistance],a=0,c=1,d=1,u=1,m=o.pixelOffsetScaleByDistance;l(m)&&(a=m.near,c=m.nearValue,d=m.far,u=m.farValue,(c!==1||u!==1)&&(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,c,d,u)):(r=o._index*4,s(r+0,a,c,d,u),s(r+1,a,c,d,u),s(r+2,a,c,d,u),s(r+3,a,c,d,u))}function Pae(e,t,n,i,o){let r,s=i[Qi.compressedAttribute3],a=0,c=Number.MAX_VALUE,d=o.distanceDisplayCondition;l(d)&&(a=d.near,c=d.far,a*=a,c*=c,e._shaderDistanceDisplayCondition=!0);let u=o.disableDepthTestDistance,m=cu(o.heightReference)&&t.context.depthTexture;l(u)||(u=m?5e3:0),u*=u,(m||u>0)&&(e._shaderDisableDepthDistance=!0,u===Number.POSITIVE_INFINITY&&(u=-1));let p,b;if(l(o._labelDimensions))b=o._labelDimensions.x,p=o._labelDimensions.y;else{let C=0,V=0,L=o._imageIndex;if(L!==-1){let G=n[L];C=G.height,V=G.width}p=Math.round(g(o.height,e._textureAtlas.texture.dimensions.y*C));let R=e._textureAtlas.texture.width;b=Math.round(g(o.width,R*V))}let f=Math.floor(P.clamp(b,0,sH)),x=Math.floor(P.clamp(p,0,sH)),_=f*sH+x;e._instanced?(r=o._index,s(r,a,c,u,_)):(r=o._index*4,s(r+0,a,c,u,_),s(r+1,a,c,u,_),s(r+2,a,c,u,_),s(r+3,a,c,u,_))}function vae(e,t,n,i,o){if(cu(o.heightReference)){let f=e._scene,x=t.context,_=t.globeTranslucencyState.translucent,C=l(f.globe)&&f.globe.depthTestAgainstTerrain;e._shaderClampToGround=x.depthTexture&&!_&&C}let r,s=i[Qi.textureCoordinateBoundsOrLabelTranslate];if(Yt.maximumVertexTextureImageUnits>0){let f=0,x=0;l(o._labelTranslate)&&(f=o._labelTranslate.x,x=o._labelTranslate.y),e._instanced?(r=o._index,s(r,f,x,0,0)):(r=o._index*4,s(r+0,f,x,0,0),s(r+1,f,x,0,0),s(r+2,f,x,0,0),s(r+3,f,x,0,0));return}let a=0,c=0,d=0,u=0,m=o._imageIndex;if(m!==-1){let f=n[m];a=f.x,c=f.y,d=f.width,u=f.height}let p=a+d,b=c+u;e._instanced?(r=o._index,s(r,a,c,p,b)):(r=o._index*4,s(r+0,a,c,p,b),s(r+1,a,c,p,b),s(r+2,a,c,p,b),s(r+3,a,c,p,b))}function WYe(e,t,n,i,o){if(!l(e._batchTable))return;let r=i[Qi.a_batchId],s=o._batchIndex,a;e._instanced?(a=o._index,r(a,s)):(a=o._index*4,r(a+0,s),r(a+1,s),r(a+2,s),r(a+3,s))}function wae(e,t,n,i,o){if(!e._sdf)return;let r,s=i[Qi.sdf],a=o.outlineColor,c=o.outlineWidth,d=O.floatToByte(a.red),u=O.floatToByte(a.green),m=O.floatToByte(a.blue),p=d*YC+u*uf+m,b=c/bs.RADIUS,f=O.floatToByte(a.alpha)*YC+O.floatToByte(b)*uf;e._instanced?(r=o._index,s(r,p,f)):(r=o._index*4,s(r+0,p+Lae,f),s(r+1,p+Zae,f),s(r+2,p+Rae,f),s(r+3,p+Gae,f))}function Fae(e,t,n,i,o){let r,s=i[Qi.depthFailTranslucency],a=1;e._allDepthFailTranslucencyNoValue||(o.depthFailTranslucency===void 0?a=0:a=o.depthFailTranslucency),e._instanced?(r=o._index,s(r,a)):(r=o._index*4,s(r+0,a),s(r+1,a),s(r+2,a),s(r+3,a))}function PYe(e,t,n,i,o){Cae(e,t,n,i,o),Eae(e,t,n,i,o),Xae(e,t,n,i,o),cH(e,t,n,i,o),lH(e,t,n,i,o),Iae(e,t,n,i,o),Wae(e,t,n,i,o),Pae(e,t,n,i,o),vae(e,t,n,i,o),WYe(e,t,n,i,o),wae(e,t,n,i,o),Fae(e,t,n,i,o)}function aH(e,t,n,i,o,r){let s;i.mode===ie.SCENE3D?(s=e._baseVolume,e._boundingVolumeDirty=!0):s=e._baseVolume2D;let a=[];for(let c=0;c<n;++c){let d=t[c],u=d.position,m=ao._computeActualPosition(d,u,i,o);l(m)&&(d._setActualPosition(m),r?a.push(m):ce.expand(s,m,s))}r&&ce.fromPoints(a,s)}function vYe(e,t){let n=t.mode,i=e._billboards,o=e._billboardsToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==ie.SCENE3D&&!M.equals(r,e.modelMatrix)?(e._mode=n,M.clone(e.modelMatrix,r),e._createVertexArray=!0,(n===ie.SCENE3D||n===ie.SCENE2D||n===ie.COLUMBUS_VIEW)&&aH(e,i,i.length,t,r,!0)):n===ie.MORPHING?aH(e,i,i.length,t,r,!0):(n===ie.SCENE2D||n===ie.COLUMBUS_VIEW)&&aH(e,o,e._billboardsToUpdateIndex,t,r,!1)}function wYe(e,t,n){let i=1;(!e._allSizedInMeters||e._maxPixelOffset!==0)&&(i=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight));let o=i*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(o*=.5);let r=i*e._maxPixelOffset+e._maxEyeOffset;n.radius+=o+r}function FYe(e,t){let i=t.createViewportQuadCommand(`uniform sampler2D billboard_texture; in vec2 v_textureCoordinates; void main() { out_FragColor = texture(billboard_texture, v_textureCoordinates); } `,{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return i.pass=Ze.OVERLAY,i}function hae(e,t,n){let i,o,r,s=l(e._batchTable)?\"VECTOR_TILE\":\"\",a=Yt.maximumVertexTextureImageUnits>0,c=[\"DEPTH_FAIL_TRANSLUCENCY\"],d=BC,u=DC;l(e._batchTable)&&(c.push(\"VECTOR_TILE\"),d=e._batchTable.getVertexShaderCallback(!1,\"a_batchId\",void 0)(d),u=e._batchTable.getFragmentShaderCallback(!1,void 0)(u)),i=new Ue({defines:c,sources:[d]}),e._instanced&&i.defines.push(\"INSTANCED\"),e._shaderRotation&&i.defines.push(\"ROTATION\"),e._shaderAlignedAxis&&i.defines.push(\"ALIGNED_AXIS\"),e._shaderScaleByDistance&&i.defines.push(\"EYE_DISTANCE_SCALING\"),e._shaderTranslucencyByDistance&&i.defines.push(\"EYE_DISTANCE_TRANSLUCENCY\"),e._shaderPixelOffsetScaleByDistance&&i.defines.push(\"EYE_DISTANCE_PIXEL_OFFSET\"),e._shaderDistanceDisplayCondition&&i.defines.push(\"DISTANCE_DISPLAY_CONDITION\"),e._shaderDisableDepthDistance&&i.defines.push(\"DISABLE_DEPTH_DISTANCE\"),e._shaderClampToGround&&(a?i.defines.push(\"VERTEX_DEPTH_CHECK\"):i.defines.push(\"FRAGMENT_DEPTH_CHECK\"));let m=1-bs.CUTOFF;e._sdf&&i.defines.push(\"SDF\"),e._blendOption===Bi.OPAQUE_AND_TRANSLUCENT&&(o=new Ue({defines:[\"OPAQUE\",s],sources:[u]}),e._shaderClampToGround&&(a?o.defines.push(\"VERTEX_DEPTH_CHECK\"):o.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(o.defines.push(\"SDF\"),o.defines.push(`SDF_EDGE ${m}`)),e._spDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spDepthFail,vertexShaderSource:i,fragmentShaderSource:o,attributeLocations:n}),r=new Ue({defines:[\"TRANSLUCENT\",s],sources:[u]}),e._shaderClampToGround&&(a?r.defines.push(\"VERTEX_DEPTH_CHECK\"):r.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(r.defines.push(\"SDF\"),r.defines.push(`SDF_EDGE ${m}`)),e._spTranslucentDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spTranslucentDepthFail,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:n})),e._blendOption===Bi.OPAQUE&&(o=new Ue({defines:[s],sources:[u]}),e._shaderClampToGround&&(a?o.defines.push(\"VERTEX_DEPTH_CHECK\"):o.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(o.defines.push(\"SDF\"),o.defines.push(`SDF_EDGE ${m}`)),e._spDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spDepthFail,vertexShaderSource:i,fragmentShaderSource:o,attributeLocations:n})),e._blendOption===Bi.TRANSLUCENT&&(r=new Ue({defines:[s],sources:[u]}),e._shaderClampToGround&&(a?r.defines.push(\"VERTEX_DEPTH_CHECK\"):r.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(r.defines.push(\"SDF\"),r.defines.push(`SDF_EDGE ${m}`)),e._spTranslucentDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spTranslucentDepthFail,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:n}))}var AYe=[];Su.prototype.update=function(e){if(uH(this),!this.show)return;let t=this._billboards,n=t.length;this._allDepthFailTranslucencyNoValue=!0,t.forEach(W=>{this._allDepthFailTranslucencyNoValue=this._allDepthFailTranslucencyNoValue&&W.depthFailTranslucency===void 0});let i=e.context;this._instanced=i.instancedArrays,Qi=this._instanced?CYe:SYe,oH=this._instanced?LYe:VYe;let o=this._textureAtlas;if(!l(o)){o=this._textureAtlas=new xy({context:i});for(let W=0;W<n;++W)t[W]._loadImage()}let r=o.textureCoordinates;if(r.length===0)return;vYe(this,e),t=this._billboards,n=t.length;let s=this._billboardsToUpdate,a=this._billboardsToUpdateIndex,c=this._propertiesChanged,d=o.guid,u=this._createVertexArray||this._textureAtlasGUID!==d;this._textureAtlasGUID=d;let m,p=e.passes,b=p.pick;if(u||!b&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let W=0;W<dH;++W)c[W]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),n>0){this._vaf=RYe(i,n,this._buffersUsage,this._instanced,this._batchTable,this._sdf),m=this._vaf.writers;for(let"
}