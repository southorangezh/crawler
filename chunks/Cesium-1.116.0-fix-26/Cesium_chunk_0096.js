{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 96,
    "total_chunks": 194,
    "chunk_size": 61742,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.703Z"
  },
  "content": "ue(`image with id \"${e}\" not found in the atlas.`);let i=this;return Promise.resolve(n).then(function(o){if(o===-1)return-1;let r=i._texture.width,s=i._texture.height,a=i._textureCoordinates[o],c=a.x+t.x/r,d=a.y+t.y/s,u=t.width/r,m=t.height/s,p=i._textureCoordinates.push(new ze(c,d,u,m))-1;return i._indexHash[e]=p,i._guid=Bn(),p})};gy.prototype.isDestroyed=function(){return!1};gy.prototype.destroy=function(){return this._texture=this._texture&&this._texture.destroy(),me(this)};var xy=gy;var hYe=ao.SHOW_INDEX,HW=ao.POSITION_INDEX,fae=ao.PIXEL_OFFSET_INDEX,pae=ao.EYE_OFFSET_INDEX,fYe=ao.HORIZONTAL_ORIGIN_INDEX,pYe=ao.VERTICAL_ORIGIN_INDEX,bYe=ao.SCALE_INDEX,zW=ao.IMAGE_INDEX_INDEX,bae=ao.COLOR_INDEX,yYe=ao.ROTATION_INDEX,gYe=ao.ALIGNED_AXIS_INDEX,yae=ao.SCALE_BY_DISTANCE_INDEX,gae=ao.TRANSLUCENCY_BY_DISTANCE_INDEX,xae=ao.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,_ae=ao.DISTANCE_DISPLAY_CONDITION,xYe=ao.DISABLE_DEPTH_DISTANCE,_Ye=ao.TEXTURE_COORDINATE_BOUNDS,Tae=ao.SDF_INDEX,TYe=ao.DEPTH_FAIL_TRANSLUCENCY,dH=ao.NUMBER_OF_PROPERTIES,Qi,SYe={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,depthFailTranslucency:10,a_batchId:11,sdf:12},CYe={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,depthFailTranslucency:11,a_batchId:12,sdf:13};function Su(e){e=g(e,g.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._textureAtlasGUID=void 0,this._destroyTextureAtlas=!0,this._sp=void 0,this._spTranslucent=void 0,this._rsOpaque=void 0,this._rsTranslucent=void 0,this._vaf=void 0,this._spDepthFail=void 0,this._spTranslucentDepthFail=void 0,this._rsDepthFail=Ne.fromCache({depthTest:{enabled:!0,func:ne.GREATER},blending:un.ALPHA_BLEND}),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!1,this._shaderRotation=!1,this._compiledShaderRotation=!1,this._shaderAlignedAxis=!1,this._compiledShaderAlignedAxis=!1,this._shaderScaleByDistance=!1,this._compiledShaderScaleByDistance=!1,this._shaderTranslucencyByDistance=!1,this._compiledShaderTranslucencyByDistance=!1,this._shaderPixelOffsetScaleByDistance=!1,this._compiledShaderPixelOffsetScaleByDistance=!1,this._shaderDistanceDisplayCondition=!1,this._compiledShaderDistanceDisplayCondition=!1,this._shaderDisableDepthDistance=!1,this._compiledShaderDisableDepthDistance=!1,this._shaderClampToGround=!1,this._compiledShaderClampToGround=!1,this._propertiesChanged=new Uint32Array(dH),this._maxSize=0,this._maxEyeOffset=0,this._maxScale=1,this._maxPixelOffset=0,this._allHorizontalCenter=!0,this._allVerticalCenter=!0,this._allSizedInMeters=!0,this._allDepthFailTranslucencyNoValue=!0,this._baseVolume=new ce,this._baseVolumeWC=new ce,this._baseVolume2D=new ce,this._boundingVolume=new ce,this._boundingVolumeDirty=!1,this._colorCommands=[],this.show=g(e.show,!0),this.modelMatrix=M.clone(g(e.modelMatrix,M.IDENTITY)),this._modelMatrix=M.clone(M.IDENTITY),this.debugShowBoundingVolume=g(e.debugShowBoundingVolume,!1),this.debugShowTextureAtlas=g(e.debugShowTextureAtlas,!1),this.blendOption=g(e.blendOption,Bi.OPAQUE_AND_TRANSLUCENT),this._blendOption=void 0,this._mode=ie.SCENE3D,this._buffersUsage=[Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW,Me.STATIC_DRAW],this._highlightColor=O.clone(O.WHITE);let t=this;this._uniforms={u_atlas:function(){return t._textureAtlas.texture},u_highlightColor:function(){return t._highlightColor}};let n=this._scene;l(n)&&l(n.terrainProviderChanged)&&(this._removeCallbackFunc=n.terrainProviderChanged.addEventListener(function(){let i=this._billboards,o=i.length;for(let r=0;r<o;++r)l(i[r])&&i[r]._updateClamping()},this))}Object.defineProperties(Su.prototype,{length:{get:function(){return uH(this),this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(e){this._textureAtlas!==e&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=e,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(e){this._destroyTextureAtlas=e}}});function Sae(e){let t=e.length;for(let n=0;n<t;++n)e[n]&&e[n]._destroy()}Su.prototype.add=function(e){let t=new ao(e,this);return t._index=this._billboards.length,this._billboards.push(t),this._createVertexArray=!0,t};Su.prototype.remove=function(e){return this.contains(e)?(this._billboards[e._index]=void 0,this._billboardsRemoved=!0,this._createVertexArray=!0,e._destroy(),!0):!1};Su.prototype.removeAll=function(){Sae(this._billboards),this._billboards=[],this._billboardsToUpdate=[],this._billboardsToUpdateIndex=0,this._billboardsRemoved=!1,this._createVertexArray=!0};function uH(e){if(e._billboardsRemoved){e._billboardsRemoved=!1;let t=[],n=e._billboards,i=n.length;for(let o=0,r=0;o<i;++o){let s=n[o];l(s)&&(s._index=r++,t.push(s))}e._billboards=t}}Su.prototype._updateBillboard=function(e,t){e._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=e),++this._propertiesChanged[t]};Su.prototype.contains=function(e){return l(e)&&e._billboardCollection===this};Su.prototype.get=function(e){return uH(this),this._billboards[e]};var oH;function VYe(e){let n=e.cache.billboardCollection_indexBufferBatched;if(l(n))return n;let i=16384*6-6,o=new Uint16Array(i);for(let r=0,s=0;r<i;r+=6,s+=4)o[r]=s,o[r+1]=s+1,o[r+2]=s+2,o[r+3]=s+0,o[r+4]=s+2,o[r+5]=s+3;return n=pt.createIndexBuffer({context:e,typedArray:o,usage:Me.STATIC_DRAW,indexDatatype:Ae.UNSIGNED_SHORT}),n.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferBatched=n,n}function LYe(e){let t=e.cache.billboardCollection_indexBufferInstanced;return l(t)||(t=pt.createIndexBuffer({context:e,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:Me.STATIC_DRAW,indexDatatype:Ae.UNSIGNED_SHORT}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_indexBufferInstanced=t),t}function ZYe(e){let t=e.cache.billboardCollection_vertexBufferInstanced;return l(t)||(t=pt.createVertexBuffer({context:e,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:Me.STATIC_DRAW}),t.vertexArrayDestroyable=!1,e.cache.billboardCollection_vertexBufferInstanced=t),t}Su.prototype.computeNewBuffersUsage=function(){let e=this._buffersUsage,t=!1,n=this._propertiesChanged;for(let i=0;i<dH;++i){let o=n[i]===0?Me.STATIC_DRAW:Me.STREAM_DRAW;t=t||e[i]!==o,e[i]=o}return t};function RYe(e,t,n,i,o,r){let s=[{index:Qi.positionHighAndScale,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[HW]},{index:Qi.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[HW]},{index:Qi.compressedAttribute0,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[fae]},{index:Qi.compressedAttribute1,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[gae]},{index:Qi.compressedAttribute2,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[bae]},{index:Qi.eyeOffset,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[pae]},{index:Qi.scaleByDistance,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[yae]},{index:Qi.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[xae]},{index:Qi.compressedAttribute3,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[_ae]},{index:Qi.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:Q.FLOAT,usage:n[_Ye]},{index:Qi.depthFailTranslucency,componentsPerAttribute:1,componentDatatype:Q.FLOAT,usage:Me.STATIC_DRAW}];i&&s.push({index:Qi.direction,componentsPerAttribute:2,componentDatatype:Q.FLOAT,vertexBuffer:ZYe(e)}),l(o)&&s.push({index:Qi.a_batchId,componentsPerAttribute:1,componentDatatype:Q.FLOAT,bufferUsage:Me.STATIC_DRAW}),r&&s.push({index:Qi.sdf,componentsPerAttribute:2,componentDatatype:Q.FLOAT,usage:n[Tae]});let a=i?t:4*t;return new xp(e,s,a,i)}var rH=new Yn;function Cae(e,t,n,i,o){let r,s=i[Qi.positionHighAndScale],a=i[Qi.positionLowAndRotation],c=o._getActualPosition();e._mode===ie.SCENE3D&&(ce.expand(e._baseVolume,c,e._baseVolume),e._boundingVolumeDirty=!0),Yn.fromCartesian(c,rH);let d=o.scale,u=o.rotation;u!==0&&(e._shaderRotation=!0),e._maxScale=Math.max(e._maxScale,d);let m=rH.high,p=rH.low;e._instanced?(r=o._index,s(r,m.x,m.y,m.z,d),a(r,p.x,p.y,p.z,u)):(r=o._index*4,s(r+0,m.x,m.y,m.z,d),s(r+1,m.x,m.y,m.z,d),s(r+2,m.x,m.y,m.z,d),s(r+3,m.x,m.y,m.z,d),a(r+0,p.x,p.y,p.z,u),a(r+1,p.x,p.y,p.z,u),a(r+2,p.x,p.y,p.z,u),a(r+3,p.x,p.y,p.z,u))}var Tu=new D,_u=32768,YC=65536,sH=4096,uf=256,GYe=128,EYe=32,XYe=8,Vae=4,IYe=1/256,Lae=0,Zae=2,Rae=3,Gae=1;function Eae(e,t,n,i,o){let r,s=i[Qi.compressedAttribute0],a=o.pixelOffset,c=a.x,d=a.y,u=o._translate,m=u.x,p=u.y;e._maxPixelOffset=Math.max(e._maxPixelOffset,Math.abs(c+m),Math.abs(-d+p));let b=o.horizontalOrigin,f=o._verticalOrigin,x=o.show&&o.clusterShow;o.color.alpha===0&&(x=!1),f===Wn.BASELINE&&(f=Wn.BOTTOM),e._allHorizontalCenter=e._allHorizontalCenter&&b===ui.CENTER,e._allVerticalCenter=e._allVerticalCenter&&f===Wn.CENTER;let _=0,C=0,V=0,L=0,R=o._imageIndex;if(R!==-1){let B=n[R];_=B.x,C=B.y,V=B.width,L=B.height}let G=_+V,X=C+L,v=Math.floor(P.clamp(c,-_u,_u)+_u)*GYe;v+=(b+1)*EYe,v+=(f+1)*XYe,v+=(x?1:0)*Vae;let W=Math.floor(P.clamp(d,-_u,_u)+_u)*uf,F=Math.floor(P.clamp(m,-_u,_u)+_u)*uf,A=(P.clamp(p,-_u,_u)+_u)*IYe,y=Math.floor(A),Z=Math.floor((A-y)*uf);W+=y,F+=Z,Tu.x=_,Tu.y=C;let E=wn.compressTextureCoordinates(Tu);Tu.x=G;let I=wn.compressTextureCoordinates(Tu);Tu.y=X;let w=wn.compressTextureCoordinates(Tu);Tu.x=_;let k=wn.compressTextureCoordinates(Tu);e._instanced?(r=o._index,s(r,v,W,F,E)):(r=o._index*4,s(r+0,v+Lae,W,F,E),s(r+1,v+Zae,W,F,I),s(r+2,v+Rae,W,F,w),s(r+3,v+Gae,W,F,k))}function Xae(e,t,n,i,o){let r,s=i[Qi.compressedAttribute1],a=o.alignedAxis;h.equals(a,h.ZERO)||(e._shaderAlignedAxis=!0);let c=0,d=1,u=1,m=1,p=o.translucencyByDistance;l(p)&&(c=p.near,d=p.nearValue,u=p.far,m=p.farValue,(d!==1||m!==1)&&(e._shaderTranslucencyByDistance=!0));let b=0,f=o._imageIndex;f!==-1&&(b=n[f].width);let x=e._textureAtlas.texture.width,_=Math.round(g(o.width,x*b));e._maxSize=Math.max(e._maxSize,_);let C=P.clamp(_,0,YC),V=0;Math.abs(h.magnitudeSquared(a)-1)<P.EPSILON6&&(V=wn.octEncodeFloat(a)),d=P.clamp(d,0,1),d=d===1?255:d*255|0,C=C*uf+d,m=P.clamp(m,0,1),m=m===1?255:m*255|0,V=V*uf+m,e._instanced?(r=o._index,s(r,C,V,c,u)):(r=o._index*4,s(r+0,C,V,c,u),s(r+1,C,V,c,u),s(r+2,C,V,c,u),s(r+3,C,V,c,u))}function cH(e,t,n,i,o){let r,s=i[Qi.compressedAttribute2],a=o.color,c=l(e._batchTable)?O.WHITE:o.getPickId(t.context).color,d=o.sizeInMeters?1:0,u=Math.abs(h.magnitudeSquared(o.alignedAxis)-1)<P.EPSILON6?1:0;e._allSizedInMeters=e._allSizedInMeters&&d===1;let m=0,p=o._imageIndex;p!==-1&&(m=n[p].height);let b=e._textureAtlas.texture.dimensions,f=Math.round(g(o.height,b.y*m));e._maxSize=Math.max(e._maxSize,f);let x=g(o._labelHorizontalOrigin,-2);x+=2;let _=f*Vae+x,C=O.floatToByte(a.red),V=O.floatToByte(a.green),L=O.floatToByte(a.blue),R=C*YC+V*uf+L;C=O.floatToByte(c.red),V=O.floatToByte(c.green),L=O.floatToByte(c.blue);let G=C*YC+V*uf+L,X=O.floatToByte(a.alpha)*YC+O.floatToByte(c.alpha)*uf;X+=d*2+u,e._instanced?(r=o._index,s(r,R,G,X,_)):(r=o._index*4,s(r+0,R,G,X,_),s(r+1,R,G,X,_),s(r+2,R,G,X,_),s(r+3,R,G,X,_))}function lH(e,t,n,i,o){let r,s=i[Qi.eyeOffset],a=o.eyeOffset,c=a.z;if(o._heightReference!==Je.NONE&&(c*=1.005),e._maxEyeOffset=Math.max(e._maxEyeOffset,Math.abs(a.x),Math.abs(a.y),Math.abs(c)),e._instanced){let d=0,u=0,m=o._imageIndex;if(m!==-1){let b=n[m];d=b.width,u=b.height}Tu.x=d,Tu.y=u;let p=wn.compressTextureCoordinates(Tu);r=o._index,s(r,a.x,a.y,c,p)}else r=o._index*4,s(r+0,a.x,a.y,c,0),s(r+1,a.x,a.y,c,0),s(r+2,a.x,a.y,c,0),s(r+3,a.x,a.y,c,0)}function Iae(e,t,n,i,o){let r,s=i[Qi.scaleByDistance],a=0,c=1,d=1,u=1,m=o.scaleByDistance;l(m)&&(a=m.near,c=m.nearValue,d=m.far,u=m.farValue,(c!==1||u!==1)&&(e._shaderScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,c,d,u)):(r=o._index*4,s(r+0,a,c,d,u),s(r+1,a,c,d,u),s(r+2,a,c,d,u),s(r+3,a,c,d,u))}function Wae(e,t,n,i,o){let r,s=i[Qi.pixelOffsetScaleByDistance],a=0,c=1,d=1,u=1,m=o.pixelOffsetScaleByDistance;l(m)&&(a=m.near,c=m.nearValue,d=m.far,u=m.farValue,(c!==1||u!==1)&&(e._shaderPixelOffsetScaleByDistance=!0)),e._instanced?(r=o._index,s(r,a,c,d,u)):(r=o._index*4,s(r+0,a,c,d,u),s(r+1,a,c,d,u),s(r+2,a,c,d,u),s(r+3,a,c,d,u))}function Pae(e,t,n,i,o){let r,s=i[Qi.compressedAttribute3],a=0,c=Number.MAX_VALUE,d=o.distanceDisplayCondition;l(d)&&(a=d.near,c=d.far,a*=a,c*=c,e._shaderDistanceDisplayCondition=!0);let u=o.disableDepthTestDistance,m=cu(o.heightReference)&&t.context.depthTexture;l(u)||(u=m?5e3:0),u*=u,(m||u>0)&&(e._shaderDisableDepthDistance=!0,u===Number.POSITIVE_INFINITY&&(u=-1));let p,b;if(l(o._labelDimensions))b=o._labelDimensions.x,p=o._labelDimensions.y;else{let C=0,V=0,L=o._imageIndex;if(L!==-1){let G=n[L];C=G.height,V=G.width}p=Math.round(g(o.height,e._textureAtlas.texture.dimensions.y*C));let R=e._textureAtlas.texture.width;b=Math.round(g(o.width,R*V))}let f=Math.floor(P.clamp(b,0,sH)),x=Math.floor(P.clamp(p,0,sH)),_=f*sH+x;e._instanced?(r=o._index,s(r,a,c,u,_)):(r=o._index*4,s(r+0,a,c,u,_),s(r+1,a,c,u,_),s(r+2,a,c,u,_),s(r+3,a,c,u,_))}function vae(e,t,n,i,o){if(cu(o.heightReference)){let f=e._scene,x=t.context,_=t.globeTranslucencyState.translucent,C=l(f.globe)&&f.globe.depthTestAgainstTerrain;e._shaderClampToGround=x.depthTexture&&!_&&C}let r,s=i[Qi.textureCoordinateBoundsOrLabelTranslate];if(Yt.maximumVertexTextureImageUnits>0){let f=0,x=0;l(o._labelTranslate)&&(f=o._labelTranslate.x,x=o._labelTranslate.y),e._instanced?(r=o._index,s(r,f,x,0,0)):(r=o._index*4,s(r+0,f,x,0,0),s(r+1,f,x,0,0),s(r+2,f,x,0,0),s(r+3,f,x,0,0));return}let a=0,c=0,d=0,u=0,m=o._imageIndex;if(m!==-1){let f=n[m];a=f.x,c=f.y,d=f.width,u=f.height}let p=a+d,b=c+u;e._instanced?(r=o._index,s(r,a,c,p,b)):(r=o._index*4,s(r+0,a,c,p,b),s(r+1,a,c,p,b),s(r+2,a,c,p,b),s(r+3,a,c,p,b))}function WYe(e,t,n,i,o){if(!l(e._batchTable))return;let r=i[Qi.a_batchId],s=o._batchIndex,a;e._instanced?(a=o._index,r(a,s)):(a=o._index*4,r(a+0,s),r(a+1,s),r(a+2,s),r(a+3,s))}function wae(e,t,n,i,o){if(!e._sdf)return;let r,s=i[Qi.sdf],a=o.outlineColor,c=o.outlineWidth,d=O.floatToByte(a.red),u=O.floatToByte(a.green),m=O.floatToByte(a.blue),p=d*YC+u*uf+m,b=c/bs.RADIUS,f=O.floatToByte(a.alpha)*YC+O.floatToByte(b)*uf;e._instanced?(r=o._index,s(r,p,f)):(r=o._index*4,s(r+0,p+Lae,f),s(r+1,p+Zae,f),s(r+2,p+Rae,f),s(r+3,p+Gae,f))}function Fae(e,t,n,i,o){let r,s=i[Qi.depthFailTranslucency],a=1;e._allDepthFailTranslucencyNoValue||(o.depthFailTranslucency===void 0?a=0:a=o.depthFailTranslucency),e._instanced?(r=o._index,s(r,a)):(r=o._index*4,s(r+0,a),s(r+1,a),s(r+2,a),s(r+3,a))}function PYe(e,t,n,i,o){Cae(e,t,n,i,o),Eae(e,t,n,i,o),Xae(e,t,n,i,o),cH(e,t,n,i,o),lH(e,t,n,i,o),Iae(e,t,n,i,o),Wae(e,t,n,i,o),Pae(e,t,n,i,o),vae(e,t,n,i,o),WYe(e,t,n,i,o),wae(e,t,n,i,o),Fae(e,t,n,i,o)}function aH(e,t,n,i,o,r){let s;i.mode===ie.SCENE3D?(s=e._baseVolume,e._boundingVolumeDirty=!0):s=e._baseVolume2D;let a=[];for(let c=0;c<n;++c){let d=t[c],u=d.position,m=ao._computeActualPosition(d,u,i,o);l(m)&&(d._setActualPosition(m),r?a.push(m):ce.expand(s,m,s))}r&&ce.fromPoints(a,s)}function vYe(e,t){let n=t.mode,i=e._billboards,o=e._billboardsToUpdate,r=e._modelMatrix;e._createVertexArray||e._mode!==n||n!==ie.SCENE3D&&!M.equals(r,e.modelMatrix)?(e._mode=n,M.clone(e.modelMatrix,r),e._createVertexArray=!0,(n===ie.SCENE3D||n===ie.SCENE2D||n===ie.COLUMBUS_VIEW)&&aH(e,i,i.length,t,r,!0)):n===ie.MORPHING?aH(e,i,i.length,t,r,!0):(n===ie.SCENE2D||n===ie.COLUMBUS_VIEW)&&aH(e,o,e._billboardsToUpdateIndex,t,r,!1)}function wYe(e,t,n){let i=1;(!e._allSizedInMeters||e._maxPixelOffset!==0)&&(i=t.camera.getPixelSize(n,t.context.drawingBufferWidth,t.context.drawingBufferHeight));let o=i*e._maxScale*e._maxSize*2;e._allHorizontalCenter&&e._allVerticalCenter&&(o*=.5);let r=i*e._maxPixelOffset+e._maxEyeOffset;n.radius+=o+r}function FYe(e,t){let i=t.createViewportQuadCommand(`uniform sampler2D billboard_texture; in vec2 v_textureCoordinates; void main() { out_FragColor = texture(billboard_texture, v_textureCoordinates); } `,{uniformMap:{billboard_texture:function(){return e._textureAtlas.texture}}});return i.pass=Ze.OVERLAY,i}function hae(e,t,n){let i,o,r,s=l(e._batchTable)?\"VECTOR_TILE\":\"\",a=Yt.maximumVertexTextureImageUnits>0,c=[\"DEPTH_FAIL_TRANSLUCENCY\"],d=BC,u=DC;l(e._batchTable)&&(c.push(\"VECTOR_TILE\"),d=e._batchTable.getVertexShaderCallback(!1,\"a_batchId\",void 0)(d),u=e._batchTable.getFragmentShaderCallback(!1,void 0)(u)),i=new Ue({defines:c,sources:[d]}),e._instanced&&i.defines.push(\"INSTANCED\"),e._shaderRotation&&i.defines.push(\"ROTATION\"),e._shaderAlignedAxis&&i.defines.push(\"ALIGNED_AXIS\"),e._shaderScaleByDistance&&i.defines.push(\"EYE_DISTANCE_SCALING\"),e._shaderTranslucencyByDistance&&i.defines.push(\"EYE_DISTANCE_TRANSLUCENCY\"),e._shaderPixelOffsetScaleByDistance&&i.defines.push(\"EYE_DISTANCE_PIXEL_OFFSET\"),e._shaderDistanceDisplayCondition&&i.defines.push(\"DISTANCE_DISPLAY_CONDITION\"),e._shaderDisableDepthDistance&&i.defines.push(\"DISABLE_DEPTH_DISTANCE\"),e._shaderClampToGround&&(a?i.defines.push(\"VERTEX_DEPTH_CHECK\"):i.defines.push(\"FRAGMENT_DEPTH_CHECK\"));let m=1-bs.CUTOFF;e._sdf&&i.defines.push(\"SDF\"),e._blendOption===Bi.OPAQUE_AND_TRANSLUCENT&&(o=new Ue({defines:[\"OPAQUE\",s],sources:[u]}),e._shaderClampToGround&&(a?o.defines.push(\"VERTEX_DEPTH_CHECK\"):o.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(o.defines.push(\"SDF\"),o.defines.push(`SDF_EDGE ${m}`)),e._spDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spDepthFail,vertexShaderSource:i,fragmentShaderSource:o,attributeLocations:n}),r=new Ue({defines:[\"TRANSLUCENT\",s],sources:[u]}),e._shaderClampToGround&&(a?r.defines.push(\"VERTEX_DEPTH_CHECK\"):r.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(r.defines.push(\"SDF\"),r.defines.push(`SDF_EDGE ${m}`)),e._spTranslucentDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spTranslucentDepthFail,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:n})),e._blendOption===Bi.OPAQUE&&(o=new Ue({defines:[s],sources:[u]}),e._shaderClampToGround&&(a?o.defines.push(\"VERTEX_DEPTH_CHECK\"):o.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(o.defines.push(\"SDF\"),o.defines.push(`SDF_EDGE ${m}`)),e._spDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spDepthFail,vertexShaderSource:i,fragmentShaderSource:o,attributeLocations:n})),e._blendOption===Bi.TRANSLUCENT&&(r=new Ue({defines:[s],sources:[u]}),e._shaderClampToGround&&(a?r.defines.push(\"VERTEX_DEPTH_CHECK\"):r.defines.push(\"FRAGMENT_DEPTH_CHECK\")),e._sdf&&(r.defines.push(\"SDF\"),r.defines.push(`SDF_EDGE ${m}`)),e._spTranslucentDepthFail=Ht.replaceCache({context:t,shaderProgram:e._spTranslucentDepthFail,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:n}))}var AYe=[];Su.prototype.update=function(e){if(uH(this),!this.show)return;let t=this._billboards,n=t.length;this._allDepthFailTranslucencyNoValue=!0,t.forEach(W=>{this._allDepthFailTranslucencyNoValue=this._allDepthFailTranslucencyNoValue&&W.depthFailTranslucency===void 0});let i=e.context;this._instanced=i.instancedArrays,Qi=this._instanced?CYe:SYe,oH=this._instanced?LYe:VYe;let o=this._textureAtlas;if(!l(o)){o=this._textureAtlas=new xy({context:i});for(let W=0;W<n;++W)t[W]._loadImage()}let r=o.textureCoordinates;if(r.length===0)return;vYe(this,e),t=this._billboards,n=t.length;let s=this._billboardsToUpdate,a=this._billboardsToUpdateIndex,c=this._propertiesChanged,d=o.guid,u=this._createVertexArray||this._textureAtlasGUID!==d;this._textureAtlasGUID=d;let m,p=e.passes,b=p.pick;if(u||!b&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(let W=0;W<dH;++W)c[W]=0;if(this._vaf=this._vaf&&this._vaf.destroy(),n>0){this._vaf=RYe(i,n,this._buffersUsage,this._instanced,this._batchTable,this._sdf),m=this._vaf.writers;for(let W=0;W<n;++W){let F=this._billboards[W];F._dirty=!1,PYe(this,e,r,m,F)}this._vaf.commit(oH(i))}this._billboardsToUpdateIndex=0}else if(a>0){let W=AYe;W.length=0,(c[HW]||c[yYe]||c[bYe])&&W.push(Cae),(c[zW]||c[fae]||c[fYe]||c[pYe]||c[hYe])&&(W.push(Eae),this._instanced&&W.push(lH)),(c[zW]||c[gYe]||c[gae])&&(W.push(Xae),W.push(cH)),(c[zW]||c[bae])&&W.push(cH),c[pae]&&W.push(lH),c[yae]&&W.push(Iae),c[xae]&&W.push(Wae),(c[_ae]||c[xYe]||c[zW]||c[HW])&&W.push(Pae),(c[zW]||c[HW])&&W.push(vae),c[Tae]&&W.push(wae),c[TYe]&&W.push(Fae);let F=W.length;if(m=this._vaf.writers,a/n>.1){for(let A=0;A<a;++A){let y=s[A];y._dirty=!1;for(let Z=0;Z<F;++Z)W[Z](this,e,r,m,y)}this._vaf.commit(oH(i))}else{for(let A=0;A<a;++A){let y=s[A];y._dirty=!1;for(let Z=0;Z<F;++Z)W[Z](this,e,r,m,y);this._instanced?this._vaf.subCommit(y._index,1):this._vaf.subCommit(y._index*4,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}if(a>n*1.5&&(s.length=n),!l(this._vaf)||!l(this._vaf.va))return;this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,ce.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));let f,x=M.IDENTITY;e.mode===ie.SCENE3D?(x=this.modelMatrix,f=ce.clone(this._baseVolumeWC,this._boundingVolume)):f=ce.clone(this._baseVolume2D,this._boundingVolume),wYe(this,e,f);let _=this._blendOption!==this.blendOption;if(this._blendOption=this.blendOption,_){this._blendOption===Bi.OPAQUE||this._blendOption===Bi.OPAQUE_AND_TRANSLUCENT?this._rsOpaque=Ne.fromCache({depthTest:{enabled:!0,func:ne.LESS},depthMask:!0}):this._rsOpaque=void 0;let W=this._blendOption===Bi.TRANSLUCENT;this._blendOption===Bi.TRANSLUCENT||this._blendOption===Bi.OPAQUE_AND_TRANSLUCENT?this._rsTranslucent=Ne.fromCache({depthTest:{enabled:!0,func:W?ne.LEQUAL:ne.LESS},depthMask:W,blending:un.ALPHA_BLEND}):this._rsTranslucent=void 0}this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||e.minimumDisableDepthTestDistance!==0;let C,V,L,R,G,X=Yt.maximumVertexTextureImageUnits>0;if(_||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround||this._sdf!==this._compiledSDF){C=BC,V=DC,G=[],l(this._batchTable)&&(G.push(\"VECTOR_TILE\"),C=this._batchTable.getVertexShaderCallback(!1,\"a_batchId\",void 0)(C),V=this._batchTable.getFragmentShaderCallback(!1,void 0)(V)),L=new Ue({defines:G,sources:[C]}),this._instanced&&L.defines.push(\"INSTANCED\"),this._shaderRotation&&L.defines.push(\"ROTATION\"),this._shaderAlignedAxis&&L.defines.push(\"ALIGNED_AXIS\"),this._shaderScaleByDistance&&L.defines.push(\"EYE_DISTANCE_SCALING\"),this._shaderTranslucencyByDistance&&L.defines.push(\"EYE_DISTANCE_TRANSLUCENCY\"),this._shaderPixelOffsetScaleByDistance&&L.defines.push(\"EYE_DISTANCE_PIXEL_OFFSET\"),this._shaderDistanceDisplayCondition&&L.defines.push(\"DISTANCE_DISPLAY_CONDITION\"),this._shaderDisableDepthDistance&&L.defines.push(\"DISABLE_DEPTH_DISTANCE\"),this._shaderClampToGround&&(X?L.defines.push(\"VERTEX_DEPTH_CHECK\"):L.defines.push(\"FRAGMENT_DEPTH_CHECK\"));let W=1-bs.CUTOFF;this._sdf&&L.defines.push(\"SDF\");let F=l(this._batchTable)?\"VECTOR_TILE\":\"\";this._blendOption===Bi.OPAQUE_AND_TRANSLUCENT&&(R=new Ue({defines:[\"OPAQUE\",F],sources:[V]}),this._shaderClampToGround&&(X?R.defines.push(\"VERTEX_DEPTH_CHECK\"):R.defines.push(\"FRAGMENT_DEPTH_CHECK\")),this._sdf&&(R.defines.push(\"SDF\"),R.defines.push(`SDF_EDGE ${W}`)),this._sp=Ht.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:L,fragmentShaderSource:R,attributeLocations:Qi}),R=new Ue({defines:[\"TRANSLUCENT\",F],sources:[V]}),this._shaderClampToGround&&(X?R.defines.push(\"VERTEX_DEPTH_CHECK\"):R.defines.push(\"FRAGMENT_DEPTH_CHECK\")),this._sdf&&(R.defines.push(\"SDF\"),R.defines.push(`SDF_EDGE ${W}`)),this._spTranslucent=Ht.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:L,fragmentShaderSource:R,attributeLocations:Qi})),this._blendOption===Bi.OPAQUE&&(R=new Ue({defines:[F],sources:[V]}),this._shaderClampToGround&&(X?R.defines.push(\"VERTEX_DEPTH_CHECK\"):R.defines.push(\"FRAGMENT_DEPTH_CHECK\")),this._sdf&&(R.defines.push(\"SDF\"),R.defines.push(`SDF_EDGE ${W}`)),this._sp=Ht.replaceCache({context:i,shaderProgram:this._sp,vertexShaderSource:L,fragmentShaderSource:R,attributeLocations:Qi})),this._blendOption===Bi.TRANSLUCENT&&(R=new Ue({defines:[F],sources:[V]}),this._shaderClampToGround&&(X?R.defines.push(\"VERTEX_DEPTH_CHECK\"):R.defines.push(\"FRAGMENT_DEPTH_CHECK\")),this._sdf&&(R.defines.push(\"SDF\"),R.defines.push(`SDF_EDGE ${W}`)),this._spTranslucent=Ht.replaceCache({context:i,shaderProgram:this._spTranslucent,vertexShaderSource:L,fragmentShaderSource:R,attributeLocations:Qi})),this._allDepthFailTranslucencyNoValue||hae(this,i,Qi),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround,this._compiledSDF=this._sdf}let v=e.commandList;if(p.render||p.pick){let W=this._colorCommands,F=this._blendOption===Bi.OPAQUE,A=this._blendOption===Bi.OPAQUE_AND_TRANSLUCENT,y=this._vaf.va,Z=y.length,E=this._uniforms,I;l(this._batchTable)?(E=this._batchTable.getUniformMapCallback()(E),I=this._batchTable.getPickId()):I=\"v_pickColor\",(!this._spDepthFail||!this._spTranslucentDepthFail)&&!this._allDepthFailTranslucencyNoValue&&hae(this,i,Qi),W.length=Z;let w=A?Z*2:Z;for(let k=0;k<w;++k){let B=W[k];l(B)||(B=W[k]=new je);let U=F||A&&k%2===0;B.pass=U||!A?Ze.OPAQUE:Ze.TRANSLUCENT,B.owner=this;let Y=A?Math.floor(k/2):k;if(B.boundingVolume=f,B.modelMatrix=x,B.count=y[Y].indicesCount,B.shaderProgram=U?this._sp:this._spTranslucent,B.uniformMap=E,B.vertexArray=y[Y].va,B.renderState=U?this._rsOpaque:this._rsTranslucent,B.debugShowBoundingVolume=this.debugShowBoundingVolume,B.pickId=I,this._instanced&&(B.count=6,B.instanceCount=n),v.push(B),!this._allDepthFailTranslucencyNoValue){let N=U?this._spDepthFail:this._spTranslucentDepthFail;if(N){let J=new je;J.pass=Ze.TRANSLUCENT,J.boundingVolume=f,J.owner=this,J.modelMatrix=x,J.count=y[Y].indicesCount,J.shaderProgram=N,J.uniformMap=E,J.vertexArray=y[Y].va,J.renderState=this._rsDepthFail,J.pickId=I,this._instanced&&(J.count=6,J.instanceCount=n),v.push(J)}}}this.debugShowTextureAtlas&&(l(this.debugCommand)||(this.debugCommand=FYe(this,e.context)),v.push(this.debugCommand))}};Su.prototype.isDestroyed=function(){return!1};Su.prototype.destroy=function(){return l(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0),this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._sp=this._sp&&this._sp.destroy(),this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy(),this._spDepthFail=this._spDepthFail&&this._spDepthFail.destroy(),this._spTranslucentDepthFail=this._spTranslucentDepthFail&&this._spTranslucentDepthFail.destroy(),this._vaf=this._vaf&&this._vaf.destroy(),Sae(this._billboards),me(this)};var yd=Su;var mIn=T(S(),1);var oIn=T(S(),1);function MYe(e,t,n,i,o){return function(){let r=document.createElement(\"canvas\"),s=o+2*i;r.height=r.width=s;let a=r.getContext(\"2d\");return a.clearRect(0,0,s,s),i!==0&&(a.beginPath(),a.arc(s/2,s/2,s/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=n,a.fill(),e<1&&(a.save(),a.globalCompositeOperation=\"destination-out\",a.beginPath(),a.arc(s/2,s/2,o/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=\"black\",a.fill(),a.restore())),a.beginPath(),a.arc(s/2,s/2,o/2,0,2*Math.PI,!0),a.closePath(),a.fillStyle=t,a.fill(),r}}var h_=MYe;function ra(e,t,n,i,o){this._content=e,this._billboard=n,this._label=i,this._polyline=o,this._batchId=t,this._billboardImage=void 0,this._billboardColor=void 0,this._billboardOutlineColor=void 0,this._billboardOutlineWidth=void 0,this._billboardSize=void 0,this._pointSize=void 0,this._color=void 0,this._pointSize=void 0,this._pointOutlineColor=void 0,this._pointOutlineWidth=void 0,this._heightOffset=void 0,this._pickIds=new Array(3),OC(this)}var NYe=new he;Object.defineProperties(ra.prototype,{show:{get:function(){return this._label.show},set:function(e){this._label.show=e,this._billboard.show=e,this._polyline.show=e}},color:{get:function(){return this._color},set:function(e){this._color=O.clone(e,this._color),OC(this)}},pointSize:{get:function(){return this._pointSize},set:function(e){this._pointSize=e,OC(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(e){this._pointOutlineColor=O.clone(e,this._pointOutlineColor),OC(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(e){this._pointOutlineWidth=e,OC(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(e){this._label.fillColor=e,this._polyline.show=this._label.show&&e.alpha>0}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(e){this._label.outlineColor=e}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(e){this._label.outlineWidth=e}},font:{get:function(){return this._label.font},set:function(e){this._label.font=e}},labelStyle:{get:function(){return this._label.style},set:function(e){this._label.style=e}},labelText:{get:function(){return this._label.text},set:function(e){l(e)||(e=\"\"),this._label.text=e}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(e){this._label.backgroundColor=e}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(e){this._label.backgroundPadding=e}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(e){this._label.showBackground=e}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(e){this._label.scaleByDistance=e,this._billboard.scaleByDistance=e}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(e){this._label.translucencyByDistance=e,this._billboard.translucencyByDistance=e}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(e){this._label.distanceDisplayCondition=e,this._polyline.distanceDisplayCondition=e,this._billboard.distanceDisplayCondition=e}},heightOffset:{get:function(){return this._heightOffset},set:function(e){let t=g(this._heightOffset,0),n=this._content.tileset.ellipsoid,i=n.cartesianToCartographic(this._billboard.position,NYe);i.height=i.height-t+e;let o=n.cartographicToCartesian(i);this._billboard.position=o,this._label.position=this._billboard.position,this._polyline.positions=[this._polyline.positions[0],o],this._heightOffset=e}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(e){this._polyline.show=e}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(e){this._polyline.material.uniforms.color=O.clone(e,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(e){let t=this._billboardImage!==e;this._billboardImage=e,t&&OC(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(e){this._label.disableDepthTestDistance=e,this._billboard.disableDepthTestDistance=e}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(e){this._billboard.horizontalOrigin=e}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(e){this._billboard.verticalOrigin=e}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(e){this._label.horizontalOrigin=e}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(e){this._label.verticalOrigin=e}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){let e=this._pickIds;return e[0]=this._billboard.pickId,e[1]=this._label.pickId,e[2]=this._polyline.pickId,e}}});ra.defaultColor=O.WHITE;ra.defaultPointOutlineColor=O.BLACK;ra.defaultPointOutlineWidth=0;ra.defaultPointSize=8;function OC(e){let t=e._billboard;if(l(e._billboardImage)&&e._billboardImage!==t.image){t.image=e._billboardImage;return}if(l(e._billboardImage))return;let n=g(e._color,ra.defaultColor),i=g(e._pointOutlineColor,ra.defaultPointOutlineColor),o=g(e._pointOutlineWidth,ra.defaultPointOutlineWidth),r=g(e._pointSize,ra.defaultPointSize),s=e._billboardColor,a=e._billboardOutlineColor,c=e._billboardOutlineWidth,d=e._billboardSize;if(O.equals(n,s)&&O.equals(i,a)&&o===c&&r===d)return;e._billboardColor=O.clone(n,e._billboardColor),e._billboardOutlineColor=O.clone(i,e._billboardOutlineColor),e._billboardOutlineWidth=o,e._billboardSize=r;let u=n.alpha,m=n.toCssColorString(),p=i.toCssColorString(),b=JSON.stringify([m,r,p,o]);t.setImage(b,h_(u,m,p,o,r))}ra.prototype.hasProperty=function(e){return this._content.batchTable.hasProperty(this._batchId,e)};ra.prototype.getPropertyIds=function(e){return this._content.batchTable.getPropertyIds(this._batchId,e)};ra.prototype.getProperty=function(e){return this._content.batchTable.getProperty(this._batchId,e)};ra.prototype.getPropertyInherited=function(e){return Fs.getPropertyInherited(this._content,this._batchId,e)};ra.prototype.setProperty=function(e,t){this._content.batchTable.setProperty(this._batchId,e,t),this._content.featurePropertiesDirty=!0};ra.prototype.isExactClass=function(e){return this._content.batchTable.isExactClass(this._batchId,e)};ra.prototype.isClass=function(e){return this._content.batchTable.isClass(this._batchId,e)};ra.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};var o0=ra;var rWn=T(S(),1);var yIn=T(S(),1);function kYe(e,t,n,i,o){let r=e.measureText(t);if(!!/\\S/.test(t)){let a=document.defaultView.getComputedStyle(e.canvas).getPropertyValue(\"font-size\").replace(\"px\",\"\"),c=document.createElement(\"canvas\"),d=100,u=r.width+d|0,m=3*a,p=m/2;c.width=u,c.height=m;let b=c.getContext(\"2d\");b.font=n,b.fillStyle=\"white\",b.fillRect(0,0,c.width+1,c.height+1),i&&(b.strokeStyle=\"black\",b.lineWidth=e.lineWidth,b.strokeText(t,d/2,p)),o&&(b.fillStyle=\"black\",b.fillText(t,d/2,p));let f=b.getImageData(0,0,u,m).data,x=f.length,_=u*4,C,V,L,R;for(C=0;C<x;++C)if(f[C]!==255){L=C/_|0;break}for(C=x-1;C>=0;--C)if(f[C]!==255){R=C/_|0;break}let G=-1;for(C=0;C<u&&G===-1;++C)for(V=0;V<m;++V){let X=C*4+V*_;if(f[X]!==255||f[X+1]!==255||f[X+2]!==255||f[X+3]!==255){G=C;break}}if(l(L)&&l(R))return{width:r.width,height:R-L,ascent:p-L,descent:R-p,minx:G-d/2}}return{width:r.width,height:0,ascent:0,descent:0,minx:0}}var f_;function UYe(e,t){if(e===\"\")return;t=g(t,g.EMPTY_OBJECT);let n=g(t.font,\"10px sans-serif\"),i=g(t.stroke,!1),o=g(t.fill,!0),r=g(t.strokeWidth,1),s=g(t.backgroundColor,O.TRANSPARENT),a=g(t.padding,0),c=a*2,d=document.createElement(\"canvas\");d.width=1,d.height=1,d.style.font=n;let u=d.getContext(\"2d\",{willReadFrequently:!0});l(f_)||(l(u.imageSmoothingEnabled)?f_=\"imageSmoothingEnabled\":l(u.mozImageSmoothingEnabled)?f_=\"mozImageSmoothingEnabled\":l(u.webkitImageSmoothingEnabled)?f_=\"webkitImageSmoothingEnabled\":l(u.msImageSmoothingEnabled)&&(f_=\"msImageSmoothingEnabled\")),u.font=n,u.lineJoin=\"round\",u.lineWidth=r,u[f_]=!1,d.style.visibility=\"hidden\",document.body.appendChild(d);let m=kYe(u,e,n,i,o);d.dimensions=m,document.body.removeChild(d),d.style.visibility=\"\";let p=-m.minx,b=Math.ceil(m.width)+p+c,f=m.height+c,x=f-m.ascent+a,_=f-x+c;if(d.width=b,d.height=f,u.font=n,u.lineJoin=\"round\",u.lineWidth=r,u[f_]=!1,s!==O.TRANSPARENT&&(u.fillStyle=s.toCssColorString(),u.fillRect(0,0,d.width,d.height)),i){let C=g(t.strokeColor,O.BLACK);u.strokeStyle=C.toCssColorString(),u.strokeText(e,p+a,_)}if(o){let C=g(t.fillColor,O.WHITE);u.fillStyle=C.toCssColorString(),u.fillText(e,p+a,_)}return d}var p_=UYe;var Hae=T(kae(),1);var MIn=T(S(),1);var TIn=T(S(),1),BYe={FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2},wo=Object.freeze(BYe);var Uae={},Dae=0,YYe=256,OYe=new O(.165,.165,.165,.8),zYe=new D(7,5),ss=Object.freeze({LTR:0,RTL:1,WEAK:2,BRACKETS:3});function b_(e){!e._rebindAllGlyphs&&!e._repositionAllGlyphs&&e._labelCollection._labelsToUpdate.push(e),e._rebindAllGlyphs=!0}function JW(e){!e._rebindAllGlyphs&&!e._repositionAllGlyphs&&e._labelCollection._labelsToUpdate.push(e),e._repositionAllGlyphs=!0}function QW(e,t){return document.defaultView.getComputedStyle(e,null).getPropertyValue(t)}function Yae(e){let t=Uae[e._font];if(!l(t)){let n=document.createElement(\"div\");n.style.position=\"absolute\",n.style.opacity=0,n.style.font=e._font,document.body.appendChild(n);let i=parseFloat(QW(n,\"line-height\"));isNaN(i)&&(i=void 0),t={family:QW(n,\"font-family\"),size:QW(n,\"font-size\").replace(\"px\",\"\"),style:QW(n,\"font-style\"),weight:QW(n,\"font-weight\"),lineHeight:i},document.body.removeChild(n),Dae<YYe&&(Uae[e._font]=t,Dae++)}e._fontFamily=t.family,e._fontSize=t.size,e._fontStyle=t.style,e._fontWeight=t.weight,e._lineHeight=t.lineHeight}function r0(e,t){e=g(e,g.EMPTY_OBJECT);let n=e.translucencyByDistance,i=e.pixelOffsetScaleByDistance,o=e.scaleByDistance,r=e.distanceDisplayCondition;l(n)&&(n=At.clone(n)),l(i)&&(i=At.clone(i)),l(o)&&(o=At.clone(o)),l(r)&&(r=It.clone(r)),this._renderedText=void 0,this._text=void 0,this._show=g(e.show,!0),this._font=g(e.font,\"30px sans-serif\"),this._fillColor=O.clone(g(e.fillColor,O.WHITE)),this._outlineColor=O.clone(g(e.outlineColor,O.BLACK)),this._outlineWidth=g(e.outlineWidth,1),this._showBackground=g(e.showBackground,!1),this._backgroundColor=O.clone(g(e.backgroundColor,OYe)),this._backgroundPadding=D.clone(g(e.backgroundPadding,zYe)),this._style=g(e.style,wo.FILL),this._verticalOrigin=g(e.verticalOrigin,Wn.BASELINE),this._horizontalOrigin=g(e.horizontalOrigin,ui.LEFT),this._pixelOffset=D.clone(g(e.pixelOffset,D.ZERO)),this._eyeOffset=h.clone(g(e.eyeOffset,h.ZERO)),this._position=h.clone(g(e.position,h.ZERO)),this._scale=g(e.scale,1),this._id=e.id,this._translucencyByDistance=n,this._pixelOffsetScaleByDistance=i,this._scaleByDistance=o,this._heightReference=g(e.heightReference,Je.NONE),this._distanceDisplayCondition=r,this._disableDepthTestDistance=e.disableDepthTestDistance,this._depthFailTranslucency=void 0,this._labelCollection=t,this._glyphs=[],this._backgroundBillboard=void 0,this._batchIndex=void 0,this._rebindAllGlyphs=!0,this._repositionAllGlyphs=!0,this._actualClampedPosition=void 0,this._removeCallbackFunc=void 0,this._mode=void 0,this._clusterShow=!0,this.text=g(e.text,\"\"),this._relativeSize=1,Yae(this),this._updateClamping()}Object.defineProperties(r0.prototype,{show:{get:function(){return this._show},set:function(e){if(this._show!==e){this._show=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i].billboard;l(r)&&(r.show=e)}let n=this._backgroundBillboard;l(n)&&(n.show=e)}}},position:{get:function(){return this._position},set:function(e){let t=this._position;if(!h.equals(t,e)){h.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o].billboard;l(s)&&(s.position=e)}let i=this._backgroundBillboard;l(i)&&(i.position=e),this._updateClamping()}}},heightReference:{get:function(){return this._heightReference},set:function(e){if(e!==this._heightReference){this._heightReference=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i].billboard;l(r)&&(r.heightReference=e)}let n=this._backgroundBillboard;l(n)&&(n.heightReference=e),JW(this),this._updateClamping()}}},text:{get:function(){return this._text},set:function(e){if(this._text!==e){this._text=e;let t=e.replace(/\\u00ad/g,\"\");this._renderedText=r0.enableRightToLeftDetection?qYe(t):t,b_(this)}}},font:{get:function(){return this._font},set:function(e){this._font!==e&&(this._font=e,b_(this),Yae(this))}},fillColor:{get:function(){return this._fillColor},set:function(e){let t=this._fillColor;O.equals(t,e)||(O.clone(e,t),b_(this))}},outlineColor:{get:function(){return this._outlineColor},set:function(e){let t=this._outlineColor;O.equals(t,e)||(O.clone(e,t),b_(this))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth!==e&&(this._outlineWidth=e,b_(this))}},showBackground:{get:function(){return this._showBackground},set:function(e){this._showBackground!==e&&(this._showBackground=e,b_(this))}},backgroundColor:{get:function(){return this._backgroundColor},set:function(e){let t=this._backgroundColor;if(!O.equals(t,e)){O.clone(e,t);let n=this._backgroundBillboard;l(n)&&(n.color=t)}}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(e){let t=this._backgroundPadding;D.equals(t,e)||(D.clone(e,t),JW(this))}},style:{get:function(){return this._style},set:function(e){this._style!==e&&(this._style=e,b_(this))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(e){let t=this._pixelOffset;if(!D.equals(t,e)){D.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];l(s.billboard)&&(s.billboard.pixelOffset=e)}let i=this._backgroundBillboard;l(i)&&(i.pixelOffset=e)}}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(e){let t=this._translucencyByDistance;if(!At.equals(t,e)){this._translucencyByDistance=At.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];l(s.billboard)&&(s.billboard.translucencyByDistance=e)}let i=this._backgroundBillboard;l(i)&&(i.translucencyByDistance=e)}}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(e){let t=this._pixelOffsetScaleByDistance;if(!At.equals(t,e)){this._pixelOffsetScaleByDistance=At.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];l(s.billboard)&&(s.billboard.pixelOffsetScaleByDistance=e)}let i=this._backgroundBillboard;l(i)&&(i.pixelOffsetScaleByDistance=e)}}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(e){let t=this._scaleByDistance;if(!At.equals(t,e)){this._scaleByDistance=At.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];l(s.billboard)&&(s.billboard.scaleByDistance=e)}let i=this._backgroundBillboard;l(i)&&(i.scaleByDistance=e)}}},eyeOffset:{get:function(){return this._eyeOffset},set:function(e){let t=this._eyeOffset;if(!h.equals(t,e)){h.clone(e,t);let n=this._glyphs;for(let o=0,r=n.length;o<r;o++){let s=n[o];l(s.billboard)&&(s.billboard.eyeOffset=e)}let i=this._backgroundBillboard;l(i)&&(i.eyeOffset=e)}}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(e){this._horizontalOrigin!==e&&(this._horizontalOrigin=e,JW(this))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(e){if(this._verticalOrigin!==e){this._verticalOrigin=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard.verticalOrigin=e)}let n=this._backgroundBillboard;l(n)&&(n.verticalOrigin=e),JW(this)}}},scale:{get:function(){return this._scale},set:function(e){if(this._scale!==e){this._scale=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard.scale=e*this._relativeSize)}let n=this._backgroundBillboard;l(n)&&(n.scale=e*this._relativeSize),JW(this)}}},totalScale:{get:function(){return this._scale*this._relativeSize}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if(!It.equals(e,this._distanceDisplayCondition)){this._distanceDisplayCondition=It.clone(e,this._distanceDisplayCondition);let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard.distanceDisplayCondition=e)}let n=this._backgroundBillboard;l(n)&&(n.distanceDisplayCondition=e)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(e){if(this._disableDepthTestDistance!==e){this._disableDepthTestDistance=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard.disableDepthTestDistance=e)}let n=this._backgroundBillboard;l(n)&&(n.disableDepthTestDistance=e)}}},depthFailTranslucency:{get:function(){return this._depthFailTranslucency},set:function(e){if(l(e)&&(bi.typeOf.number(\"value\",e),e<0&&(e=0),e>1&&(e=1)),this._depthFailTranslucency!==e){this._depthFailTranslucency=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard.depthFailTranslucency=e)}let n=this._backgroundBillboard;l(n)&&(n.depthFailTranslucency=e)}}},id:{get:function(){return this._id},set:function(e){if(this._id!==e){this._id=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard.id=e)}let n=this._backgroundBillboard;l(n)&&(n.id=e)}}},pickId:{get:function(){if(!(this._glyphs.length===0||!l(this._glyphs[0].billboard)))return this._glyphs[0].billboard.pickId}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(e){this._actualClampedPosition=h.clone(e,this._actualClampedPosition);let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard._clampedPosition=e)}let n=this._backgroundBillboard;l(n)&&(n._clampedPosition=e)}},clusterShow:{get:function(){return this._clusterShow},set:function(e){if(this._clusterShow!==e){this._clusterShow=e;let t=this._glyphs;for(let i=0,o=t.length;i<o;i++){let r=t[i];l(r.billboard)&&(r.billboard.clusterShow=e)}let n=this._backgroundBillboard;l(n)&&(n.clusterShow=e)}}}});r0.prototype._updateClamping=function(){ao._updateClamping(this._labelCollection,this)};r0.prototype.computeScreenSpacePosition=function(e,t){l(t)||(t=new D);let i=this._labelCollection.modelMatrix,o=l(this._actualClampedPosition)?this._actualClampedPosition:this._position;return ao._computeScreenSpacePosition(i,o,this._eyeOffset,this._pixelOffset,e,t)};r0.getScreenSpaceBoundingBox=function(e,t,n){let i=0,o=0,r=0,s=0,a=e.totalScale,c=e._backgroundBillboard;if(l(c))i=t.x+c._translate.x,o=t.y-c._translate.y,r=c.width*a,s=c.height*a,e.verticalOrigin===Wn.BOTTOM||e.verticalOrigin===Wn.BASELINE?o-=s:e.verticalOrigin===Wn.CENTER&&(o-=s*.5);else{i=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY;let d=0,u=0,m=e._glyphs,p=m.length;for(let b=0;b<p;++b){let f=m[b],x=f.billboard;if(!l(x))continue;let _=t.x+x._translate.x,C=t.y-x._translate.y,V=f.dimensions.width*a,L=f.dimensions.height*a;e.verticalOrigin===Wn.BOTTOM||e.verticalOrigin===Wn.BASELINE?C-=L:e.verticalOrigin===Wn.CENTER&&(C-=L*.5),e._verticalOrigin===Wn.TOP?C+=bs.PADDING*a:(e._verticalOrigin===Wn.BOTTOM||e._verticalOrigin===Wn.BASELINE)&&(C-=bs.PADDING*a),i=Math.min(i,_),o=Math.min(o,C),d=Math.max(d,_+V),u=Math.max(u,C+L)}r=d-i,s=u-o}return l(n)||(n=new ze),n.x=i,n.y=o,n.width=r,n.height=s,n};r0.prototype.equals=function(e){return this===e||l(e)&&this._show===e._show&&this._scale===e._scale&&this._outlineWidth===e._outlineWidth&&this._showBackground===e._showBackground&&this._style===e._style&&this._verticalOrigin===e._verticalOrigin&&this._horizontalOrigin===e._horizontalOrigin&&this._heightReference===e._heightReference&&this._renderedText===e._renderedText&&this._font===e._font&&h.equals(this._position,e._position)&&O.equals(this._fillColor,e._fillColor)&&O.equals(this._outlineColor,e._outlineColor)&&O.equals(this._backgroundColor,e._backgroundColor)&&D.equals(this._backgroundPadding,e._backgroundPadding)&&D.equals(this._pixelOffset,e._pixelOffset)&&h.equals(this._eyeOffset,e._eyeOffset)&&At.equals(this._translucencyByDistance,e._translucencyByDistance)&&At.equals(this._pixelOffsetScaleByDistance,e._pixelOffsetScaleByDistance)&&At.equals(this._scaleByDistance,e._scaleByDistance)&&It.equals(this._distanceDisplayCondition,e._distanceDisplayCondition)&&this._disableDepthTestDistance===e._disableDepthTestDistance&&this._depthFailTranslucency===e._depthFailTranslucency&&this._id===e._id};r0.prototype.isDestroyed=function(){return!1};r0.enableRightToLeftDetection=!1;function HYe(e,t){let n=/[a-zA-Z0-9]/,i=/[()[\\]{}<>]/,o=[],r=\"\",s=ss.LTR,a=\"\",c=e.length;for(let d=0;d<c;++d){let u=e.charAt(d);t.test(u)?a=ss.RTL:n.test(u)?a=ss.LTR:i.test(u)?a=ss.BRACKETS:a=ss.WEAK,d===0&&(s=a),s===a&&a!==ss.BRACKETS?r+=u:(r!==\"\"&&o.push({Type:s,Word:r}),s=a,r=u)}return o.push({Type:a,Word:r}),o}function KYe(e){return e.split(\"\").reverse().join(\"\")}function jW(e,t,n){return e.slice(0,t)+n+e.slice(t)}function JYe(e){switch(e){case\"(\":return\")\";case\")\":return\"(\";case\"[\":return\"]\";case\"]\":return\"[\";case\"{\":return\"}\";case\"}\":return\"{\";case\"<\":return\">\";case\">\":return\"<\"}}var QYe=\"\\u05D0-\\u05EA\",jYe=\"\\u0600-\\u06FF\\u0750-\\u077F\\u08A0-\\u08FF\",Bae=new RegExp(`[${QYe}${jYe}]`);function qYe(e){let t=e.split(` `),n=\"\";for(let i=0;i<t.length;i++){let o=t[i],r=Bae.test(o.charAt(0)),s=HYe(o,Bae),a=0,c=\"\";for(let d=0;d<s.length;++d){let u=s[d],m=u.Type===ss.BRACKETS?JYe(u.Word):KYe(u.Word);r?u.Type===ss.RTL?(c=m+c,a=0):u.Type===ss.LTR?(c=jW(c,a,u.Word),a+=u.Word.length):(u.Type===ss.WEAK||u.Type===ss.BRACKETS)&&(u.Type===ss.WEAK&&s[d-1].Type===ss.BRACKETS?c=m+c:s[d-1].Type===ss.RTL?(c=m+c,a=0):s.length>d+1?s[d+1].Type===ss.RTL?(c=m+c,a=0):(c=jW(c,a,u.Word),a+=u.Word.length):c=jW(c,0,m)):u.Type===ss.RTL?c=jW(c,a,m):u.Type===ss.LTR?(c+=u.Word,a=c.length):(u.Type===ss.WEAK||u.Type===ss.BRACKETS)&&(d>0&&s[d-1].Type===ss.RTL?s.length>d+1?s[d+1].Type===ss.RTL?c=jW(c,a,m):(c+=u.Word,a=c.length):c+=u.Word:(c+=u.Word,a=c.length))}n+=c,i<t.length-1&&(n+=` `)}return n}var _y=r0;var Kae=T(Oae(),1);function eOe(){this.textureInfo=void 0,this.dimensions=void 0,this.billboard=void 0}function tOe(e,t,n){this.labelCollection=e,this.index=t,this.dimensions=n}var nOe=1.2,Jae=\"ID_WHITE_PIXEL\",mH=new D(4,4),iOe=new ze(1,1,1,1);function oOe(e){let t=document.createElement(\"canvas\");t.width=mH.x,t.height=mH.y;let n=t.getContext(\"2d\");return n.fillStyle=\"#fff\",n.fillRect(0,0,t.width,t.height),e.addImage(Jae,t)}var Cu={};function rOe(e,t,n,i,o,r,s){return Cu.font=t,Cu.fillColor=n,Cu.strokeColor=i,Cu.strokeWidth=o,Cu.padding=bs.PADDING,s===Wn.CENTER?Cu.textBaseline=\"middle\":s===Wn.TOP?Cu.textBaseline=\"top\":Cu.textBaseline=\"bottom\",Cu.fill=r===wo.FILL||r===wo.FILL_AND_OUTLINE,Cu.stroke=r===wo.OUTLINE||r===wo.FILL_AND_OUTLINE,Cu.backgroundColor=O.BLACK,p_(e,Cu)}function hH(e,t){t.textureInfo=void 0,t.dimensions=void 0;let n=t.billboard;l(n)&&(n.show=!1,n.image=void 0,l(n._removeCallbackFunc)&&(n._removeCallbackFunc(),n._removeCallbackFunc=void 0),e._spareBillboards.push(n),t.billboard=void 0)}function sOe(e,t,n,i){i.index=e.addImageSync(t,n)}var aOe=new Kae.default;function cOe(e,t){let n=t._renderedText,i=aOe.splitGraphemes(n),o=i.length,r=t._glyphs,s=r.length,a,c,d;if(t._relativeSize=t._fontSize/bs.FONT_SIZE,o<s)for(c=o;c<s;++c)hH(e,r[c]);r.length=o;let u=t.show&&t._showBackground&&n.split(` `).join(\"\").length>0,m=t._backgroundBillboard,p=e._backgroundBillboardCollection;u?(l(m)||(m=p.add({collection:e,image:Jae,imageSubRegion:iOe}),t._backgroundBillboard=m),m.color=t._backgroundColor,m.show=t._show,m.position=t._position,m.eyeOffset=t._eyeOffset,m.pixelOffset=t._pixelOffset,m.horizontalOrigin=ui.LEFT,m.verticalOrigin=t._verticalOrigin,m.heightReference=t._heightReference,m.scale=t.totalScale,m.pickPrimitive=t,m.id=t._id,m.translucencyByDistance=t._translucencyByDistance,m.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,m.scaleByDistance=t._scaleByDistance,m.distanceDisplayCondition=t._distanceDisplayCondition,m.disableDepthTestDistance=t._disableDepthTestDistance,m.clusterShow=t.clusterShow,m.depthFailTranslucency=t.depthFailTranslucency):l(m)&&(p.remove(m),t._backgroundBillboard=m=void 0);let b=e._glyphTextureCache;for(d=0;d<o;++d){let f=i[d],x=t._verticalOrigin,_=JSON.stringify([f,t._fontFamily,t._fontStyle,t._fontWeight,+x]),C=b[_];if(!l(C)){let V=`${t._fontStyle} ${t._fontWeight} ${bs.FONT_SIZE}px ${t._fontFamily}`,L=rOe(f,V,O.WHITE,O.WHITE,0,wo.FILL,x);if(C=new tOe(e,-1,L.dimensions),b[_]=C,L.width>0&&L.height>0){let R=(0,Hae.default)(L,{cutoff:bs.CUTOFF,radius:bs.RADIUS}),G=L.getContext(\"2d\"),X=L.width,v=L.height,W=G.getImageData(0,0,X,v);for(let F=0;F<X;F++)for(let A=0;A<v;A++){let y=A*X+F,Z=R[y]*255,E=y*4;W.data[E+0]=Z,W.data[E+1]=Z,W.data[E+2]=Z,W.data[E+3]=Z}G.putImageData(W,0,0),f!==\" \"&&sOe(e._textureAtlas,_,L,C)}}if(a=r[d],l(a)?C.index===-1?hH(e,a):l(a.textureInfo)&&(a.textureInfo=void 0):(a=new eOe,r[d]=a),a.textureInfo=C,a.dimensions=C.dimensions,C.index!==-1){let V=a.billboard,L=e._spareBillboards;l(V)||(L.length>0?V=L.pop():(V=e._billboardCollection.add({collection:e}),V._labelDimensions=new D,V._labelTranslate=new D),a.billboard=V),V.show=t._show,V.position=t._position,V.eyeOffset=t._eyeOffset,V.pixelOffset=t._pixelOffset,V.horizontalOrigin=ui.LEFT,V.verticalOrigin=t._verticalOrigin,V.heightReference=t._heightReference,V.scale=t.totalScale,V.pickPrimitive=t,V.id=t._id,V.image=_,V.translucencyByDistance=t._translucencyByDistance,V.pixelOffsetScaleByDistance=t._pixelOffsetScaleByDistance,V.scaleByDistance=t._scaleByDistance,V.distanceDisplayCondition=t._distanceDisplayCondition,V.disableDepthTestDistance=t._disableDepthTestDistance,V._batchIndex=t._batchIndex,V.outlineColor=t.outlineColor,t.style===wo.FILL_AND_OUTLINE?(V.color=t._fillColor,V.outlineWidth=t.outlineWidth):t.style===wo.FILL?(V.color=t._fillColor,V.outlineWidth=0):t.style===wo.OUTLINE&&(V.color=O.TRANSPARENT,V.outlineWidth=t.outlineWidth),V.depthFailTranslucency=t.depthFailTranslucency}}t._repositionAllGlyphs=!0}function zae(e,t,n){return t===ui.CENTER?-e/2:t===ui.RIGHT?-(e+n.x):n.x}var sr=new D,lOe=new D;function dOe(e){let t=e._glyphs,n=e._renderedText,i,o,r=0,s=0,a=[],c=Number.NEGATIVE_INFINITY,d=0,u=1,m,p=t.length,b=e._backgroundBillboard,f=D.clone(l(b)?e._backgroundPadding:D.ZERO,lOe);for(f.x/=e._relativeSize,f.y/=e._relativeSize,m=0;m<p;++m)n.charAt(m)===` `?(a.push(r),++u,r=0):(i=t[m],o=i.dimensions,d=Math.max(d,o.height-o.descent),c=Math.max(c,o.descent),r+=o.width-o.minx,m<p-1&&(r+=t[m+1].dimensions.minx),s=Math.max(s,r));a.push(r);let x=d+c,_=e.totalScale,C=e._horizontalOrigin,V=e._verticalOrigin,L=0,R=a[L],G=zae(R,C,f),X=(l(e._lineHeight)?e._lineHeight:nOe*e._fontSize)/e._relativeSize,v=X*(u-1),W=s,F=x+v;l(b)&&(W+=f.x*2,F+=f.y*2,b._labelHorizontalOrigin=C),sr.x=G*_,sr.y=0;let A=!0,y=0;for(m=0;m<p;++m)if(n.charAt(m)===` `)++L,y+=X,R=a[L],G=zae(R,C,f),sr.x=G*_,A=!0;else if(i=t[m],o=i.dimensions,V===Wn.TOP?(sr.y=o.height-d-f.y,sr.y+=bs.PADDING):V===Wn.CENTER?sr.y=(v+o.height-d)/2:V===Wn.BASELINE?(sr.y=v,sr.y-=bs.PADDING):(sr.y=v+c+f.y,sr.y-=bs.PADDING),sr.y=(sr.y-o.descent-y)*_,A&&(sr.x-=bs.PADDING*_,A=!1),l(i.billboard)&&(i.billboard._setTranslate(sr),i.billboard._labelDimensions.x=W,i.billboard._labelDimensions.y=F,i.billboard._labelHorizontalOrigin=C),m<p-1){let Z=t[m+1];sr.x+=(o.width-o.minx+Z.dimensions.minx)*_}if(l(b)&&n.split(` `).join(\"\").length>0&&(C===ui.CENTER?G=-s/2-f.x:C===ui.RIGHT?G=-(s+f.x*2):G=0,sr.x=G*_,V===Wn.TOP?sr.y=x-d-c:V===Wn.CENTER?sr.y=(x-d)/2-c:V===Wn.BASELINE?sr.y=-f.y-c:sr.y=0,sr.y=sr.y*_,b.width=W,b.height=F,b._setTranslate(sr),b._labelTranslate=D.clone(sr,b._labelTranslate)),cu(e.heightReference))for(m=0;m<p;++m){i=t[m];let Z=i.billboard;l(Z)&&(Z._labelTranslate=D.clone(sr,Z._labelTranslate))}}function Qae(e,t){let n=t._glyphs;for(let i=0,o=n.length;i<o;++i)hH(e,n[i]);l(t._backgroundBillboard)&&(e._backgroundBillboardCollection.remove(t._backgroundBillboard),t._backgroundBillboard=void 0),t._labelCollection=void 0,l(t._removeCallbackFunc)&&t._removeCallbackFunc(),me(t)}function mf(e){e=g(e,g.EMPTY_OBJECT),this._scene=e.scene,this._batchTable=e.batchTable,this._textureAtlas=void 0,this._backgroundTextureAtlas=void 0,this._backgroundBillboardCollection=new yd({scene:this._scene}),this._backgroundBillboardCollection.destroyTextureAtlas=!1,this._billboardCollection=new yd({scene:this._scene,batchTable:this._batchTable}),this._billboardCollection.destroyTextureAtlas=!1,this._billboardCollection._sdf=!0,this._spareBillboards=[],this._glyphTextureCache={},this._labels=[],this._labelsToUpdate=[],this._totalGlyphCount=0,this._highlightColor=O.clone(O.WHITE),this.show=g(e.show,!0),this.modelMatrix=M.clone(g(e.modelMatrix,M.IDENTITY)),this.debugShowBoundingVolume=g(e.debugShowBoundingVolume,!1),this.blendOption=g(e.blendOption,Bi.OPAQUE_AND_TRANSLUCENT)}Object.defineProperties(mf.prototype,{length:{get:function(){return this._labels.length}}});mf.prototype.add=function(e){let t=new _y(e,this);return this._labels.push(t),this._labelsToUpdate.push(t),t};mf.prototype.remove=function(e){if(l(e)&&e._labelCollection===this){let t=this._labels.indexOf(e);if(t!==-1)return this._labels.splice(t,1),Qae(this,e),!0}return!1};mf.prototype.removeAll=function(){let e=this._labels;for(let t=0,n=e.length;t<n;++t)Qae(this,e[t]);e.length=0};mf.prototype.contains=function(e){return l(e)&&e._labelCollection===this};mf.prototype.get=function(e){return this._labels[e]};mf.prototype.update=function(e){if(!this.show)return;let t=this._billboardCollection,n=this._backgroundBillboardCollection;t.modelMatrix=this.modelMatrix,t.debugShowBoundingVolume=this.debugShowBoundingVolume,n.modelMatrix=this.modelMatrix,n.debugShowBoundingVolume=this.debugShowBoundingVolume;let i=e.context;l(this._textureAtlas)||(this._textureAtlas=new xy({context:i}),t.textureAtlas=this._textureAtlas),l(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new xy({context:i,initialSize:mH}),n.textureAtlas=this._backgroundTextureAtlas,oOe(this._backgroundTextureAtlas));let o=this._labelsToUpdate.length;for(let s=0;s<o;++s){let a=this._labelsToUpdate[s];if(a.isDestroyed())continue;let c=a._glyphs.length;a._rebindAllGlyphs&&(cOe(this,a),a._rebindAllGlyphs=!1),a._repositionAllGlyphs&&(dOe(a),a._repositionAllGlyphs=!1);let d=a._glyphs.length-c;this._totalGlyphCount+=d}let r=n.length>0?Bi.TRANSLUCENT:this.blendOption;t.blendOption=r,n.blendOption=r,t._highlightColor=this._highlightColor,n._highlightColor=this._highlightColor,this._labelsToUpdate.length=0,n.update(e),t.update(e)};mf.prototype.isDestroyed=function(){return!1};mf.prototype.destroy=function(){return this.removeAll(),this._billboardCollection=this._billboardCollection.destroy(),this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy(),this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy(),this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy(),me(this)};var hf=mf;var y2n=T(S(),1);var aWn=T(S(),1),qW=`in vec3 position3DHigh; in vec3 position3DLow; in vec3 position2DHigh; in vec3 position2DLow; in vec3 prevPosition3DHigh; in vec3 prevPosition3DLow; in vec3 prevPosition2DHigh; in vec3 prevPosition2DLow; in vec3 nextPosition3DHigh; in vec3 nextPosition3DLow; in vec3 nextPosition2DHigh; in vec3 nextPosition2DLow; in vec4 texCoordExpandAndBatchIndex; out vec2 v_st; out float v_width; out vec4 v_pickColor; out float v_polylineAngle; // @uranus change \\u65B0\\u589E\\u53D8\\u91CF\\u7528\\u6765\\u8BA1\\u7B97\\u8FB9\\u7F18\\u6297\\u952F\\u9F7F out float v_aa_width; out float v_aa_out; void main() { float texCoord = texCoordExpandAndBatchIndex.x; float expandDir = texCoordExpandAndBatchIndex.y; bool usePrev = texCoordExpandAndBatchIndex.z < 0.0; float batchTableIndex = texCoordExpandAndBatchIndex.w; // @uranus change: \\u8BA1\\u7B97\\u5916\\u6269\\u53D8\\u91CF v_aa_out = 1.0 / czm_pixelRatio; // \\u7EBF\\u6BB5\\u9876\\u70B9\\u5916\\u6269\\u4E24\\u4E2A\\u50CF\\u7D20 float width_out = v_aa_out * 2.0; // @uranus change end vec2 widthAndShow = batchTable_getWidthAndShow(batchTableIndex); // @uranus change \\u5BBD\\u5EA6\\u5916\\u6269 float width = widthAndShow.x + 0.5 + width_out; float show = widthAndShow.y; if (width < 1.0) { show = 0.0; } vec4 pickColor = batchTable_getPickColor(batchTableIndex); vec4 p, prev, next; if (czm_morphTime == 1.0) { p = czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz); prev = czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz); next = czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz); } else if (czm_morphTime == 0.0) { p = czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy); prev = czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy); next = czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy); } else { p = czm_columbusViewMorph( czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy), czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz), czm_morphTime); prev = czm_columbusViewMorph( czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy), czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz), czm_morphTime); next = czm_columbusViewMorph( czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy), czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz), czm_morphTime); } #ifdef DISTANCE_DISPLAY_CONDITION vec3 centerHigh"
}