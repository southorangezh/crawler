{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 168,
    "total_chunks": 194,
    "chunk_size": 34977,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.750Z"
  },
  "content": "grid with voxel coordinates on the left side. 2 +---+ |001| 1 +-z-+ |000| 0 +---+ When doing nearest neighbor the megatexture only needs to be sampled once at the closest Z slice. */ Properties getPropertiesFromMegatexture(in SampleData sampleData) { int tileIndex = sampleData.megatextureIndex; vec3 voxelCoord = sampleData.tileUv * vec3(u_dimensions); ivec3 voxelDimensions = u_dimensions; #if defined(PADDING) voxelDimensions += u_paddingBefore + u_paddingAfter; voxelCoord += vec3(u_paddingBefore); #endif #if defined(NEAREST_SAMPLING) // Round to the center of the nearest voxel voxelCoord = floor(voxelCoord) + vec3(0.5); #endif // Tile location vec2 tileUvOffset = index1DTo2DTexcoord(tileIndex, u_megatextureTileDimensions, u_megatextureTileSizeUv); // Slice location float slice = voxelCoord.z - 0.5; int sliceIndex = int(floor(slice)); int sliceIndex0 = intClamp(sliceIndex, 0, voxelDimensions.z - 1); vec2 sliceUvOffset0 = index1DTo2DTexcoord(sliceIndex0, u_megatextureSliceDimensions, u_megatextureSliceSizeUv); // Voxel location vec2 voxelUvOffset = clamp(voxelCoord.xy, vec2(0.5), vec2(voxelDimensions.xy) - vec2(0.5)) * u_megatextureVoxelSizeUv; // Final location in the megatexture vec2 uv0 = tileUvOffset + sliceUvOffset0 + voxelUvOffset; #if defined(NEAREST_SAMPLING) return getPropertiesFromMegatextureAtUv(uv0); #else float sliceLerp = fract(slice); int sliceIndex1 = intMin(sliceIndex + 1, voxelDimensions.z - 1); vec2 sliceUvOffset1 = index1DTo2DTexcoord(sliceIndex1, u_megatextureSliceDimensions, u_megatextureSliceSizeUv); vec2 uv1 = tileUvOffset + sliceUvOffset1 + voxelUvOffset; Properties properties0 = getPropertiesFromMegatextureAtUv(uv0); Properties properties1 = getPropertiesFromMegatextureAtUv(uv1); return mixProperties(properties0, properties1, sliceLerp); #endif } // Convert an array of sample datas to a final weighted properties. Properties accumulatePropertiesFromMegatexture(in SampleData sampleDatas[SAMPLE_COUNT]) { #if (SAMPLE_COUNT == 1) return getPropertiesFromMegatexture(sampleDatas[0]); #else // When more than one sample is taken the accumulator needs to start at 0 Properties properties = clearProperties(); for (int i = 0; i < SAMPLE_COUNT; ++i) { float weight = sampleDatas[i].weight; // Avoid reading the megatexture when the weight is 0 as it can be costly. if (weight > 0.0) { Properties tempProperties = getPropertiesFromMegatexture(sampleDatas[i]); tempProperties = scaleProperties(tempProperties, weight); properties = sumProperties(properties, tempProperties); } } return properties; #endif } `;function wpt(e){let t=new sx;this.shaderBuilder=t;let n=e._customShader,i=Ct(e._uniformMap,n.uniformMap);e._uniformMap=i;let o=n.uniforms;for(let p in o)if(o.hasOwnProperty(p)){let b=o[p];t.addUniform(b.type,p,Ce.FRAGMENT)}t.addUniform(\"sampler2D\",\"u_megatextureTextures[METADATA_COUNT]\",Ce.FRAGMENT),this.uniformMap=i;let r=e._clippingPlanes,s=l(r)&&r.enabled?r.length:0;this.clippingPlanes=r,this.clippingPlanesLength=s,t.addVertexLines([HF]),t.addFragmentLines([n.fragmentShaderText,\"#line 0\",i9,OF,KF,o9]),s>0&&(t.addDefine(\"CLIPPING_PLANES\",void 0,Ce.FRAGMENT),t.addDefine(\"CLIPPING_PLANES_COUNT\",s,Ce.FRAGMENT),r.unionClippingRegions&&t.addDefine(\"CLIPPING_PLANES_UNION\",void 0,Ce.FRAGMENT),t.addFragmentLines([QF])),e._depthTest&&(t.addDefine(\"DEPTH_TEST\",void 0,Ce.FRAGMENT),t.addFragmentLines([JF]));let a=e._provider.shape;a===\"BOX\"?t.addFragmentLines([e9,jF,kT]):a===\"CYLINDER\"?t.addFragmentLines([t9,JV,qF,kT]):a===\"ELLIPSOID\"&&(t.addDefine(\"SHAPE_ELLIPSOID\",void 0,Ce.FRAGMENT),t.addFragmentLines([n9,JV,$F,kT])),t.addFragmentLines([zF]);let c=e._shape,d=c.shaderDefines;for(let p in d)if(d.hasOwnProperty(p)){let b=d[p];l(b)&&(b=b===!0?void 0:b,t.addDefine(p,b,Ce.FRAGMENT))}let u=c.shaderMaximumIntersectionsLength;s>0&&(t.addDefine(\"CLIPPING_PLANES_INTERSECTION_INDEX\",u,Ce.FRAGMENT),s===1?u+=1:r.unionClippingRegions?u+=2:u+=1),e._depthTest&&(t.addDefine(\"DEPTH_INTERSECTION_INDEX\",u,Ce.FRAGMENT),u+=1),t.addDefine(\"INTERSECTION_COUNT\",u,Ce.FRAGMENT),(!h.equals(e.paddingBefore,h.ZERO)||!h.equals(e.paddingAfter,h.ZERO))&&t.addDefine(\"PADDING\",void 0,Ce.FRAGMENT),e._useLogDepth&&t.addDefine(\"LOG_DEPTH_READ_ONLY\",void 0,Ce.FRAGMENT),e._jitter&&t.addDefine(\"JITTER\",void 0,Ce.FRAGMENT),e._nearestSampling&&t.addDefine(\"NEAREST_SAMPLING\",void 0,Ce.FRAGMENT);let m=e._traversal;t.addDefine(\"SAMPLE_COUNT\",`${m._sampleCount}`,Ce.FRAGMENT)}var r9=wpt;var dMi=T(S(),1);function Fpt(e,t){let{shaderBuilder:n}=e,{names:i,types:o,componentTypes:r,minimumValues:s,maximumValues:a}=t._provider,c=o.length,d=l(s)&&l(a);n.addDefine(\"METADATA_COUNT\",c,Ce.FRAGMENT),d&&n.addDefine(\"STATISTICS\",void 0,Ce.FRAGMENT);for(let W=0;W<c;W++){let F=i[W],A=o[W],y=`PropertyStatistics_${F}`,Z=`PropertyStatistics_${F}`;n.addStruct(y,Z,Ce.FRAGMENT);let E=u3(A);n.addStructField(y,E,\"min\"),n.addStructField(y,E,\"max\")}let u=\"Statistics\",m=\"Statistics\",p=\"statistics\";n.addStruct(u,m,Ce.FRAGMENT);for(let W=0;W<c;W++){let F=i[W],A=`PropertyStatistics_${F}`,y=F;n.addStructField(u,A,y)}let b=\"Metadata\",f=\"Metadata\",x=\"metadata\";n.addStruct(b,f,Ce.FRAGMENT),n.addStructField(b,m,p);for(let W=0;W<c;W++){let F=i[W],A=o[W],y=u3(A);n.addStructField(b,y,F)}for(let W=0;W<c;W++){let F=i[W],A=o[W],y=Mpt(A),Z=`VoxelProperty_${F}`,E=`VoxelProperty_${F}`;n.addStruct(Z,E,Ce.FRAGMENT),n.addStructField(Z,y,\"partialDerivativeLocal\"),n.addStructField(Z,y,\"partialDerivativeWorld\"),n.addStructField(Z,y,\"partialDerivativeView\"),n.addStructField(Z,y,\"partialDerivativeValid\")}let _=\"Voxel\",C=\"Voxel\",V=\"voxel\";n.addStruct(_,C,Ce.FRAGMENT);for(let W=0;W<c;W++){let F=i[W],A=`VoxelProperty_${F}`;n.addStructField(_,A,F)}n.addStructField(_,\"vec3\",\"positionEC\"),n.addStructField(_,\"vec3\",\"positionUv\"),n.addStructField(_,\"vec3\",\"positionShapeUv\"),n.addStructField(_,\"vec3\",\"positionUvLocal\"),n.addStructField(_,\"vec3\",\"viewDirUv\"),n.addStructField(_,\"vec3\",\"viewDirWorld\"),n.addStructField(_,\"vec3\",\"surfaceNormal\"),n.addStructField(_,\"float\",\"travelDistance\"),n.addStructField(_,\"int\",\"stepCount\"),n.addStructField(_,\"int\",\"tileIndex\"),n.addStructField(_,\"int\",\"sampleIndex\");let L=\"FragmentInput\";n.addStruct(L,\"FragmentInput\",Ce.FRAGMENT),n.addStructField(L,f,x),n.addStructField(L,C,V);let G=\"Properties\",X=\"Properties\",v=\"properties\";n.addStruct(G,X,Ce.FRAGMENT);for(let W=0;W<c;W++){let F=i[W],A=o[W],y=u3(A);n.addStructField(G,y,F)}{let W=\"clearProperties\";n.addFunction(W,`${X} clearProperties()`,Ce.FRAGMENT),n.addFunctionLines(W,[`${X} ${v};`]);for(let F=0;F<c;F++){let A=i[F],y=o[F],Z=r[F],E=u3(y,Z);n.addFunctionLines(W,[`${v}.${A} = ${E}(0.0);`])}n.addFunctionLines(W,[`return ${v};`])}{let W=\"sumProperties\";n.addFunction(W,`${X} sumProperties(${X} propertiesA, ${X} propertiesB)`,Ce.FRAGMENT),n.addFunctionLines(W,[`${X} ${v};`]);for(let F=0;F<c;F++){let A=i[F];n.addFunctionLines(W,[`${v}.${A} = propertiesA.${A} + propertiesB.${A};`])}n.addFunctionLines(W,[`return ${v};`])}{let W=\"scaleProperties\";n.addFunction(W,`${X} scaleProperties(${X} ${v}, float scale)`,Ce.FRAGMENT),n.addFunctionLines(W,[`${X} scaledProperties = ${v};`]);for(let F=0;F<c;F++){let A=i[F];n.addFunctionLines(W,[`scaledProperties.${A} *= scale;`])}n.addFunctionLines(W,[\"return scaledProperties;\"])}{let W=\"mixProperties\";n.addFunction(W,`${X} mixProperties(${X} propertiesA, ${X} propertiesB, float mixFactor)`,Ce.FRAGMENT),n.addFunctionLines(W,[`${X} ${v};`]);for(let F=0;F<c;F++){let A=i[F];n.addFunctionLines(W,[`${v}.${A} = mix(propertiesA.${A}, propertiesB.${A}, mixFactor);`])}n.addFunctionLines(W,[`return ${v};`])}{let W=\"copyPropertiesToMetadata\";n.addFunction(W,`void copyPropertiesToMetadata(in ${X} ${v}, inout ${f} ${x})`,Ce.FRAGMENT);for(let F=0;F<c;F++){let A=i[F];n.addFunctionLines(W,[`${x}.${A} = ${v}.${A};`])}}if(d){let W=\"setStatistics\";n.addFunction(W,`void setStatistics(inout ${m} ${p})`,Ce.FRAGMENT);for(let F=0;F<c;F++){let A=i[F],y=o[F],Z=Kt.getComponentCount(y);for(let E=0;E<Z;E++){let I=Npt(y,E),w=s[F][E],k=a[F][E];n.addFunctionLines(W,[`${p}.${A}.min${I} = ${W_e(w)};`,`${p}.${A}.max${I} = ${W_e(k)};`])}}}{let W=\"getPropertiesFromMegatextureAtUv\";n.addFunction(W,`${X} getPropertiesFromMegatextureAtUv(vec2 texcoord)`,Ce.FRAGMENT),n.addFunctionLines(W,[`${X} ${v};`]);for(let F=0;F<c;F++){let A=i[F],y=o[F],Z=r[F],E=Apt(y,Z);n.addFunctionLines(W,[`properties.${A} = texture(u_megatextureTextures[${F}], texcoord)${E};`])}n.addFunctionLines(W,[`return ${v};`])}}function u3(e){if(e===Kt.SCALAR)return\"float\";if(e===Kt.VEC2)return\"vec2\";if(e===Kt.VEC3)return\"vec3\";if(e===Kt.VEC4)return\"vec4\"}function Apt(e){if(e===Kt.SCALAR)return\".r\";if(e===Kt.VEC2)return\".ra\";if(e===Kt.VEC3)return\".rgb\";if(e===Kt.VEC4)return\"\"}function Mpt(e){if(e===Kt.SCALAR)return\"vec3\";if(e===Kt.VEC2)return\"mat2\";if(e===Kt.VEC3)return\"mat3\";if(e===Kt.VEC4)return\"mat4\"}function W_e(e){let t=e.toString();return t.indexOf(\".\")===-1&&(t=`${e}.0`),t}function Npt(e,t){return e===Kt.SCALAR?\"\":`[${t}]`}var s9=Fpt;function kpt(e,t){let n=new r9(e);s9(n,e);let{shaderBuilder:i,clippingPlanes:o,clippingPlanesLength:r}=n;if(r>0){let C=\"getClippingPlane\",V=K0(o,t),L=0,R=V.indexOf(\")\")+1,G=V.indexOf(\"{\",R)+1,X=V.indexOf(\"}\",G),v=V.slice(L,R),W=V.slice(G,X);i.addFunction(C,v,Ce.FRAGMENT),i.addFunctionLines(C,[W])}let s=i.clone();s.addDefine(\"PICKING\",void 0,Ce.FRAGMENT);let a=i.clone();a.addDefine(\"PICKING_VOXEL\",void 0,Ce.FRAGMENT);let c=i.buildShaderProgram(t),d=s.buildShaderProgram(t),u=a.buildShaderProgram(t),m=Ne.fromCache({cull:{enabled:!0,face:mi.BACK},depthTest:{enabled:!1},depthMask:!1,blending:un.PRE_MULTIPLIED_ALPHA_BLEND}),p=t.getViewportQuadVertexArray(),b=e._depthTest,f=new je({vertexArray:p,primitiveType:we.TRIANGLES,renderState:m,shaderProgram:c,uniformMap:n.uniformMap,modelMatrix:e._compoundModelMatrix,pass:Ze.VOXELS,executeInClosestFrustum:!0,owner:this,cull:b,occlude:b}),x=je.shallowClone(f,new je);x.shaderProgram=d,x.pickOnly=!0;let _=je.shallowClone(f,new je);if(_.shaderProgram=u,_.pickOnly=!0,l(e._drawCommand)){let C=e._drawCommand;C.shaderProgram=C.shaderProgram&&C.shaderProgram.destroy()}if(l(e._drawCommandPick)){let C=e._drawCommandPick;C.shaderProgram=C.shaderProgram&&C.shaderProgram.destroy()}if(l(e._drawCommandPickVoxel)){let C=e._drawCommandPickVoxel;C.shaderProgram=C.shaderProgram&&C.shaderProgram.destroy()}e._drawCommand=f,e._drawCommandPick=x,e._drawCommandPickVoxel=_}var a9=kpt;var s5i=T(S(),1);var WMi=T(S(),1);function jl(){this.orientedBoundingBox=new Zn,this.boundingSphere=new ce,this.boundTransform=new M,this.shapeTransform=new M,this._minBounds=h.clone(jl.DefaultMinBounds,new h),this._maxBounds=h.clone(jl.DefaultMaxBounds,new h),this.shaderUniforms={renderMinBounds:new h,renderMaxBounds:new h,boxUvToShapeUvScale:new h,boxUvToShapeUvTranslate:new h},this.shaderDefines={BOX_INTERSECTION_INDEX:void 0,BOX_HAS_SHAPE_BOUNDS:void 0},this.shaderMaximumIntersectionsLength=0}var Upt=new h,qj=new h,Dpt=new $,Bpt=new h,Ypt=new h,Opt=new h,zpt=new h,P_e=M.fromRotationTranslation($.fromUniformScale(.5,new $),new h(.5,.5,.5),new M);jl.prototype.update=function(e,t,n,i,o){i=g(i,jl.DefaultMinBounds),o=g(o,jl.DefaultMaxBounds);let r=jl.DefaultMinBounds,s=jl.DefaultMaxBounds;t=this._minBounds=h.clamp(t,r,s,this._minBounds),n=this._maxBounds=h.clamp(n,r,s,this._maxBounds),i=h.clamp(i,r,s,Bpt),o=h.clamp(o,r,s,Ypt);let a=h.clamp(t,i,o,Opt),c=h.clamp(n,i,o,zpt),d=M.getScale(e,qj);if(a.x>c.x||a.y>c.y||a.z>c.z||(a.x===c.x)+(a.y===c.y)+(a.z===c.z)>=2||i.x>o.x||i.y>o.y||i.z>o.z||d.x===0||d.y===0||d.z===0)return!1;this.shapeTransform=M.clone(e,this.shapeTransform),this.orientedBoundingBox=e8(a,c,this.shapeTransform,this.orientedBoundingBox),this.boundTransform=M.fromRotationTranslation(this.orientedBoundingBox.halfAxes,this.orientedBoundingBox.center,this.boundTransform),this.boundingSphere=ce.fromOrientedBoundingBox(this.orientedBoundingBox,this.boundingSphere);let{shaderUniforms:u,shaderDefines:m}=this;for(let f in m)m.hasOwnProperty(f)&&(m[f]=void 0);let p=!h.equals(t,r)||!h.equals(n,s),b=0;if(m.BOX_INTERSECTION_INDEX=b,b+=1,u.renderMinBounds=M.multiplyByPoint(P_e,a,u.renderMinBounds),u.renderMaxBounds=M.multiplyByPoint(P_e,c,u.renderMaxBounds),p){m.BOX_HAS_SHAPE_BOUNDS=!0;let f=t,x=n;u.boxUvToShapeUvScale=h.fromElements(2/(f.x===x.x?1:x.x-f.x),2/(f.y===x.y?1:x.y-f.y),2/(f.z===x.z?1:x.z-f.z),u.boxUvToShapeUvScale),u.boxUvToShapeUvTranslate=h.fromElements(-u.boxUvToShapeUvScale.x*(f.x*.5+.5),-u.boxUvToShapeUvScale.y*(f.y*.5+.5),-u.boxUvToShapeUvScale.z*(f.z*.5+.5),u.boxUvToShapeUvTranslate)}return this.shaderMaximumIntersectionsLength=b,!0};var m3=new h,$j=new h;jl.prototype.computeOrientedBoundingBoxForTile=function(e,t,n,i,o){let r=this._minBounds,s=this._maxBounds,a=1/Math.pow(2,e),c=h.fromElements(P.lerp(r.x,s.x,a*t),P.lerp(r.y,s.y,a*n),P.lerp(r.z,s.z,a*i),m3),d=h.fromElements(P.lerp(r.x,s.x,a*(t+1)),P.lerp(r.y,s.y,a*(n+1)),P.lerp(r.z,s.z,a*(i+1)),$j);return e8(c,d,this.shapeTransform,o)};var v_e=new h;jl.prototype.computeOrientedBoundingBoxForSample=function(e,t,n,i){let o=1/Math.pow(2,e.level),r=h.divideComponents(h.ONE,t,v_e),s=h.multiplyByScalar(r,o,v_e),a=h.multiplyByScalar(h.fromElements(e.x+n.x,e.y+n.y,e.z+n.z,m3),o,m3),c=h.add(a,s,$j),d=this._minBounds,u=this._maxBounds,m=h.fromElements(P.lerp(d.x,u.x,a.x),P.lerp(d.y,u.y,a.y),P.lerp(d.z,u.z,a.z),m3),p=h.fromElements(P.lerp(d.x,u.x,c.x),P.lerp(d.y,u.y,c.y),P.lerp(d.z,u.z,c.z),$j);return e8(m,p,this.shapeTransform,i)};jl.DefaultMinBounds=Object.freeze(new h(-1,-1,-1));jl.DefaultMaxBounds=Object.freeze(new h(1,1,1));function e8(e,t,n,i){let o=jl.DefaultMinBounds,r=jl.DefaultMaxBounds;if(h.equals(e,o)&&h.equals(t,r))i.center=M.getTranslation(n,i.center),i.halfAxes=M.getMatrix3(n,i.halfAxes);else{let a=M.getScale(n,qj),c=h.midpoint(e,t,Upt);i.center=M.multiplyByPoint(n,c,i.center),a=h.fromElements(a.x*.5*(t.x-e.x),a.y*.5*(t.y-e.y),a.z*.5*(t.z-e.z),qj);let d=M.getRotation(n,Dpt);i.halfAxes=$.setScale(d,a,i.halfAxes)}return i}var qf=jl;var BMi=T(S(),1);function Qr(){this.orientedBoundingBox=new Zn,this.boundingSphere=new ce,this.boundTransform=new M,this.shapeTransform=new M,this._minimumRadius=Qr.DefaultMinBounds.x,this._maximumRadius=Qr.DefaultMaxBounds.x,this._minimumHeight=Qr.DefaultMinBounds.y,this._maximumHeight=Qr.DefaultMaxBounds.y,this._minimumAngle=Qr.DefaultMinBounds.z,this._maximumAngle=Qr.DefaultMaxBounds.z,this.shaderUniforms={cylinderRenderHeightMinMax:new D,cylinderRenderRadiusMinMax:new D,cylinderRenderAngleMinMax:new D,cylinderUvToShapeUvRadius:new D,cylinderUvToShapeUvHeight:new D,cylinderUvToShapeUvAngle:new D,cylinderShapeUvAngleMinMax:new D,cylinderShapeUvAngleRangeZeroMid:0},this.shaderDefines={CYLINDER_HAS_RENDER_BOUNDS_RADIUS_MIN:void 0,CYLINDER_HAS_RENDER_BOUNDS_RADIUS_FLAT:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_EQUAL_ZERO:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_UNDER_HALF:void 0,CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_OVER_HALF:void 0,CYLINDER_HAS_SHAPE_BOUNDS_RADIUS:void 0,CYLINDER_HAS_SHAPE_BOUNDS_HEIGHT:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_DISCONTINUITY:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MAX_DISCONTINUITY:void 0,CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_MAX_REVERSED:void 0,CYLINDER_INTERSECTION_INDEX_RADIUS_MAX:void 0,CYLINDER_INTERSECTION_INDEX_RADIUS_MIN:void 0,CYLINDER_INTERSECTION_INDEX_ANGLE:void 0},this.shaderMaximumIntersectionsLength=0}var M_e=new h;Qr.prototype.update=function(e,t,n,i,o){i=g(i,Qr.DefaultMinBounds),o=g(o,Qr.DefaultMaxBounds);let r=Qr.DefaultMinBounds.x,s=Qr.DefaultMaxBounds.x,a=Qr.DefaultMinBounds.y,c=Qr.DefaultMaxBounds.y,d=Qr.DefaultMinBounds.z,u=Qr.DefaultMaxBounds.z,m=u-d,p=.5*m,b=P.EPSILON10,f=P.EPSILON3,x=P.EPSILON10,_=P.clamp(t.x,r,s),C=P.clamp(n.x,r,s),V=P.clamp(i.x,r,s),L=P.clamp(o.x,r,s),R=Math.max(_,V),G=Math.min(C,L),X=P.clamp(t.y,a,c),v=P.clamp(n.y,a,c),W=P.clamp(i.y,a,c),F=P.clamp(o.y,a,c),A=Math.max(X,W),y=Math.min(v,F),Z=P.negativePiToPi(t.z),E=P.negativePiToPi(n.z),I=P.negativePiToPi(i.z),w=P.negativePiToPi(o.z),k=Math.max(Z,I),B=Math.min(E,w),U=M.getScale(e,M_e);if(G===0||R>G||A>y||P.equalsEpsilon(U.x,0,void 0,b)||P.equalsEpsilon(U.y,0,void 0,b)||P.equalsEpsilon(U.z,0,void 0,b))return!1;this._minimumRadius=_,this._maximumRadius=C,this._minimumHeight=X,this._maximumHeight=v,this._minimumAngle=Z,this._maximumAngle=E,this.shapeTransform=M.clone(e,this.shapeTransform),this.orientedBoundingBox=n8(R,G,A,y,k,B,this.shapeTransform,this.orientedBoundingBox),this.boundTransform=M.fromRotationTranslation(this.orientedBoundingBox.halfAxes,this.orientedBoundingBox.center,this.boundTransform),this.boundingSphere=ce.fromOrientedBoundingBox(this.orientedBoundingBox,this.boundingSphere);let J=_===r&&C===s,z=X===a&&v===c,ee=E<Z,H=E-Z+ee*m,j=H>p+x&&H<m-x,q=H<p-x,pe=H>=p-x&&H<=p+x,_e=j||q||pe,ae=P.equalsEpsilon(Z,d,void 0,f),ye=P.equalsEpsilon(E,u,void 0,f),Te=R===r,Le=B<k,Re=B-k+Le*m,ke=Re>=p-x&&Re<m-x,rt=Re>x&&Re<p-x,yt=Re<=x,Dt=ke||rt||yt,{shaderUniforms:it,shaderDefines:Ie}=this;for(let Ke in Ie)Ie.hasOwnProperty(Ke)&&(Ie[Ke]=void 0);let ft=0;if(Ie.CYLINDER_INTERSECTION_INDEX_RADIUS_MAX=ft,ft+=1,Te||(Ie.CYLINDER_HAS_RENDER_BOUNDS_RADIUS_MIN=!0,Ie.CYLINDER_INTERSECTION_INDEX_RADIUS_MIN=ft,ft+=1),it.cylinderRenderRadiusMinMax=D.fromElements(R,G,it.cylinderRenderRadiusMinMax),R===G&&(Ie.CYLINDER_HAS_RENDER_BOUNDS_RADIUS_FLAT=!0),!J){Ie.CYLINDER_HAS_SHAPE_BOUNDS_RADIUS=!0;let Ke=C-_,ct=0,Jt=1;Ke!==0&&(ct=1/Ke,Jt=-_/Ke),it.cylinderUvToShapeUvRadius=D.fromElements(ct,Jt,it.cylinderUvToShapeUvRadius)}if(!z){Ie.CYLINDER_HAS_SHAPE_BOUNDS_HEIGHT=!0;let Ke=v-X,ct=0,Jt=1;Ke!==0&&(ct=2/Ke,Jt=-(X+1)/Ke),it.cylinderUvToShapeUvHeight=D.fromElements(ct,Jt,it.cylinderUvToShapeUvHeight)}if(it.cylinderRenderHeightMinMax=D.fromElements(A,y,it.cylinderRenderHeightMinMax),ee&&(Ie.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_MAX_REVERSED=!0),Dt&&(Ie.CYLINDER_HAS_RENDER_BOUNDS_ANGLE=!0,Ie.CYLINDER_INTERSECTION_INDEX_ANGLE=ft,ke?(Ie.CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_UNDER_HALF=!0,ft+=1):rt?(Ie.CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_OVER_HALF=!0,ft+=2):yt&&(Ie.CYLINDER_HAS_RENDER_BOUNDS_ANGLE_RANGE_EQUAL_ZERO=!0,ft+=2),it.cylinderRenderAngleMinMax=D.fromElements(k,B,it.cylinderRenderAngleMinMax)),_e){Ie.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE=!0,ae&&(Ie.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MIN_DISCONTINUITY=!0),ye&&(Ie.CYLINDER_HAS_SHAPE_BOUNDS_ANGLE_MAX_DISCONTINUITY=!0);let Ke=(Z-d)/m,ct=(E-d)/m,Jt=1-H/m;if(it.cylinderShapeUvAngleMinMax=D.fromElements(Ke,ct,it.cylinderShapeUvAngleMinMax),it.cylinderShapeUvAngleRangeZeroMid=(ct+.5*Jt)%1,H<=x)it.cylinderUvToShapeUvAngle=D.fromElements(0,1,it.cylinderUvToShapeUvAngle);else{let be=m/H,Ve=-(Z-d)/H;it.cylinderUvToShapeUvAngle=D.fromElements(be,Ve,it.cylinderUvToShapeUvAngle)}}return this.shaderMaximumIntersectionsLength=ft,!0};Qr.prototype.computeOrientedBoundingBoxForTile=function(e,t,n,i,o){let r=this._minimumRadius,s=this._maximumRadius,a=this._minimumHeight,c=this._maximumHeight,d=this._minimumAngle,u=this._maximumAngle,m=1/Math.pow(2,e),p=P.lerp(r,s,t*m),b=P.lerp(r,s,(t+1)*m),f=P.lerp(a,c,n*m),x=P.lerp(a,c,(n+1)*m),_=P.lerp(d,u,i*m),C=P.lerp(d,u,(i+1)*m);return n8(p,b,f,x,_,C,this.shapeTransform,o)};var w_e=new h,F_e=new h,Hpt=new h;Qr.prototype.computeOrientedBoundingBoxForSample=function(e,t,n,i){let o=1/Math.pow(2,e.level),r=h.divideComponents(h.ONE,t,w_e),s=h.multiplyByScalar(r,o,w_e),a=h.multiplyByScalar(h.fromElements(e.x+n.x,e.y+n.y,e.z+n.z,F_e),o,F_e),c=h.add(a,s,Hpt),d=this._minimumRadius,u=this._maximumRadius,m=this._minimumHeight,p=this._maximumHeight,b=this._minimumAngle,f=this._maximumAngle,x=P.lerp(d,u,a.x),_=P.lerp(d,u,c.x),C=P.lerp(m,p,a.y),V=P.lerp(m,p,c.y),L=P.lerp(b,f,a.z),R=P.lerp(b,f,c.z);return n8(x,_,C,V,L,R,this.shapeTransform,i)};Qr.DefaultMinBounds=Object.freeze(new h(0,-1,-P.PI));Qr.DefaultMaxBounds=Object.freeze(new h(1,1,+P.PI));var Kpt=5,Jpt=new Array(Kpt),Qpt=new h,jpt=new $,qpt=new M,$pt=new M,e0t=new M,t8=new M,t0t=new h,n0t=new h,i0t=new h,N_e=new Array(8);for(let e=0;e<8;e++)N_e[e]=new h;function A_e(e,t,n){return Math.abs(se.dot(e,t))<n}function o0t(e){let t=M.getColumn(e,0,t0t),n=M.getColumn(e,1,n0t),i=M.getColumn(e,2,i0t),o=P.EPSILON4;return A_e(t,n,o)&&A_e(n,i,o)}function r0t(e,t){let n=N_e;h.fromElements(-.5,-.5,-.5,n[0]),h.fromElements(-.5,-.5,.5,n[1]),h.fromElements(-.5,.5,-.5,n[2]),h.fromElements(-.5,.5,.5,n[3]),h.fromElements(.5,-.5,-.5,n[4]),h.fromElements(.5,-.5,.5,n[5]),h.fromElements(.5,.5,-.5,n[6]),h.fromElements(.5,.5,.5,n[7]);for(let i=0;i<8;++i)M.multiplyByPoint(e,n[i],n[i]);return Zn.fromPoints(n,t)}function n8(e,t,n,i,o,r,s,a){let c=Qr.DefaultMinBounds,d=Qr.DefaultMaxBounds,u=c.x,m=d.x,p=c.y,b=d.y,f=c.z,x=d.z;if(e===u&&t===m&&n===p&&i===b&&o===f&&r===x)return a.center=M.getTranslation(s,a.center),a.halfAxes=M.getMatrix3(s,a.halfAxes),a;r<o&&(r+=P.TWO_PI);let C=r-o,V=o+C*.5,L=Jpt,R=0;L[R++]=o,L[R++]=r,L[R++]=V,C>P.PI&&(L[R++]=V-P.PI_OVER_TWO,L[R++]=V+P.PI_OVER_TWO);let G=1,X=1,v=-1,W=-1;for(let ee=0;ee<R;++ee){let H=L[ee]-V,j=Math.cos(H),q=Math.sin(H),pe=j*e,_e=q*e,ae=j*t,ye=q*t;G=Math.min(G,pe),X=Math.min(X,_e),G=Math.min(G,ae),X=Math.min(X,ye),v=Math.max(v,pe),W=Math.max(W,_e),v=Math.max(v,ae),W=Math.max(W,ye)}let F=v-G,A=W-X,y=i-n,Z=(G+v)*.5,E=(X+W)*.5,I=(n+i)*.5,w=h.fromElements(Z,E,I,Qpt),k=$.fromRotationZ(V,jpt),B=h.fromElements(F,A,y,M_e),U=M.fromScale(B,e0t),Y=M.fromRotation(k,$pt),N=M.fromTranslation(w,qpt),J=M.multiplyTransformation(Y,M.multiplyTransformation(N,U,t8),t8),z=M.multiplyTransformation(s,J,t8);return o0t(z)?Zn.fromTransformation(z,a):r0t(z,a)}var $f=Qr;var t5i=T(S(),1);function lb(){this.orientedBoundingBox=new Zn,this.boundingSphere=new ce,this.boundTransform=new M,this.shapeTransform=new M,this._rectangle=new le,this._minimumHeight=lb.DefaultMinBounds.z,this._maximumHeight=lb.DefaultMaxBounds.z,this._ellipsoid=new oe,this._translation=new h,this._rotation=new $,this.shaderUniforms={ellipsoidRadiiUv:new h,eccentricitySquared:0,evoluteScale:new D,ellipsoidInverseRadiiSquaredUv:new h,ellipsoidRenderLongitudeMinMax:new D,ellipsoidShapeUvLongitudeMinMaxMid:new h,ellipsoidUvToShapeUvLongitude:new D,ellipsoidUvToShapeUvLatitude:new D,ellipsoidRenderLatitudeSinMinMax:new D,ellipsoidInverseHeightDifferenceUv:0,clipMinMaxHeight:new D},this.shaderDefines={ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_EQUAL_ZERO:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_OVER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_EQUAL_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_OVER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_EQUAL_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_OVER_HALF:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE:void 0,ELLIPSOID_INTERSECTION_INDEX_LONGITUDE:void 0,ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX:void 0,ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN:void 0,ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MAX:void 0,ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MIN:void 0},this.shaderMaximumIntersectionsLength=0}var s0t=new h,a0t=new h,c0t=new h,l0t=new h,d0t=new h,u0t=new h,m0t=new h,h0t=new h,f0t=new $,k_e=new h,U_e=new h,p0t=new le;lb.prototype.update=function(e,t,n,i,o){let{DefaultMinBounds:r,DefaultMaxBounds:s}=lb;i=g(i,r),o=g(o,s);let a=P.EPSILON10,c=P.EPSILON3,d=P.EPSILON10,u=P.EPSILON10,m=P.EPSILON3,p=M.getScale(e,h0t),b=h.clone(r,s0t);b.z=-h.minimumComponent(p);let f=h.clamp(t,b,s,a0t),x=h.clamp(n,b,s,c0t),_=h.clamp(i,b,s,l0t),C=h.clamp(o,b,s,d0t),V=h.maximumByComponent(f,_,u0t),L=h.minimumByComponent(x,C,m0t),R=h.add(p,h.fromElements(x.z,x.z,x.z,k_e),k_e),G=h.maximumComponent(R),X=h.add(p,h.fromElements(L.z,L.z,L.z,U_e),U_e);if(V.y>L.y||V.y===s.y||L.y===r.y||V.z>L.z||P.equalsEpsilon(X,h.ZERO,void 0,a))return!1;this._rectangle=le.fromRadians(f.x,f.y,x.x,x.y),this._translation=M.getTranslation(e,this._translation),this._rotation=M.getRotation(e,this._rotation),this._ellipsoid=oe.fromCartesian3(p,this._ellipsoid),this._minimumHeight=f.z,this._maximumHeight=x.z;let v=le.fromRadians(V.x,V.y,L.x,L.y,p0t);this.orientedBoundingBox=i8(v,V.z,L.z,this._ellipsoid,this._translation,this._rotation,this.orientedBoundingBox),this.shapeTransform=M.fromRotationTranslation($.setScale(this._rotation,R,f0t),this._translation,this.shapeTransform),this.boundTransform=M.fromRotationTranslation(this.orientedBoundingBox.halfAxes,this.orientedBoundingBox.center,this.boundTransform),this.boundingSphere=ce.fromOrientedBoundingBox(this.orientedBoundingBox,this.boundingSphere);let W=s.x-r.x,F=.5*W,A=L.x<V.x,y=L.x-V.x+A*W,Z=y<=d,E=y>=F-d&&y<W-d,I=y>d&&y<F-d,w=Z||E||I,k=x.x<f.x,B=x.x-f.x+k*W,U=B>F+d&&B<W-d,Y=B>=F-d&&B<=F+d,N=B<F-d,J=U||Y||N,z=L.y<-m,ee=L.y>=-m&&L.y<=+m,H=L.y>+m&&L.y<s.y-u,j=z||ee||H,q=V.y>r.y+u&&V.y<-m,pe=V.y>=-m&&V.y<=+m,_e=V.y>+m,ae=q||pe||_e,ye=j||ae,Te=x.y-f.y,Le=x.y<-m,Re=x.y>=-m&&x.y<=+m,ke=x.y>+m&&x.y<s.y-u,rt=Le||Re||ke,yt=f.y>r.y+u&&f.y<-m,Dt=f.y>=-m&&f.y<=+m,it=f.y>+m,ft=rt||(yt||Dt||it),{shaderUniforms:Ke,shaderDefines:ct}=this;for(let Pi in ct)ct.hasOwnProperty(Pi)&&(ct[Pi]=void 0);Ke.ellipsoidRadiiUv=h.divideByScalar(R,G,Ke.ellipsoidRadiiUv);let{x:Jt,z:be}=Ke.ellipsoidRadiiUv,Ve=be/Jt;Ke.eccentricitySquared=1-Ve*Ve,Ke.evoluteScale=D.fromElements((Jt*Jt-be*be)/Jt,(be*be-Jt*Jt)/be,Ke.evoluteScale),Ke.ellipsoidInverseRadiiSquaredUv=h.divideComponents(h.ONE,h.multiplyComponents(Ke.ellipsoidRadiiUv,Ke.ellipsoidRadiiUv,Ke.ellipsoidInverseRadiiSquaredUv),Ke.ellipsoidInverseRadiiSquaredUv);let Bt=0;ct.ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MAX=Bt,Bt+=1,ct.ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MIN=Bt,Bt+=1,Ke.clipMinMaxHeight=D.fromElements((V.z-x.z)/G,(L.z-x.z)/G,Ke.clipMinMaxHeight);let mt=(x.z-f.z)/G;if(Ke.ellipsoidInverseHeightDifferenceUv=1/mt,f.z===x.z&&(Ke.ellipsoidInverseHeightDifferenceUv=0),w&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE=!0,ct.ELLIPSOID_INTERSECTION_INDEX_LONGITUDE=Bt,E?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_UNDER_HALF=!0,Bt+=1):I?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_OVER_HALF=!0,Bt+=2):Z&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_EQUAL_ZERO=!0,Bt+=2),Ke.ellipsoidRenderLongitudeMinMax=D.fromElements(V.x,L.x,Ke.ellipsoidRenderLongitudeMinMax)),J)if(ct.ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE=!0,x.x<f.x&&(ct.ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED=!0),B<=d)Ke.ellipsoidUvToShapeUvLongitude=D.fromElements(0,1,Ke.ellipsoidUvToShapeUvLongitude);else{let Co=W/B,Es=-(f.x-r.x)/B;Ke.ellipsoidUvToShapeUvLongitude=D.fromElements(Co,Es,Ke.ellipsoidUvToShapeUvLongitude)}if(w){let Pi=P.equalsEpsilon(V.x,r.x,void 0,c),Co=P.equalsEpsilon(L.x,s.x,void 0,c);Pi&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY=!0),Co&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY=!0);let Es=(f.x-r.x)/W,$r=(x.x-r.x)/W,Nr=(L.x-r.x)/W,Qs=1-y/W,De=(Nr+.5*Qs)%1;Ke.ellipsoidShapeUvLongitudeMinMaxMid=h.fromElements(Es,$r,De,Ke.ellipsoidShapeUvLongitudeMinMaxMid)}if(ye&&(ae&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN=!0,ct.ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN=Bt,q?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_UNDER_HALF=!0,Bt+=1):pe?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_EQUAL_HALF=!0,Bt+=1):_e&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_OVER_HALF=!0,Bt+=2)),j&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX=!0,ct.ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX=Bt,z?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_UNDER_HALF=!0,Bt+=2):ee?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_EQUAL_HALF=!0,Bt+=1):H&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_OVER_HALF=!0,Bt+=1)),Ke.ellipsoidRenderLatitudeSinMinMax=D.fromElements(Math.sin(V.y),Math.sin(L.y),Ke.ellipsoidRenderLatitudeSinMinMax)),ft)if(ct.ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE=!0,Te<u)Ke.ellipsoidUvToShapeUvLatitude=D.fromElements(0,1,Ke.ellipsoidUvToShapeUvLatitude);else{let Co=(s.y-r.y)/Te,Es=(r.y-f.y)/Te;Ke.ellipsoidUvToShapeUvLatitude=D.fromElements(Co,Es,Ke.ellipsoidUvToShapeUvLatitude)}return this.shaderMaximumIntersectionsLength=Bt,!0};var Y_e=new le;lb.prototype.computeOrientedBoundingBoxForTile=function(e,t,n,i,o){let r=1/Math.pow(2,e),s=t*r,a=(t+1)*r,c=n*r,d=(n+1)*r,u=i*r,m=(i+1)*r,p=le.subsection(this._rectangle,s,c,a,d,Y_e),b=P.lerp(this._minimumHeight,this._maximumHeight,u),f=P.lerp(this._minimumHeight,this._maximumHeight,m);return i8(p,b,f,this._ellipsoid,this._translation,this._rotation,o)};var D_e=new h,B_e=new h,b0t=new h;lb.prototype.computeOrientedBoundingBoxForSample=function(e,t,n,i){let o=1/Math.pow(2,e.level),r=h.divideComponents(h.ONE,t,D_e),s=h.multiplyByScalar(r,o,D_e),a=h.multiplyByScalar(h.fromElements(e.x+n.x,e.y+n.y,e.z+n.z,B_e),o,B_e),c=h.add(a,s,b0t),d=le.subsection(this._rectangle,a.x,a.y,c.x,c.y,Y_e),u=P.lerp(this._minimumHeight,this._maximumHeight,a.z),m=P.lerp(this._minimumHeight,this._maximumHeight,c.z);return i8(d,u,m,this._ellipsoid,this._translation,this._rotation,i)};function i8(e,t,n,i,o,r,s){return s=Zn.fromRectangle(e,t,n,i,s),s.center=h.add(s.center,o,s.center),s.halfAxes=$.multiply(s.halfAxes,r,s.halfAxes),s}lb.DefaultMinBounds=Object.freeze(new h(-P.PI,-P.PI_OVER_TWO,-oe.WGS84.minimumRadius));lb.DefaultMaxBounds=Object.freeze(new h(P.PI,P.PI_OVER_TWO,10*oe.WGS84.maximumRadius));var UT=lb;var Kd={BOX:\"BOX\",ELLIPSOID:\"ELLIPSOID\",CYLINDER:\"CYLINDER\"};Kd.getMinBounds=function(e){switch(e){case Kd.BOX:return qf.DefaultMinBounds;case Kd.ELLIPSOID:return UT.DefaultMinBounds;case Kd.CYLINDER:return $f.DefaultMinBounds}};Kd.getMaxBounds=function(e){switch(e){case Kd.BOX:return qf.DefaultMaxBounds;case Kd.ELLIPSOID:return UT.DefaultMaxBounds;case Kd.CYLINDER:return $f.DefaultMaxBounds}};Kd.getShapeConstructor=function(e){switch(e){case Kd.BOX:return qf;case Kd.ELLIPSOID:return UT;case Kd.CYLINDER:return $f}};var Ii=Object.freeze(Kd);var aNi=T(S(),1);var d5i=T(S(),1);function Eh(e){this._comparator=e.comparator,this._maximumLength=e.maximumLength,this._array=l(e.maximumLength)?new Array(e.maximumLength):[],this._length=0}Object.defineProperties(Eh.prototype,{length:{get:function(){return this._length}},maximumLength:{get:function(){return this._maximumLength},set:function(e){if(l(e)){for(;this._length>e;)this.removeMinimum();this._array.length=e}this._maximumLength=e}},internalArray:{get:function(){return this._array}},comparator:{get:function(){return this._comparator}}});Eh.prototype.clone=function(){let e=this._maximumLength,t=this._comparator,n=this._array,i=this._length,o=new Eh({comparator:t,maximumLength:e});o._length=i;for(let r=0;r<i;r++)o._array[r]=n[r];return o};Eh.prototype.reset=function(){this._length=0;let e=this._maximumLength;if(l(e))for(let t=0;t<e;t++)this._array[t]=void 0;else this._array.length=0};Eh.prototype.resort=function(){let e=this._length;for(let t=0;t<e;t++)O_e(this,t)};Eh.prototype.insert=function(e){let t,n=this._maximumLength;if(l(n)){if(n===0)return;if(this._length===n){let o=this._array[0];if(this._comparator(e,o)<=0)return e;t=this.removeMinimum()}}let i=this._length;return this._array[i]=e,this._length++,O_e(this,i),t};Eh.prototype.removeMinimum=function(){let e=this._length;if(e===0)return;this._length--;let t=this._array[0];return e>=2&&(this._array[0]=this._array[e-1],z_e(this,0)),this._array[e-1]=void 0,t};Eh.prototype.removeMaximum=function(){let e=this._length;if(e===0)return;this._length--;let t;if(e<=2)t=this._array[e-1];else{let n=o8(this,1,2)?1:2;t=this._array[n],this._array[n]=this._array[e-1],e>=4&&z_e(this,n)}return this._array[e-1]=void 0,t};Eh.prototype.getMinimum=function(){if(this._length!==0)return this._array[0]};Eh.prototype.getMaximum=function(){let e=this._length;if(e!==0)return e<=2?this._array[e-1]:this._array[o8(this,1,2)?1:2]};function h3(e,t,n){let i=e._array,o=i[t];i[t]=i[n],i[n]=o}function c9(e,t,n){return e._comparator(e._array[t],e._array[n])<0}function o8(e,t,n){return e._comparator(e._array[t],e._array[n])>0}function O_e(e,t){if(t===0)return;let n=Math.floor(P.log2(t+1))%2===0,i=Math.floor((t-1)/2),o=c9(e,t,i);for(o!==n&&(h3(e,t,i),t=i);t>=3;){let r=Math.floor((t-3)/4);if(c9(e,t,r)!==o)break;h3(e,t,r),t=r}}function z_e(e,t){let n=e._length,i=Math.floor(P.log2(t+1))%2===0,o;for(;(o=2*t+1)<n;){let r=o,s=o+1;if(s<n){c9(e,s,r)===i&&(r=s);let a=2*o+1,c=Math.max(Math.min(n-a,4),0);for(let d=0;d<c;d++){let u=a+d;c9(e,u,r)===i&&(r=u)}}if(c9(e,r,t)===i&&(h3(e,r,t),r!==o&&r!==s)){let a=Math.floor((r-1)/2);o8(e,r,a)===i&&h3(e,r,a)}t=r}}var DT=Eh;var m5i=T(S(),1),H_e=Object.freeze({UNLOADED:0,RECEIVING:1,RECEIVED:2,LOADED:3,FAILED:4,UNAVAILABLE:5});function f3(e,t){this.spatialNode=e,this.keyframe=t,this.state=H_e.UNLOADED,this.metadata=[],this.megatextureIndex=-1,this.priority=-Number.MAX_VALUE,this.highPriorityFrameNumber=-1}f3.priorityComparator=function(e,t){return e.priority-t.priority};f3.searchComparator=function(e,t){return e.keyframe-t.keyframe};f3.LoadState=H_e;var ji=f3;var W5i=T(S(),1);function Lg(e,t,n,i,o){i===sn.UNSIGNED_SHORT&&(i=sn.FLOAT32);let r=e.floatingPointTexture;if(i===sn.FLOAT32&&!r)throw new ue(\"Floating point texture not supported\");let s;i===sn.FLOAT32||i===sn.FLOAT64?s=Qe.FLOAT:i===sn.UINT8&&(s=Qe.UNSIGNED_BYTE);let a;n===1?a=e.webgl2?at.RED:at.LUMINANCE:n===2?a=e.webgl2?at.RG:at.LUMINANCE_ALPHA:n===3?a=at.RGB:n===4&&(a=at.RGBA);let c=512*1024*1024,d=128*1024*1024;o=Math.min(g(o,d),c);let u=Yt.maximumTextureSize,m=sn.getSizeInBytes(i),p=Math.floor(o/(n*m)),b=Math.min(u,P.previousPowerOfTwo(Math.floor(Math.sqrt(p)))),f=Math.ceil(Math.sqrt(t.x)),x=Math.ceil(t.z/f),_=f*t.x,C=x*t.y,V=Math.floor(b/_),L=Math.floor(b/C);if(V===0||L===0)throw new ue(\"Tileset is too large to fit into megatexture\");this.channelCount=n,this.componentType=i,this.voxelCountPerTile=h.clone(t,new h),this.maximumTileCount=V*L,this.regionCountPerMegatexture=new D(V,L),this.voxelCountPerRegion=new D(_,C),this.sliceCountPerRegion=new D(f,x),this.voxelSizeUv=new D(1/b,1/b),this.sliceSizeUv=new D(t.x/b,t.y/b),this.regionSizeUv=new D(_/b,C/b),this.texture=new Ft({context:e,pixelFormat:a,pixelDatatype:s,flipY:!1,width:b,height:b,sampler:new mn({wrapS:En.CLAMP_TO_EDGE,wrapT:En.CLAMP_TO_EDGE,minificationFilter:dn.LINEAR,magnificationFilter:yi.LINEAR})});let R=sn.toComponentDatatype(i);this.tileVoxelDataTemp=Q.createTypedArray(R,_*C*n),this.nodes=new Array(this.maximumTileCount);for(let G=0;G<this.maximumTileCount;G++)this.nodes[G]=new y0t(G);for(let G=0;G<this.maximumTileCount;G++){let X=this.nodes[G];X.previousNode=G>0?this.nodes[G-1]:void 0,X.nextNode=G<this.maximumTileCount-1?this.nodes[G+1]:void 0}this.occupiedList=void 0,this.emptyList=this.nodes[0],this.occupiedCount=0}function y0t(e){this.index=e,this.nextNode=void 0,this.previousNode=void 0}Lg.prototype.add=function(e){if(this.isFull())throw new fe(\"Trying to add when there are no empty"
}