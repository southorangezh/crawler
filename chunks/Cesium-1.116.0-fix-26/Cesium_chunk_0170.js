{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 170,
    "total_chunks": 194,
    "chunk_size": 62950,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.751Z"
  },
  "content": "0,this._clock=e.clock,this._transformPositionWorldToUv=new M,this._transformPositionUvToWorld=new M,this._transformDirectionWorldToLocal=new $,this._transformNormalLocalToWorld=new $,this._jitter=!1,this._nearestSampling=!1,this._levelBlendFactor=0,this._stepSizeMultiplier=1,this._depthTest=!0,this._useLogDepth=void 0,this._screenSpaceError=4,this._debugPolylines=new zm,this._debugDraw=!1,this._disableRender=!1,this._disableUpdate=!1,this._uniforms={octreeInternalNodeTexture:void 0,octreeInternalNodeTilesPerRow:0,octreeInternalNodeTexelSizeUv:new D,octreeLeafNodeTexture:void 0,octreeLeafNodeTilesPerRow:0,octreeLeafNodeTexelSizeUv:new D,megatextureTextures:[],megatextureSliceDimensions:new D,megatextureTileDimensions:new D,megatextureVoxelSizeUv:new D,megatextureSliceSizeUv:new D,megatextureTileSizeUv:new D,dimensions:new h,paddingBefore:new h,paddingAfter:new h,transformPositionViewToUv:new M,transformPositionUvToView:new M,transformDirectionViewToLocal:new $,transformNormalLocalToWorld:new $,cameraPositionUv:new h,ndcSpaceAxisAlignedBoundingBox:new se,clippingPlanesTexture:void 0,clippingPlanesMatrix:new M,stepSize:0,pickColor:new O},this._shapeDefinesOld={},this._uniformMap={};let t=this._uniforms,n=this._uniformMap;for(let o in t)if(t.hasOwnProperty(o)){let r=`u_${o}`;n[r]=function(){return t[o]}}let i=this._provider;N0t(this,i)}function N0t(e,t){let{shape:n,minBounds:i=Ii.getMinBounds(n),maxBounds:o=Ii.getMaxBounds(n)}=t;e.minBounds=i,e.maxBounds=o,e.minClippingBounds=Ii.getMinBounds(n),e.maxClippingBounds=Ii.getMaxBounds(n),e._exaggeratedMinBounds=h.clone(e._minBounds,e._exaggeratedMinBounds),e._exaggeratedMaxBounds=h.clone(e._maxBounds,e._exaggeratedMaxBounds),e._exaggeratedModelMatrix=M.clone(e._modelMatrix,e._exaggeratedModelMatrix),tTe(e,t);let r=Ii.getShapeConstructor(n);e._shape=new r,e._shapeVisible=nTe(e,e._shape,t)}Object.defineProperties(ep.prototype,{ready:{get:function(){return this._ready}},provider:{get:function(){return this._provider}},boundingSphere:{get:function(){return this._shape.boundingSphere}},orientedBoundingBox:{get:function(){return this._shape.orientedBoundingBox}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=M.clone(e,this._modelMatrix)}},shape:{get:function(){return this._provider.shape}},dimensions:{get:function(){return this._provider.dimensions}},minimumValues:{get:function(){return this._provider.minimumValues}},maximumValues:{get:function(){return this._provider.maximumValues}},show:{get:function(){return!this._disableRender},set:function(e){this._disableRender=!e}},disableUpdate:{get:function(){return this._disableUpdate},set:function(e){this._disableUpdate=e}},debugDraw:{get:function(){return this._debugDraw},set:function(e){this._debugDraw=e}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._shaderDirty=!0)}},jitter:{get:function(){return this._jitter},set:function(e){this._jitter!==e&&(this._jitter=e,this._shaderDirty=!0)}},nearestSampling:{get:function(){return this._nearestSampling},set:function(e){this._nearestSampling!==e&&(this._nearestSampling=e,this._shaderDirty=!0)}},levelBlendFactor:{get:function(){return this._levelBlendFactor},set:function(e){this._levelBlendFactor=P.clamp(e,0,1)}},screenSpaceError:{get:function(){return this._screenSpaceError},set:function(e){this._screenSpaceError=e}},stepSize:{get:function(){return this._stepSizeMultiplier},set:function(e){this._stepSizeMultiplier=e}},minBounds:{get:function(){return this._minBounds},set:function(e){this._minBounds=h.clone(e,this._minBounds)}},maxBounds:{get:function(){return this._maxBounds},set:function(e){this._maxBounds=h.clone(e,this._maxBounds)}},minClippingBounds:{get:function(){return this._minClippingBounds},set:function(e){this._minClippingBounds=h.clone(e,this._minClippingBounds)}},maxClippingBounds:{get:function(){return this._maxClippingBounds},set:function(e){this._maxClippingBounds=h.clone(e,this._maxClippingBounds)}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){fs.setOwner(e,this,\"_clippingPlanes\")}},customShader:{get:function(){return this._customShader},set:function(e){if(this._customShader!==e){let t=this._uniformMap,i=this._customShader.uniformMap;for(let o in i)i.hasOwnProperty(o)&&delete t[o];l(e)?this._customShader=e:this._customShader=ep.DefaultCustomShader,this._shaderDirty=!0}}},customShaderCompilationEvent:{get:function(){return this._customShaderCompilationEvent}}});var k0t=new h,U0t=new se,D0t=new se,B0t=new h,Y0t=new h,O0t=new $,z0t=new $,H0t=new M,K0t=new M,J0t=new M,Q0t=M.fromRotationTranslation($.fromUniformScale(.5,new $),new h(.5,.5,.5),new M),j0t=M.fromRotationTranslation($.fromUniformScale(2,new $),new h(-1,-1,-1),new M);ep.prototype.update=function(e){let t=this._provider;this._customShader.update(e);let n=e.context;if(!this._ready){ibt(this,t,n),e.afterRender.push(()=>(this._ready=!0,!0));return}tbt(this,e);let i=tTe(this,t),o=this._shape;if(i&&(this._shapeVisible=nTe(this,o,t),sbt(this,o)&&(this._shaderDirty=!0)),!this._shapeVisible)return;let r=abt(t.timeIntervalCollection,this._clock),s=this._traversal,a=s._sampleCount;if(s.update(e,r,i,this._disableUpdate),a!==s._sampleCount&&(this._shaderDirty=!0),!s.isRenderable(s.rootNode)||(this._debugDraw&&pbt(this,e),this._disableRender))return;this._useLogDepth!==e.useLogDepth&&(this._useLogDepth=e.useLogDepth,this._shaderDirty=!0),cbt(this,e)&&(this._shaderDirty=!0);let d=s.leafNodeTexture,u=this._uniforms;l(d)&&(u.octreeLeafNodeTexture=s.leafNodeTexture,u.octreeLeafNodeTexelSizeUv=D.clone(s.leafNodeTexelSizeUv,u.octreeLeafNodeTexelSizeUv),u.octreeLeafNodeTilesPerRow=s.leafNodeTilesPerRow),this._shaderDirty&&(a9(this,n),this._shaderDirty=!1);let m=n.uniformState.viewProjection,p=o.orientedBoundingBox,b=ubt(p,m,D0t);if(b.x===1||b.y===1||b.z===-1||b.w===-1)return;u.ndcSpaceAxisAlignedBoundingBox=se.clone(b,u.ndcSpaceAxisAlignedBoundingBox);let x=n.uniformState.inverseView;u.transformPositionViewToUv=M.multiplyTransformation(this._transformPositionWorldToUv,x,u.transformPositionViewToUv);let _=n.uniformState.view;u.transformPositionUvToView=M.multiplyTransformation(_,this._transformPositionUvToWorld,u.transformPositionUvToView);let C=n.uniformState.inverseViewRotation;u.transformDirectionViewToLocal=$.multiply(this._transformDirectionWorldToLocal,C,u.transformDirectionViewToLocal),u.transformNormalLocalToWorld=$.clone(this._transformNormalLocalToWorld,u.transformNormalLocalToWorld);let V=e.camera.positionWC;u.cameraPositionUv=M.multiplyByPoint(this._transformPositionWorldToUv,V,u.cameraPositionUv),u.stepSize=this._stepSizeMultiplier;let L=e.passes.pick?this._drawCommandPick:e.passes.pickVoxel?this._drawCommandPickVoxel:this._drawCommand;L.boundingVolume=o.boundingSphere,e.commandList.push(L)};var q0t=new h,s8=new h,$0t=new he,ebt=new h;function tbt(e,t){if(e._exaggeratedMinBounds=h.clone(e._minBounds,e._exaggeratedMinBounds),e._exaggeratedMaxBounds=h.clone(e._maxBounds,e._exaggeratedMaxBounds),e.shape===Ii.ELLIPSOID){let n=t.verticalExaggerationRelativeHeight,i=t.verticalExaggeration;e._exaggeratedMinBounds.z=(e._minBounds.z-n)*i+n,e._exaggeratedMaxBounds.z=(e._maxBounds.z-n)*i+n}else if(e.shape===Ii.BOX){let n=h.fromElements(1,1,t.verticalExaggeration,q0t);e._exaggeratedModelMatrix=M.multiplyByScale(e._modelMatrix,n,e._exaggeratedModelMatrix),e._exaggeratedModelMatrix=M.multiplyByTranslation(e._exaggeratedModelMatrix,nbt(e,t),e._exaggeratedModelMatrix)}}function nbt(e,t){let{shapeTransform:n=M.IDENTITY,globalTransform:i=M.IDENTITY}=e._provider,o=M.getTranslation(n,s8),r=M.multiplyByPoint(e._modelMatrix,o,s8),s=M.multiplyByPoint(i,r,s8),c=oe.WGS84.cartesianToCartographic(s,$0t),d=0;l(c)&&(d=c.height);let u=pr.getHeight(d,t.verticalExaggeration,t.verticalExaggerationRelativeHeight);return h.fromElements(0,0,(u-d)/t.verticalExaggeration,ebt)}function ibt(e,t,n){let i=e._uniforms;e._pickId=n.createPickId({primitive:e}),i.pickColor=O.clone(e._pickId.color,i.pickColor);let{shaderDefines:o,shaderUniforms:r}=e._shape;e._shapeDefinesOld=Oe(o,!0);let s=e._uniformMap;for(let a in r)if(r.hasOwnProperty(a)){let c=`u_${a}`;s[c]=function(){return r[a]}}i.dimensions=h.clone(t.dimensions,i.dimensions),e._paddingBefore=h.clone(g(t.paddingBefore,h.ZERO),e._paddingBefore),i.paddingBefore=h.clone(e._paddingBefore,i.paddingBefore),e._paddingAfter=h.clone(g(t.paddingAfter,h.ZERO),e._paddingBefore),i.paddingAfter=h.clone(e._paddingAfter,i.paddingAfter),e._traversal=obt(e,t,n),rbt(e._traversal,i)}function tTe(e,t){let n=g(t.shapeTransform,M.IDENTITY),i=g(t.globalTransform,M.IDENTITY);return M.multiplyTransformation(i,e._exaggeratedModelMatrix,e._compoundModelMatrix),M.multiplyTransformation(e._compoundModelMatrix,n,e._compoundModelMatrix),OT(e,\"_compoundModelMatrix\",\"_compoundModelMatrixOld\")+OT(e,\"_minBounds\",\"_minBoundsOld\")+OT(e,\"_maxBounds\",\"_maxBoundsOld\")+OT(e,\"_exaggeratedMinBounds\",\"_exaggeratedMinBoundsOld\")+OT(e,\"_exaggeratedMaxBounds\",\"_exaggeratedMaxBoundsOld\")+OT(e,\"_minClippingBounds\",\"_minClippingBoundsOld\")+OT(e,\"_maxClippingBounds\",\"_maxClippingBoundsOld\")>0}function OT(e,t,n){let i=e[t],o=e[n],r=!i.equals(o);return r&&i.clone(o),r?1:0}function nTe(e,t,n){if(!t.update(e._compoundModelMatrix,e._exaggeratedMinBounds,e._exaggeratedMaxBounds,e.minClippingBounds,e.maxClippingBounds))return!1;let o=t.shapeTransform,r=M.inverse(o,H0t),s=M.getRotation(o,O0t),a=M.getScale(o,B0t),c=h.maximumComponent(a),d=h.divideByScalar(a,c,Y0t),u=$.multiplyByScale(s,d,z0t);return e._transformPositionWorldToUv=M.multiplyTransformation(Q0t,r,e._transformPositionWorldToUv),e._transformPositionUvToWorld=M.multiplyTransformation(o,j0t,e._transformPositionUvToWorld),e._transformDirectionWorldToLocal=M.getMatrix3(r,e._transformDirectionWorldToLocal),e._transformNormalLocalToWorld=$.inverseTranspose(u,e._transformNormalLocalToWorld),!0}function obt(e,t,n){let i=h.clone(t.dimensions,k0t);h.add(i,e._paddingBefore,i),h.add(i,e._paddingAfter,i);let o=t.maximumTileCount,r=l(o)?jV.getApproximateTextureMemoryByteLength(o,i,t.types,t.componentTypes):void 0,s=g(t.keyframeCount,1);return new jV(e,n,i,t.types,t.componentTypes,s,r)}function rbt(e,t){t.octreeInternalNodeTexture=e.internalNodeTexture,t.octreeInternalNodeTexelSizeUv=D.clone(e.internalNodeTexelSizeUv,t.octreeInternalNodeTexelSizeUv),t.octreeInternalNodeTilesPerRow=e.internalNodeTilesPerRow;let n=e.megatextures,i=n[0],o=n.length;t.megatextureTextures=new Array(o);for(let r=0;r<o;r++)t.megatextureTextures[r]=n[r].texture;t.megatextureSliceDimensions=D.clone(i.sliceCountPerRegion,t.megatextureSliceDimensions),t.megatextureTileDimensions=D.clone(i.regionCountPerMegatexture,t.megatextureTileDimensions),t.megatextureVoxelSizeUv=D.clone(i.voxelSizeUv,t.megatextureVoxelSizeUv),t.megatextureSliceSizeUv=D.clone(i.sliceSizeUv,t.megatextureSliceSizeUv),t.megatextureTileSizeUv=D.clone(i.regionSizeUv,t.megatextureTileSizeUv)}function sbt(e,t){let n=t.shaderDefines,i=Object.keys(n).some(o=>n[o]!==e._shapeDefinesOld[o]);return i&&(e._shapeDefinesOld=Oe(n,!0)),i}function abt(e,t){if(!l(e)||!l(t))return 0;let n=t.currentTime,i,o=e.indexOf(n);o>=0?i=e.get(o):(o=~o,o===e.length?(o=e.length-1,i=e.get(o),n=i.stop):(i=e.get(o),n=i.start));let r=te.secondsDifference(i.stop,i.start),a=te.secondsDifference(n,i.start)/r;return o+a}function cbt(e,t){let n=e.clippingPlanes;if(!l(n))return!1;n.update(t);let{clippingPlanesState:i,enabled:o}=n;if(o){let r=e._uniforms;r.clippingPlanesTexture=n.texture,r.clippingPlanesMatrix=M.transpose(M.multiplyTransformation(M.inverse(n.modelMatrix,r.clippingPlanesMatrix),e._transformPositionUvToWorld,r.clippingPlanesMatrix),r.clippingPlanesMatrix)}return e._clippingPlanesState===i&&e._clippingPlanesEnabled===o?!1:(e._clippingPlanesState=i,e._clippingPlanesEnabled=o,!0)}ep.prototype.isDestroyed=function(){return!1};ep.prototype.destroy=function(){let e=this._drawCommand;l(e)&&(e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy());let t=this._drawCommandPick;return l(t)&&(t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()),this._pickId=this._pickId&&this._pickId.destroy(),this._traversal=this._traversal&&this._traversal.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),me(this)};var eTe=new Array(new se(-1,-1,-1,1),new se(1,-1,-1,1),new se(-1,1,-1,1),new se(1,1,-1,1),new se(-1,-1,1,1),new se(1,-1,1,1),new se(-1,1,1,1),new se(1,1,1,1)),lbt=new Array(1,2,4,0,3,5,0,3,6,1,2,7,0,5,6,1,4,7,2,4,7,3,5,6),dbt=new Array(new se,new se,new se,new se,new se,new se,new se,new se);function ubt(e,t,n){let i=M.fromRotationTranslation(e.halfAxes,e.center,K0t),o=M.multiply(t,i,J0t),r=+Number.MAX_VALUE,s=-Number.MAX_VALUE,a=+Number.MAX_VALUE,c=-Number.MAX_VALUE,d,u=dbt,m=eTe.length;for(d=0;d<m;d++)M.multiplyByVector(o,eTe[d],u[d]);for(d=0;d<m;d++){let p=u[d];if(p.z>=-p.w){let b=p.x/p.w,f=p.y/p.w;r=Math.min(r,b),s=Math.max(s,b),a=Math.min(a,f),c=Math.max(c,f)}else for(let b=0;b<3;b++){let f=lbt[d*3+b],x=u[f];if(x.z>=-x.w){let _=p.z+p.w,C=x.z+x.w,V=_/(_-C),L=se.lerp(p,x,V,U0t),R=L.x/L.w,G=L.y/L.w;r=Math.min(r,R),s=Math.max(s,R),a=Math.min(a,G),c=Math.max(c,G)}}}return r=P.clamp(r,-1,1),a=P.clamp(a,-1,1),s=P.clamp(s,-1,1),c=P.clamp(c,-1,1),n=se.fromElements(r,a,s,c,n),n}var a8=3e7,mbt=new h(a8,0,0),hbt=new h(0,a8,0),fbt=new h(0,0,a8);function pbt(e,t){let n=e._traversal,i=e._debugPolylines;i.removeAll();function o(c,d,u,m){i.add({positions:[c,d],width:m,material:ki.fromType(\"Color\",{color:u})})}function r(c,d,u){let m=c.computeCorners();o(m[0],m[1],d,u),o(m[2],m[3],d,u),o(m[4],m[5],d,u),o(m[6],m[7],d,u),o(m[0],m[2],d,u),o(m[4],m[6],d,u),o(m[1],m[3],d,u),o(m[5],m[7],d,u),o(m[0],m[4],d,u),o(m[2],m[6],d,u),o(m[1],m[5],d,u),o(m[3],m[7],d,u)}function s(c){if(!n.isRenderable(c))return;let d=c.level,m=Math.max(1,5/Math.pow(2,d)),b=[O.RED,O.LIME,O.BLUE][d%3];if(r(c.orientedBoundingBox,b,m),l(c.children))for(let f=0;f<8;f++)s(c.children[f])}r(e._shape.orientedBoundingBox,O.WHITE,5),s(n.rootNode);let a=10;o(h.ZERO,mbt,O.RED,a),o(h.ZERO,hbt,O.LIME,a),o(h.ZERO,fbt,O.BLUE,a),i.update(t)}ep.DefaultCustomShader=new YT({fragmentShaderText:`void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) { material.diffuse = vec3(1.0); material.alpha = 1.0; }`});function iTe(){this.ready=!0,this.shape=Ii.BOX,this.dimensions=new h(1,1,1),this.names=[\"data\"],this.types=[Kt.SCALAR],this.componentTypes=[sn.FLOAT32],this.maximumTileCount=1}iTe.prototype.requestData=function(e){if(!((l(e)?g(e.tileLevel,0):0)>=1))return Promise.resolve([new Float32Array(1)])};ep.DefaultProvider=new iTe;var Zg=ep;var g3=function(e){return function(){e.frameState.afterRender.push(function(){e.requestRender()})}};function ci(e){e=g(e,g.EMPTY_OBJECT);let t=e.canvas,n=e.creditContainer,i=e.creditViewport,o=Oe(e.contextOptions),r=l(n),s=new NG(t,o);r||(n=document.createElement(\"div\"),n.style.position=\"absolute\",n.style.bottom=\"0\",n.style[\"text-shadow\"]=\"0 0 2px #000000\",n.style.color=\"#ffffff\",n.style[\"font-size\"]=\"10px\",n.style[\"padding-right\"]=\"5px\",t.parentNode.appendChild(n)),l(i)||(i=t.parentNode),this._id=Bn(),this._jobScheduler=new Jw,this._frameState=new Hw(s,new ww(n,\" \\u2022 \",i),this._jobScheduler),this._frameState.scene3DOnly=g(e.scene3DOnly,!1),this._removeCreditContainer=!r,this._creditContainer=n,this._canvas=t,this._context=s,this._computeEngine=new NL(s),this._globe=void 0,this._globeTranslucencyState=new Kw,this._primitives=new Ml,this._groundPrimitives=new Ml,this._globeHeight=void 0,this._globeHeightDirty=!0,this._cameraUnderground=!1,this._removeUpdateHeightCallback=void 0,this._logDepthBuffer=ci.defaultLogDepthBuffer&&s.fragmentDepth,this._logDepthBufferDirty=!0,this._tweens=new AT,this._shaderFrameCount=0,this._sunPostProcess=void 0,this._computeCommandList=[],this._overlayCommandList=[],this._useOIT=g(e.orderIndependentTranslucency,!0),this._executeOITFunction=void 0,this._depthPlane=new Bw(e.depthPlaneEllipsoidOffset),this._clearColorCommand=new ei({color:new O,stencil:0,owner:this}),this._depthClearCommand=new ei({depth:1,owner:this}),this._stencilClearCommand=new ei({stencil:0}),this._classificationStencilClearCommand=new ei({stencil:0,renderState:Ne.fromCache({stencilMask:Mt.CLASSIFICATION_MASK})}),this._depthOnlyRenderStateCache={},this._transitioner=new vF(this),this._preUpdate=new ge,this._postUpdate=new ge,this._renderError=new ge,this._preRender=new ge,this._postRender=new ge,this._minimumDisableDepthTestDistance=0,this._debugInspector=new BF,this._msaaSamples=g(e.msaaSamples,1),this.rethrowRenderErrors=!1,this.prefer3dTiles=!1,this.completeMorphOnUserInput=!0,this.morphStart=new ge,this.morphComplete=new ge,this.skyBox=void 0,this.skyAtmosphere=void 0,this.sun=void 0,this.sunBloom=!0,this._sunBloom=void 0,this.moon=void 0,this.backgroundColor=O.clone(O.BLACK),this._mode=ie.SCENE3D,this._mapProjection=l(e.mapProjection)?e.mapProjection:new Ci,this.morphTime=1,this.farToNearRatio=1e3,this.logarithmicDepthFarToNearRatio=1e9,this.nearToFarDistance2D=175e4,this.verticalExaggeration=1,this.verticalExaggerationRelativeHeight=0,this.debugCommandFilter=void 0,this.debugShowCommands=!1,this.debugShowFrustums=!1,this.debugShowFramesPerSecond=!1,this.debugShowDepthFrustum=1,this.debugShowFrustumPlanes=!1,this._debugShowFrustumPlanes=!1,this._debugFrustumPlanes=void 0,this.useDepthPicking=!0,this.pickTranslucentDepth=!1,this.cameraEventWaitTime=500,this.atmosphere=new Zw,this.fog=new zw,this._shadowMapCamera=new lo(this),this.shadowMap=new Lh({context:s,lightCamera:this._shadowMapCamera,enabled:g(e.shadows,!1)}),this.invertClassification=!1,this.invertClassificationColor=O.clone(O.WHITE),this._actualInvertClassificationColor=O.clone(this._invertClassificationColor),this._invertClassification=new BV,this.focalLength=void 0,this.eyeSeparation=void 0,this.postProcessStages=new IF,this._brdfLutGenerator=new Ew,this._performanceDisplay=void 0,this._debugVolume=void 0,this._screenSpaceCameraController=new MF(this),this._cameraUnderground=!1,this._mapMode2D=g(e.mapMode2D,Jl.INFINITE_SCROLL),this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1},this._useWebVR=!1,this._cameraVR=void 0,this._aspectRatioVR=void 0,this.requestRenderMode=g(e.requestRenderMode,!1),this._renderRequested=!0,this.maximumRenderTimeChange=g(e.maximumRenderTimeChange,0),this._lastRenderTime=void 0,this._frameRateMonitor=void 0,this._removeRequestListenerCallback=Ja.requestCompletedEvent.addEventListener(g3(this)),this._removeTaskProcessorListenerCallback=di.taskCompletedEvent.addEventListener(g3(this)),this._removeGlobeCallbacks=[],this._removeTerrainProviderReadyListener=void 0;let a=new ze(0,0,s.drawingBufferWidth,s.drawingBufferHeight),c=new lo(this);this._logDepthBuffer&&(c.frustum.near=.1,c.frustum.far=1e10),this.preloadFlightCamera=new lo(this),this.preloadFlightCullingVolume=void 0,this._picking=new cF(this),this._defaultView=new ET(this,c,a),this._view=this._defaultView,this._hdr=void 0,this._hdrDirty=void 0,this.highDynamicRange=!1,this.gamma=2.2,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this._specularEnvironmentMapAtlas=void 0,this.light=new yp,this.enablePickOverlay=!0,this.disableGetTilesetHeight=!1,aTe(this,0,te.now()),this.updateFrameState(),this.initializeFrame()}ci.defaultLogDepthBuffer=!0;function bbt(e,t){for(let i=0;i<e._removeGlobeCallbacks.length;++i)e._removeGlobeCallbacks[i]();e._removeGlobeCallbacks.length=0;let n=[];l(t)&&(n.push(t.imageryLayersUpdatedEvent.addEventListener(g3(e))),n.push(t.terrainProviderChanged.addEventListener(g3(e)))),e._removeGlobeCallbacks=n}Object.defineProperties(ci.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return Yt.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return Yt.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},specularEnvironmentMapsSupported:{get:function(){return Xm.isSupported(this._context)}},globe:{get:function(){return this._globe},set:function(e){this._globe=this._globe&&this._globe.destroy(),this._globe=e,bbt(this,e)}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(e){this._view.camera=e}},view:{get:function(){return this._view},set:function(e){this._view=e}},defaultView:{get:function(){return this._defaultView}},picking:{get:function(){return this._picking}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},jobScheduler:{get:function(){return this._jobScheduler}},frameState:{get:function(){return this._frameState}},environmentState:{get:function(){return this._environmentState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(l(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(l(this.globe))return this.globe.terrainProvider},set:function(e){this._removeTerrainProviderReadyListener=this._removeTerrainProviderReadyListener&&this._removeTerrainProviderReadyListener(),l(this.globe)&&(this.globe.terrainProvider=e)}},terrainProviderChanged:{get:function(){if(l(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(e){e===ie.SCENE2D?this.morphTo2D(0):e===ie.SCENE3D?this.morphTo3D(0):e===ie.COLUMBUS_VIEW&&this.morphToColumbusView(0),this._mode=e}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},useWebVR:{get:function(){return this._useWebVR},set:function(e){this._useWebVR=e,this._useWebVR?(this._frameState.creditDisplay.container.style.visibility=\"hidden\",this._cameraVR=new lo(this),l(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new Ow(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility=\"visible\",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},splitMode:{get:function(){return this._frameState.splitMode},set:function(e){this._frameState.splitMode=e}},splitPosition:{get:function(){return this._frameState.splitPosition},set:function(e){this._frameState.splitPosition=e}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(e){this._minimumDisableDepthTestDistance=e}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(e){e=this._context.fragmentDepth&&e,this._logDepthBuffer!==e&&(this._logDepthBuffer=e,this._logDepthBufferDirty=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(e){this._context.uniformState.gamma=e}},highDynamicRange:{get:function(){return this._hdr},set:function(e){let t=this._context,n=e&&t.depthTexture&&(t.colorBufferFloat||t.colorBufferHalfFloat);this._hdrDirty=n!==this._hdr,this._hdr=n}},highDynamicRangeSupported:{get:function(){let e=this._context;return e.depthTexture&&(e.colorBufferFloat||e.colorBufferHalfFloat)}},cameraUnderground:{get:function(){return this._cameraUnderground}},msaaSamples:{get:function(){return this._msaaSamples},set:function(e){e=Math.min(e,Yt.maximumSamples),this._msaaSamples=e}},msaaSupported:{get:function(){return this._context.msaa}},pixelRatio:{get:function(){return this._frameState.pixelRatio},set:function(e){this._frameState.pixelRatio=e}},opaqueFrustumNearOffset:{get:function(){return .9999}},globeHeight:{get:function(){return this._globeHeight}}});ci.prototype.getCompressedTextureFormatSupported=function(e){let t=this.context;return(e===\"WEBGL_compressed_texture_s3tc\"||e===\"s3tc\")&&t.s3tc||(e===\"WEBGL_compressed_texture_pvrtc\"||e===\"pvrtc\")&&t.pvrtc||(e===\"WEBGL_compressed_texture_etc\"||e===\"etc\")&&t.etc||(e===\"WEBGL_compressed_texture_etc1\"||e===\"etc1\")&&t.etc1||(e===\"WEBGL_compressed_texture_astc\"||e===\"astc\")&&t.astc||(e===\"EXT_texture_compression_bptc\"||e===\"bc7\")&&t.bc7};function oTe(e,t,n){let i=e._frameState,o=e._context,r=e._view.oit,s=i.shadowState.lightShadowMaps,a=i.shadowState.lightShadowsEnabled,c=t.derivedCommands;l(t.pickId)&&(c.picking=Dd.createPickDerivedCommand(e,t,o,c.picking)),t.pickOnly||(c.depth=Dd.createDepthOnlyDerivedCommand(e,t,o,c.depth)),c.originalCommand=t,e._hdr&&(c.hdr=Dd.createHdrCommand(t,o,c.hdr),t=c.hdr.command,c=t.derivedCommands),a&&t.receiveShadows&&(c.shadows=Lh.createReceiveDerivedCommand(s,t,n,o,c.shadows)),t.pass===Ze.TRANSLUCENT&&l(r)&&r.isSupported()&&(a&&t.receiveShadows?(c.oit=l(c.oit)?c.oit:{},c.oit.shadows=r.createDerivedCommands(c.shadows.receiveCommand,o,c.oit.shadows)):c.oit=r.createDerivedCommands(t,o,c.oit))}ci.prototype.updateDerivedCommands=function(e){if(!l(e.derivedCommands))return;let t=this._frameState,n=this._context,i=!1,o=t.shadowState.lastDirtyTime;e.lastDirtyTime!==o&&(e.lastDirtyTime=o,e.dirty=!0,i=!0);let r=t.useLogDepth,s=this._hdr,a=e.derivedCommands,c=l(a.logDepth),d=l(a.hdr),u=l(a.originalCommand),m=r&&!c,p=s&&!d,b=(!r||!s)&&!u;if(e.dirty=e.dirty||m||p||b,e.dirty){e.dirty=!1;let f=t.shadowState.shadowMaps;t.shadowState.shadowsEnabled&&e.castShadows&&(a.shadows=Lh.createCastDerivedCommand(f,e,i,n,a.shadows)),(c||m)&&(a.logDepth=Dd.createLogDepthCommand(e,n,a.logDepth),oTe(this,a.logDepth.command,i)),(u||b)&&oTe(this,e,i)}};var ybt=new em({pass:Io.RENDER}),c8=new em({pass:Io.PRELOAD}),l8=new em({pass:Io.PRELOAD_FLIGHT}),gbt=new em({pass:Io.REQUEST_RENDER_MODE_DEFER_CHECK}),rTe=new ce,d8;function xbt(e){let t=e.globe;if(e._mode===ie.SCENE3D&&l(t)&&t.show&&!e._cameraUnderground&&!e._globeTranslucencyState.translucent){let n=t.ellipsoid,i=e.frameState.minimumTerrainHeight;return rTe.radius=n.minimumRadius+i,d8=Vw.fromBoundingSphere(rTe,e.camera.positionWC,d8),d8}}ci.prototype.clearPasses=function(e){e.render=!1,e.pick=!1,e.pickVoxel=!1,e.depth=!1,e.postProcess=!1,e.offscreen=!1,e.uranusDepth=!1};function aTe(e,t,n){let i=e._frameState;i.frameNumber=t,i.time=te.clone(n,i.time)}ci.prototype.updateFrameState=function(){let e=this.camera,t=this._frameState;t.commandList.length=0,t.shadowMaps.length=0,t.brdfLutGenerator=this._brdfLutGenerator,t.environmentMap=this.skyBox&&this.skyBox._cubeMap,t.mode=this._mode,t.morphTime=this.morphTime,t.mapProjection=this.mapProjection,t.camera=e,t.cullingVolume=e.frustum.computeCullingVolume(e.positionWC,e.directionWC,e.upWC),t.occluder=xbt(this),t.minimumTerrainHeight=0,t.minimumDisableDepthTestDistance=this._minimumDisableDepthTestDistance,t.invertClassification=this.invertClassification,t.useLogDepth=this._logDepthBuffer&&!(this.camera.frustum instanceof rn||this.camera.frustum instanceof Vr),t.light=this.light,t.cameraUnderground=this._cameraUnderground,t.globeTranslucencyState=this._globeTranslucencyState;let{globe:n}=this;l(n)&&n._terrainExaggerationChanged&&(this.verticalExaggeration=n._terrainExaggeration,this.verticalExaggerationRelativeHeight=n._terrainExaggerationRelativeHeight,n._terrainExaggerationChanged=!1),t.verticalExaggeration=this.verticalExaggeration,t.verticalExaggerationRelativeHeight=this.verticalExaggerationRelativeHeight,l(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready?(t.specularEnvironmentMaps=this._specularEnvironmentMapAtlas.texture,t.specularEnvironmentMapsMaximumLOD=this._specularEnvironmentMapAtlas.maximumMipmapLevel):(t.specularEnvironmentMaps=void 0,t.specularEnvironmentMapsMaximumLOD=void 0),t.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients,this._actualInvertClassificationColor=O.clone(this.invertClassificationColor,this._actualInvertClassificationColor),BV.isTranslucencySupported(this._context)||(this._actualInvertClassificationColor.alpha=1),t.invertClassificationColor=this._actualInvertClassificationColor,l(this.globe)?t.maximumScreenSpaceError=this.globe.maximumScreenSpaceError:t.maximumScreenSpaceError=2,this.clearPasses(t.passes),t.tilesetPassState=void 0};ci.prototype.isVisible=function(e,t,n){return l(e)&&(!l(e.boundingVolume)||!e.cull||t.computeVisibility(e.boundingVolume)!==nn.OUTSIDE&&(!l(n)||!e.occlude||!e.boundingVolume.isOccluded(n)))};var y3=new M(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);y3=M.inverseTransformation(y3,y3);function _bt(e,t,n,i){let o=t._frameState,r=o.context,s=e.boundingVolume;l(t._debugVolume)&&t._debugVolume.destroy();let a,c=h.clone(s.center);if(o.mode!==ie.SCENE3D){c=M.multiplyByPoint(y3,c,c);let p=o.mapProjection,b=p.unproject(c);c=p.ellipsoid.cartographicToCartesian(b)}if(l(s.radius)){let p=s.radius;a=An.toWireframe(Ds.createGeometry(new Ds({radii:new h(p,p,p),vertexFormat:ln.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Rn({geometryInstances:new Vt({geometry:a,modelMatrix:M.fromTranslation(c),attributes:{color:new Ot(1,0,0,1)}}),appearance:new ln({flat:!0,translucent:!1}),asynchronous:!1})}else{let p=s.halfAxes;a=An.toWireframe(Tl.createGeometry(Tl.fromDimensions({dimensions:new h(2,2,2),vertexFormat:ln.FLAT_VERTEX_FORMAT}))),t._debugVolume=new Rn({geometryInstances:new Vt({geometry:a,modelMatrix:M.fromRotationTranslation(p,c,new M),attributes:{color:new Ot(1,0,0,1)}}),appearance:new ln({flat:!0,translucent:!1}),asynchronous:!1})}let d=o.commandList,u=o.commandList=[];t._debugVolume.update(o),e=u[0],o.useLogDepth&&(e=Dd.createLogDepthCommand(e,r).command);let m;l(i)&&(m=n.framebuffer,n.framebuffer=i),e.execute(r,n),l(m)&&(n.framebuffer=m),o.commandList=d}function u8(e,t){if(!t||!(e instanceof je))return e;let n=je.shallowClone(e),i=Oe(Ne.fromCache(n.renderState),!0);return i.stencilTest={enabled:!0,frontFunction:vn.EQUAL,frontOperation:{fail:dt.KEEP,zFail:dt.KEEP,zPass:dt.KEEP},backFunction:vn.EQUAL,backOperation:{fail:dt.KEEP,zFail:dt.KEEP,zPass:dt.KEEP},reference:Mt.CESIUM_3D_TILE_MASK,mask:Mt.CESIUM_3D_TILE_MASK},n.renderState=Ne.fromCache(i),n}function ka(e,t,n,i,o){let r=t._frameState;if(l(t.debugCommandFilter)&&!t.debugCommandFilter(e))return;if(e instanceof ei){e.execute(n,i);return}e.debugShowBoundingVolume&&l(e.boundingVolume)&&_bt(e,t,i,o),r.useLogDepth&&l(e.derivedCommands.logDepth)&&(e=e.derivedCommands.logDepth.command);let s=r.passes;if(!s.pick&&!s.pickVoxel&&!s.depth&&t._hdr&&l(e.derivedCommands)&&l(e.derivedCommands.hdr)&&(e=e.derivedCommands.hdr.command),s.pick||s.depth){if(s.pick&&!s.depth&&l(e.derivedCommands.picking)){e=e.derivedCommands.picking.pickCommand,e=u8(e,i.onlyOn3DTiles),e.execute(n,i);return}else if(l(e.derivedCommands.depth)){e=e.derivedCommands.depth.depthOnlyCommand,e=u8(e,i.onlyOn3DTiles),e.execute(n,i);return}}if(t.debugShowCommands||t.debugShowFrustums){t._debugInspector.executeDebugShowFrustumsCommand(t,e,i);return}r.shadowState.lightShadowsEnabled&&e.receiveShadows&&l(e.derivedCommands.shadows)?e.derivedCommands.shadows.receiveCommand.execute(n,i):(e=u8(e,i.onlyOn3DTiles),e.execute(n,i))}function f9(e,t,n,i){let o=t._frameState,r=e.derivedCommands;l(r)&&(o.useLogDepth&&l(r.logDepth)&&(e=r.logDepth.command),r=e.derivedCommands,l(r.picking)?(e=r.picking.pickCommand,e.execute(n,i)):l(r.depth)&&(e=r.depth.depthOnlyCommand,e.execute(n,i)))}function cTe(e,t,n){return t.boundingVolume.distanceSquaredTo(n)-e.boundingVolume.distanceSquaredTo(n)}function Tbt(e,t,n){return e.boundingVolume.distanceSquaredTo(n)-t.boundingVolume.distanceSquaredTo(n)+P.EPSILON12}function Sbt(e,t,n,i,o){let r=e.context;eb(i,cTe,e.camera.positionWC),l(o)&&t(o.unclassifiedCommand,e,r,n);let s=i.length;for(let a=0;a<s;++a)t(i[a],e,r,n)}function Cbt(e,t,n,i,o){let r=e.context;eb(i,Tbt,e.camera.positionWC),l(o)&&t(o.unclassifiedCommand,e,r,n);let s=i.length;for(let a=0;a<s;++a)t(i[a],e,r,n)}function Vbt(e,t,n,i){let o=e.context;eb(i,cTe,e.camera.positionWC);let r=i.length;for(let s=0;s<r;++s)t(i[s],e,o,n)}var lTe=new _i,dTe=new ol,uTe=new rn,mTe=new Vr,HT={all:0,globe:1,tiles:2};function Lbt(e,t){p9(e,t,HT.globe),p9(e,t,HT.tiles)}function p9(e,t,n=HT.all){if(n===HT.all&&e.prefer3dTiles&&!e.frameState.passes.uranusDepth){Lbt(e,t);return}let i=n!==HT.tiles,o=n!==HT.globe,r=n===HT.tiles,{camera:s,context:a,frameState:c}=e,{uniformState:d}=a;d.updateCamera(s);let u;l(s.frustum.fov)?u=s.frustum.clone(lTe):l(s.frustum.infiniteProjectionMatrix)?u=s.frustum.clone(dTe):l(s.frustum.width)?u=s.frustum.clone(uTe):u=s.frustum.clone(mTe),u.near=s.frustum.near,u.far=s.frustum.far,d.updateFrustum(u),d.updatePass(Ze.ENVIRONMENT);let m=c.passes,p=m.pick||m.pickVoxel,b=e._environmentState,f=e._view,x=b.renderTranslucentDepthForPick,_=b.useWebVR;if(!p&&!r){let k=b.skyBoxCommand;if(l(k)&&ka(k,e,a,t),b.isSkyAtmosphereVisible&&ka(b.skyAtmosphereCommand,e,a,t),b.isSunVisible&&(b.sunDrawCommand.execute(a,t),e.sunBloom&&!_)){let B;b.useGlobeDepthFramebuffer?B=f.globeDepth.framebuffer:b.usePostProcess?B=f.sceneFramebuffer.framebuffer:B=b.originalFramebuffer,e._sunPostProcess.execute(a),e._sunPostProcess.copy(a,B),t.framebuffer=B}b.isMoonVisible&&b.moonCommand.execute(a,t)}let C;b.useOIT?(l(e._executeOITFunction)||(e._executeOITFunction=function(k,B,U,Y,N){f.globeDepth.prepareColorTextures(a),f.oit.executeCommands(k,B,U,Y,N)}),C=e._executeOITFunction):m.render?C=Sbt:C=Cbt;let V=f.frustumCommandsList,L=V.length,R=b.clearGlobeDepth,G=b.useDepthPlane,X=e._globeTranslucencyState,v=X.translucent,W=e._view.globeTranslucencyFramebuffer,F=e._depthClearCommand,A=e._stencilClearCommand,y=e._classificationStencilClearCommand,Z=e._depthPlane,E=b.usePostProcessSelected,I=s.position.z,w;for(let k=0;k<L;++k){let B=L-k-1,U=V[B];e.mode===ie.SCENE2D?(s.position.z=I-U.near+1,u.far=Math.max(1,U.far-U.near),u.near=1,d.update(c),d.updateFrustum(u)):(u.near=B!==0?U.near*e.opaqueFrustumNearOffset:U.near,u.far=U.far,d.updateFrustum(u)),F.execute(a,t),!r&&k!==0&&a.stencilBuffer&&A.execute(a,t);let Y,N;if(i)if(d.updatePass(Ze.GLOBE),Y=U.commands[Ze.GLOBE],N=U.indices[Ze.GLOBE],v)X.executeGlobeCommands(U,ka,W,e,t);else for(w=0;w<N;++w)ka(Y[w],e,a,t);let J=f.globeDepth;if(r||l(J)&&b.useGlobeDepthFramebuffer&&J.executeCopyDepth(a,t),i){if(!b.renderTranslucentDepthForPick)if(d.updatePass(Ze.TERRAIN_CLASSIFICATION),Y=U.commands[Ze.TERRAIN_CLASSIFICATION],N=U.indices[Ze.TERRAIN_CLASSIFICATION],v)X.executeGlobeClassificationCommands(U,ka,W,e,t);else for(w=0;w<N;++w)ka(Y[w],e,a,t);R&&(F.execute(a,t),G&&Z.execute(a,t))}if(N=0,o)if(!b.useInvertClassification||p||b.renderTranslucentDepthForPick){for(d.updatePass(Ze.CESIUM_3D_TILE),Y=U.commands[Ze.CESIUM_3D_TILE],N=U.indices[Ze.CESIUM_3D_TILE],w=0;w<N;++w)ka(Y[w],e,a,t,void 0);if(N>0&&(l(J)&&b.useGlobeDepthFramebuffer&&(J.prepareColorTextures(a,R),J.executeUpdateDepth(a,t,R,J.depthStencilTexture)),!b.renderTranslucentDepthForPick))for(d.updatePass(Ze.CESIUM_3D_TILE_CLASSIFICATION),Y=U.commands[Ze.CESIUM_3D_TILE_CLASSIFICATION],N=U.indices[Ze.CESIUM_3D_TILE_CLASSIFICATION],w=0;w<N;++w)ka(Y[w],e,a,t,void 0)}else{e._invertClassification.clear(a,t);let j=t.framebuffer;for(t.framebuffer=e._invertClassification._fbo.framebuffer,d.updatePass(Ze.CESIUM_3D_TILE),Y=U.commands[Ze.CESIUM_3D_TILE],N=U.indices[Ze.CESIUM_3D_TILE],w=0;w<N;++w)ka(Y[w],e,a,t,void 0);for(l(J)&&b.useGlobeDepthFramebuffer&&(e._invertClassification.prepareTextures(a),J.executeUpdateDepth(a,t,R,e._invertClassification._fbo.getDepthStencilTexture())),d.updatePass(Ze.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW),Y=U.commands[Ze.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],N=U.indices[Ze.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW],w=0;w<N;++w)ka(Y[w],e,a,t,void 0);for(t.framebuffer=j,e._invertClassification.executeClassified(a,t),c.invertClassificationColor.alpha===1&&e._invertClassification.executeUnclassified(a,t),N>0&&a.stencilBuffer&&y.execute(a,t),d.updatePass(Ze.CESIUM_3D_TILE_CLASSIFICATION),Y=U.commands[Ze.CESIUM_3D_TILE_CLASSIFICATION],N=U.indices[Ze.CESIUM_3D_TILE_CLASSIFICATION],w=0;w<N;++w)ka(Y[w],e,a,t,void 0)}if(!r)N>0&&a.stencilBuffer&&A.execute(a,t);else if(U.indices[Ze.CESIUM_3D_TILE]>0)t.onlyOn3DTiles=!0;else continue;for(d.updatePass(Ze.VOXELS),Y=U.commands[Ze.VOXELS],N=U.indices[Ze.VOXELS],Y.length=N,Vbt(e,ka,t,Y),d.updatePass(Ze.OPAQUE),Y=U.commands[Ze.OPAQUE],N=U.indices[Ze.OPAQUE],w=0;w<N;++w)ka(Y[w],e,a,t);B!==0&&e.mode!==ie.SCENE2D&&(u.near=U.near,d.updateFrustum(u));let z;if(!p&&b.useInvertClassification&&c.invertClassificationColor.alpha<1&&(z=e._invertClassification),d.updatePass(Ze.TRANSLUCENT),Y=U.commands[Ze.TRANSLUCENT],Y.length=U.indices[Ze.TRANSLUCENT],C(e,ka,t,Y,z),U.indices[Ze.CESIUM_3D_TILE_CLASSIFICATION]>0&&f.translucentTileClassification.isSupported()&&(f.translucentTileClassification.executeTranslucentCommands(e,ka,t,Y,J.depthStencilTexture),f.translucentTileClassification.executeClassificationCommands(e,ka,t,U)),a.depthTexture&&e.useDepthPicking&&(b.useGlobeDepthFramebuffer||x)){let j=J.depthStencilTexture,q=e._picking.getPickDepth(e,B);q.update(a,j),q.executeCopyDepth(a,t)}if(r){t.onlyOn3DTiles=!1;continue}if(p||!E)continue;let H=t.framebuffer;if(t.framebuffer=f.sceneFramebuffer.getIdFramebuffer(),u.near=B!==0?U.near*e.opaqueFrustumNearOffset:U.near,u.far=U.far,d.updateFrustum(u),d.updatePass(Ze.GLOBE),Y=U.commands[Ze.GLOBE],N=U.indices[Ze.GLOBE],v)X.executeGlobeCommands(U,f9,W,e,t);else for(w=0;w<N;++w)f9(Y[w],e,a,t);for(R&&(F.framebuffer=t.framebuffer,F.execute(a,t),F.framebuffer=void 0),R&&G&&Z.execute(a,t),d.updatePass(Ze.CESIUM_3D_TILE),Y=U.commands[Ze.CESIUM_3D_TILE],N=U.indices[Ze.CESIUM_3D_TILE],w=0;w<N;++w)f9(Y[w],e,a,t);for(d.updatePass(Ze.OPAQUE),Y=U.commands[Ze.OPAQUE],N=U.indices[Ze.OPAQUE],w=0;w<N;++w)f9(Y[w],e,a,t);for(d.updatePass(Ze.TRANSLUCENT),Y=U.commands[Ze.TRANSLUCENT],N=U.indices[Ze.TRANSLUCENT],w=0;w<N;++w)f9(Y[w],e,a,t);t.framebuffer=H}}function hTe(e){e.context.uniformState.updatePass(Ze.COMPUTE);let n=e._environmentState.sunComputeCommand;l(n)&&n.execute(e._computeEngine);let i=e._computeCommandList,o=i.length;for(let r=0;r<o;++r)i[r].execute(e._computeEngine)}function Zbt(e,t){e._depthClearCommand.execute(e.context,t);let i=e.camera,o;l(i.frustum.fov)?o=i.frustum.clone(lTe):l(i.frustum.infiniteProjectionMatrix)?o=i.frustum.clone(dTe):l(i.frustum.width)?o=i.frustum.clone(uTe):o=i.frustum.clone(mTe),o.near=i.frustum.near,o.far=i.frustum.far;let r=e.context.uniformState;r.updateFrustum(o),r.updatePass(Ze.OVERLAY);let s=e.context,a=e._overlayCommandList,c=a.length;for(let d=0;d<c;++d)a[d].execute(s,t)}function Rbt(e,t,n){let i=n.shadowMapCullingVolume,o=n.isPointLight,r=n.passes,s=r.length,a=t.length;for(let c=0;c<a;++c){let d=t[c];if(e.updateDerivedCommands(d),d.castShadows&&(d.pass===Ze.GLOBE||d.pass===Ze.CESIUM_3D_TILE||d.pass===Ze.OPAQUE||d.pass===Ze.TRANSLUCENT)&&e.isVisible(d,i))if(o)for(let u=0;u<s;++u)r[u].commandList.push(d);else if(s===1)r[0].commandList.push(d);else{let u=!1;for(let m=s-1;m>=0;--m){let p=r[m].cullingVolume;if(e.isVisible(d,p))r[m].commandList.push(d),u=!0;else if(u)break}}}}function fTe(e){let t=e.frameState,n=t.shadowState.shadowMaps,i=n.length;if(!t.shadowState.shadowsEnabled)return;let o=e.context,r=o.uniformState;for(let s=0;s<i;++s){let a=n[s];if(a.outOfView)continue;let c=a.passes,d=c.length;for(let m=0;m<d;++m)c[m].commandList.length=0;let u=e.frameState.commandList;Rbt(e,u,a);for(let m=0;m<d;++m){let p=a.passes[m];r.updateCamera(p.camera),a.updatePass(o,m);let b=p.commandList.length;for(let f=0;f<b;++f){let x=p.commandList[f];r.updatePass(x.pass),ka(x.derivedCommands.shadows.castCommands[s],e,o,p.passState)}}}}var Gbt=new h;ci.prototype.updateAndExecuteCommands=function(e,t){let i=this._frameState.mode;this._environmentState.useWebVR?Ebt(this,e,t):i!==ie.SCENE2D||this._mapMode2D===Jl.ROTATE?Rg(!0,this,e,t):(h8(this,e,t),Mbt(this,e))};function Ebt(e,t,n){let i=e._view,o=i.camera,s=e._environmentState.renderTranslucentDepthForPick;h8(e,t,n),pTe(e),i.createPotentiallyVisibleSet(e),hTe(e),s||fTe(e);let a=t.viewport;a.x=0,a.y=0,a.width=a.width*.5;let c=lo.clone(o,e._cameraVR);c.frustum=o.frustum;let d=o.frustum.near,u=d*g(e.focalLength,5),m=g(e.eyeSeparation,u/30),p=h.multiplyByScalar(c.right,m*.5,Gbt);o.frustum.aspectRatio=a.width/a.height;let b=.5*m*d/u;h.add(c.position,p,o.position),o.frustum.xOffset=b,p9(e,t),a.x=a.width,h.subtract(c.position,p,o.position),o.frustum.xOffset=-b,p9(e,t),lo.clone(c,o)}var Xbt=new he(Math.PI,P.PI_OVER_TWO),Ibt=new h,Wbt=new h,Pbt=new M,vbt=new M,wbt=new h,Fbt=new h,Abt=new ze;function Mbt(e,t){let n=e.context,i=e.frameState,o=e.camera,r=t.viewport,s=ze.clone(r,Abt);t.viewport=s;let a=Xbt,c=Ibt;e.mapProjection.project(a,c);let u=h.clone(o.position,Wbt),m=M.clone(o.transform,vbt),p=o.frustum.clone();o._setTransform(M.IDENTITY);let b=M.computeViewportTransformation(s,0,1,Pbt),f=o.frustum.projectionMatrix,x=o.positionWC.y,_=h.fromElements(P.sign(x)*c.x-x,0,-o.positionWC.x,wbt),C=Wt.pointToGLWindowCoordinates(f,b,_,Fbt);C.x=Math.floor(C.x);let V=s.x,L=s.width;if(x===0||C.x<=V||C.x>=V+L)Rg(!0,e,t);else if(Math.abs(V+L*.5-C.x)<1)s.width=C.x-s.x,o.position.x*=P.sign(o.position.x),o.frustum.right=0,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),Rg(!0,e,t),s.x=C.x,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=0,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),Rg(!1,e,t);else if(C.x>V+L*.5){s.width=C.x-V;let R=o.frustum.right;o.frustum.right=c.x-x,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),Rg(!0,e,t),s.x=C.x,s.width=V+L-C.x,o.position.x=-o.position.x,o.frustum.left=-o.frustum.right,o.frustum.right=R-o.frustum.right*2,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),Rg(!1,e,t)}else{s.x=C.x,s.width=V+L-C.x;let R=o.frustum.left;o.frustum.left=-c.x-x,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),Rg(!0,e,t),s.x=V,s.width=C.x-V,o.position.x=-o.position.x,o.frustum.right=-o.frustum.left,o.frustum.left=R-o.frustum.left*2,i.cullingVolume=o.frustum.computeCullingVolume(o.positionWC,o.directionWC,o.upWC),n.uniformState.update(i),Rg(!1,e,t)}o._setTransform(m),h.clone(u,o.position),o.frustum=p.clone(),t.viewport=r}function Rg(e,t,n,i){let o=t._environmentState,r=t._view,s=o.renderTranslucentDepthForPick;e||(t.frameState.commandList.length=0),pTe(t),r.createPotentiallyVisibleSet(t),e&&(l(i)&&h8(t,n,i),hTe(t),s||fTe(t)),p9(t,n)}var sTe=new os;ci.prototype.updateEnvironment=function(){let e=this._frameState,t=this._view,n=this._environmentState,i=e.passes.render,o=e.passes.offscreen,r=this.atmosphere,s=this.skyAtmosphere,a=this.globe,c=this._globeTranslucencyState;if(!i||this._mode!==ie.SCENE2D&&t.camera.frustum instanceof rn||!c.environmentVisible)n.skyAtmosphereCommand=void 0,n.skyBoxCommand=void 0,n.sunDrawCommand=void 0,n.sunComputeCommand=void 0,n.moonCommand=void 0;else{if(l(s)){if(l(a))s.setDynamicLighting(_T.fromGlobeFlags(a)),n.isReadyForAtmosphere=n.isReadyForAtmosphere||!a.show||a._surface._tilesToRender.length>0;else{let C=r.dynamicLighting;s.setDynamicLighting(C),n.isReadyForAtmosphere=!0}n.skyAtmosphereCommand=s.update(e,a),l(n.skyAtmosphereCommand)&&this.updateDerivedCommands(n.skyAtmosphereCommand)}else n.skyAtmosphereCommand=void 0;n.skyBoxCommand=l(this.skyBox)?this.skyBox.update(e,this._hdr):void 0;let _=l(this.sun)?this.sun.update(e,t.passState,this._hdr):void 0;n.sunDrawCommand=l(_)?_.drawCommand:void 0,n.sunComputeCommand=l(_)?_.computeCommand:void 0,n.moonCommand=l(this.moon)?this.moon.update(e):void 0}let d=n.clearGlobeDepth=l(a)&&a.show&&(!a.depthTestAgainstTerrain||this.mode===ie.SCENE2D);(n.useDepthPlane=d&&this.mode===ie.SCENE3D&&c.useDepthPlane)&&this._depthPlane.update(e),n.renderTranslucentDepthForPick=!1,n.useWebVR=this._useWebVR&&this.mode!==ie.SCENE2D&&!o;let m=e.mode===ie.SCENE3D&&!c.sunVisibleThroughGlobe?e.occluder:void 0,p=e.cullingVolume,b=sTe.planes;for(let _=0;_<5;++_)b[_]=p.planes[_];p=sTe,n.isSkyAtmosphereVisible=l(n.skyAtmosphereCommand)&&n.isReadyForAtmosphere,n.isSunVisible=this.isVisible(n.sunDrawCommand,p,m),n.isMoonVisible=this.isVisible(n.moonCommand,p,m);let f=this.specularEnvironmentMaps,x=this._specularEnvironmentMapAtlas;l(f)&&(!l(x)||x.url!==f)?(x=x&&x.destroy(),this._specularEnvironmentMapAtlas=new Xm(f)):!l(f)&&l(x)&&(x.destroy(),this._specularEnvironmentMapAtlas=void 0),l(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e)};function Nbt(e){let t=e._frameState;e.debugShowFrustumPlanes!==e._debugShowFrustumPlanes&&(e.debugShowFrustumPlanes?e._debugFrustumPlanes=new Yf({camera:e.camera,updateOnChange:!1,frustumSplits:t.frustumSplits}):e._debugFrustumPlanes=e._debugFrustumPlanes&&e._debugFrustumPlanes.destroy(),e._debugShowFrustumPlanes=e.debugShowFrustumPlanes),l(e._debugFrustumPlanes)&&e._debugFrustumPlanes.update(t)}function kbt(e){let t=e._frameState,n=t.shadowMaps,i=n.length,o=i>0&&!t.passes.pick&&!t.passes.pickVoxel&&e.mode===ie.SCENE3D;if(o!==t.shadowState.shadowsEnabled&&(++t.shadowState.lastDirtyTime,t.shadowState.shadowsEnabled=o),t.shadowState.lightShadowsEnabled=!1,!!o){for(let r=0;r<i;++r)if(n[r]!==t.shadowState.shadowMaps[r]){++t.shadowState.lastDirtyTime;break}t.shadowState.shadowMaps.length=0,t.shadowState.lightShadowMaps.length=0;for(let r=0;r<i;++r){let s=n[r];s.update(t),t.shadowState.shadowMaps.push(s),s.fromLightSource&&(t.shadowState.lightShadowMaps.push(s),t.shadowState.lightShadowsEnabled=!0),s.dirty&&(++t.shadowState.lastDirtyTime,s.dirty=!1)}}}function pTe(e){let t=e._frameState;e._groundPrimitives.update(t),e._primitives.update(t),Nbt(e),kbt(e),e._globe&&e._globe.render(t)}function h8(e,t,n){let i=e._context,o=e._frameState,r=e._environmentState,s=e._view,a=e._frameState.passes,c=a.pick||a.pickVoxel;l(s.globeDepth)&&(s.globeDepth.picking=c);let d=r.useWebVR;r.originalFramebuffer=t.framebuffer,l(e.sun)&&e.sunBloom!==e._sunBloom?(e.sunBloom&&!d?e._sunPostProcess=new UF:l(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy()),e._sunBloom=e.sunBloom):!l(e.sun)&&l(e._sunPostProcess)&&(e._sunPostProcess=e._sunPostProcess.destroy(),e._sunBloom=!1);let u=e._clearColorCommand;O.clone(n,u.color),u.execute(i,t);let m=r.useGlobeDepthFramebuffer=l(s.globeDepth);m&&(s.globeDepth.update(i,t,s.viewport,e.msaaSamples,e._hdr,r.clearGlobeDepth),s.globeDepth.clear(i,t,n));let p=s.oit,b=r.useOIT=!c&&l(p)&&p.isSupported();b&&(p.update(i,t,s.globeDepth.colorFramebufferManager,e._hdr,e.msaaSamples),p.clear(i,t,n),r.useOIT=p.isSupported());let f=e.postProcessStages,x=r.usePostProcess=!c&&(e._hdr||f.length>0||f.ambientOcclusion.enabled||f.fxaa.enabled||f.bloom.enabled);if(r.usePostProcessSelected=!1,x&&(s.sceneFramebuffer.update(i,s.viewport,e._hdr,e.msaaSamples),s.sceneFramebuffer.clear(i,t,n),f.update(i,o.useLogDepth,e._hdr),f.clear(i),x=r.usePostProcess=f.ready,r.usePostProcessSelected=x&&f.hasSelected),r.isSunVisible&&e.sunBloom&&!d?(t.framebuffer=e._sunPostProcess.update(t),e._sunPostProcess.clear(i,t,n)):m?t.framebuffer=s.globeDepth.framebuffer:x&&(t.framebuffer=s.sceneFramebuffer.framebuffer),l(t.framebuffer)&&u.execute(i,t),r.useInvertClassification=!c&&l(t.framebuffer)&&e.invertClassification){let C;if(e.frameState.invertClassificationColor.alpha===1&&r.useGlobeDepthFramebuffer&&(C=s.globeDepth.framebuffer),l(C)||i.depthTexture){if(e._invertClassification.previousFramebuffer=C,e._invertClassification.update(i,e.msaaSamples,s.globeDepth.colorFramebufferManager),e._invertClassification.clear(i,t),e.frameState.invertClassificationColor.alpha<1&&b){let V=e._invertClassification.unclassifiedCommand,L=V.derivedCommands;L.oit=p.createDerivedCommands(V,i,L.oit)}}else r.useInvertClassification=!1}e._globeTranslucencyState.translucent&&s.globeTranslucencyFramebuffer.updateAndClear(e._hdr,s.viewport,i,t)}ci.prototype.resolveFramebuffers=function(e,t){let n=this._context,i=this._environmentState,o=this._view,r=o.globeDepth;l(r)&&r.prepareColorTextures(n);let s=i.useOIT,a=i.useGlobeDepthFramebuffer,c=i.usePostProcess,d=i.originalFramebuffer,u=a?r.colorFramebufferManager:void 0,m=o.sceneFramebuffer._colorFramebuffer,p=o.sceneFramebuffer.idFramebuffer;s&&(e.framebuffer=c?m.framebuffer:d,o.oit.execute(n,e));let b=o.translucentTileClassification;if(b.hasTranslucentDepth&&b.isSupported()&&b.execute(this,e),t&&t(),c){o.sceneFramebuffer.prepareColorTextures(n);let f=m;a&&!s&&(f=u);let x=this.postProcessStages,_=f.getColorTexture(0),C=p.getColorTexture(0),V=g(u,m).getDepthStencilTexture();x.execute(n,_,V,C),x.copy(n,d)}!s&&!c&&a&&(e.framebuffer=d,r.executeCopyColor(n,e))};function Ubt(e){let t=e._frameState.afterRender;for(let n=0,i=t.length;n<i;++n)t[n]()&&e.requestRender();t.length=0}function Dbt(e){if(e.mode===ie.MORPHING)return;let n=e.camera.positionCartographic;return e.disableGetTilesetHeight?l(e._globe)&&e._globe.show&&l(n)?e._globe.getHeight(n):void 0:e.getHeight(n)}ci.prototype.getHeight=function(e,t){if(!l(e))return;let n=t===Je.CLAMP_TO_TERRAIN||t===Je.RELATIVE_TO_TERRAIN,i=t===Je.CLAMP_TO_3D_TILE||t===Je.RELATIVE_TO_3D_TILE;if(!l(e))return;let o=Number.NEGATIVE_INFINITY;if(!n){let s=this.primitives.length;for(let a=0;a<s;++a){let c=this.primitives.get(a);if(!c.isCesium3DTileset||!c.show||!c.enableCollision)continue;let d=c.getHeight(e,this);l(d)&&d>o&&(o=d)}}let r=this._globe;if(!i&&l(r)&&r.show){let s=r.getHeight(e);s>o&&(o=s)}if(o>Number.NEGATIVE_INFINITY)return o};var m8=new he;ci.prototype.updateHeight=function(e,t,n){let i=()=>{he.clone(e,m8);let b=this.getHeight(e,n);l(b)&&(m8.height=b,t(m8))},o=n===Je.CLAMP_TO_TERRAIN||n===Je.RELATIVE_TO_TERRAIN,r=n===Je.CLAMP_TO_3D_TILE||n===Je.RELATIVE_TO_3D_TILE,s;!r&&l(this.globe)&&(s=this.globe._surface.updateHeight(e,i));let a={},c=this.globe?.ellipsoid,d=b=>{if(o||b.isDestroyed()||!b.isCesium3DTileset)return;let f=b.updateHeight(e,i,c);a[b.id]=f};if(!o){let b=this.primitives.length;for(let f=0;f<b;++f){let x=this.primitives.get(f);d(x)}}let u=this.primitives.primitiveAdded.addEventListener(d),m=this.primitives.primitiveRemoved.addEventListener(b=>{b.isDestroyed()||!b.isCesium3DTileset||(l(a[b.id])&&a[b.id](),delete a[b.id])});return()=>{s=s&&s(),Object.values(a).forEach(b=>b()),a={},u(),m()}};function Bbt(e){let t=e.camera,n=e._mode,i=e._screenSpaceCameraController,o=t.positionCartographic;if(!l(o))return!1;if(!i.onMap()&&o.height<0)return!0;if(n===ie.SCENE2D||n===ie.MORPHING)return!1;let r=e._globeHeight;return l(r)&&o.height<r}ci.prototype.initializeFrame=function(){if(this._shaderFrameCount++===120&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures()),this._tweens.update(),this.disableGetTilesetHeight&&l(this._removeUpdateHeightCallback)&&(this._globeHeightDirty=!0),this._globeHeightDirty&&(l(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),this._globeHeight=Dbt(this),this._globeHeightDirty=!1,!this.disableGetTilesetHeight)){let e=this.camera.positionCartographic;this._removeUpdateHeightCallback=this.updateHeight(e,t=>{this.isDestroyed()||(this._globeHeight=t.height)})}this._cameraUnderground=Bbt(this),this._globeTranslucencyState.update(this),this._screenSpaceCameraController.update(),l(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update(),this.camera.update(this._mode),this.camera._updateCameraChanged()};function Ybt(e,t){if(e.debugShowFramesPerSecond){if(!l(e._performanceDisplay)){let n=document.createElement(\"div\");n.className=\"cesium-performanceDisplay-defaultContainer\",e._canvas.parentNode.appendChild(n);let o=new tb({container:n});e._performanceDisplay=o,e._performanceContainer=n}e._performanceDisplay.throttled=e.requestRenderMode,e._performanceDisplay.update(t)}else l(e._performanceDisplay)&&(e._performanceDisplay=e._performanceDisplay&&e._performanceDisplay.destroy(),e._performanceContainer.parentNode.removeChild(e._performanceContainer))}function Obt(e){e._jobScheduler.resetBudgets();let t=e._frameState;e.primitives.prePassesUpdate(t),l(e.globe)&&e.globe.update(t),e._picking.update(),t.creditDisplay.update()}function zbt(e){let t=e._frameState;e.primitives.postPassesUpdate(t),Ja.update()}var Hbt=new O;function Kbt(e){let t=e._frameState,n=e.context,i=n.uniformState,o=e._defaultView;e._view=o,e.updateFrameState(),t.passes.render=!0,t.passes.postProcess=e.postProcessStages.hasSelected,t.tilesetPassState=ybt;let r=g(e.backgroundColor,O.BLACK);e._hdr&&(r=O.clone(r,Hbt),r.red=Math.pow(r.red,e.gamma),r.green=Math.pow(r.green,e.gamma),r.blue=Math.pow(r.blue,e.gamma)),t.backgroundColor=r,t.atmosphere=e.atmosphere,e.fog.update(t),i.update(t);let s=e.shadowMap;l(s)&&s.enabled&&(!l(e.light)||e.light instanceof yp?h.negate(i.sunDirectionWC,e._shadowMapCamera.direction):h.clone(e.light.direction,e._shadowMapCamera.direction),t.shadowMaps.push(s)),e._computeCommandList.length=0,e._overlayCommandList.length=0;let a=o.viewport;a.x=0,a.y=0,a.width=n.drawingBufferWidth,a.height=n.drawingBufferHeight;let c=o.passState;c.framebuffer=void 0,c.blendingEnabled=void 0,c.scissorTest=void 0,c.viewport=ze.clone(a,c.viewport),l(e.globe)&&e.globe.beginFrame(t),e.updateEnvironment(),e.updateAndExecuteCommands(c,r),e.resolveFramebuffers(c,()=>{Zbt(e,c)}),c.framebuffer=void 0,l(e.globe)&&(e.globe.endFrame(t),e.globe.tilesLoaded||(e._renderRequested=!0)),n.endFrame()}function zT(e,t){try{t(e)}catch(n){if(e._renderError.raiseEvent(e,n),e.rethrowRenderErrors)throw n}}function Jbt(e){return e._picking.updateMostDetailedRayPicks(e)}ci.prototype.render=function(e){this._preUpdate.raiseEvent(this,e);let t=this._frameState;t.newFrame=!1,l(e)||(e=te.now());let n=this._view.checkForCameraUpdates(this);n&&(this._globeHeightDirty=!0);let i=!this.requestRenderMode||this._renderRequested||n||this._logDepthBufferDirty||this._hdrDirty||this.mode===ie.MORPHING;if(!i&&l(this.maximumRenderTimeChange)&&l(this._lastRenderTime)){let o=Math.abs(te.secondsDifference(this._lastRenderTime,e));i=i||o>this.maximumRenderTimeChange}if(i){this._lastRenderTime=te.clone(e,this._lastRenderTime),this._renderRequested=!1,this._logDepthBufferDirty=!1,this._hdrDirty=!1;let o=P.incrementWrap(t.frameNumber,15e6,1);aTe(this,o,e),t.newFrame=!0}zT(this,Obt),this.primitives.show&&(zT(this,Jbt),zT(this,Qbt),zT(this,jbt),i||zT(this,qbt)),this._postUpdate.raiseEvent(this,e),i&&(this._preRender.raiseEvent(this,e),t.creditDisplay.beginFrame(),zT(this,Kbt)),Ybt(this,i),zT(this,zbt),Ubt(this),i&&(this._postRender.raiseEvent(this,e),t.creditDisplay.endFrame())};ci.prototype.forceRender=function(e){this._renderRequested=!0,this.render(e)};ci.prototype.requestRender=function(){this._renderRequested=!0};ci.prototype.clampLineWidth=function(e){return Math.max(Yt.minimumAliasedLineWidth,Math.min(e,Yt.maximumAliasedLineWidth))};ci.prototype.pick=function(e,t,n){return this._picking.pick(this,e,t,n)};ci.prototype.pickVoxel=function(e,t,n){let i=this.pick(e,t,n);if(!l(i))return;let o=i.primitive;if(!(o instanceof Zg))return;let r=this._picking.pickVoxelCoordinate(this,e,t,n),s=255*r[0]+r[1],a=o._traversal.findKeyframeNode(s);if(!l(a))return;let c=255*r[2]+r[3];return YF.fromKeyframeNode(o,s,c,a)};ci.prototype.pickPositionWorldCoordinates=function(e,t){return this._picking.pickPositionWorldCoordinates(this,e,t)};ci.prototype.pickPosition=function(e,t){return this._picking.pickPosition(this,e,t)};ci.prototype.pickPositionNearest=function(e,t=10,n=10,i){return this.render(),this._picking.pickPositionNearest(this,e,t,n,i)};ci.prototype.drillPick=function(e,t,n,i){return this._picking.drillPick(this,e,t,n,i)};function Qbt(e){let t=e._frameState;c8.camera=t.camera,c8.cullingVolume=t.cullingVolume,e.primitives.updateForPass(t,c8)}function jbt(e){let t=e._frameState;if(!t.camera.canPreloadFlight())return;l8.camera=e.preloadFlightCamera,l8.cullingVolume=e.preloadFlightCullingVolume,e.primitives.updateForPass(t,l8)}function qbt(e){e.primitives.updateForPass(e._frameState,gbt)}ci.prototype.pickFromRay=function(e,t,n){return this._picking.pickFromRay(this,e,t,n)};ci.prototype.drillPickFromRay=function(e,t,n,i){return this._picking.drillPickFromRay(this,e,t,n,i)};ci.prototype.pickFromRayMostDetailed=function(e,t,n){return this._picking.pickFromRayMostDetailed(this,e,t,n)};ci.prototype.drillPickFromRayMostDetailed=function(e,t,n,i){return this._picking.drillPickFromRayMostDetailed(this,e,t,n,i)};ci.prototype.sampleHeight=function(e,t,n){return this._picking.sampleHeight(this,e,t,n)};ci.prototype.clampToHeight=function(e,t,n,i){return this._picking.clampToHeight(this,e,t,n,i)};ci.prototype.sampleHeightMostDetailed=function(e,t,n){return this._picking.sampleHeightMostDetailed(this,e,t,n)};ci.prototype.clampToHeightMostDetailed=function(e,t,n){return this._picking.clampToHeightMostDetailed(this,e,t,n)};ci.prototype.cartesianToCanvasCoordinates=function(e,t){return Zi.wgs84ToWindowCoordinates(this,e,t)};ci.prototype.completeMorph=function(){this._transitioner.completeMorph()};ci.prototype.morphTo2D=function(e){let t,n=this.globe;l(n)?t=n.ellipsoid:t=this.mapProjection.ellipsoid,e=g(e,2),this._transitioner.morphTo2D(e,t)};ci.prototype.morphToColumbusView=function(e){let t,n=this.globe;l(n)?t=n.ellipsoid:t=this.mapProjection.ellipsoid,e=g(e,2),this._transitioner.morphToColumbusView(e,t)};ci.prototype.morphTo3D=function(e){let t,n=this.globe;l(n)?t=n.ellipsoid:t=this.mapProjection.ellipsoid,e=g(e,2),this._transitioner.morphTo3D(e,t)};function $bt(e,t){if(e._removeTerrainProviderReadyListener=e._removeTerrainProviderReadyListener&&e._removeTerrainProviderReadyListener(),t.ready){l(e.globe)&&(e.globe.terrainProvider=t.provider);return}e.globe.terrainProvider=void 0,e._removeTerrainProviderReadyListener=t.readyEvent.addEventListener(n=>{l(e)&&l(e.globe)&&(e.globe.terrainProvider=n),e._removeTerrainProviderReadyListener()})}ci.prototype.setTerrain=function(e){return $bt(this,e),e};ci.prototype.isDestroyed=function(){return!1};ci.prototype.destroy=function(){this._tweens.removeAll(),this._computeEngine=this._computeEngine&&this._computeEngine.destroy(),this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy(),this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this._primitives=this._primitives&&this._primitives.destroy(),this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy(),this._globe=this._globe&&this._globe.destroy(),this._removeTerrainProviderReadyListener=this._removeTerrainProviderReadyListener&&this._removeTerrainProviderReadyListener(),this.skyBox=this.skyBox&&this.skyBox.destroy(),this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy(),this._debugSphere=this._debugSphere&&this._debugSphere.destroy(),this.sun=this.sun&&this.sun.destroy(),this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy(),this._depthPlane=this._depthPlane&&this._depthPlane.destroy(),this._transitioner=this._transitioner&&this._transitioner.destroy(),this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy(),this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy(),this._picking=this._picking&&this._picking.destroy(),this._defaultView=this._defaultView&&this._defaultView.destroy(),this._view=void 0,this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer),this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy(),this._context=this._context&&this._context.destroy(),this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy(),l(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer)),this._removeRequestListenerCallback(),this._removeTaskProcessorListenerCallback();for(let e=0;e<this._removeGlobeCallbacks.length;++e)this._removeGlobeCallbacks[e]();return this._removeGlobeCallbacks.length=0,l(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),me(this)};var b9=ci;var lDi=T(S(),1);var PUi=T(S(),1),eL=`float interpolateByDistance(vec4 nearFarScalar, float distance) { float startDistance = nearFarScalar.x; float startValue = nearFarScalar.y; float endDistance = nearFarScalar.z; float endValue = nearFarScalar.w; float t = clamp((distance - startDistance) / (endDistance - startDistance), 0.0, 1.0); return mix(startValue, endValue, t); } void computeAtmosphereScattering(vec3 positionWC, vec3 lightDirection, out vec3 rayleighColor, out vec3 mieColor, out float opacity, out float underTranslucentGlobe) { float ellipsoidRadiiDifference = czm_ellipsoidRadii.x - czm_ellipsoidRadii.z; // Adjustment to the atmosphere radius applied based on the camera height. float distanceAdjustMin = czm_ellipsoidRadii.x / 4.0; float distanceAdjustMax = czm_ellipsoidRadii.x; float distanceAdjustModifier = ellipsoidRadiiDifference / 2.0; float distanceAdjust = distanceAdjustModifier * clamp((czm_eyeHeight - distanceAdjustMin) / (distanceAdjustMax - distanceAdjustMin), 0.0, 1.0); // Since atmosphere scattering assumes the atmosphere is"
}