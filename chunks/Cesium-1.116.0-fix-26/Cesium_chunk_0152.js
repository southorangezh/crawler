{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 152,
    "total_chunks": 194,
    "chunk_size": 50898,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.741Z"
  },
  "content": "Ue({defines:[e._useLogDepth?\"LOG_DEPTH\":\"\"],sources:[n]});e._command=t.createViewportQuadCommand(i,{uniformMap:e._uniformMap,owner:e})}function Wmt(e){let t=e._sampleMode,n,i;t===Bd.LINEAR?(n=dn.LINEAR,i=yi.LINEAR):(n=dn.NEAREST,i=yi.NEAREST);let o=e._sampler;(!l(o)||o.minificationFilter!==n||o.magnificationFilter!==i)&&(e._sampler=new mn({wrapS:En.CLAMP_TO_EDGE,wrapT:En.CLAMP_TO_EDGE,minificationFilter:n,magnificationFilter:i}))}function Pmt(e,t){return function(n){e._texturesToCreate.push({name:t,source:n})}}function vmt(e,t){return function(){return e._textureCache.getOutputTexture(t)}}function wmt(e,t){let n,i,o,r=e._texturesToRelease,s=r.length;for(n=0;n<s;++n)i=r[n],i=i&&i.destroy();r.length=0;let a=e._texturesToCreate;for(s=a.length,n=0;n<s;++n){let m=a[n];o=m.name;let p=m.source;e._actualUniforms[o]=new Ft({context:t,source:p})}a.length=0;let c=e._dirtyUniforms;if(c.length===0&&!l(e._texturePromise)){e._ready=!0;return}if(c.length===0||l(e._texturePromise))return;s=c.length;let d=e._uniforms,u=[];for(n=0;n<s;++n){o=c[n];let m=d[o],p=e._textureCache.getStageByName(m);if(l(p))e._actualUniforms[o]=vmt(e,m);else if(typeof m==\"string\"){let b=new Xe({url:m});u.push(b.fetchImage().then(Pmt(e,o)))}else e._texturesToCreate.push({name:o,source:m})}c.length=0,u.length>0?(e._ready=!1,e._texturePromise=Promise.all(u).then(function(){e._ready=!0,e._texturePromise=void 0})):e._ready=!0}function _xe(e){l(e._command)&&(e._command.shaderProgram=e._command.shaderProgram&&e._command.shaderProgram.destroy(),e._command=void 0),e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy();let t=e._textureCache;if(!l(t))return;let n=e._uniforms,i=e._actualUniforms;for(let o in i)i.hasOwnProperty(o)&&i[o]instanceof Ft&&(l(t.getStageByName(n[o]))||i[o].destroy(),e._dirtyUniforms.push(o))}function Fmt(e){let t=l(e._selected)?e._selected.length:0,n=l(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,l(e._selected)&&l(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):l(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&l(e._combinedSelected)){if(!l(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let o=0;o<t;++o)if(e._combinedSelected[o]!==e._combinedSelectedShadow[o])return!0}return i}function Amt(e,t){if(!e._selectedDirty)return;e._selectedIdTexture=e._selectedIdTexture&&e._selectedIdTexture.destroy(),e._selectedIdTexture=void 0;let n=e._combinedSelected;if(!l(n))return;let i,o,r=0,s=n.length;for(i=0;i<s;++i)o=n[i],l(o.pickIds)?r+=o.pickIds.length:l(o.pickId)&&++r;if(s===0||r===0){let u=new Uint8Array(4);u[0]=255,u[1]=255,u[2]=255,u[3]=255,e._selectedIdTexture=new Ft({context:t,pixelFormat:at.RGBA,pixelDatatype:Qe.UNSIGNED_BYTE,source:{arrayBufferView:u,width:1,height:1},sampler:mn.NEAREST});return}let a,c=0,d=new Uint8Array(r*4);for(i=0;i<s;++i)if(o=n[i],l(o.pickIds)){let u=o.pickIds,m=u.length;for(let p=0;p<m;++p)a=u[p].color,d[c]=O.floatToByte(a.red),d[c+1]=O.floatToByte(a.green),d[c+2]=O.floatToByte(a.blue),d[c+3]=O.floatToByte(a.alpha),c+=4}else l(o.pickId)&&(a=o.pickId.color,d[c]=O.floatToByte(a.red),d[c+1]=O.floatToByte(a.green),d[c+2]=O.floatToByte(a.blue),d[c+3]=O.floatToByte(a.alpha),c+=4);e._selectedIdTexture=new Ft({context:t,pixelFormat:at.RGBA,pixelDatatype:Qe.UNSIGNED_BYTE,source:{arrayBufferView:d,width:r,height:1},sampler:mn.NEAREST})}IT.prototype.update=function(e,t){if(this.enabled!==this._enabled&&!this.enabled&&_xe(this),this._enabled=this.enabled,!this._enabled||(this._logDepthChanged=t!==this._useLogDepth,this._useLogDepth=t,this._selectedDirty=Fmt(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=l(this._selected)?this._selected.length:0,this._parentSelectedLength=l(this._parentSelected)?this._parentSelected.length:0,Amt(this,e),Xmt(this),wmt(this,e),Imt(this,e),Wmt(this),this._selectedDirty=!1,!this._ready))return;let n=this._textureCache.getFramebuffer(this._name);if(this._command.framebuffer=n,!l(n))return;let i=n.getColorTexture(0),o;(i.width!==e.drawingBufferWidth||i.height!==e.drawingBufferHeight)&&(o=this._renderState,(!l(o)||i.width!==o.viewport.width||i.height!==o.viewport.height)&&(this._renderState=Ne.fromCache({viewport:new ze(0,0,i.width,i.height)}))),this._command.renderState=o};IT.prototype.execute=function(e,t,n,i){if(!l(this._command)||!l(this._command.framebuffer)||!this._ready||!this._enabled)return;this._colorTexture=t,this._depthTexture=n,this._idTexture=i,mn.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler);let o=this.scissorRectangle.width>0&&this.scissorRectangle.height>0?this._passState:void 0;l(o)&&(o.context=e),this._command.execute(e,o)};IT.prototype.isDestroyed=function(){return!1};IT.prototype.destroy=function(){return _xe(this),me(this)};var fo=IT;var Hvi=T(S(),1);function WT(e){e=g(e,g.EMPTY_OBJECT),this._stages=e.stages,this._inputPreviousStageTexture=g(e.inputPreviousStageTexture,!0);let t=e.name;l(t)||(t=Bn()),this._name=t,this._uniforms=e.uniforms,this._textureCache=void 0,this._index=void 0,this._selected=void 0,this._selectedShadow=void 0,this._parentSelected=void 0,this._parentSelectedShadow=void 0,this._combinedSelected=void 0,this._combinedSelectedShadow=void 0,this._selectedLength=0,this._parentSelectedLength=0,this._selectedDirty=!0}Object.defineProperties(WT.prototype,{ready:{get:function(){let e=this._stages,t=e.length;for(let n=0;n<t;++n)if(!e[n].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(e){let t=this._stages,n=t.length;for(let i=0;i<n;++i)t[i].enabled=e}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(e){this._selected=e}},parentSelected:{get:function(){return this._parentSelected},set:function(e){this._parentSelected=e}}});WT.prototype._isSupported=function(e){let t=this._stages,n=t.length;for(let i=0;i<n;++i)if(!t[i]._isSupported(e))return!1;return!0};WT.prototype.get=function(e){return this._stages[e]};function Mmt(e){let t=l(e._selected)?e._selected.length:0,n=l(e._parentSelected)?e._parentSelected:0,i=e._selected!==e._selectedShadow||t!==e._selectedLength;if(i=i||e._parentSelected!==e._parentSelectedShadow||n!==e._parentSelectedLength,l(e._selected)&&l(e._parentSelected)?e._combinedSelected=e._selected.concat(e._parentSelected):l(e._parentSelected)?e._combinedSelected=e._parentSelected:e._combinedSelected=e._selected,!i&&l(e._combinedSelected)){if(!l(e._combinedSelectedShadow))return!0;t=e._combinedSelected.length;for(let o=0;o<t;++o)if(e._combinedSelected[o]!==e._combinedSelectedShadow[o])return!0}return i}WT.prototype.update=function(e,t){this._selectedDirty=Mmt(this),this._selectedShadow=this._selected,this._parentSelectedShadow=this._parentSelected,this._combinedSelectedShadow=this._combinedSelected,this._selectedLength=l(this._selected)?this._selected.length:0,this._parentSelectedLength=l(this._parentSelected)?this._parentSelected.length:0;let n=this._stages,i=n.length;for(let o=0;o<i;++o){let r=n[o];this._selectedDirty&&(r.parentSelected=this._combinedSelected),r.update(e,t)}};WT.prototype.isDestroyed=function(){return!1};WT.prototype.destroy=function(){let e=this._stages,t=e.length;for(let n=0;n<t;++n)e[n].destroy();return me(this)};var rl=WT;var Mr={};function $D(e){let o=`#define USE_STEP_SIZE ${Cg}`,r=new fo({name:`${e}_x_direction`,fragmentShader:o,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:Bd.LINEAR}),s=new fo({name:`${e}_y_direction`,fragmentShader:o,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:Bd.LINEAR}),a={};return Object.defineProperties(a,{delta:{get:function(){return r.uniforms.delta},set:function(c){let d=r.uniforms,u=s.uniforms;d.delta=u.delta=c}},sigma:{get:function(){return r.uniforms.sigma},set:function(c){let d=r.uniforms,u=s.uniforms;d.sigma=u.sigma=c}},stepSize:{get:function(){return r.uniforms.stepSize},set:function(c){let d=r.uniforms,u=s.uniforms;d.stepSize=u.stepSize=c}}}),new rl({name:e,stages:[r,s],uniforms:a})}Mr.createBlurStage=function(){return $D(\"czm_blur\")};Mr.createDepthOfFieldStage=function(){let e=$D(\"czm_depth_of_field_blur\"),t=new fo({name:\"czm_depth_of_field_composite\",fragmentShader:bF,uniforms:{focalDistance:5,blurTexture:e.name}}),n={};return Object.defineProperties(n,{focalDistance:{get:function(){return t.uniforms.focalDistance},set:function(i){t.uniforms.focalDistance=i}},delta:{get:function(){return e.uniforms.delta},set:function(i){e.uniforms.delta=i}},sigma:{get:function(){return e.uniforms.sigma},set:function(i){e.uniforms.sigma=i}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(i){e.uniforms.stepSize=i}}}),new rl({name:\"czm_depth_of_field\",stages:[e,t],inputPreviousStageTexture:!1,uniforms:n})};Mr.isDepthOfFieldSupported=function(e){return e.context.depthTexture};Mr.createEdgeDetectionStage=function(){let e=Bn();return new fo({name:`czm_edge_detection_${e}`,fragmentShader:gF,uniforms:{length:.25,color:O.clone(O.BLACK)}})};Mr.isEdgeDetectionSupported=function(e){return e.context.depthTexture};function Nmt(e){if(!l(e))return Mr.createEdgeDetectionStage();let t=new rl({name:\"czm_edge_detection_multiple\",stages:e,inputPreviousStageTexture:!1}),n={},i=\"\",o=\"\";for(let a=0;a<e.length;++a)i+=`uniform sampler2D edgeTexture${a}; `,o+=` vec4 edge${a} = texture(edgeTexture${a}, v_textureCoordinates); if (edge${a}.a > 0.0) { color = edge${a}; break; } `,n[`edgeTexture${a}`]=e[a].name;let r=`${i}in vec2 v_textureCoordinates; void main() { vec4 color = vec4(0.0); for (int i = 0; i < ${e.length}; i++) { ${o} } out_FragColor = color; } `,s=new fo({name:\"czm_edge_detection_combine\",fragmentShader:r,uniforms:n});return new rl({name:\"czm_edge_detection_composite\",stages:[t,s]})}Mr.createSilhouetteStage=function(e){let t=Nmt(e),n=new fo({name:\"czm_silhouette_color_edges\",fragmentShader:LF,uniforms:{silhouetteTexture:t.name}});return new rl({name:\"czm_silhouette\",stages:[t,n],inputPreviousStageTexture:!1,uniforms:t.uniforms})};Mr.isSilhouetteSupported=function(e){return e.context.depthTexture};Mr.createBloomStage=function(){let e=new fo({name:\"czm_bloom_contrast_bias\",fragmentShader:pF,uniforms:{contrast:128,brightness:-.3}}),t=$D(\"czm_bloom_blur\"),n=new rl({name:\"czm_bloom_contrast_bias_blur\",stages:[e,t]}),i=new fo({name:\"czm_bloom_generate_composite\",fragmentShader:hF,uniforms:{glowOnly:!1,bloomTexture:n.name}}),o={};return Object.defineProperties(o,{glowOnly:{get:function(){return i.uniforms.glowOnly},set:function(r){i.uniforms.glowOnly=r}},contrast:{get:function(){return e.uniforms.contrast},set:function(r){e.uniforms.contrast=r}},brightness:{get:function(){return e.uniforms.brightness},set:function(r){e.uniforms.brightness=r}},delta:{get:function(){return t.uniforms.delta},set:function(r){t.uniforms.delta=r}},sigma:{get:function(){return t.uniforms.sigma},set:function(r){t.uniforms.sigma=r}},stepSize:{get:function(){return t.uniforms.stepSize},set:function(r){t.uniforms.stepSize=r}}}),new rl({name:\"czm_bloom\",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})};Mr.createAmbientOcclusionStage=function(){let e=new fo({name:\"czm_ambient_occlusion_generate\",fragmentShader:dF,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1e3,randomTexture:void 0}}),t=$D(\"czm_ambient_occlusion_blur\");t.uniforms.stepSize=.86;let n=new rl({name:\"czm_ambient_occlusion_generate_blur\",stages:[e,t]}),i=new fo({name:\"czm_ambient_occlusion_composite\",fragmentShader:uF,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:n.name}}),o={};return Object.defineProperties(o,{intensity:{get:function(){return e.uniforms.intensity},set:function(r){e.uniforms.intensity=r}},bias:{get:function(){return e.uniforms.bias},set:function(r){e.uniforms.bias=r}},lengthCap:{get:function(){return e.uniforms.lengthCap},set:function(r){e.uniforms.lengthCap=r}},stepSize:{get:function(){return e.uniforms.stepSize},set:function(r){e.uniforms.stepSize=r}},frustumLength:{get:function(){return e.uniforms.frustumLength},set:function(r){e.uniforms.frustumLength=r}},randomTexture:{get:function(){return e.uniforms.randomTexture},set:function(r){e.uniforms.randomTexture=r}},delta:{get:function(){return t.uniforms.delta},set:function(r){t.uniforms.delta=r}},sigma:{get:function(){return t.uniforms.sigma},set:function(r){t.uniforms.sigma=r}},blurStepSize:{get:function(){return t.uniforms.stepSize},set:function(r){t.uniforms.stepSize=r}},ambientOcclusionOnly:{get:function(){return i.uniforms.ambientOcclusionOnly},set:function(r){i.uniforms.ambientOcclusionOnly=r}}}),new rl({name:\"czm_ambient_occlusion\",stages:[n,i],inputPreviousStageTexture:!1,uniforms:o})};Mr.isAmbientOcclusionSupported=function(e){return e.context.depthTexture};var kmt=`#define FXAA_QUALITY_PRESET 39 ${ZF} ${_F}`;Mr.createFXAAStage=function(){return new fo({name:\"czm_FXAA\",fragmentShader:kmt,sampleMode:Bd.LINEAR})};Mr.createAcesTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE `:\"\";return t+=lF,new fo({name:\"czm_aces\",fragmentShader:t,uniforms:{autoExposure:void 0}})};Mr.createFilmicTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE `:\"\";return t+=xF,new fo({name:\"czm_filmic\",fragmentShader:t,uniforms:{autoExposure:void 0}})};Mr.createReinhardTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE `:\"\";return t+=VF,new fo({name:\"czm_reinhard\",fragmentShader:t,uniforms:{autoExposure:void 0}})};Mr.createModifiedReinhardTonemappingStage=function(e){let t=e?`#define AUTO_EXPOSURE `:\"\";return t+=SF,new fo({name:\"czm_modified_reinhard\",fragmentShader:t,uniforms:{white:O.WHITE,autoExposure:void 0}})};Mr.createAutoExposureStage=function(){return new RF};Mr.createBlackAndWhiteStage=function(){return new fo({name:\"czm_black_and_white\",fragmentShader:mF,uniforms:{gradations:5}})};Mr.createBrightnessStage=function(){return new fo({name:\"czm_brightness\",fragmentShader:fF,uniforms:{brightness:.5}})};Mr.createNightVisionStage=function(){return new fo({name:\"czm_night_vision\",fragmentShader:CF})};Mr.createDepthViewStage=function(){return new fo({name:\"czm_depth_view\",fragmentShader:yF})};Mr.createLensFlareStage=function(){return new fo({name:\"czm_lens_flare\",fragmentShader:TF,uniforms:{dirtTexture:on(\"Assets/Textures/LensFlare/DirtMask.jpg\"),starTexture:on(\"Assets/Textures/LensFlare/StarBurst.jpg\"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,dirtAmount:.4,earthRadius:oe.WGS84.maximumRadius}})};var nm=Mr;var Iwi=T(S(),1);function rb(e){this._collection=e,this._framebuffers=[],this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0,this._updateDependencies=!1}function EF(e){for(;l(e.length);)e=e.get(e.length-1);return e.name}function Cj(e,t,n,i,o){if(!i.enabled||!i._isSupported(t))return o;let r=n[i.name]={};if(l(o)){let a=e.getStageByName(o);r[EF(a)]=!0}let s=i.uniforms;if(l(s)){let a=Object.getOwnPropertyNames(s),c=a.length;for(let d=0;d<c;++d){let u=s[a[d]];if(typeof u==\"string\"){let m=e.getStageByName(u);l(m)&&(r[EF(m)]=!0)}}}return i.name}function GF(e,t,n,i,o){if(l(i.enabled)&&!i.enabled||l(i._isSupported)&&!i._isSupported(t))return o;let r=o,s=!l(i.inputPreviousStageTexture)||i.inputPreviousStageTexture,a=o,c=i.length;for(let m=0;m<c;++m){let p=i.get(m);l(p.length)?a=GF(e,t,n,p,o):a=Cj(e,t,n,p,o),s&&(o=a)}let d,u;if(s)for(d=1;d<c;++d)u=EF(i.get(d)),l(n[u])||(n[u]={}),n[u][r]=!0;else for(d=1;d<c;++d){u=EF(i.get(d));let m=n[u];for(let p=0;p<d;++p)m[EF(i.get(p))]=!0}return a}function Umt(e,t){let n={};if(l(e.ambientOcclusion)){let i=e.ambientOcclusion,o=e.bloom,r=e._tonemapping,s=e.fxaa,a=GF(e,t,n,i,void 0);a=GF(e,t,n,o,a),a=Cj(e,t,n,r,a),a=GF(e,t,n,e,a),Cj(e,t,n,s,a)}else GF(e,t,n,e,void 0);return n}function Dmt(e,t,n){let o=e._collection.getStageByName(t),r=o._textureScale,s=o._forcePowerOfTwo,a=o._pixelFormat,c=o._pixelDatatype,d=o._clearColor,u,m,p=e._framebuffers,b=p.length;for(u=0;u<b;++u){if(m=p[u],r!==m.textureScale||s!==m.forcePowerOfTwo||a!==m.pixelFormat||c!==m.pixelDatatype||!O.equals(d,m.clearColor))continue;let f=m.stages,x=f.length,_=!1;for(let C=0;C<x;++C)if(n[f[C]]){_=!0;break}if(!_)break}return l(m)&&u<b?(m.stages.push(t),m):(m={textureScale:r,forcePowerOfTwo:s,pixelFormat:a,pixelDatatype:c,clearColor:d,stages:[t],buffer:new li({pixelFormat:a,pixelDatatype:c}),clear:void 0},p.push(m),m)}function Bmt(e,t){let n=Umt(e._collection,t);for(let i in n)n.hasOwnProperty(i)&&(e._stageNameToFramebuffer[i]=Dmt(e,i,n[i]))}function Vj(e){let t=e._framebuffers,n=t.length;for(let i=0;i<n;++i)t[i].buffer.destroy()}function Ymt(e,t){let n=e._width,i=e._height,o=e._framebuffers,r=o.length;for(let s=0;s<r;++s){let a=o[s],c=a.textureScale,d=Math.ceil(n*c),u=Math.ceil(i*c),m=Math.min(d,u);a.forcePowerOfTwo&&(P.isPowerOfTwo(m)||(m=P.nextPowerOfTwo(m)),d=m,u=m),a.buffer.update(t,d,u),a.clear=new ei({color:a.clearColor,framebuffer:a.buffer.framebuffer})}}rb.prototype.updateDependencies=function(){this._updateDependencies=!0};rb.prototype.update=function(e){let t=this._collection,n=this._updateDependencies,i=l(t.ambientOcclusion)&&t.ambientOcclusion.enabled&&t.ambientOcclusion._isSupported(e),o=l(t.bloom)&&t.bloom.enabled&&t.bloom._isSupported(e),r=l(t._tonemapping)&&t._tonemapping.enabled&&t._tonemapping._isSupported(e),s=l(t.fxaa)&&t.fxaa.enabled&&t.fxaa._isSupported(e),a=!l(t._activeStages)||t._activeStages.length>0||i||o||r||s;if((n||!a&&this._framebuffers.length>0)&&(Vj(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._width=void 0,this._height=void 0),!n&&!a)return;this._framebuffers.length===0&&Bmt(this,e);let c=e.drawingBufferWidth,d=e.drawingBufferHeight,u=this._width!==c||this._height!==d;!n&&!u||(this._width=c,this._height=d,this._updateDependencies=!1,Vj(this),Ymt(this,e))};rb.prototype.clear=function(e){let t=this._framebuffers;for(let n=0;n<t.length;++n)t[n].clear.execute(e)};rb.prototype.getStageByName=function(e){return this._collection.getStageByName(e)};rb.prototype.getOutputTexture=function(e){return this._collection.getOutputTexture(e)};rb.prototype.getFramebuffer=function(e){let t=this._stageNameToFramebuffer[e];if(l(t))return t.buffer.framebuffer};rb.prototype.isDestroyed=function(){return!1};rb.prototype.destroy=function(){return Vj(this),me(this)};var PT=rb;var Pwi=T(S(),1),XF={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:function(e){return e===XF.REINHARD||e===XF.MODIFIED_REINHARD||e===XF.FILMIC||e===XF.ACES}},Vg=Object.freeze(XF);var Lj=[];function sl(){let e=nm.createFXAAStage(),t=nm.createAmbientOcclusionStage(),n=nm.createBloomStage();this._autoExposureEnabled=!1,this._autoExposure=nm.createAutoExposureStage(),this._tonemapping=void 0,this._tonemapper=void 0,this.tonemapper=Vg.ACES;let i=this._tonemapping;e.enabled=!1,t.enabled=!1,n.enabled=!1,i.enabled=!1;let o=new PT(this),r={},s=Lj;for(s.push(e,t,n,i);s.length>0;){let c=s.pop();r[c.name]=c,c._textureCache=o;let d=c.length;if(l(d))for(let u=0;u<d;++u)s.push(c.get(u))}this._stages=[],this._activeStages=[],this._previousActiveStages=[],this._randomTexture=void 0;let a=this;t.uniforms.randomTexture=function(){return a._randomTexture},this._ao=t,this._bloom=n,this._fxaa=e,this._aoEnabled=void 0,this._bloomEnabled=void 0,this._tonemappingEnabled=void 0,this._fxaaEnabled=void 0,this._activeStagesChanged=!1,this._stagesRemoved=!1,this._textureCacheDirty=!1,this._stageNames=r,this._textureCache=o}Object.defineProperties(sl.prototype,{ready:{get:function(){let e=!1,t=this._stages,n=t.length;for(let a=n-1;a>=0;--a){let c=t[a];e=e||c.ready&&c.enabled}let i=this._fxaa,o=this._ao,r=this._bloom,s=this._tonemapping;return e=e||i.ready&&i.enabled,e=e||o.ready&&o.enabled,e=e||r.ready&&r.enabled,e=e||s.ready&&s.enabled,e}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){return Zj(this),this._stages.length}},outputTexture:{get:function(){let e=this._fxaa;if(e.enabled&&e.ready)return this.getOutputTexture(e.name);let t=this._stages,n=t.length;for(let s=n-1;s>=0;--s){let a=t[s];if(l(a)&&a.ready&&a.enabled)return this.getOutputTexture(a.name)}let i=this._tonemapping;if(i.enabled&&i.ready)return this.getOutputTexture(i.name);let o=this._bloom;if(o.enabled&&o.ready)return this.getOutputTexture(o.name);let r=this._ao;if(r.enabled&&r.ready)return this.getOutputTexture(r.name)}},hasSelected:{get:function(){let e=this._stages.slice();for(;e.length>0;){let t=e.pop();if(!l(t))continue;if(l(t.selected))return!0;let n=t.length;if(l(n))for(let i=0;i<n;++i)e.push(t.get(i))}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(e){if(this._tonemapper===e)return;l(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());let t=this._autoExposureEnabled,n;switch(e){case Vg.REINHARD:n=nm.createReinhardTonemappingStage(t);break;case Vg.MODIFIED_REINHARD:n=nm.createModifiedReinhardTonemappingStage(t);break;case Vg.FILMIC:n=nm.createFilmicTonemappingStage(t);break;default:n=nm.createAcesTonemappingStage(t);break}if(t){let i=this._autoExposure;n.uniforms.autoExposure=function(){return i.outputTexture}}this._tonemapper=e,this._tonemapping=n,l(this._stageNames)&&(this._stageNames[n.name]=n,n._textureCache=this._textureCache),this._textureCacheDirty=!0}}});function Zj(e){if(!e._stagesRemoved)return;e._stagesRemoved=!1;let t=[],n=e._stages,i=n.length;for(let o=0,r=0;o<i;++o){let s=n[o];s&&(s._index=r++,t.push(s))}e._stages=t}sl.prototype.add=function(e){let t=this._stageNames,n=Lj;for(n.push(e);n.length>0;){let o=n.pop();t[o.name]=o,o._textureCache=this._textureCache;let r=o.length;if(l(r))for(let s=0;s<r;++s)n.push(o.get(s))}let i=this._stages;return e._index=i.length,i.push(e),this._textureCacheDirty=!0,e};sl.prototype.remove=function(e){if(!this.contains(e))return!1;let t=this._stageNames,n=Lj;for(n.push(e);n.length>0;){let i=n.pop();delete t[i.name];let o=i.length;if(l(o))for(let r=0;r<o;++r)n.push(i.get(r))}return this._stages[e._index]=void 0,this._stagesRemoved=!0,this._textureCacheDirty=!0,e._index=void 0,e._textureCache=void 0,e.destroy(),!0};sl.prototype.contains=function(e){return l(e)&&l(e._index)&&e._textureCache===this._textureCache};sl.prototype.get=function(e){return Zj(this),this._stages[e]};sl.prototype.removeAll=function(){let e=this._stages,t=e.length;for(let n=0;n<t;++n)this.remove(e[n]);e.length=0};sl.prototype.getStageByName=function(e){return this._stageNames[e]};sl.prototype.update=function(e,t,n){Zj(this);let i=this._activeStages,o=this._activeStages=this._previousActiveStages;this._previousActiveStages=i;let r=this._stages,s=o.length=r.length,a,c,d=0;for(a=0;a<s;++a)c=r[a],c.ready&&c.enabled&&c._isSupported(e)&&(o[d++]=c);o.length=d;let u=d!==i.length;if(!u){for(a=0;a<d;++a)if(o[a]!==i[a]){u=!0;break}}let m=this._ao,p=this._bloom,b=this._autoExposure,f=this._tonemapping,x=this._fxaa;f.enabled=n;let _=m.enabled&&m._isSupported(e),C=p.enabled&&p._isSupported(e),V=f.enabled&&f._isSupported(e),L=x.enabled&&x._isSupported(e);if((u||this._textureCacheDirty||_!==this._aoEnabled||C!==this._bloomEnabled||V!==this._tonemappingEnabled||L!==this._fxaaEnabled)&&(this._textureCache.updateDependencies(),this._aoEnabled=_,this._bloomEnabled=C,this._tonemappingEnabled=V,this._fxaaEnabled=L,this._textureCacheDirty=!1),l(this._randomTexture)&&!_&&(this._randomTexture.destroy(),this._randomTexture=void 0),!l(this._randomTexture)&&_){s=256*256*3;let R=new Uint8Array(s);for(a=0;a<s;a+=3)R[a]=Math.floor(Math.random()*255);this._randomTexture=new Ft({context:e,pixelFormat:at.RGB,pixelDatatype:Qe.UNSIGNED_BYTE,source:{arrayBufferView:R,width:256,height:256},sampler:new mn({wrapS:En.REPEAT,wrapT:En.REPEAT,minificationFilter:dn.NEAREST,magnificationFilter:yi.NEAREST})})}for(this._textureCache.update(e),x.update(e,t),m.update(e,t),p.update(e,t),f.update(e,t),this._autoExposureEnabled&&b.update(e,t),s=r.length,a=0;a<s;++a)r[a].update(e,t);for(d=0,a=0;a<s;++a)c=r[a],c.ready&&c.enabled&&c._isSupported(e)&&d++;u=d!==o.length,u&&this.update(e,t,n)};sl.prototype.clear=function(e){this._textureCache.clear(e),this._autoExposureEnabled&&this._autoExposure.clear(e)};function vT(e){for(;l(e.length);)e=e.get(e.length-1);return e.outputTexture}sl.prototype.getOutputTexture=function(e){let t=this.getStageByName(e);if(l(t))return vT(t)};function jf(e,t,n,i,o){if(l(e.execute)){e.execute(t,n,i,o);return}let r=e.length,s;if(e.inputPreviousStageTexture)for(jf(e.get(0),t,n,i,o),s=1;s<r;++s)jf(e.get(s),t,vT(e.get(s-1)),i,o);else for(s=0;s<r;++s)jf(e.get(s),t,n,i,o)}sl.prototype.execute=function(e,t,n,i){let o=this._activeStages,r=o.length,s=this._fxaa,a=this._ao,c=this._bloom,d=this._autoExposure,u=this._tonemapping,m=a.enabled&&a._isSupported(e),p=c.enabled&&c._isSupported(e),b=this._autoExposureEnabled,f=u.enabled&&u._isSupported(e),x=s.enabled&&s._isSupported(e);if(!x&&!m&&!p&&!f&&r===0)return;let _=t;m&&a.ready&&(jf(a,e,_,n,i),_=vT(a)),p&&c.ready&&(jf(c,e,_,n,i),_=vT(c)),b&&d.ready&&jf(d,e,_,n,i),f&&u.ready&&(jf(u,e,_,n,i),_=vT(u));let C=_;if(r>0){jf(o[0],e,_,n,i);for(let V=1;V<r;++V)jf(o[V],e,vT(o[V-1]),n,i);C=vT(o[r-1])}x&&s.ready&&jf(s,e,C,n,i)};sl.prototype.copy=function(e,t){if(!l(this._copyColorCommand)){let n=this;this._copyColorCommand=e.createViewportQuadCommand(Ql,{uniformMap:{colorTexture:function(){return n.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=t,this._copyColorCommand.execute(e)};sl.prototype.isDestroyed=function(){return!1};sl.prototype.destroy=function(){return this._fxaa.destroy(),this._ao.destroy(),this._bloom.destroy(),this._autoExposure.destroy(),this._tonemapping.destroy(),this.removeAll(),this._textureCache=this._textureCache&&this._textureCache.destroy(),me(this)};var IF=sl;var RFi=T(S(),1);var lFi=T(S(),1);var Qwi=T(S(),1),Omt={SHIFT:0,CTRL:1,ALT:2,META:3},Rs=Object.freeze(Omt);var qwi=T(S(),1),zmt={LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19},Tn=Object.freeze(zmt);function sb(e,t,n){let i=e._element;if(i===document)return n.x=t.clientX,n.y=t.clientY,n;let o=i.getBoundingClientRect();return n.x=t.clientX-o.left,n.y=t.clientY-o.top,n}function Wj(e,t){let n=e;return l(t)&&(n+=`+${t}`),n}function wT(e){if(e.shiftKey)return Rs.SHIFT;if(e.ctrlKey)return Rs.CTRL;if(e.altKey)return Rs.ALT;if(e.metaKey)return Rs.META}var Gs={LEFT:0,MIDDLE:1,RIGHT:2};function Yd(e,t,n,i){function o(r){i(e,r)}Ut.isInternetExplorer()?n.addEventListener(t,o,!1):n.addEventListener(t,o,{capture:!1,passive:!1}),e._removalFunctions.push(function(){n.removeEventListener(t,o,!1)})}function Hmt(e){let t=e._element,n=l(t.disableRootEvents)?t:document;Ut.supportsPointerEvents()?(Yd(e,\"pointerdown\",t,eht),Yd(e,\"pointerup\",t,Xxe),Yd(e,\"pointermove\",t,tht),Yd(e,\"pointercancel\",t,Xxe)):(Yd(e,\"mousedown\",t,Ixe),Yd(e,\"mouseup\",n,Wxe),Yd(e,\"mousemove\",n,Pxe),Yd(e,\"touchstart\",t,qmt),Yd(e,\"touchend\",n,Lxe),Yd(e,\"touchmove\",n,$mt),Yd(e,\"touchcancel\",n,Lxe)),Yd(e,\"dblclick\",t,Jmt);let i;\"onwheel\"in t?i=\"wheel\":document.onmousewheel!==void 0?i=\"mousewheel\":i=\"DOMMouseScroll\",Yd(e,i,t,jmt)}function Kmt(e){let t=e._removalFunctions;for(let n=0;n<t.length;++n)t[n]()}var Txe={position:new D};function Pj(e){e._lastSeenTouchEvent=fi()}function vj(e){return fi()-e._lastSeenTouchEvent>Rh.mouseEmulationIgnoreMilliseconds}function Ij(e,t,n){let i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)<n}function Ixe(e,t){if(!vj(e))return;let n=t.button;e._buttonDown[n]=!0;let i;if(n===Gs.LEFT)i=Tn.LEFT_DOWN;else if(n===Gs.MIDDLE)i=Tn.MIDDLE_DOWN;else if(n===Gs.RIGHT)i=Tn.RIGHT_DOWN;else return;let o=sb(e,t,e._primaryPosition);D.clone(o,e._primaryStartPosition),D.clone(o,e._primaryPreviousPosition);let r=wT(t),s=e.getInputAction(i,r);l(s)&&(D.clone(o,Txe.position),s(Txe),t.preventDefault())}var Sxe={position:new D},Cxe={position:new D};function Rj(e,t,n,i){let o=wT(i),r=e.getInputAction(t,o),s=e.getInputAction(n,o);if(l(r)||l(s)){let a=sb(e,i,e._primaryPosition);if(l(r)&&(D.clone(a,Sxe.position),r(Sxe)),l(s)){let c=e._primaryStartPosition;Ij(c,a,e._clickPixelTolerance)&&(D.clone(a,Cxe.position),s(Cxe))}}}function Wxe(e,t){if(!vj(e))return;let n=t.button;n!==Gs.LEFT&&n!==Gs.MIDDLE&&n!==Gs.RIGHT||(e._buttonDown[Gs.LEFT]&&(Rj(e,Tn.LEFT_UP,Tn.LEFT_CLICK,t),e._buttonDown[Gs.LEFT]=!1),e._buttonDown[Gs.MIDDLE]&&(Rj(e,Tn.MIDDLE_UP,Tn.MIDDLE_CLICK,t),e._buttonDown[Gs.MIDDLE]=!1),e._buttonDown[Gs.RIGHT]&&(Rj(e,Tn.RIGHT_UP,Tn.RIGHT_CLICK,t),e._buttonDown[Gs.RIGHT]=!1))}var Gj={startPosition:new D,endPosition:new D};function Pxe(e,t){if(!vj(e))return;let n=wT(t),i=sb(e,t,e._primaryPosition),o=e._primaryPreviousPosition,r=e.getInputAction(Tn.MOUSE_MOVE,n);l(r)&&(D.clone(o,Gj.startPosition),D.clone(i,Gj.endPosition),r(Gj)),D.clone(i,o),(e._buttonDown[Gs.LEFT]||e._buttonDown[Gs.MIDDLE]||e._buttonDown[Gs.RIGHT])&&t.preventDefault()}var Vxe={position:new D};function Jmt(e,t){let n=t.button,i;if(n===Gs.LEFT)i=Tn.LEFT_DOUBLE_CLICK;else return;let o=wT(t),r=e.getInputAction(i,o);l(r)&&(sb(e,t,Vxe.position),r(Vxe))}var Qmt=new D;function jmt(e,t){let n;if(l(t.deltaY)){let r=t.deltaMode;r===t.DOM_DELTA_PIXEL?n=-t.deltaY:r===t.DOM_DELTA_LINE?n=-t.deltaY*40:n=-t.deltaY*120}else t.detail>0?n=t.detail*-120:n=t.wheelDelta;if(!l(n))return;let i=wT(t),o=e.getInputAction(Tn.WHEEL,i);l(o)&&(o(n,sb(e,t,Qmt)),t.preventDefault())}function qmt(e,t){Pj(e);let n=t.changedTouches,i,o=n.length,r,s,a=e._positions;for(i=0;i<o;++i)r=n[i],s=r.identifier,a.set(s,sb(e,r,new D));e3(e,t);let c=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,c.set(s,D.clone(a.get(s)))}function Lxe(e,t){Pj(e);let n=t.changedTouches,i,o=n.length,r,s,a=e._positions;for(i=0;i<o;++i)r=n[i],s=r.identifier,a.remove(s);e3(e,t);let c=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,c.remove(s)}var Zxe={position:new D},Ej={position1:new D,position2:new D},Rxe={position:new D},Gxe={position:new D},Exe={position:new D};function e3(e,t){let n=wT(t),i=e._positions,o=i.length,r,s,a=e._isPinching;if(o!==1&&e._buttonDown[Gs.LEFT]){if(e._buttonDown[Gs.LEFT]=!1,l(e._touchHoldTimer)&&(clearTimeout(e._touchHoldTimer),e._touchHoldTimer=void 0),r=e.getInputAction(Tn.LEFT_UP,n),l(r)&&(D.clone(e._primaryPosition,Rxe.position),r(Rxe)),o===0&&!e._isTouchHolding&&(s=e.getInputAction(Tn.LEFT_CLICK,n),l(s))){let c=e._primaryStartPosition,d=e._previousPositions.values[0];Ij(c,d,e._clickPixelTolerance)&&(D.clone(e._primaryPosition,Gxe.position),s(Gxe))}e._isTouchHolding=!1}if(o===0&&a&&(e._isPinching=!1,r=e.getInputAction(Tn.PINCH_END,n),l(r)&&r()),o===1&&!a){let c=i.values[0];D.clone(c,e._primaryPosition),D.clone(c,e._primaryStartPosition),D.clone(c,e._primaryPreviousPosition),e._buttonDown[Gs.LEFT]=!0,r=e.getInputAction(Tn.LEFT_DOWN,n),l(r)&&(D.clone(c,Zxe.position),r(Zxe)),e._touchHoldTimer=setTimeout(function(){if(!e.isDestroyed()&&(e._touchHoldTimer=void 0,e._isTouchHolding=!0,s=e.getInputAction(Tn.RIGHT_CLICK,n),l(s))){let d=e._primaryStartPosition,u=e._previousPositions.values[0];Ij(d,u,e._holdPixelTolerance)&&(D.clone(e._primaryPosition,Exe.position),s(Exe))}},Rh.touchHoldDelayMilliseconds),t.preventDefault()}o===2&&!a&&(e._isPinching=!0,r=e.getInputAction(Tn.PINCH_START,n),l(r)&&(D.clone(i.values[0],Ej.position1),D.clone(i.values[1],Ej.position2),r(Ej),t.preventDefault()))}function $mt(e,t){Pj(e);let n=t.changedTouches,i,o=n.length,r,s,a=e._positions;for(i=0;i<o;++i){r=n[i],s=r.identifier;let d=a.get(s);l(d)&&sb(e,r,d)}vxe(e,t);let c=e._previousPositions;for(i=0;i<o;++i)r=n[i],s=r.identifier,D.clone(a.get(s),c.get(s))}var Xj={startPosition:new D,endPosition:new D},WF={distance:{startPosition:new D,endPosition:new D},angleAndHeight:{startPosition:new D,endPosition:new D}};function vxe(e,t){let n=wT(t),i=e._positions,o=e._previousPositions,r=i.length,s;if(r===1&&e._buttonDown[Gs.LEFT]){let a=i.values[0];D.clone(a,e._primaryPosition);let c=e._primaryPreviousPosition;s=e.getInputAction(Tn.MOUSE_MOVE,n),l(s)&&(D.clone(c,Xj.startPosition),D.clone(a,Xj.endPosition),s(Xj)),D.clone(a,c),t.preventDefault()}else if(r===2&&e._isPinching&&(s=e.getInputAction(Tn.PINCH_MOVE,n),l(s))){let a=i.values[0],c=i.values[1],d=o.values[0],u=o.values[1],m=c.x-a.x,p=c.y-a.y,b=Math.sqrt(m*m+p*p)*.25,f=u.x-d.x,x=u.y-d.y,_=Math.sqrt(f*f+x*x)*.25,C=(c.y+a.y)*.125,V=(u.y+d.y)*.125,L=Math.atan2(p,m),R=Math.atan2(x,f);D.fromElements(0,_,WF.distance.startPosition),D.fromElements(0,b,WF.distance.endPosition),D.fromElements(R,V,WF.angleAndHeight.startPosition),D.fromElements(L,C,WF.angleAndHeight.endPosition),s(WF)}}function eht(e,t){if(t.target.setPointerCapture(t.pointerId),t.pointerType===\"touch\"){let n=e._positions,i=t.pointerId;n.set(i,sb(e,t,new D)),e3(e,t),e._previousPositions.set(i,D.clone(n.get(i)))}else Ixe(e,t)}function Xxe(e,t){if(t.pointerType===\"touch\"){let n=e._positions,i=t.pointerId;n.remove(i),e3(e,t),e._previousPositions.remove(i)}else Wxe(e,t)}function tht(e,t){if(t.pointerType===\"touch\"){let n=e._positions,i=t.pointerId,o=n.get(i);if(!l(o))return;sb(e,t,o),vxe(e,t);let r=e._previousPositions;D.clone(n.get(i),r.get(i))}else Pxe(e,t)}function Rh(e){this._inputEvents={},this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1},this._isPinching=!1,this._isTouchHolding=!1,this._lastSeenTouchEvent=-Rh.mouseEmulationIgnoreMilliseconds,this._primaryStartPosition=new D,this._primaryPosition=new D,this._primaryPreviousPosition=new D,this._positions=new Lt,this._previousPositions=new Lt,this._removalFunctions=[],this._touchHoldTimer=void 0,this._clickPixelTolerance=5,this._holdPixelTolerance=25,this._element=g(e,document),Hmt(this)}Rh.prototype.setInputAction=function(e,t,n){let i=Wj(t,n);this._inputEvents[i]=e};Rh.prototype.getInputAction=function(e,t){let n=Wj(e,t);return this._inputEvents[n]};Rh.prototype.removeInputAction=function(e,t){let n=Wj(e,t);delete this._inputEvents[n]};Rh.prototype.isDestroyed=function(){return!1};Rh.prototype.destroy=function(){return Kmt(this),me(this)};Rh.mouseEmulationIgnoreMilliseconds=800;Rh.touchHoldDelayMilliseconds=1500;var Od=Rh;function FT(e){this._scene=e,this._currentTweens=[],this._morphHandler=void 0,this._morphCancelled=!1,this._completeMorph=void 0,this._morphToOrthographic=!1}FT.prototype.completeMorph=function(){l(this._completeMorph)&&this._completeMorph()};FT.prototype.morphTo2D=function(e,t){l(this._completeMorph)&&this._completeMorph();let n=this._scene;this._previousMode=n.mode,this._morphToOrthographic=n.camera.frustum instanceof rn,!(this._previousMode===ie.SCENE2D||this._previousMode===ie.MORPHING)&&(this._scene.morphStart.raiseEvent(this,this._previousMode,ie.SCENE2D,!0),n._mode=ie.MORPHING,n.camera._setTransform(M.IDENTITY),this._previousMode===ie.COLUMBUS_VIEW?vht(this,e):Uht(this,e,t),e===0&&l(this._completeMorph)&&this._completeMorph())};var nht=new h,iht=new h,oht=new h,rht=new h,sht=new h,aht=new h,cht=new h,lht=new he,dht=new M,uht=new _i,mht=new rn,hht={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};FT.prototype.morphToColumbusView=function(e,t){l(this._completeMorph)&&this._completeMorph();let n=this._scene;if(this._previousMode=n.mode,this._previousMode===ie.COLUMBUS_VIEW||this._previousMode===ie.MORPHING)return;this._scene.morphStart.raiseEvent(this,this._previousMode,ie.COLUMBUS_VIEW,!0),n.camera._setTransform(M.IDENTITY);let i=nht,o=iht,r=oht;if(e>0)i.x=0,i.y=-1,i.z=1,i=h.multiplyByScalar(h.normalize(i,i),5*t.maximumRadius,i),h.negate(h.normalize(i,o),o),h.cross(h.UNIT_X,o,r);else{let d=n.camera;if(this._previousMode===ie.SCENE2D)h.clone(d.position,i),i.z=d.frustum.right-d.frustum.left,h.negate(h.UNIT_Z,o),h.clone(h.UNIT_Y,r);else{h.clone(d.positionWC,i),h.clone(d.directionWC,o),h.clone(d.upWC,r);let u=t.scaleToGeodeticSurface(i,cht),m=Wt.eastNorthUpToFixedFrame(u,t,dht);M.inverseTransformation(m,m),n.mapProjection.project(t.cartesianToCartographic(i,lht),i),M.multiplyByPointAsVector(m,o,o),M.multiplyByPointAsVector(m,r,r)}}let s;this._morphToOrthographic?(s=mht,s.width=n.camera.frustum.right-n.camera.frustum.left,s.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight):(s=uht,s.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,s.fov=P.toRadians(60));let a=hht;a.position=i,a.direction=o,a.up=r,a.frustum=s;let c=Bht(a);PF(this,c),this._previousMode===ie.SCENE2D?Dht(this,e,a,c):(a.position2D=M.multiplyByPoint(lo.TRANSFORM_2D,i,rht),a.direction2D=M.multiplyByPointAsVector(lo.TRANSFORM_2D,o,sht),a.up2D=M.multiplyByPointAsVector(lo.TRANSFORM_2D,r,aht),n._mode=ie.MORPHING,Oxe(this,e,a,c)),e===0&&l(this._completeMorph)&&this._completeMorph()};var Aj={position:new h,direction:new h,up:new h,frustum:void 0},Fxe=new _i;FT.prototype.morphTo3D=function(e,t){l(this._completeMorph)&&this._completeMorph();let n=this._scene;if(this._previousMode=n.mode,!(this._previousMode===ie.SCENE3D||this._previousMode===ie.MORPHING)){if(this._scene.morphStart.raiseEvent(this,this._previousMode,ie.SCENE3D,!0),n._mode=ie.MORPHING,n.camera._setTransform(M.IDENTITY),this._previousMode===ie.SCENE2D)Vht(this,e,t);else{let i;e>0?(i=Aj,h.fromDegrees(0,0,5*t.maximumRadius,t,i.position),h.negate(i.position,i.direction),h.normalize(i.direction,i.direction),h.clone(h.UNIT_Z,i.up)):i=Axe(this,t);let o,r=n.camera;r.frustum instanceof rn?o=r.frustum.clone():(o=Fxe,o.aspectRatio=n.drawingBufferWidth/n.drawingBufferHeight,o.fov=P.toRadians(60)),i.frustum=o;let s=Hxe(i);PF(this,s),Fj(this,e,i,s)}e===0&&l(this._completeMorph)&&this._completeMorph()}};FT.prototype.isDestroyed=function(){return!1};FT.prototype.destroy=function(){return t3(this),me(this)};function PF(e,t){if(e._scene.completeMorphOnUserInput){e._morphHandler=new Od(e._scene.canvas);let n=function(){e._morphCancelled=!0,e._scene.camera.cancelFlight(),t(e)};e._completeMorph=n,e._morphHandler.setInputAction(n,Tn.LEFT_DOWN),e._morphHandler.setInputAction(n,Tn.MIDDLE_DOWN),e._morphHandler.setInputAction(n,Tn.RIGHT_DOWN),e._morphHandler.setInputAction(n,Tn.WHEEL)}}function t3(e){let t=e._currentTweens;for(let n=0;n<t.length;++n)t[n].cancelTween();e._currentTweens.length=0,e._morphHandler=e._morphHandler&&e._morphHandler.destroy()}var fht=new he,pht=new h,bht=new M;function Axe(e,t){let n=e._scene,i=n.camera,o=Aj,r=o.position,s=o.direction,a=o.up,c=n.mapProjection.unproject(i.position,fht);t.cartographicToCartesian(c,r);let d=t.scaleToGeodeticSurface(r,pht),u=Wt.eastNorthUpToFixedFrame(d,t,bht);return M.multiplyByPointAsVector(u,i.direction,s),M.multiplyByPointAsVector(u,i.up,a),o}var yht=new h,ght=new h,xht=new h,_ht=new h,Tht=new h,Sht=new h;function Fj(e,t,n,i){t*=.5;let o=e._scene,r=o.camera,s=h.clone(r.position,yht),a=h.clone(r.direction,ght),c=h.clone(r.up,xht),d=M.multiplyByPoint(lo.TRANSFORM_2D_INVERSE,n.position,_ht),u=M.multiplyByPointAsVector(lo.TRANSFORM_2D_INVERSE,n.direction,Tht),m=M.multiplyByPointAsVector(lo.TRANSFORM_2D_INVERSE,n.up,Sht);function p(f){im(s,d,f.time,r.position),im(a,u,f.time,r.direction),im(c,m,f.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right)}let b=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){zxe(e,o,0,1,t,i)}});e._currentTweens.push(b)}var Cht=new rn,Mxe=new h,Nxe=new h,kxe=new h,Mj=new h,Uxe=new h,Dxe=new h;function Vht(e,t,n){t/=3;let i=e._scene,o=i.camera,r;t>0?(r=Aj,h.fromDegrees(0,0,5*n.maximumRadius,n,r.position),h.negate(r.position,r.direction),h.normalize(r.direction,r.direction),h.clone(h.UNIT_Z,r.up)):(o.position.z=o.frustum.right-o.frustum.left,r=Axe(e,n));let s;e._morphToOrthographic?(s=Cht,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.width=o.frustum.right-o.frustum.left):(s=Fxe,s.aspectRatio=i.drawingBufferWidth/i.drawingBufferHeight,s.fov=P.toRadians(60)),r.frustum=s;let a=Hxe(r);PF(e,a);let c;e._morphToOrthographic?c=function(){Fj(e,t,r,a)}:c=function(){Yxe(e,t,r,function(){Fj(e,t,r,a)})},t>0?(i._mode=ie.SCENE2D,o.flyTo({duration:t,destination:h.fromDegrees(0,0,5*n.maximumRadius,n,Mj),complete:function(){i._mode=ie.MORPHING,c()}})):c()}function im(e,t,n,i){return h.lerp(e,t,n,i)}function Bxe(e,t,n,i,o){let r=e._scene,s=r.camera;if(s.frustum instanceof rn)return;let a=s.frustum.fov,c=P.RADIANS_PER_DEGREE*.5,d=n.position.z*Math.tan(a*.5);s.frustum.far=d/Math.tan(c*.5)+1e7;function u(p){s.frustum.fov=P.lerp(a,c,p.time);let b=d/Math.tan(s.frustum.fov*.5);i(s,b)}let m=r.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:u,complete:function(){s.frustum=n.frustum.clone(),o(e)}});e._currentTweens.push(m)}var Lht=new h,Zht=new h,Rht=new h,wj=new h,Ght=new h,Eht=new h,Xht=new Vr,Iht=new bn,Wht=new h,Pht={position:void 0,direction:void 0,up:void 0,frustum:void 0};function vht(e,t){t*=.5;let n=e._scene,i=n.camera,o=h.clone(i.position,Lht),r=h.clone(i.direction,Zht),s=h.clone(i.up,Rht),a=h.negate(h.UNIT_Z,Ght),c=h.clone(h.UNIT_Y,Eht),d=wj;if(t>0)h.clone(h.ZERO,wj),d.z=5*n.mapProjection.ellipsoid.maximumRadius;else{h.clone(o,wj);let _=Iht;M.multiplyByPoint(lo.TRANSFORM_2D,o,_.origin),M.multiplyByPointAsVector(lo.TRANSFORM_2D,r,_.direction);let C=n.globe;if(l(C)){let V=C.pickWorldCoordinates(_,n,!0,Wht);l(V)&&(M.multiplyByPoint(lo.TRANSFORM_2D_INVERSE,V,d),d.z+=h.distance(o,d))}}let u=Xht;u.right=d.z*.5,u.left=-u.right,u.top=u.right*(n.drawingBufferHeight/n.drawingBufferWidth),u.bottom=-u.top;let m=Pht;m.position=d,m.direction=a,m.up=c,m.frustum=u;let p=Kxe(m);PF(e,p);function b(_){im(o,d,_.time,i.position),im(r,a,_.time,i.direction),im(s,c,_.time,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i._adjustOrthographicFrustum(!0)}function f(_,C){_.position.z=C}let x=n.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:b,complete:function(){Bxe(e,t,m,f,p)}});e._currentTweens.push(x)}var wxe=new he,wht={position:new h,direction:new h,up:new h,position2D:new h,direction2D:new h,up2D:new h,frustum:new Vr},Fht={position:new h,direction:new h,up:new h,frustum:void 0},Aht=new h,Mht=new bn,Nht=new M,kht=new h;function Uht(e,t,n){t*=.5;let i=e._scene,o=i.camera,r=wht;if(t>0)h.clone(h.ZERO,r.position),r.position.z=5*n.maximumRadius,h.negate(h.UNIT_Z,r.direction),h.clone(h.UNIT_Y,r.up);else{n.cartesianToCartographic(o.positionWC,wxe),i.mapProjection.project(wxe,r.position),h.negate(h.UNIT_Z,r.direction),h.clone(h.UNIT_Y,r.up);let m=Mht;h.clone(r.position2D,m.origin);let p=h.clone(o.directionWC,m.direction),b=n.scaleToGeodeticSurface(o.positionWC,kht),f=Wt.eastNorthUpToFixedFrame(b,n,Nht);M.inverseTransformation(f,f),M.multiplyByPointAsVector(f,p,p),M.multiplyByPointAsVector(lo.TRANSFORM_2D,p,p);let x=i.globe;if(l(x)){let _=x.pickWorldCoordinates(m,i,!0,Aht);if(l(_)){let C=h.distance(r.position2D,_);_.x+=C,h.clone(_,r.position2D)}}}function s(m,p){m.position.x=p}M.multiplyByPoint(lo.TRANSFORM_2D,r.position,r.position2D),M.multiplyByPointAsVector(lo.TRANSFORM_2D,r.direction,r.direction2D),M.multiplyByPointAsVector(lo.TRANSFORM_2D,r.up,r.up2D);let a=r.frustum;a.right=r.position.z*.5,a.left=-a.right,a.top=a.right*(i.drawingBufferHeight/i.drawingBufferWidth),a.bottom=-a.top;let c=Fht;M.multiplyByPoint(lo.TRANSFORM_2D_INVERSE,r.position2D,c.position),h.clone(r.direction,c.direction),h.clone(r.up,c.up),c.frustum=a;let d=Kxe(c);PF(e,d);function u(){Bxe(e,t,r,s,d)}Oxe(e,t,r,u)}function Yxe(e,t,n,i){let o=e._scene,r=o.camera,s=r.frustum.right-r.frustum.left;r.frustum=n.frustum.clone();let a=r.frustum.fov,c=P.RADIANS_PER_DEGREE*.5,d=s*Math.tan(a*.5);r.frustum.far=d/Math.tan(c*.5)+1e7,r.frustum.fov=c;function u(p){r.frustum.fov=P.lerp(c,a,p.time),r.position.z=d/Math.tan(r.frustum.fov*.5)}let m=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:u,complete:function(){i(e)}});e._currentTweens.push(m)}function Dht(e,t,n,i){t*=.5;let o=e._scene,r=o.camera,s=h.clone(n.position,Mj),a=h.clone(n.direction,Uxe),c=h.clone(n.up,Dxe);o._mode=ie.MORPHING;function d(){r.frustum=n.frustum.clone();let u=h.clone(r.position,Mxe),m=h.clone(r.direction,Nxe),p=h.clone(r.up,kxe);u.z=s.z;function b(x){im(u,s,x.time,r.position),im(m,a,x.time,r.direction),im(p,c,x.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right)}let f=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:b,complete:function(){i(e)}});e._currentTweens.push(f)}e._morphToOrthographic?d():Yxe(e,0,n,d)}function Oxe(e,t,n,i){let o=e._scene,r=o.camera,s=h.clone(r.position,Mxe),a=h.clone(r.direction,Nxe),c=h.clone(r.up,kxe),d=h.clone(n.position2D,Mj),u=h.clone(n.direction2D,Uxe),m=h.clone(n.up2D,Dxe);function p(f){im(s,d,f.time,r.position),im(a,u,f.time,r.direction),im(c,m,f.time,r.up),h.cross(r.direction,r.up,r.right),h.normalize(r.right,r.right),r._adjustOrthographicFrustum(!0)}let b=o.tweens.add({duration:t,easingFunction:Ar.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:p,complete:function(){zxe(e,o,1,0,t,i)}});e._currentTweens.push(b)}function zxe(e,t,n,i,o,r){let s={object:t,property:\"morphTime\",startValue:n,stopValue:i,duration:o,easingFunction:Ar.QUARTIC_OUT};l(r)&&(s.complete=function(){r(e)});let a=t.tweens.addProperty(s);e._currentTweens.push(a)}function Hxe(e){return function(t){let n=t._scene;n._mode=ie.SCENE3D,n.morphTime=ie.getMorphTime(ie.SCENE3D),t3(t);let i=n.camera;(t._previousMode!==ie.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,h.clone(e.position,i.position),h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i.frustum=e.frustum.clone());let o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);let r=l(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ie.SCENE3D,r)}}function Kxe(e){return function(t){let n=t._scene;n._mode=ie.SCENE2D,n.morphTime=ie.getMorphTime(ie.SCENE2D),t3(t);let i=n.camera;h.clone(e.position,i.position),i.position.z=n.mapProjection.ellipsoid.maximumRadius*2,h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right),i.frustum=e.frustum.clone();let o=l(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ie.SCENE2D,o)}}function Bht(e){return function(t){let n=t._scene;n._mode=ie.COLUMBUS_VIEW,n.morphTime=ie.getMorphTime(ie.COLUMBUS_VIEW),t3(t);let i=n.camera;(t._previousModeMode!==ie.MORPHING||t._morphCancelled)&&(t._morphCancelled=!1,h.clone(e.position,i.position),h.clone(e.direction,i.direction),h.clone(e.up,i.up),h.cross(i.direction,i.up,i.right),h.normalize(i.right,i.right));let o=i.frustum;n.frameState.useLogDepth&&(o.near=.1,o.far=1e10);let r=l(t._completeMorph);t._completeMorph=void 0,n.camera.update(n.mode),t._scene.morphComplete.raiseEvent(t,t._previousMode,ie.COLUMBUS_VIEW,r)}}var vF=FT;var S9i=T(S(),1);var NFi=T(S(),1);var EFi=T(S(),1),Yht={LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4},Ti=Object.freeze(Yht);function Na(e,t){let n=e;return l(t)&&(n+=`+${t}`),n}function Oht(e,t){D.clone(e.distance.startPosition,t.distance.startPosition),D.clone(e.distance.endPosition,t.distance.endPosition),D.clone(e.angleAndHeight.startPosition,t.angleAndHeight.startPosition),D.clone(e.angleAndHeight.endPosition,t.angleAndHeight.endPosition)}function Jxe(e,t,n){let i=Na(Ti.PINCH,t),o=e._update,r=e._isDown,s=e._eventStartPosition,a=e._pressTime,c=e._releaseTime;o[i]=!0,r[i]=!1,s[i]=new D;let d=e._movement[i];l(d)||(d=e._movement[i]={}),d.distance={startPosition:new D,endPosition:new D},d.angleAndHeight={startPosition:new D,endPosition:new D},d.prevAngle=0,e._eventHandler.setInputAction(function(u){e._buttonsDown++,r[i]=!0,a[i]=new Date,D.lerp(u.position1,u.position2,.5,s[i])},Tn.PINCH_START,t),e._eventHandler.setInputAction(function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),r[i]=!1,c[i]=new Date},Tn.PINCH_END,t),e._eventHandler.setInputAction(function(u){if(r[i]){o[i]?(Oht(u,d),o[i]=!1,d.prevAngle=d.angleAndHeight.startPosition.x):(D.clone(u.distance.endPosition,d.distance.endPosition),D.clone(u.angleAndHeight.endPosition,d.angleAndHeight.endPosition));let m=d.angleAndHeight.endPosition.x,p=d.prevAngle,b=Math.PI*2;for(;m>=p+Math.PI;)m-=b;for(;m<p-Math.PI;)m+=b;d.angleAndHeight.endPosition.x=-m*n.clientWidth/12,d.angleAndHeight.startPosition.x=-p*n.clientWidth/12}},Tn.PINCH_MOVE,t)}function Qxe(e,t){let n=Na(Ti.WHEEL,t),i=e._pressTime,o=e._releaseTime,r=e._update;r[n]=!0;let s=e._movement[n];l(s)||(s=e._movement[n]={});let a=e._lastMovement[n];l(a)||(a=e._lastMovement[n]={startPosition:new D,endPosition:new D,valid:!1}),s.startPosition=new D,D.clone(D.ZERO,s.startPosition),s.endPosition=new D,e._eventHandler.setInputAction(function(c){let d=7.5*P.toRadians(c);i[n]=o[n]=new Date,s.endPosition.x=0,s.endPosition.y=d,D.clone(s.endPosition,a.endPosition),a.valid=!0,r[n]=!1},Tn.WHEEL,t)}function HV(e,t,n){let i=Na(n,t),o=e._isDown,r=e._eventStartPosition,s=e._pressTime,a=e._releaseTime;o[i]=!1,r[i]=new D;let c=e._lastMovement[i];l(c)||(c=e._lastMovement[i]={startPosition:new D,endPosition:new D,valid:!1});let d,u;n===Ti.LEFT_DRAG?(d=Tn.LEFT_DOWN,u=Tn.LEFT_UP):n===Ti.RIGHT_DRAG?(d=Tn.RIGHT_DOWN,u=Tn.RIGHT_UP):n===Ti.MIDDLE_DRAG&&(d=Tn.MIDDLE_DOWN,u=Tn.MIDDLE_UP),e._eventHandler.setInputAction(function(m){e._buttonsDown++,c.valid=!1,o[i]=!0,s[i]=new Date,D.clone(m.position,r[i])},d,t),e._eventHandler.setInputAction(function(){e._buttonsDown=Math.max(e._buttonsDown-1,0),o[i]=!1,a[i]=new Date},u,t)}function jxe(e,t){D.clone(e.startPosition,t.startPosition),D.clone(e.endPosition,t.endPosition)}function qxe(e,t){let n=e._update,i=e._movement,o=e._lastMovement,r=e._isDown;for(let s in Ti)if(Ti.hasOwnProperty(s)){let a=Ti[s];if(l(a)){let c=Na(a,t);n[c]=!0,l(e._lastMovement[c])||(e._lastMovement[c]={startPosition:new D,endPosition:new D,valid:!1}),l(e._movement[c])||(e._movement[c]={startPosition:new D,endPosition:new D})}}e._eventHandler.setInputAction(function(s){for(let a in Ti)if(Ti.hasOwnProperty(a)){let c=Ti[a];if(l(c)){let d=Na(c,t);r[d]&&(n[d]?(jxe(i[d],o[d]),o[d].valid=!0,jxe(s,i[d]),n[d]=!1):D.clone(s.endPosition,i[d].endPosition))}}D.clone(s.endPosition,e._currentMousePosition)},Tn.MOUSE_MOVE,t)}function om(e){this._eventHandler=new Od(e),this._update={},this._movement={},this._lastMovement={},this._isDown={},this._eventStartPosition={},this._pressTime={},this._releaseTime={},this._buttonsDown=0,this._currentMousePosition=new"
}