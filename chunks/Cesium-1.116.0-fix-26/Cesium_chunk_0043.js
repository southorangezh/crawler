{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 43,
    "total_chunks": 194,
    "chunk_size": 65565,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.670Z"
  },
  "content": "Fee(e,t,n,i,o,r,s){n<0&&(n=-n,o+=P.PI);let a=e*(1-t),c=i-o,d=o,u=EZe(r-i,t),m=GZe(t,0);vZe(c,n,d,yee);let p=a*(1+t),b=Math.cos(u),f=Math.sin(u),x=1+t*b,_=p/x;return l(s)?(s.x=_*b,s.y=_*f,s.z=0):s=new h(_*b,_*f,0),$.multiplyByVector(yee,s,s)}function GZe(e,t){return e<=t?\"Circular\":e<1-t?\"Elliptical\":e<=1+t?\"Parabolic\":\"Hyperbolic\"}function EZe(e,t){let n=WZe(e,t);return PZe(n,t)}var XZe=50,IZe=P.EPSILON8;function WZe(e,t){let n=Math.floor(e/P.TWO_PI);e-=n*P.TWO_PI;let i=e+t*Math.sin(e)/(1-Math.sin(e+t)+Math.sin(e)),o=Number.MAX_VALUE,r;for(r=0;r<XZe&&Math.abs(o-i)>IZe;++r){o=i;let s=o-t*Math.sin(o)-e,a=1-t*Math.cos(o);i=o-s/a}return o=i+n*P.TWO_PI,o}function PZe(e,t){let n=Math.floor(e/P.TWO_PI);e-=n*P.TWO_PI;let i=Math.cos(e)-t,o=Math.sin(e)*Math.sqrt(1-t*t),r=Math.atan2(o,i);return r=P.zeroToTwoPi(r),e<0&&(r-=P.TWO_PI),r+=n*P.TWO_PI,r}function vZe(e,t,n,i){let o=Math.cos(e),r=Math.sin(e),s=Math.cos(t),a=Math.sin(t),c=Math.cos(n),d=Math.sin(n);return l(i)?(i[0]=c*o-d*r*s,i[1]=d*o+c*r*s,i[2]=r*a,i[3]=-c*r-d*o*s,i[4]=-d*r+c*o*s,i[5]=o*a,i[6]=d*a,i[7]=-c*a,i[8]=s):i=new $(c*o-d*r*s,-c*r-d*o*s,d*a,d*o+c*r*s,-d*r+c*o*s,-c*a,r*a,o*a,s),i}var wZe=1.0000010178*Ca,FZe=100.46645683*su,AZe=129597742283429e-5*id,gee=16002,xee=21863,_ee=32004,Tee=10931,See=14529,Cee=16368,Vee=15318,Lee=32794,MZe=64*1e-7*Ca,NZe=-152*1e-7*Ca,kZe=62*1e-7*Ca,UZe=-8*1e-7*Ca,DZe=32*1e-7*Ca,BZe=-41*1e-7*Ca,YZe=19*1e-7*Ca,OZe=-11*1e-7*Ca,zZe=-150*1e-7*Ca,HZe=-46*1e-7*Ca,KZe=68*1e-7*Ca,JZe=54*1e-7*Ca,QZe=14*1e-7*Ca,jZe=24*1e-7*Ca,qZe=-28*1e-7*Ca,$Ze=22*1e-7*Ca,Zee=10,Ree=16002,Gee=21863,Eee=10931,Xee=1473,Iee=32004,Wee=4387,Pee=73,eRe=-325*1e-7,tRe=-322*1e-7,nRe=-79*1e-7,iRe=232*1e-7,oRe=-52*1e-7,rRe=97*1e-7,sRe=55*1e-7,aRe=-41*1e-7,cRe=-105*1e-7,lRe=-137*1e-7,dRe=258*1e-7,uRe=35*1e-7,mRe=-116*1e-7,hRe=-88*1e-7,fRe=-112*1e-7,pRe=-80*1e-7,NS=new te(0,0,zn.TAI);function bRe(e,t){wee(e,NS);let i=(NS.dayNumber-l5.dayNumber+(NS.secondsOfDay-l5.secondsOfDay)/Hn.SECONDS_PER_DAY)/(Hn.DAYS_PER_JULIAN_CENTURY*10),o=.3595362*i,r=wZe+MZe*Math.cos(gee*o)+zZe*Math.sin(gee*o)+NZe*Math.cos(xee*o)+HZe*Math.sin(xee*o)+kZe*Math.cos(_ee*o)+KZe*Math.sin(_ee*o)+UZe*Math.cos(Tee*o)+JZe*Math.sin(Tee*o)+DZe*Math.cos(See*o)+QZe*Math.sin(See*o)+BZe*Math.cos(Cee*o)+jZe*Math.sin(Cee*o)+YZe*Math.cos(Vee*o)+qZe*Math.sin(Vee*o)+OZe*Math.cos(Lee*o)+$Ze*Math.sin(Lee*o),s=FZe+AZe*i+eRe*Math.cos(Zee*o)+cRe*Math.sin(Zee*o)+tRe*Math.cos(Ree*o)+lRe*Math.sin(Ree*o)+nRe*Math.cos(Gee*o)+dRe*Math.sin(Gee*o)+iRe*Math.cos(Eee*o)+uRe*Math.sin(Eee*o)+oRe*Math.cos(Xee*o)+mRe*Math.sin(Xee*o)+rRe*Math.cos(Iee*o)+hRe*Math.sin(Iee*o)+sRe*Math.cos(Wee*o)+fRe*Math.sin(Wee*o)+aRe*Math.cos(Pee*o)+pRe*Math.sin(Pee*o),a=.0167086342-.0004203654*i,c=102.93734808*su+11612.3529*id*i,d=469.97289*id*i,u=174.87317577*su-8679.27034*id*i;return Fee(r,a,d,c,u,s,t)}function Aee(e,t){wee(e,NS);let i=(NS.dayNumber-l5.dayNumber+(NS.secondsOfDay-l5.secondsOfDay)/Hn.SECONDS_PER_DAY)/Hn.DAYS_PER_JULIAN_CENTURY,o=i*i,r=o*i,s=r*i,a=383397.7725+.004*i,c=.055545526-16e-9*i,d=5.15668983*su,u=-8e-5*i+.02966*o-42e-6*r-13e-8*s,m=83.35324312*su,p=146434202669e-4*i-38.2702*o-.045047*r+21301e-8*s,b=125.04455501*su,f=-69679193631e-4*i+6.3602*o+.007625*r-3586e-8*s,x=218.31664563*su,_=17325593434847e-4*i-6.391*o+.006588*r-3169e-8*s,C=297.85019547*su+id*(1602961601209e-3*i-6.3706*o+.006593*r-3169e-8*s),V=93.27209062*su+id*(17395272628478e-4*i-12.7512*o-.001037*r+417e-8*s),L=134.96340251*su+id*(17179159232178e-4*i+31.8792*o+.051635*r-2447e-7*s),R=357.52910918*su+id*(1295965810481e-4*i-.5532*o+136e-6*r-1149e-8*s),G=310.17137918*su-id*(6967051436e-3*i+6.2068*o+.007618*r-3219e-8*s),X=2*C,v=4*C,W=6*C,F=2*L,A=3*L,y=4*L,Z=2*V;a+=3400.4*Math.cos(X)-635.6*Math.cos(X-L)-235.6*Math.cos(L)+218.1*Math.cos(X-R)+181*Math.cos(X+L),c+=.014216*Math.cos(X-L)+.008551*Math.cos(X-F)-.001383*Math.cos(L)+.001356*Math.cos(X+L)-.001147*Math.cos(v-A)-914e-6*Math.cos(v-F)+869e-6*Math.cos(X-R-L)-627e-6*Math.cos(X)-394e-6*Math.cos(v-y)+282e-6*Math.cos(X-R-F)-279e-6*Math.cos(C-L)-236e-6*Math.cos(F)+231e-6*Math.cos(v)+229e-6*Math.cos(W-y)-201e-6*Math.cos(F-Z),u+=486.26*Math.cos(X-Z)-40.13*Math.cos(X)+37.51*Math.cos(Z)+25.73*Math.cos(F-Z)+19.97*Math.cos(X-R-Z),p+=-55609*Math.sin(X-L)-34711*Math.sin(X-F)-9792*Math.sin(L)+9385*Math.sin(v-A)+7505*Math.sin(v-F)+5318*Math.sin(X+L)+3484*Math.sin(v-y)-3417*Math.sin(X-R-L)-2530*Math.sin(W-y)-2376*Math.sin(X)-2075*Math.sin(X-A)-1883*Math.sin(F)-1736*Math.sin(W-5*L)+1626*Math.sin(R)-1370*Math.sin(W-A),f+=-5392*Math.sin(X-Z)-540*Math.sin(R)-441*Math.sin(X)+423*Math.sin(Z)-288*Math.sin(F-Z),_+=-3332.9*Math.sin(X)+1197.4*Math.sin(X-L)-662.5*Math.sin(R)+396.3*Math.sin(L)-218*Math.sin(X-R);let E=2*G,I=3*G;u+=46.997*Math.cos(G)*i-.614*Math.cos(X-Z+G)*i+.614*Math.cos(X-Z-G)*i-.0297*Math.cos(E)*o-.0335*Math.cos(G)*o+.0012*Math.cos(X-Z+E)*o-16e-5*Math.cos(G)*r+4e-5*Math.cos(I)*r+4e-5*Math.cos(E)*r;let w=2.116*Math.sin(G)*i-.111*Math.sin(X-Z-G)*i-.0015*Math.sin(G)*o;p+=w,_+=w,f+=-520.77*Math.sin(G)*i+13.66*Math.sin(X-Z+G)*i+1.12*Math.sin(X-G)*i-1.06*Math.sin(Z-G)*i+.66*Math.sin(E)*o+.371*Math.sin(G)*o-.035*Math.sin(X-Z+E)*o-.015*Math.sin(X-Z+G)*o+.0014*Math.sin(G)*r-.0011*Math.sin(I)*r-9e-4*Math.sin(E)*r,a*=RZe;let k=d+u*id,B=m+p*id,U=x+_*id,Y=b+f*id;return Fee(a,c,k,B,Y,U,t)}var vee=.012300034,yRe=vee/(vee+1)*-1;function gRe(e,t){return t=Aee(e,t),h.multiplyByScalar(t,yRe,t)}var Mee=new $(1.0000000000000002,5619723173785822e-31,4690511510146299e-34,-5154129427414611e-31,.9174820620691819,-.39777715593191376,-223970096136568e-30,.39777715593191376,.9174820620691819),FG=new h;LY.computeSunPositionInEarthInertialFrame=function(e,t){return l(e)||(e=te.now()),l(t)||(t=new h),FG=bRe(e,FG),t=h.negate(FG,t),gRe(e,FG),h.subtract(t,FG,t),$.multiplyByVector(Mee,t,t),t};LY.computeMoonPositionInEarthInertialFrame=function(e,t){return l(e)||(e=te.now()),t=Aee(e,t),$.multiplyByVector(Mee,t,t),t};var Eb=LY;var HMt=T(S(),1),d5={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3};d5.getMorphTime=function(e){return e===d5.SCENE3D?1:e===d5.MORPHING?void 0:0};var ie=Object.freeze(d5);var JMt=T(S(),1),xRe={LEFT_RIGHT:1,UP_DOWN:-1},Xb=Object.freeze(xRe);var $Mt=T(S(),1);function _Re(e){e=g(e,g.EMPTY_OBJECT),this.color=O.clone(g(e.color,O.WHITE)),this.intensity=g(e.intensity,2)}var yp=_Re;function kS(){this.globeDepthTexture=void 0,this.gamma=void 0,this._viewport=new ze,this._viewportCartesian4=new se,this._viewportDirty=!1,this._viewportOrthographicMatrix=M.clone(M.IDENTITY),this._viewportTransformation=M.clone(M.IDENTITY),this._model=M.clone(M.IDENTITY),this._view=M.clone(M.IDENTITY),this._inverseView=M.clone(M.IDENTITY),this._projection=M.clone(M.IDENTITY),this._infiniteProjection=M.clone(M.IDENTITY),this._entireFrustum=new D,this._currentFrustum=new D,this._frustumPlanes=new se,this._farDepthFromNearPlusOne=void 0,this._log2FarDepthFromNearPlusOne=void 0,this._oneOverLog2FarDepthFromNearPlusOne=void 0,this._frameState=void 0,this._temeToPseudoFixed=$.clone(M.IDENTITY),this._view3DDirty=!0,this._view3D=new M,this._inverseView3DDirty=!0,this._inverseView3D=new M,this._inverseModelDirty=!0,this._inverseModel=new M,this._inverseTransposeModelDirty=!0,this._inverseTransposeModel=new $,this._viewRotation=new $,this._inverseViewRotation=new $,this._viewRotation3D=new $,this._inverseViewRotation3D=new $,this._inverseProjectionDirty=!0,this._inverseProjection=new M,this._modelViewDirty=!0,this._modelView=new M,this._modelView3DDirty=!0,this._modelView3D=new M,this._modelViewRelativeToEyeDirty=!0,this._modelViewRelativeToEye=new M,this._inverseModelViewDirty=!0,this._inverseModelView=new M,this._inverseModelView3DDirty=!0,this._inverseModelView3D=new M,this._viewProjectionDirty=!0,this._viewProjection=new M,this._inverseViewProjectionDirty=!0,this._inverseViewProjection=new M,this._modelViewProjectionDirty=!0,this._modelViewProjection=new M,this._inverseModelViewProjectionDirty=!0,this._inverseModelViewProjection=new M,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewProjectionRelativeToEye=new M,this._modelViewInfiniteProjectionDirty=!0,this._modelViewInfiniteProjection=new M,this._normalDirty=!0,this._normal=new $,this._normal3DDirty=!0,this._normal3D=new $,this._inverseNormalDirty=!0,this._inverseNormal=new $,this._inverseNormal3DDirty=!0,this._inverseNormal3D=new $,this._encodedCameraPositionMCDirty=!0,this._encodedCameraPositionMC=new Yn,this._cameraPosition=new h,this._sunPositionWC=new h,this._sunPositionColumbusView=new h,this._sunDirectionWC=new h,this._sunDirectionEC=new h,this._moonDirectionEC=new h,this._lightDirectionWC=new h,this._lightDirectionEC=new h,this._lightColor=new h,this._lightColorHdr=new h,this._pass=void 0,this._mode=void 0,this._mapProjection=void 0,this._ellipsoid=void 0,this._cameraDirection=new h,this._cameraRight=new h,this._cameraUp=new h,this._frustum2DWidth=0,this._eyeHeight=0,this._eyeHeight2D=new D,this._eyeEllipsoidNormalEC=new h,this._eyeEllipsoidCurvature=new D,this._modelToEnu=new M,this._enuToModel=new M,this._pixelRatio=1,this._orthographicIn3D=!1,this._backgroundColor=new O,this._brdfLut=void 0,this._environmentMap=void 0,this._sphericalHarmonicCoefficients=void 0,this._specularEnvironmentMaps=void 0,this._specularEnvironmentMapsDimensions=new D,this._specularEnvironmentMapsMaximumLOD=void 0,this._fogDensity=void 0,this._fogMinimumBrightness=void 0,this._atmosphereHsbShift=void 0,this._atmosphereLightIntensity=void 0,this._atmosphereRayleighCoefficient=new h,this._atmosphereRayleighScaleHeight=new h,this._atmosphereMieCoefficient=new h,this._atmosphereMieScaleHeight=void 0,this._atmosphereMieAnisotropy=void 0,this._atmosphereDynamicLighting=void 0,this._invertClassificationColor=void 0,this._splitMode=Xb.LEFT_RIGHT,this._splitPosition=0,this._pixelSizePerMeter=void 0,this._geometricToleranceOverMeter=void 0,this._minimumDisableDepthTestDistance=void 0}Object.defineProperties(kS.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(e){if(!ze.equals(e,this._viewport)){ze.clone(e,this._viewport);let t=this._viewport,n=this._viewportCartesian4;n.x=t.x,n.y=t.y,n.z=t.width,n.w=t.height,this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){return kee(this),this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){return kee(this),this._viewportTransformation}},model:{get:function(){return this._model},set:function(e){M.clone(e,this._model),this._modelView3DDirty=!0,this._inverseModelView3DDirty=!0,this._inverseModelDirty=!0,this._inverseTransposeModelDirty=!0,this._modelViewDirty=!0,this._inverseModelViewDirty=!0,this._modelViewRelativeToEyeDirty=!0,this._inverseModelViewDirty=!0,this._modelViewProjectionDirty=!0,this._inverseModelViewProjectionDirty=!0,this._modelViewProjectionRelativeToEyeDirty=!0,this._modelViewInfiniteProjectionDirty=!0,this._normalDirty=!0,this._inverseNormalDirty=!0,this._normal3DDirty=!0,this._inverseNormal3DDirty=!0,this._encodedCameraPositionMCDirty=!0}},inverseModel:{get:function(){return this._inverseModelDirty&&(this._inverseModelDirty=!1,M.inverse(this._model,this._inverseModel)),this._inverseModel}},inverseTransposeModel:{get:function(){let e=this._inverseTransposeModel;return this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,M.getMatrix3(this.inverseModel,e),$.transpose(e,e)),e}},view:{get:function(){return this._view}},view3D:{get:function(){return ZY(this),this._view3D}},viewRotation:{get:function(){return ZY(this),this._viewRotation}},viewRotation3D:{get:function(){return ZY(this),this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){return Bee(this),this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){return Bee(this),this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){return IRe(this),this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){return WRe(this),this._modelView}},modelView3D:{get:function(){return PRe(this),this._modelView3D}},modelViewRelativeToEye:{get:function(){return NRe(this),this._modelViewRelativeToEye}},inverseModelView:{get:function(){return vRe(this),this._inverseModelView}},inverseModelView3D:{get:function(){return wRe(this),this._inverseModelView3D}},viewProjection:{get:function(){return FRe(this),this._viewProjection}},inverseViewProjection:{get:function(){return ARe(this),this._inverseViewProjection}},modelViewProjection:{get:function(){return MRe(this),this._modelViewProjection}},inverseModelViewProjection:{get:function(){return kRe(this),this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){return URe(this),this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){return DRe(this),this._modelViewInfiniteProjection}},normal:{get:function(){return BRe(this),this._normal}},normal3D:{get:function(){return YRe(this),this._normal3D}},inverseNormal:{get:function(){return ORe(this),this._inverseNormal}},inverseNormal3D:{get:function(){return zRe(this),this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},farDepthFromNearPlusOne:{get:function(){return this._farDepthFromNearPlusOne}},log2FarDepthFromNearPlusOne:{get:function(){return this._log2FarDepthFromNearPlusOne}},oneOverLog2FarDepthFromNearPlusOne:{get:function(){return this._oneOverLog2FarDepthFromNearPlusOne}},eyeHeight:{get:function(){return this._eyeHeight}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},eyeEllipsoidNormalEC:{get:function(){return this._eyeEllipsoidNormalEC}},eyeEllipsoidCurvature:{get:function(){return this._eyeEllipsoidCurvature}},modelToEnu:{get:function(){return this._modelToEnu}},enuToModel:{get:function(){return this._enuToModel}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},lightDirectionWC:{get:function(){return this._lightDirectionWC}},lightDirectionEC:{get:function(){return this._lightDirectionEC}},lightColor:{get:function(){return this._lightColor}},lightColorHdr:{get:function(){return this._lightColorHdr}},encodedCameraPositionMCHigh:{get:function(){return Dee(this),this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){return Dee(this),this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},pixelRatio:{get:function(){return this._pixelRatio}},fogDensity:{get:function(){return this._fogDensity}},fogMinimumBrightness:{get:function(){return this._fogMinimumBrightness}},atmosphereHsbShift:{get:function(){return this._atmosphereHsbShift}},atmosphereLightIntensity:{get:function(){return this._atmosphereLightIntensity}},atmosphereRayleighCoefficient:{get:function(){return this._atmosphereRayleighCoefficient}},atmosphereRayleighScaleHeight:{get:function(){return this._atmosphereRayleighScaleHeight}},atmosphereMieCoefficient:{get:function(){return this._atmosphereMieCoefficient}},atmosphereMieScaleHeight:{get:function(){return this._atmosphereMieScaleHeight}},atmosphereMieAnisotropy:{get:function(){return this._atmosphereMieAnisotropy}},atmosphereDynamicLighting:{get:function(){return this._atmosphereDynamicLighting}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsDimensions:{get:function(){return this._specularEnvironmentMapsDimensions}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},splitMode:{get:function(){return this._splitMode}},splitPosition:{get:function(){return this._splitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},orthographicIn3D:{get:function(){return this._orthographicIn3D}},ellipsoid:{get:function(){return g(this._ellipsoid,oe.WGS84)}}});function TRe(e,t){M.clone(t,e._view),M.getMatrix3(t,e._viewRotation),e._view3DDirty=!0,e._inverseView3DDirty=!0,e._modelViewDirty=!0,e._modelView3DDirty=!0,e._modelViewRelativeToEyeDirty=!0,e._inverseModelViewDirty=!0,e._inverseModelView3DDirty=!0,e._viewProjectionDirty=!0,e._inverseViewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0,e._modelViewInfiniteProjectionDirty=!0,e._normalDirty=!0,e._inverseNormalDirty=!0,e._normal3DDirty=!0,e._inverseNormal3DDirty=!0}function SRe(e,t){M.clone(t,e._inverseView),M.getMatrix3(t,e._inverseViewRotation)}function CRe(e,t){M.clone(t,e._projection),e._inverseProjectionDirty=!0,e._viewProjectionDirty=!0,e._inverseViewProjectionDirty=!0,e._modelViewProjectionDirty=!0,e._modelViewProjectionRelativeToEyeDirty=!0}function VRe(e,t){M.clone(t,e._infiniteProjection),e._modelViewInfiniteProjectionDirty=!0}var Nee=new h,LRe=new M;function ZRe(e,t){h.clone(t.positionWC,e._cameraPosition),h.clone(t.directionWC,e._cameraDirection),h.clone(t.rightWC,e._cameraRight),h.clone(t.upWC,e._cameraUp);let n=e._ellipsoid,i,o=t.positionCartographic;if(l(o)?(e._eyeHeight=o.height,e._eyeEllipsoidNormalEC=n.geodeticSurfaceNormalCartographic(o,e._eyeEllipsoidNormalEC),i=h.fromRadians(o.longitude,o.latitude,0,n,Nee)):(e._eyeHeight=-n.maximumRadius,h.magnitude(t.positionWC)>0&&(e._eyeEllipsoidNormalEC=h.normalize(t.positionWC,e._eyeEllipsoidNormalEC)),i=n.scaleToGeodeticSurface(t.positionWC,Nee)),e._encodedCameraPositionMCDirty=!0,!l(i))return;e._eyeEllipsoidNormalEC=$.multiplyByVector(e._viewRotation,e._eyeEllipsoidNormalEC,e._eyeEllipsoidNormalEC);let r=Wt.eastNorthUpToFixedFrame(i,n,LRe);e._enuToModel=M.multiplyTransformation(e.inverseModel,r,e._enuToModel),e._modelToEnu=M.inverseTransformation(e._enuToModel,e._modelToEnu),P.equalsEpsilon(n._radii.x,n._radii.y,P.EPSILON15)&&(e._eyeEllipsoidCurvature=n.getLocalCurvature(i,e._eyeEllipsoidCurvature))}var AG=new $,RRe=new he;function GRe(e,t){l(Wt.computeIcrfToFixedMatrix(t.time,AG))||(AG=Wt.computeTemeToPseudoFixedMatrix(t.time,AG));let n=Eb.computeSunPositionInEarthInertialFrame(t.time,e._sunPositionWC);$.multiplyByVector(AG,n,n),h.normalize(n,e._sunDirectionWC),n=$.multiplyByVector(e.viewRotation3D,n,e._sunDirectionEC),h.normalize(n,n),n=Eb.computeMoonPositionInEarthInertialFrame(t.time,e._moonDirectionEC),$.multiplyByVector(AG,n,n),$.multiplyByVector(e.viewRotation3D,n,n),h.normalize(n,n);let i=t.mapProjection,r=i.ellipsoid.cartesianToCartographic(e._sunPositionWC,RRe);i.project(r,e._sunPositionColumbusView)}kS.prototype.updateCamera=function(e){TRe(this,e.viewMatrix),SRe(this,e.inverseViewMatrix),ZRe(this,e),this._entireFrustum.x=e.frustum.near,this._entireFrustum.y=e.frustum.far,this.updateFrustum(e.frustum),this._orthographicIn3D=this._mode!==ie.SCENE2D&&e.frustum instanceof rn};kS.prototype.updateFrustum=function(e){CRe(this,e.projectionMatrix),l(e.infiniteProjectionMatrix)&&VRe(this,e.infiniteProjectionMatrix),this._currentFrustum.x=e.near,this._currentFrustum.y=e.far,this._farDepthFromNearPlusOne=e.far-e.near+1,this._log2FarDepthFromNearPlusOne=P.log2(this._farDepthFromNearPlusOne),this._oneOverLog2FarDepthFromNearPlusOne=1/this._log2FarDepthFromNearPlusOne;let t=e.offCenterFrustum;l(t)&&(e=t),this._frustumPlanes.x=e.top,this._frustumPlanes.y=e.bottom,this._frustumPlanes.z=e.left,this._frustumPlanes.w=e.right};kS.prototype.updatePass=function(e){this._pass=e};var ERe=[],XRe=new yp;kS.prototype.update=function(e){this._mode=e.mode,this._mapProjection=e.mapProjection,this._ellipsoid=e.mapProjection.ellipsoid,this._pixelRatio=e.pixelRatio;let t=e.camera;this.updateCamera(t),e.mode===ie.SCENE2D?(this._frustum2DWidth=t.frustum.right-t.frustum.left,this._eyeHeight2D.x=this._frustum2DWidth*.5,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0),GRe(this,e);let n=g(e.light,XRe);n instanceof yp?(this._lightDirectionWC=h.clone(this._sunDirectionWC,this._lightDirectionWC),this._lightDirectionEC=h.clone(this._sunDirectionEC,this._lightDirectionEC)):(this._lightDirectionWC=h.normalize(h.negate(n.direction,this._lightDirectionWC),this._lightDirectionWC),this._lightDirectionEC=$.multiplyByVector(this.viewRotation3D,this._lightDirectionWC,this._lightDirectionEC));let i=n.color,o=h.fromElements(i.red,i.green,i.blue,this._lightColorHdr);o=h.multiplyByScalar(o,n.intensity,o);let r=h.maximumComponent(o);r>1?h.divideByScalar(o,r,this._lightColor):h.clone(o,this._lightColor);let s=e.brdfLutGenerator,a=l(s)?s.colorTexture:void 0;this._brdfLut=a,this._environmentMap=g(e.environmentMap,e.context.defaultCubeMap),this._sphericalHarmonicCoefficients=g(e.sphericalHarmonicCoefficients,ERe),this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._specularEnvironmentMapsMaximumLOD=e.specularEnvironmentMapsMaximumLOD,l(this._specularEnvironmentMaps)&&D.clone(this._specularEnvironmentMaps.dimensions,this._specularEnvironmentMapsDimensions),this._fogDensity=e.fog.density,this._fogMinimumBrightness=e.fog.minimumBrightness;let c=e.atmosphere;l(c)&&(this._atmosphereHsbShift=h.fromElements(c.hueShift,c.saturationShift,c.brightnessShift,this._atmosphereHsbShift),this._atmosphereLightIntensity=c.lightIntensity,this._atmosphereRayleighCoefficient=h.clone(c.rayleighCoefficient,this._atmosphereRayleighCoefficient),this._atmosphereRayleighScaleHeight=c.rayleighScaleHeight,this._atmosphereMieCoefficient=h.clone(c.mieCoefficient,this._atmosphereMieCoefficient),this._atmosphereMieScaleHeight=c.mieScaleHeight,this._atmosphereMieAnisotropy=c.mieAnisotropy,this._atmosphereDynamicLighting=c.dynamicLighting),this._invertClassificationColor=e.invertClassificationColor,this._frameState=e,this._temeToPseudoFixed=Wt.computeTemeToPseudoFixedMatrix(e.time,this._temeToPseudoFixed);let d=e.splitMode,u=e.splitPosition,m=e.context;this._splitMode=d,this._splitPosition=d===Xb.LEFT_RIGHT?u*m.drawingBufferWidth:u*m.drawingBufferHeight;let p=t.frustum.fov,b=this._viewport,f;l(p)?b.height>b.width?f=Math.tan(.5*p)*2/b.height:f=Math.tan(.5*p)*2/b.width:f=1/Math.max(b.width,b.height),this._geometricToleranceOverMeter=f*e.maximumScreenSpaceError,O.clone(e.backgroundColor,this._backgroundColor),this._minimumDisableDepthTestDistance=e.minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance,this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};function kee(e){if(e._viewportDirty){let t=e._viewport;M.computeOrthographicOffCenter(t.x,t.x+t.width,t.y,t.y+t.height,0,1,e._viewportOrthographicMatrix),M.computeViewportTransformation(t,0,1,e._viewportTransformation),e._viewportDirty=!1}}function IRe(e){e._inverseProjectionDirty&&(e._inverseProjectionDirty=!1,e._mode!==ie.SCENE2D&&e._mode!==ie.MORPHING&&!e._orthographicIn3D?M.inverse(e._projection,e._inverseProjection):M.clone(M.ZERO,e._inverseProjection))}function WRe(e){e._modelViewDirty&&(e._modelViewDirty=!1,M.multiplyTransformation(e._view,e._model,e._modelView))}function PRe(e){e._modelView3DDirty&&(e._modelView3DDirty=!1,M.multiplyTransformation(e.view3D,e._model,e._modelView3D))}function vRe(e){e._inverseModelViewDirty&&(e._inverseModelViewDirty=!1,M.inverse(e.modelView,e._inverseModelView))}function wRe(e){e._inverseModelView3DDirty&&(e._inverseModelView3DDirty=!1,M.inverse(e.modelView3D,e._inverseModelView3D))}function FRe(e){e._viewProjectionDirty&&(e._viewProjectionDirty=!1,M.multiply(e._projection,e._view,e._viewProjection))}function ARe(e){e._inverseViewProjectionDirty&&(e._inverseViewProjectionDirty=!1,M.inverse(e.viewProjection,e._inverseViewProjection))}function MRe(e){e._modelViewProjectionDirty&&(e._modelViewProjectionDirty=!1,M.multiply(e._projection,e.modelView,e._modelViewProjection))}function NRe(e){if(e._modelViewRelativeToEyeDirty){e._modelViewRelativeToEyeDirty=!1;let t=e.modelView,n=e._modelViewRelativeToEye;n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=0,n[13]=0,n[14]=0,n[15]=t[15]}}function kRe(e){e._inverseModelViewProjectionDirty&&(e._inverseModelViewProjectionDirty=!1,M.inverse(e.modelViewProjection,e._inverseModelViewProjection))}function URe(e){e._modelViewProjectionRelativeToEyeDirty&&(e._modelViewProjectionRelativeToEyeDirty=!1,M.multiply(e._projection,e.modelViewRelativeToEye,e._modelViewProjectionRelativeToEye))}function DRe(e){e._modelViewInfiniteProjectionDirty&&(e._modelViewInfiniteProjectionDirty=!1,M.multiply(e._infiniteProjection,e.modelView,e._modelViewInfiniteProjection))}function BRe(e){if(e._normalDirty){e._normalDirty=!1;let t=e._normal;M.getMatrix3(e.inverseModelView,t),$.transpose(t,t)}}function YRe(e){if(e._normal3DDirty){e._normal3DDirty=!1;let t=e._normal3D;M.getMatrix3(e.inverseModelView3D,t),$.transpose(t,t)}}function ORe(e){if(e._inverseNormalDirty){e._inverseNormalDirty=!1;let t=e._inverseNormal;M.getMatrix3(e.modelView,t),$.transpose(t,t)}}function zRe(e){if(e._inverseNormal3DDirty){e._inverseNormal3DDirty=!1;let t=e._inverseNormal3D;M.getMatrix3(e.modelView3D,t),$.transpose(t,t)}}var Uee=new h;function Dee(e){e._encodedCameraPositionMCDirty&&(e._encodedCameraPositionMCDirty=!1,M.multiplyByPoint(e.inverseModel,e._cameraPosition,Uee),Yn.fromCartesian(Uee,e._encodedCameraPositionMC))}var HRe=new h,KRe=new h,JRe=new h,QRe=new h,jRe=new he,qRe=new h,$Re=new M;function eGe(e,t,n,i,o,r,s,a){let c=HRe;c.x=e.y,c.y=e.z,c.z=e.x;let d=KRe;d.x=n.y,d.y=n.z,d.z=n.x;let u=JRe;u.x=i.y,u.y=i.z,u.z=i.x;let m=QRe;m.x=t.y,m.y=t.z,m.z=t.x,r===ie.SCENE2D&&(c.z=o*.5);let p=s.unproject(c,jRe);p.longitude=P.clamp(p.longitude,-Math.PI,Math.PI),p.latitude=P.clamp(p.latitude,-P.PI_OVER_TWO,P.PI_OVER_TWO);let b=s.ellipsoid,f=b.cartographicToCartesian(p,qRe),x=Wt.eastNorthUpToFixedFrame(f,b,$Re);return M.multiplyByPointAsVector(x,d,d),M.multiplyByPointAsVector(x,u,u),M.multiplyByPointAsVector(x,m,m),l(a)||(a=new M),a[0]=d.x,a[1]=u.x,a[2]=-m.x,a[3]=0,a[4]=d.y,a[5]=u.y,a[6]=-m.y,a[7]=0,a[8]=d.z,a[9]=u.z,a[10]=-m.z,a[11]=0,a[12]=-h.dot(d,f),a[13]=-h.dot(u,f),a[14]=h.dot(m,f),a[15]=1,a}function ZY(e){e._view3DDirty&&(e._mode===ie.SCENE3D?M.clone(e._view,e._view3D):eGe(e._cameraPosition,e._cameraDirection,e._cameraRight,e._cameraUp,e._frustum2DWidth,e._mode,e._mapProjection,e._view3D),M.getMatrix3(e._view3D,e._viewRotation3D),e._view3DDirty=!1)}function Bee(e){e._inverseView3DDirty&&(M.inverseTransformation(e.view3D,e._inverseView3D),M.getMatrix3(e._inverseView3D,e._inverseViewRotation3D),e._inverseView3DDirty=!1)}var MG=kS;var P5t=T(S(),1);function tGe(e,t,n,i){let o=l(t.vertexBuffer),r=l(t.value),s=t.value?t.value.length:t.componentsPerAttribute,a={index:g(t.index,n),enabled:g(t.enabled,!0),vertexBuffer:t.vertexBuffer,value:r?t.value.slice(0):void 0,componentsPerAttribute:s,componentDatatype:g(t.componentDatatype,Q.FLOAT),normalize:g(t.normalize,!1),offsetInBytes:g(t.offsetInBytes,0),strideInBytes:g(t.strideInBytes,0),instanceDivisor:g(t.instanceDivisor,0)};if(o)a.vertexAttrib=function(c){let d=this.index;c.bindBuffer(c.ARRAY_BUFFER,this.vertexBuffer._getBuffer()),c.vertexAttribPointer(d,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes),c.enableVertexAttribArray(d),this.instanceDivisor>0&&(i.glVertexAttribDivisor(d,this.instanceDivisor),i._vertexAttribDivisors[d]=this.instanceDivisor,i._previousDrawInstanced=!0)},a.disableVertexAttribArray=function(c){c.disableVertexAttribArray(this.index),this.instanceDivisor>0&&i.glVertexAttribDivisor(n,0)};else{switch(a.componentsPerAttribute){case 1:a.vertexAttrib=function(c){c.vertexAttrib1fv(this.index,this.value)};break;case 2:a.vertexAttrib=function(c){c.vertexAttrib2fv(this.index,this.value)};break;case 3:a.vertexAttrib=function(c){c.vertexAttrib3fv(this.index,this.value)};break;case 4:a.vertexAttrib=function(c){c.vertexAttrib4fv(this.index,this.value)};break}a.disableVertexAttribArray=function(c){}}e.push(a)}function Oee(e,t,n){for(let i=0;i<t.length;++i){let o=t[i];o.enabled&&o.vertexAttrib(e)}l(n)&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n._getBuffer())}function gp(e){e=g(e,g.EMPTY_OBJECT);let t=e.context,n=t._gl,i=e.attributes,o=e.indexBuffer,r,s=[],a=1,c=!1,d=!1,u=i.length;for(r=0;r<u;++r)tGe(s,i[r],r,t);for(u=s.length,r=0;r<u;++r){let p=s[r];if(l(p.vertexBuffer)&&p.instanceDivisor===0){let b=p.strideInBytes||p.componentsPerAttribute*Q.getSizeInBytes(p.componentDatatype);a=p.vertexBuffer.sizeInBytes/b;break}}for(r=0;r<u;++r)s[r].instanceDivisor>0&&(c=!0),l(s[r].value)&&(d=!0);let m;t.vertexArrayObject&&(m=t.glCreateVertexArray(),t.glBindVertexArray(m),Oee(n,s,o),t.glBindVertexArray(null)),this._numberOfVertices=a,this._hasInstancedAttributes=c,this._hasConstantAttributes=d,this._context=t,this._gl=n,this._vao=m,this._attributes=s,this._indexBuffer=o}function Yee(e){return e.values.length/e.componentsPerAttribute}function nGe(e){return Q.getSizeInBytes(e.componentDatatype)*e.componentsPerAttribute}function iGe(e){let t,n,i,o=[];for(n in e)e.hasOwnProperty(n)&&l(e[n])&&l(e[n].values)&&(o.push(n),e[n].componentDatatype===Q.DOUBLE&&(e[n].componentDatatype=Q.FLOAT,e[n].values=Q.createTypedArray(Q.FLOAT,e[n].values)));let r,s=o.length;if(s>0)for(r=Yee(e[o[0]]),t=1;t<s;++t){let d=Yee(e[o[t]]);if(d!==r)throw new ue(`Each attribute list must have the same number of vertices. Attribute ${o[t]} has a different number of vertices (${d.toString()}) than attribute ${o[0]} (${r.toString()}).`)}o.sort(function(d,u){return Q.getSizeInBytes(e[u].componentDatatype)-Q.getSizeInBytes(e[d].componentDatatype)});let a=0,c={};for(t=0;t<s;++t)n=o[t],i=e[n],c[n]=a,a+=nGe(i);if(a>0){let d=Q.getSizeInBytes(e[o[0]].componentDatatype),u=a%d;u!==0&&(a+=d-u);let m=r*a,p=new ArrayBuffer(m),b={};for(t=0;t<s;++t){n=o[t];let f=Q.getSizeInBytes(e[n].componentDatatype);b[n]={pointer:Q.createTypedArray(e[n].componentDatatype,p),index:c[n]/f,strideInComponentType:a/f}}for(t=0;t<r;++t)for(let f=0;f<s;++f){n=o[f],i=e[n];let x=i.values,_=b[n],C=_.pointer,V=i.componentsPerAttribute;for(let L=0;L<V;++L)C[_.index+L]=x[t*V+L];_.index+=_.strideInComponentType}return{buffer:p,offsetsInBytes:c,vertexSizeInBytes:a}}}gp.fromGeometry=function(e){e=g(e,g.EMPTY_OBJECT);let t=e.context,n=g(e.geometry,g.EMPTY_OBJECT),i=g(e.bufferUsage,Me.DYNAMIC_DRAW),o=g(e.attributeLocations,g.EMPTY_OBJECT),r=g(e.interleave,!1),s=e.vertexArrayAttributes,a,c,d,u=l(s)?s:[],m=n.attributes;if(r){let f=iGe(m);if(l(f)){d=pt.createVertexBuffer({context:t,typedArray:f.buffer,usage:i});let x=f.offsetsInBytes,_=f.vertexSizeInBytes;for(a in m)m.hasOwnProperty(a)&&l(m[a])&&(c=m[a],l(c.values)?u.push({index:o[a],vertexBuffer:d,componentDatatype:c.componentDatatype,componentsPerAttribute:c.componentsPerAttribute,normalize:c.normalize,offsetInBytes:x[a],strideInBytes:_}):u.push({index:o[a],value:c.value,componentDatatype:c.componentDatatype,normalize:c.normalize}))}}else for(a in m)if(m.hasOwnProperty(a)&&l(m[a])){c=m[a];let f=c.componentDatatype;f===Q.DOUBLE&&(f=Q.FLOAT),d=void 0,l(c.values)&&(d=pt.createVertexBuffer({context:t,typedArray:Q.createTypedArray(f,c.values),usage:i})),u.push({index:o[a],vertexBuffer:d,value:c.value,componentDatatype:f,componentsPerAttribute:c.componentsPerAttribute,normalize:c.normalize})}let p,b=n.indices;return l(b)&&(ut.computeNumberOfVertices(n)>=P.SIXTY_FOUR_KILOBYTES&&t.elementIndexUint?p=pt.createIndexBuffer({context:t,typedArray:new Uint32Array(b),usage:i,indexDatatype:Ae.UNSIGNED_INT}):p=pt.createIndexBuffer({context:t,typedArray:new Uint16Array(b),usage:i,indexDatatype:Ae.UNSIGNED_SHORT})),new gp({context:t,attributes:u,indexBuffer:p})};Object.defineProperties(gp.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}});gp.prototype.getAttribute=function(e){return this._attributes[e]};function oGe(e){let t=e._context,n=e._hasInstancedAttributes;if(!n&&!t._previousDrawInstanced)return;t._previousDrawInstanced=n;let i=t._vertexAttribDivisors,o=e._attributes,r=Yt.maximumVertexAttributes,s;if(n){let a=o.length;for(s=0;s<a;++s){let c=o[s];if(c.enabled){let d=c.instanceDivisor,u=c.index;d!==i[u]&&(t.glVertexAttribDivisor(u,d),i[u]=d)}}}else for(s=0;s<r;++s)i[s]>0&&(t.glVertexAttribDivisor(s,0),i[s]=0)}function rGe(e,t){let n=e._attributes,i=n.length;for(let o=0;o<i;++o){let r=n[o];r.enabled&&l(r.value)&&r.vertexAttrib(t)}}gp.prototype._bind=function(){l(this._vao)?(this._context.glBindVertexArray(this._vao),this._context.instancedArrays&&oGe(this),this._hasConstantAttributes&&rGe(this,this._gl)):Oee(this._gl,this._attributes,this._indexBuffer)};gp.prototype._unBind=function(){if(l(this._vao))this._context.glBindVertexArray(null);else{let e=this._attributes,t=this._gl;for(let n=0;n<e.length;++n){let i=e[n];i.enabled&&i.disableVertexAttribArray(t)}this._indexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}};gp.prototype.isDestroyed=function(){return!1};gp.prototype.destroy=function(){let e=this._attributes;for(let n=0;n<e.length;++n){let i=e[n].vertexBuffer;l(i)&&!i.isDestroyed()&&i.vertexArrayDestroyable&&i.destroy()}let t=this._indexBuffer;return l(t)&&!t.isDestroyed()&&t.vertexArrayDestroyable&&t.destroy(),l(this._vao)&&this._context.glDeleteVertexArray(this._vao),me(this)};var ti=gp;function od(e,t){let{getWebGLStub:n,requestWebgl1:i,webgl:o={},allowTextureFilterAnisotropic:r=!0}=g(t,{});o.alpha=g(o.alpha,!1),o.stencil=g(o.stencil,!0),o.powerPreference=g(o.powerPreference,\"high-performance\");let s=l(n)?n(e,o):sGe(e,o,i),c=typeof WebGL2RenderingContext<\"u\"&&s instanceof WebGL2RenderingContext;this._canvas=e,this._originalGLContext=s,this._gl=s,this._webgl2=c,this._id=Bn(),this.validateFramebuffer=!1,this.validateShaderProgram=!1,this.logShaderCompilation=!1,this._throwOnWebGLError=!1,this._shaderCache=new PG(this),this._textureCache=new vG;let d=s;this._stencilBits=d.getParameter(d.STENCIL_BITS),Yt._maximumCombinedTextureImageUnits=d.getParameter(d.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Yt._maximumCubeMapSize=d.getParameter(d.MAX_CUBE_MAP_TEXTURE_SIZE),Yt._maximumFragmentUniformVectors=d.getParameter(d.MAX_FRAGMENT_UNIFORM_VECTORS),Yt._maximumTextureImageUnits=d.getParameter(d.MAX_TEXTURE_IMAGE_UNITS),Yt._maximumRenderbufferSize=d.getParameter(d.MAX_RENDERBUFFER_SIZE),Yt._maximumTextureSize=d.getParameter(d.MAX_TEXTURE_SIZE),Yt._maximumVaryingVectors=d.getParameter(d.MAX_VARYING_VECTORS),Yt._maximumVertexAttributes=d.getParameter(d.MAX_VERTEX_ATTRIBS),Yt._maximumVertexTextureImageUnits=d.getParameter(d.MAX_VERTEX_TEXTURE_IMAGE_UNITS),Yt._maximumVertexUniformVectors=d.getParameter(d.MAX_VERTEX_UNIFORM_VECTORS),Yt._maximumSamples=this._webgl2?d.getParameter(d.MAX_SAMPLES):0;let u=d.getParameter(d.ALIASED_LINE_WIDTH_RANGE);Yt._minimumAliasedLineWidth=u[0],Yt._maximumAliasedLineWidth=u[1];let m=d.getParameter(d.ALIASED_POINT_SIZE_RANGE);Yt._minimumAliasedPointSize=m[0],Yt._maximumAliasedPointSize=m[1];let p=d.getParameter(d.MAX_VIEWPORT_DIMS);Yt._maximumViewportWidth=p[0],Yt._maximumViewportHeight=p[1];let b=d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.HIGH_FLOAT);Yt._highpFloatSupported=b.precision!==0;let f=d.getShaderPrecisionFormat(d.FRAGMENT_SHADER,d.HIGH_INT);Yt._highpIntSupported=f.rangeMax!==0,this._antialias=d.getContextAttributes().antialias,this._standardDerivatives=!!Lr(d,[\"OES_standard_derivatives\"]),this._blendMinmax=!!Lr(d,[\"EXT_blend_minmax\"]),this._elementIndexUint=!!Lr(d,[\"OES_element_index_uint\"]),this._depthTexture=!!Lr(d,[\"WEBGL_depth_texture\",\"WEBKIT_WEBGL_depth_texture\"]),this._fragDepth=!!Lr(d,[\"EXT_frag_depth\"]),this._debugShaders=Lr(d,[\"WEBGL_debug_shaders\"]),this._textureFloat=!!Lr(d,[\"OES_texture_float\"]),this._textureHalfFloat=!!Lr(d,[\"OES_texture_half_float\"]),this._textureFloatLinear=!!Lr(d,[\"OES_texture_float_linear\"]),this._textureHalfFloatLinear=!!Lr(d,[\"OES_texture_half_float_linear\"]),this._colorBufferFloat=!!Lr(d,[\"EXT_color_buffer_float\",\"WEBGL_color_buffer_float\"]),this._floatBlend=!!Lr(d,[\"EXT_float_blend\"]),this._colorBufferHalfFloat=!!Lr(d,[\"EXT_color_buffer_half_float\"]),this._s3tc=!!Lr(d,[\"WEBGL_compressed_texture_s3tc\",\"MOZ_WEBGL_compressed_texture_s3tc\",\"WEBKIT_WEBGL_compressed_texture_s3tc\"]),this._pvrtc=!!Lr(d,[\"WEBGL_compressed_texture_pvrtc\",\"WEBKIT_WEBGL_compressed_texture_pvrtc\"]),this._astc=!!Lr(d,[\"WEBGL_compressed_texture_astc\"]),this._etc=!!Lr(d,[\"WEBG_compressed_texture_etc\"]),this._etc1=!!Lr(d,[\"WEBGL_compressed_texture_etc1\"]),this._bc7=!!Lr(d,[\"EXT_texture_compression_bptc\"]),gl.setKTX2SupportedFormats(this._s3tc,this._pvrtc,this._astc,this._etc,this._etc1,this._bc7);let x=r?Lr(d,[\"EXT_texture_filter_anisotropic\",\"WEBKIT_EXT_texture_filter_anisotropic\"]):void 0;this._textureFilterAnisotropic=x,Yt._maximumTextureFilterAnisotropy=l(x)?d.getParameter(x.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;let _,C,V,L,R,G,X,v,W,F;if(c){let E=this;_=function(){return E._gl.createVertexArray()},C=function(I){E._gl.bindVertexArray(I)},V=function(I){E._gl.deleteVertexArray(I)},L=function(I,w,k,B,U){d.drawElementsInstanced(I,w,k,B,U)},R=function(I,w,k,B){d.drawArraysInstanced(I,w,k,B)},G=function(I,w){d.vertexAttribDivisor(I,w)},X=function(I){d.drawBuffers(I)}}else v=Lr(d,[\"OES_vertex_array_object\"]),l(v)&&(_=function(){return v.createVertexArrayOES()},C=function(E){v.bindVertexArrayOES(E)},V=function(E){v.deleteVertexArrayOES(E)}),W=Lr(d,[\"ANGLE_instanced_arrays\"]),l(W)&&(L=function(E,I,w,k,B){W.drawElementsInstancedANGLE(E,I,w,k,B)},R=function(E,I,w,k){W.drawArraysInstancedANGLE(E,I,w,k)},G=function(E,I){W.vertexAttribDivisorANGLE(E,I)}),F=Lr(d,[\"WEBGL_draw_buffers\"]),l(F)&&(X=function(E){F.drawBuffersWEBGL(E)});this.glCreateVertexArray=_,this.glBindVertexArray=C,this.glDeleteVertexArray=V,this.glDrawElementsInstanced=L,this.glDrawArraysInstanced=R,this.glVertexAttribDivisor=G,this.glDrawBuffers=X,this._vertexArrayObject=!!v,this._instancedArrays=!!W,this._drawBuffers=!!F,Yt._maximumDrawBuffers=this.drawBuffers?d.getParameter(ne.MAX_DRAW_BUFFERS):1,Yt._maximumColorAttachments=this.drawBuffers?d.getParameter(ne.MAX_COLOR_ATTACHMENTS):1,this._clearColor=new O(0,0,0,0),this._clearDepth=1,this._clearStencil=0;let A=new MG,y=new $a(this),Z=Ne.fromCache();this._defaultPassState=y,this._defaultRenderState=Z,this._defaultTexture=void 0,this._defaultEmissiveTexture=void 0,this._defaultNormalTexture=void 0,this._defaultCubeMap=void 0,this._us=A,this._currentRenderState=Z,this._currentPassState=y,this._currentFramebuffer=void 0,this._maxFrameTextureUnitIndex=0,this._vertexAttribDivisors=[],this._previousDrawInstanced=!1;for(let E=0;E<Yt._maximumVertexAttributes;E++)this._vertexAttribDivisors.push(0);this._pickObjects={},this._nextPickColor=new Uint32Array(1),this.options={getWebGLStub:n,requestWebgl1:i,webgl:o,allowTextureFilterAnisotropic:r},this.cache={},Ne.apply(d,Z,y)}function sGe(e,t,n){if(typeof WebGLRenderingContext>\"u\")throw new ue(\"The browser does not support WebGL. Visit http://get.webgl.org.\");!n&&!(typeof WebGL2RenderingContext<\"u\")&&(n=!0);let o=n?\"webgl\":\"webgl2\",r=e.getContext(o,t);if(!l(r))throw new ue(\"The browser supports WebGL, but initialization failed.\");return r}function aGe(e,t){let n=\"WebGL Error: \";switch(t){case e.INVALID_ENUM:n+=\"INVALID_ENUM\";break;case e.INVALID_VALUE:n+=\"INVALID_VALUE\";break;case e.INVALID_OPERATION:n+=\"INVALID_OPERATION\";break;case e.OUT_OF_MEMORY:n+=\"OUT_OF_MEMORY\";break;case e.CONTEXT_LOST_WEBGL:n+=\"CONTEXT_LOST_WEBGL lost\";break;default:n+=`Unknown (${t})`}return n}function cGe(e,t,n,i){let o=`${aGe(e,i)}: ${t.name}(`;for(let r=0;r<n.length;++r)r!==0&&(o+=\", \"),o+=n[r];return o+=\");\",o}function lGe(e,t,n){let i=e.getError();if(i!==e.NO_ERROR)throw new ue(cGe(e,t,n,i))}function dGe(e,t,n){return{get:function(){let i=e[t];return n(e,`get: ${t}`,i),e[t]},set:function(i){e[t]=i,n(e,`set: ${t}`,i)}}}function uGe(e,t){if(!l(t))return e;function n(o){return function(){let r=o.apply(e,arguments);return t(e,o,arguments),r}}let i={};for(let o in e){let r=e[o];r instanceof Function?i[o]=n(r):Object.defineProperty(i,o,dGe(e,o,t))}return i}function Lr(e,t){let n=t.length;for(let i=0;i<n;++i){let o=e.getExtension(t[i]);if(o)return o}}var mGe={};Object.defineProperties(od.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return this._stencilBits>=8}},antialias:{get:function(){return this._antialias}},msaa:{get:function(){return this._webgl2}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},floatBlend:{get:function(){return this._floatBlend}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},astc:{get:function(){return this._astc}},etc:{get:function(){return this._etc}},etc1:{get:function(){return this._etc1}},bc7:{get:function(){return this._bc7}},supportsBasis:{get:function(){return this._s3tc||this._pvrtc||this._astc||this._etc||this._etc1||this._bc7}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(e){this._throwOnWebGLError=e,this._gl=uGe(this._originalGLContext,e?lGe:void 0)}},defaultTexture:{get:function(){return this._defaultTexture===void 0&&(this._defaultTexture=new Ft({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1})),this._defaultTexture}},defaultEmissiveTexture:{get:function(){return this._defaultEmissiveTexture===void 0&&(this._defaultEmissiveTexture=new Ft({context:this,pixelFormat:at.RGB,source:{width:1,height:1,arrayBufferView:new Uint8Array([0,0,0])},flipY:!1})),this._defaultEmissiveTexture}},defaultNormalTexture:{get:function(){return this._defaultNormalTexture===void 0&&(this._defaultNormalTexture=new Ft({context:this,pixelFormat:at.RGB,source:{width:1,height:1,arrayBufferView:new Uint8Array([128,128,255])},flipY:!1})),this._defaultNormalTexture}},defaultCubeMap:{get:function(){if(this._defaultCubeMap===void 0){let e={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new qa({context:this,source:{positiveX:e,negativeX:e,positiveY:e,negativeY:e,positiveZ:e,negativeZ:e},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return mGe}}});function zee(e,t,n,i){let o=e._currentRenderState,r=e._currentPassState;e._currentRenderState=t,e._currentPassState=n,Ne.partialApply(e._gl,o,t,r,n,i)}var RY;typeof WebGLRenderingContext<\"u\"&&(RY=[ne.BACK]);function GY(e,t){if(t!==e._currentFramebuffer){e._currentFramebuffer=t;let n=RY;if(l(t))t._bind(),n=t._getActiveColorAttachments();else{let i=e._gl;i.bindFramebuffer(i.FRAMEBUFFER,null)}e.drawBuffers&&e.glDrawBuffers(n)}}var hGe=new ei;od.prototype.clear=function(e,t){e=g(e,hGe),t=g(t,this._defaultPassState);let n=this._gl,i=0,o=e.color,r=e.depth,s=e.stencil;l(o)&&(O.equals(this._clearColor,o)||(O.clone(o,this._clearColor),n.clearColor(o.red,o.green,o.blue,o.alpha)),i|=n.COLOR_BUFFER_BIT),l(r)&&(r!==this._clearDepth&&(this._clearDepth=r,n.clearDepth(r)),i|=n.DEPTH_BUFFER_BIT),l(s)&&(s!==this._clearStencil&&(this._clearStencil=s,n.clearStencil(s)),i|=n.STENCIL_BUFFER_BIT);let a=g(e.renderState,this._defaultRenderState);zee(this,a,t,!0);let c=g(e.framebuffer,t.framebuffer);GY(this,c),n.clear(i)};function fGe(e,t,n,i,o){GY(e,t),zee(e,o,n,!1),i._bind(),e._maxFrameTextureUnitIndex=Math.max(e._maxFrameTextureUnitIndex,i.maximumTextureUnitIndex)}function pGe(e,t,n,i){let o=t._primitiveType,r=t._vertexArray,s=t._offset,a=t._count,c=t.instanceCount;e._us.model=g(t._modelMatrix,M.IDENTITY),n._setUniforms(i,e._us,e.validateShaderProgram),r._bind();let d=r.indexBuffer;l(d)?(s=s*d.bytesPerIndex,l(a)?a=Math.min(a,d.numberOfIndices):a=d.numberOfIndices,c===0?e._gl.drawElements(o,a,d.indexDatatype,s):e.glDrawElementsInstanced(o,a,d.indexDatatype,s,c)):(l(a)?a=Math.min(a,r.numberOfVertices):a=r.numberOfVertices,c===0?e._gl.drawArrays(o,s,a):e.glDrawArraysInstanced(o,s,a,c)),r._unBind()}od.prototype.draw=function(e,t,n,i){t=g(t,this._defaultPassState);let o=g(e._framebuffer,t.framebuffer),r=g(e._renderState,this._defaultRenderState);n=g(n,e._shaderProgram),i=g(i,e._uniformMap),fGe(this,o,t,n,r),pGe(this,e,n,i)};od.prototype.endFrame=function(){let e=this._gl;e.useProgram(null),this._currentFramebuffer=void 0,e.bindFramebuffer(e.FRAMEBUFFER,null);let t=RY;this.drawBuffers&&this.glDrawBuffers(t);let n=this._maxFrameTextureUnitIndex;this._maxFrameTextureUnitIndex=0;for(let i=0;i<n;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null)};od.prototype.readPixels=function(e){let t=this._gl;e=g(e,g.EMPTY_OBJECT);let n=Math.max(g(e.x,0),0),i=Math.max(g(e.y,0),0),o=g(e.width,t.drawingBufferWidth),r=g(e.height,t.drawingBufferHeight),s=e.framebuffer,a=Qe.UNSIGNED_BYTE;l(s)&&s.numberOfColorAttachments>0&&(a=s.getColorTexture(0).pixelDatatype);let c=at.createTypedArray(at.RGBA,a,o,r);return GY(this,s),t.readPixels(n,i,o,r,at.RGBA,Qe.toWebGLConstant(a,this),c),c};var Hee={position:0,textureCoordinates:1};od.prototype.getViewportQuadVertexArray=function(){let e=this.cache.viewportQuad_vertexArray;if(!l(e)){let t=new ut({attributes:{position:new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:we.TRIANGLES});e=ti.fromGeometry({context:this,geometry:t,attributeLocations:Hee,bufferUsage:Me.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=e}return e};od.prototype.createViewportQuadCommand=function(e,t){return t=g(t,g.EMPTY_OBJECT),new je({vertexArray:this.getViewportQuadVertexArray(),primitiveType:we.TRIANGLES,renderState:t.renderState,shaderProgram:Ht.fromCache({context:this,vertexShaderSource:Og,fragmentShaderSource:e,attributeLocations:Hee}),uniformMap:t.uniformMap,owner:t.owner,framebuffer:t.framebuffer,pass:t.pass})};od.prototype.getObjectByPickColor=function(e){return this._pickObjects[e.toRgba()]};function EY(e,t,n){this._pickObjects=e,this.key=t,this.color=n}Object.defineProperties(EY.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(e){this._pickObjects[this.key]=e}}});EY.prototype.destroy=function(){delete this._pickObjects[this.key]};od.prototype.createPickId=function(e){++this._nextPickColor[0];let t=this._nextPickColor[0];if(t===0)throw new ue(\"Out of unique Pick IDs.\");return this._pickObjects[t]=e,new EY(this._pickObjects,t,O.fromRgba(t))};od.prototype.isDestroyed=function(){return!1};od.prototype.destroy=function(){let e=this.cache;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];l(n.destroy)&&n.destroy()}return this._shaderCache=this._shaderCache.destroy(),this._textureCache=this._textureCache.destroy(),this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy(),this._defaultEmissiveTexture=this._defaultEmissiveTexture&&this._defaultEmissiveTexture.destroy(),this._defaultNormalTexture=this._defaultNormalTexture&&this._defaultNormalTexture.destroy(),this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy(),me(this)};od._deprecationWarning=Is;var NG=od;var kNt=T(S(),1);var gNt=T(S(),1);function US(e){e=g(e,g.EMPTY_OBJECT);let t=e.context,n=e.width,i=e.height;this._width=n,this._height=i;let o=e.colorRenderbuffers,r=e.colorTextures;if(l(o)!==l(r))throw new fe(\"Both color renderbuffer and texture attachments must be provided.\");let s=e.depthStencilRenderbuffer,a=e.depthStencilTexture;if(l(s)!==l(a))throw new fe(\"Both depth-stencil renderbuffer and texture attachments must be provided.\");this._renderFramebuffer=new $s({context:t,colorRenderbuffers:o,depthStencilRenderbuffer:s,destroyAttachments:e.destroyAttachments}),this._colorFramebuffer=new $s({context:t,colorTextures:r,depthStencilTexture:a,destroyAttachments:e.destroyAttachments})}US.prototype.getRenderFramebuffer=function(){return this._renderFramebuffer};US.prototype.getColorFramebuffer=function(){return this._colorFramebuffer};US.prototype.blitFramebuffers=function(e,t){this._renderFramebuffer.bindRead(),this._colorFramebuffer.bindDraw();let n=e._gl,i=0;this._colorFramebuffer._colorTextures.length>0&&(i|=n.COLOR_BUFFER_BIT),l(this._colorFramebuffer.depthStencilTexture)&&(i|=n.DEPTH_BUFFER_BIT|(t?n.STENCIL_BUFFER_BIT:0)),n.blitFramebuffer(0,0,this._width,this._height,0,0,this._width,this._height,i,n.NEAREST),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null)};US.prototype.isDestroyed=function(){return!1};US.prototype.destroy=function(){return this._renderFramebuffer.destroy(),this._colorFramebuffer.destroy(),me(this)};var kG=US;var GNt=T(S(),1);var TNt=T(S(),1);var _l={RGBA4:ne.RGBA4,RGBA8:ne.RGBA8,RGBA16F:ne.RGBA16F,RGBA32F:ne.RGBA32F,RGB5_A1:ne.RGB5_A1,RGB565:ne.RGB565,DEPTH_COMPONENT16:ne.DEPTH_COMPONENT16,STENCIL_INDEX8:ne.STENCIL_INDEX8,DEPTH_STENCIL:ne.DEPTH_STENCIL,DEPTH24_STENCIL8:ne.DEPTH24_STENCIL8,validate:function(e){return e===_l.RGBA4||e===_l.RGBA8||e===_l.RGBA16F||e===_l.RGBA32F||e===_l.RGB5_A1||e===_l.RGB565||e===_l.DEPTH_COMPONENT16||e===_l.STENCIL_INDEX8||e===_l.DEPTH_STENCIL||e===_l.DEPTH24_STENCIL8},getColorFormat:function(e){return e===ne.FLOAT?_l.RGBA32F:e===ne.HALF_FLOAT_OES?_l.RGBA16F:_l.RGBA8}},Pc=Object.freeze(_l);function UG(e){e=g(e,g.EMPTY_OBJECT);let n=e.context._gl,i=Yt.maximumRenderbufferSize,o=g(e.format,Pc.RGBA4),r=l(e.width)?e.width:n.drawingBufferWidth,s=l(e.height)?e.height:n.drawingBufferHeight,a=g(e.numSamples,1);this._gl=n,this._format=o,this._width=r,this._height=s,this._renderbuffer=this._gl.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this._renderbuffer),a>1?n.renderbufferStorageMultisample(n.RENDERBUFFER,a,o,r,s):n.renderbufferStorage(n.RENDERBUFFER,o,r,s),n.bindRenderbuffer(n.RENDERBUFFER,null)}Object.defineProperties(UG.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}});UG.prototype._getRenderbuffer=function(){return this._renderbuffer};UG.prototype.isDestroyed=function(){return!1};UG.prototype.destroy=function(){return this._gl.deleteRenderbuffer(this._renderbuffer),me(this)};var rd=UG;function ms(e){e=g(e,g.EMPTY_OBJECT),this._numSamples=g(e.numSamples,1),this._colorAttachmentsLength=g(e.colorAttachmentsLength,1),this._color=g(e.color,!0),this._depth=g(e.depth,!1),this._depthStencil=g(e.depthStencil,!1),this._supportsDepthTexture=g(e.supportsDepthTexture,!1),this._createColorAttachments=g(e.createColorAttachments,!0),this._createDepthAttachments=g(e.createDepthAttachments,!0),this._pixelDatatype=e.pixelDatatype,this._pixelFormat=e.pixelFormat,this._width=void 0,this._height=void 0,this._framebuffer=void 0,this._multisampleFramebuffer=void 0,this._colorTextures=void 0,this._color&&(this._colorTextures=new Array(this._colorAttachmentsLength),this._colorRenderbuffers=new Array(this._colorAttachmentsLength)),this._colorRenderbuffer=void 0,this._depthStencilRenderbuffer=void 0,this._depthStencilTexture=void 0,this._depthRenderbuffer=void 0,this._depthTexture=void 0,this._attachmentsDirty=!1}Object.defineProperties(ms.prototype,{framebuffer:{get:function(){return this._numSamples>1?this._multisampleFramebuffer.getRenderFramebuffer():this._framebuffer}},numSamples:{get:function(){return this._numSamples}},status:{get:function(){return this.framebuffer.status}}});ms.prototype.isDirty=function(e,t,n,i,o){n=g(n,1);let r=this._width!==e||this._height!==t,s=this._numSamples!==n,a=l(i)&&this._pixelDatatype!==i||l(o)&&this._pixelFormat!==o,c=n===1?l(this._framebuffer):l(this._multisampleFramebuffer);return this._attachmentsDirty||r||s||a||!c||this._color&&!l(this._colorTextures[0])};ms.prototype.update=function(e,t,n,i,o,r){if(i=e.msaa?g(i,1):1,o=g(o,this._color?g(this._pixelDatatype,Qe.UNSIGNED_BYTE):void 0),r=g(r,this._color?g(this._pixelFormat,at.RGBA):void 0),this.isDirty(t,n,i,o,r)){if(this.destroy(),this._width=t,this._height=n,this._numSamples=i,this._pixelDatatype=o,this._pixelFormat=r,this._attachmentsDirty=!1,this._color&&this._createColorAttachments){for(let s=0;s<this._colorAttachmentsLength;++s)if(this._colorTextures[s]=new Ft({context:e,width:t,height:n,pixelFormat:r,pixelDatatype:o,sampler:mn.NEAREST}),this._numSamples>1){let a=Pc.getColorFormat(o);this._colorRenderbuffers[s]=new rd({context:e,width:t,height:n,format:a,numSamples:this._numSamples})}}this._depthStencil&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?(this._depthStencilTexture=new Ft({context:e,width:t,height:n,pixelFormat:at.DEPTH_STENCIL,pixelDatatype:Qe.UNSIGNED_INT_24_8,sampler:mn.NEAREST}),this._numSamples>1&&(this._depthStencilRenderbuffer=new rd({context:e,width:t,height:n,format:Pc.DEPTH24_STENCIL8,numSamples:this._numSamples}))):this._depthStencilRenderbuffer=new rd({context:e,width:t,height:n,format:Pc.DEPTH_STENCIL})),this._depth&&this._createDepthAttachments&&(this._supportsDepthTexture&&e.depthTexture?this._depthTexture=new Ft({context:e,width:t,height:n,pixelFormat:at.DEPTH_COMPONENT,pixelDatatype:Qe.UNSIGNED_INT,sampler:mn.NEAREST}):this._depthRenderbuffer=new rd({context:e,width:t,height:n,format:Pc.DEPTH_COMPONENT16})),this._numSamples>1?this._multisampleFramebuffer=new kG({context:e,width:this._width,height:this._height,colorTextures:this._colorTextures,colorRenderbuffers:this._colorRenderbuffers,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}):this._framebuffer=new $s({context:e,colorTextures:this._colorTextures,depthTexture:this._depthTexture,depthRenderbuffer:this._depthRenderbuffer,depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1})}};ms.prototype.getColorTexture=function(e){return e=g(e,0),this._colorTextures[e]};ms.prototype.setColorTexture=function(e,t){t=g(t,0),this._attachmentsDirty=e!==this._colorTextures[t],this._colorTextures[t]=e};ms.prototype.getColorRenderbuffer=function(e){return e=g(e,0),this._colorRenderbuffers[e]};ms.prototype.setColorRenderbuffer=function(e,t){t=g(t,0),this._attachmentsDirty=e!==this._colorRenderbuffers[t],this._colorRenderbuffers[t]=e};ms.prototype.getDepthRenderbuffer=function(){return this._depthRenderbuffer};ms.prototype.setDepthRenderbuffer=function(e){this._attachmentsDirty=e!==this._depthRenderbuffer,this._depthRenderbuffer=e};ms.prototype.getDepthTexture=function(){return this._depthTexture};ms.prototype.setDepthTexture=function(e){this._attachmentsDirty=e!==this._depthTexture,this._depthTexture=e};ms.prototype.getDepthStencilRenderbuffer=function(){return this._depthStencilRenderbuffer};ms.prototype.setDepthStencilRenderbuffer=function(e){this._attachmentsDirty=e!==this._depthStencilRenderbuffer,this._depthStencilRenderbuffer=e};ms.prototype.getDepthStencilTexture=function(){return this._depthStencilTexture};ms.prototype.setDepthStencilTexture=function(e){this._attachmentsDirty=e!==this._depthStencilTexture,this._depthStencilTexture=e};ms.prototype.prepareTextures=function(e,t){this._numSamples>1&&this._multisampleFramebuffer.blitFramebuffers(e,t)};ms.prototype.clear=function(e,t,n){let i=t.framebuffer;t.framebuffer=this.framebuffer,t.execute(e,n),t.framebuffer=i};ms.prototype.destroyFramebuffer=function(){this._framebuffer=this._framebuffer&&this._framebuffer.destroy(),this._multisampleFramebuffer=this._multisampleFramebuffer&&this._multisampleFramebuffer.destroy()};ms.prototype.destroy=function(){if(this._color){let e,t=this._colorTextures.length;for(e=0;e<t;++e){let n=this._colorTextures[e];this._createColorAttachments&&l(n)&&!n.isDestroyed()&&(this._colorTextures[e].destroy(),this._colorTextures[e]=void 0),l(n)&&n.isDestroyed()&&(this._colorTextures[e]=void 0);let i=this._colorRenderbuffers[e];this._createColorAttachments&&l(i)&&!i.isDestroyed()&&(this._colorRenderbuffers[e].destroy(),this._colorRenderbuffers[e]=void 0),l(i)&&i.isDestroyed()&&(this._colorRenderbuffers[e]=void 0)}}this._depthStencil&&(this._createDepthAttachments&&(this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()),l(this._depthStencilTexture)&&this._depthStencilTexture.isDestroyed()&&(this._depthStencilTexture=void 0),l(this._depthStencilRenderbuffer)&&this._depthStencilRenderbuffer.isDestroyed()&&(this._depthStencilRenderbuffer=void 0)),this._depth&&(this._createDepthAttachments&&(this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy()),l(this._depthTexture)&&this._depthTexture.isDestroyed()&&(this._depthTexture=void 0),l(this._depthRenderbuffer)&&this._depthRenderbuffer.isDestroyed()&&(this._depthRenderbuffer=void 0)),this.destroyFramebuffer()};var li=ms;var nkt=T(S(),1);var DNt=T(S(),1);var rx={VERTEX:0,FRAGMENT:1,BOTH:2};rx.includesVertexShader=function(e){return e===rx.VERTEX||e===rx.BOTH};rx.includesFragmentShader=function(e){return e===rx.FRAGMENT||e===rx.BOTH};var Ce=Object.freeze(rx);var YNt=T(S(),1);function XY(e){this.name=e,this.fields=[]}XY.prototype.addField=function(e,t){let n=` ${e} ${t};`;this.fields.push(n)};XY.prototype.generateGlslLines=function(){let e=this.fields;return e.length===0&&(e=[\" float _empty;\"]),[].concat(`struct ${this.name}`,\"{\",e,\"};\")};var DG=XY;var zNt=T(S(),1);function IY(e){this.signature=e,this.body=[]}IY.prototype.addLines=function(e){let t=this.body;if(Array.isArray(e)){let n=e.length;for(let i=0;i<n;i++)t.push(` ${e[i]}`)}else t.push(` ${e}`)};IY.prototype.generateGlslLines=function(){return[].concat(this.signature,\"{\",this.body,\"}\")};var BG=IY;function vc(){this._positionAttributeLine=void 0,this._nextAttributeLocation=1,this._attributeLocations={},this._attributeLines=[],this._structs={},this._functions={},this._vertexShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]},this._fragmentShaderParts={defineLines:[],uniformLines:[],shaderLines:[],varyingLines:[],structIds:[],functionIds:[]}}Object.defineProperties(vc.prototype,{attributeLocations:{get:function(){return this._attributeLocations}}});vc.prototype.addDefine=function(e,t,n){n=g(n,Ce.BOTH);let i=e;l(t)&&(i+=` ${t.toString()}`),Ce.includesVertexShader(n)&&this._vertexShaderParts.defineLines.push(i),Ce.includesFragmentShader(n)&&this._fragmentShaderParts.defineLines.push(i)};vc.prototype.addStruct=function(e,t,n){this._structs[e]=new DG(t),Ce.includesVertexShader(n)&&this._vertexShaderParts.structIds.push(e),Ce.includesFragmentShader(n)&&this._fragmentShaderParts.structIds.push(e)};vc.prototype.addStructField=function(e,t,n){this._structs[e].addField(t,n)};vc.prototype.addFunction=function(e,t,n){this._functions[e]=new BG(t),Ce.includesVertexShader(n)&&this._vertexShaderParts.functionIds.push(e),Ce.includesFragmentShader(n)&&this._fragmentShaderParts.functionIds.push(e)};vc.prototype.addFunctionLines=function(e,t){this._functions[e].addLines(t)};vc.prototype.addUniform=function(e,t,n){n=g(n,Ce.BOTH);let i=`uniform ${e} ${t};`;Ce.includesVertexShader(n)&&this._vertexShaderParts.uniformLines.push(i),Ce.includesFragmentShader(n)&&this._fragmentShaderParts.uniformLines.push(i)};vc.prototype.setPositionAttribute=function(e,t){return this._positionAttributeLine=`in ${e} ${t};`,this._attributeLocations[t]=0,0};vc.prototype.addAttribute=function(e,t){let n=`in ${e} ${t};`;this._attributeLines.push(n);let i=this._nextAttributeLocation;return this._attributeLocations[t]=i,this._nextAttributeLocation+=yGe(e),i};vc.prototype.addVarying=function(e,t){let n=`${e} ${t};`;this._vertexShaderParts.varyingLines.push(`out ${n}`),this._fragmentShaderParts.varyingLines.push(`in ${n}`)};vc.prototype.addVertexLines=function(e){let t=this._vertexShaderParts.shaderLines;Array.isArray(e)?t.push.apply(t,e):t.push(e)};vc.prototype.addFragmentLines=function(e){let t=this._fragmentShaderParts.shaderLines;Array.isArray(e)?t.push.apply(t,e):t.push(e)};vc.prototype.buildShaderProgram=function(e){let t=l(this._positionAttributeLine)?[this._positionAttributeLine]:[],n=bGe(this),i=gGe(this),o=t.concat(this._attributeLines,this._vertexShaderParts.uniformLines,this._vertexShaderParts.varyingLines,n.vertexLines,i.vertexLines,this._vertexShaderParts.shaderLines).join(` `),r=new Ue({defines:this._vertexShaderParts.defineLines,sources:[o]}),s=this._fragmentShaderParts.uniformLines.concat(this._fragmentShaderParts.varyingLines,n.fragmentLines,i.fragmentLines,this._fragmentShaderParts.shaderLines).join(` `),a=new Ue({defines:this._fragmentShaderParts.defineLines,sources:[s]});return Ht.fromCache({context:e,vertexShaderSource:r,fragmentShaderSource:a,attributeLocations:this._attributeLocations})};vc.prototype.clone=function(){return Oe(this,!0)};function bGe(e){let t=[],n=[],i,o=e._vertexShaderParts.structIds,r,s,a;for(i=0;i<o.length;i++)r=o[i],s=e._structs[r],a=s.generateGlslLines(),t.push.apply(t,a);for(o=e._fragmentShaderParts.structIds,i=0;i<o.length;i++)r=o[i],s=e._structs[r],a=s.generateGlslLines(),n.push.apply(n,a);return{vertexLines:t,fragmentLines:n}}function yGe(e){switch(e){case\"mat2\":return 2;case\"mat3\":return 3;case\"mat4\":return 4;default:return 1}}function gGe(e){let t=[],n=[],i,o=e._vertexShaderParts.functionIds,r,s,a;for(i=0;i<o.length;i++)r=o[i],s=e._functions[r],a=s.generateGlslLines(),t.push.apply(t,a);for(o=e._fragmentShaderParts.functionIds,i=0;i<o.length;i++)r=o[i],s=e._functions[r],a=s.generateGlslLines(),n.push.apply(n,a);return{vertexLines:t,fragmentLines:n}}var sx=vc;var mkt=T(S(),1);function vs(e,t,n,i){let o=vs._verifyAttributes(t);n=g(n,0);let r=[],s={},a,c,d=o.length;for(let m=0;m<d;++m){let p=o[m];if(p.vertexBuffer){r.push(p);continue}c=p.usage,a=s[c],l(a)||(a=s[c]=[]),a.push(p)}function u(m,p){return Q.getSizeInBytes(p.componentDatatype)-Q.getSizeInBytes(m.componentDatatype)}this._allBuffers=[];for(c in s)if(s.hasOwnProperty(c)){a=s[c],a.sort(u);let m=vs._vertexSizeInBytes(a),p=a[0].usage,b={vertexSizeInBytes:m,vertexBuffer:void 0,usage:p,needsCommit:!1,arrayBuffer:void 0,arrayViews:vs._createArrayViews(a,m)};this._allBuffers.push(b)}this._size=0,this._instanced=g(i,!1),this._precreated=r,this._context=e,this.writers=void 0,this.va=void 0,this.resize(n)}vs._verifyAttributes=function(e){let t=[];for(let i=0;i<e.length;++i){let o=e[i],r={index:g(o.index,i),enabled:g(o.enabled,!0),componentsPerAttribute:o.componentsPerAttribute,componentDatatype:g(o.componentDatatype,Q.FLOAT),normalize:g(o.normalize,!1),vertexBuffer:o.vertexBuffer,usage:g(o.usage,Me.STATIC_DRAW)};t.push(r)}let n=new Array(t.length);for(let i=0;i<t.length;++i){let r=t[i].index;n[r]=!0}return t};vs._vertexSizeInBytes=function(e){let t=0,n=e.length;for(let s=0;s<n;++s){let a=e[s];t+=a.componentsPerAttribute*Q.getSizeInBytes(a.componentDatatype)}let i=n>0?Q.getSizeInBytes(e[0].componentDatatype):0,o=i>0?t%i:0,r=o===0?0:i-o;return t+=r,t};vs._createArrayViews=function(e,t){let n=[],i=0,o=e.length;for(let r=0;r<o;++r){let"
}