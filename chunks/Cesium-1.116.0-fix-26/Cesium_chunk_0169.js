{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 169,
    "total_chunks": 194,
    "chunk_size": 48600,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.750Z"
  },
  "content": "h,ellipsoidUvToShapeUvLongitude:new D,ellipsoidUvToShapeUvLatitude:new D,ellipsoidRenderLatitudeSinMinMax:new D,ellipsoidInverseHeightDifferenceUv:0,clipMinMaxHeight:new D},this.shaderDefines={ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_EQUAL_ZERO:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_OVER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_EQUAL_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_OVER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_UNDER_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_EQUAL_HALF:void 0,ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_OVER_HALF:void 0,ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE:void 0,ELLIPSOID_INTERSECTION_INDEX_LONGITUDE:void 0,ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX:void 0,ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN:void 0,ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MAX:void 0,ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MIN:void 0},this.shaderMaximumIntersectionsLength=0}var s0t=new h,a0t=new h,c0t=new h,l0t=new h,d0t=new h,u0t=new h,m0t=new h,h0t=new h,f0t=new $,k_e=new h,U_e=new h,p0t=new le;lb.prototype.update=function(e,t,n,i,o){let{DefaultMinBounds:r,DefaultMaxBounds:s}=lb;i=g(i,r),o=g(o,s);let a=P.EPSILON10,c=P.EPSILON3,d=P.EPSILON10,u=P.EPSILON10,m=P.EPSILON3,p=M.getScale(e,h0t),b=h.clone(r,s0t);b.z=-h.minimumComponent(p);let f=h.clamp(t,b,s,a0t),x=h.clamp(n,b,s,c0t),_=h.clamp(i,b,s,l0t),C=h.clamp(o,b,s,d0t),V=h.maximumByComponent(f,_,u0t),L=h.minimumByComponent(x,C,m0t),R=h.add(p,h.fromElements(x.z,x.z,x.z,k_e),k_e),G=h.maximumComponent(R),X=h.add(p,h.fromElements(L.z,L.z,L.z,U_e),U_e);if(V.y>L.y||V.y===s.y||L.y===r.y||V.z>L.z||P.equalsEpsilon(X,h.ZERO,void 0,a))return!1;this._rectangle=le.fromRadians(f.x,f.y,x.x,x.y),this._translation=M.getTranslation(e,this._translation),this._rotation=M.getRotation(e,this._rotation),this._ellipsoid=oe.fromCartesian3(p,this._ellipsoid),this._minimumHeight=f.z,this._maximumHeight=x.z;let v=le.fromRadians(V.x,V.y,L.x,L.y,p0t);this.orientedBoundingBox=i8(v,V.z,L.z,this._ellipsoid,this._translation,this._rotation,this.orientedBoundingBox),this.shapeTransform=M.fromRotationTranslation($.setScale(this._rotation,R,f0t),this._translation,this.shapeTransform),this.boundTransform=M.fromRotationTranslation(this.orientedBoundingBox.halfAxes,this.orientedBoundingBox.center,this.boundTransform),this.boundingSphere=ce.fromOrientedBoundingBox(this.orientedBoundingBox,this.boundingSphere);let W=s.x-r.x,F=.5*W,A=L.x<V.x,y=L.x-V.x+A*W,Z=y<=d,E=y>=F-d&&y<W-d,I=y>d&&y<F-d,w=Z||E||I,k=x.x<f.x,B=x.x-f.x+k*W,U=B>F+d&&B<W-d,Y=B>=F-d&&B<=F+d,N=B<F-d,J=U||Y||N,z=L.y<-m,ee=L.y>=-m&&L.y<=+m,H=L.y>+m&&L.y<s.y-u,j=z||ee||H,q=V.y>r.y+u&&V.y<-m,pe=V.y>=-m&&V.y<=+m,_e=V.y>+m,ae=q||pe||_e,ye=j||ae,Te=x.y-f.y,Le=x.y<-m,Re=x.y>=-m&&x.y<=+m,ke=x.y>+m&&x.y<s.y-u,rt=Le||Re||ke,yt=f.y>r.y+u&&f.y<-m,Dt=f.y>=-m&&f.y<=+m,it=f.y>+m,ft=rt||(yt||Dt||it),{shaderUniforms:Ke,shaderDefines:ct}=this;for(let Pi in ct)ct.hasOwnProperty(Pi)&&(ct[Pi]=void 0);Ke.ellipsoidRadiiUv=h.divideByScalar(R,G,Ke.ellipsoidRadiiUv);let{x:Jt,z:be}=Ke.ellipsoidRadiiUv,Ve=be/Jt;Ke.eccentricitySquared=1-Ve*Ve,Ke.evoluteScale=D.fromElements((Jt*Jt-be*be)/Jt,(be*be-Jt*Jt)/be,Ke.evoluteScale),Ke.ellipsoidInverseRadiiSquaredUv=h.divideComponents(h.ONE,h.multiplyComponents(Ke.ellipsoidRadiiUv,Ke.ellipsoidRadiiUv,Ke.ellipsoidInverseRadiiSquaredUv),Ke.ellipsoidInverseRadiiSquaredUv);let Bt=0;ct.ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MAX=Bt,Bt+=1,ct.ELLIPSOID_INTERSECTION_INDEX_HEIGHT_MIN=Bt,Bt+=1,Ke.clipMinMaxHeight=D.fromElements((V.z-x.z)/G,(L.z-x.z)/G,Ke.clipMinMaxHeight);let mt=(x.z-f.z)/G;if(Ke.ellipsoidInverseHeightDifferenceUv=1/mt,f.z===x.z&&(Ke.ellipsoidInverseHeightDifferenceUv=0),w&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE=!0,ct.ELLIPSOID_INTERSECTION_INDEX_LONGITUDE=Bt,E?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_UNDER_HALF=!0,Bt+=1):I?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_OVER_HALF=!0,Bt+=2):Z&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_RANGE_EQUAL_ZERO=!0,Bt+=2),Ke.ellipsoidRenderLongitudeMinMax=D.fromElements(V.x,L.x,Ke.ellipsoidRenderLongitudeMinMax)),J)if(ct.ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE=!0,x.x<f.x&&(ct.ELLIPSOID_HAS_SHAPE_BOUNDS_LONGITUDE_MIN_MAX_REVERSED=!0),B<=d)Ke.ellipsoidUvToShapeUvLongitude=D.fromElements(0,1,Ke.ellipsoidUvToShapeUvLongitude);else{let Co=W/B,Es=-(f.x-r.x)/B;Ke.ellipsoidUvToShapeUvLongitude=D.fromElements(Co,Es,Ke.ellipsoidUvToShapeUvLongitude)}if(w){let Pi=P.equalsEpsilon(V.x,r.x,void 0,c),Co=P.equalsEpsilon(L.x,s.x,void 0,c);Pi&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MIN_DISCONTINUITY=!0),Co&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LONGITUDE_MAX_DISCONTINUITY=!0);let Es=(f.x-r.x)/W,$r=(x.x-r.x)/W,Nr=(L.x-r.x)/W,Qs=1-y/W,De=(Nr+.5*Qs)%1;Ke.ellipsoidShapeUvLongitudeMinMaxMid=h.fromElements(Es,$r,De,Ke.ellipsoidShapeUvLongitudeMinMaxMid)}if(ye&&(ae&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN=!0,ct.ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MIN=Bt,q?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_UNDER_HALF=!0,Bt+=1):pe?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_EQUAL_HALF=!0,Bt+=1):_e&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MIN_OVER_HALF=!0,Bt+=2)),j&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX=!0,ct.ELLIPSOID_INTERSECTION_INDEX_LATITUDE_MAX=Bt,z?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_UNDER_HALF=!0,Bt+=2):ee?(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_EQUAL_HALF=!0,Bt+=1):H&&(ct.ELLIPSOID_HAS_RENDER_BOUNDS_LATITUDE_MAX_OVER_HALF=!0,Bt+=1)),Ke.ellipsoidRenderLatitudeSinMinMax=D.fromElements(Math.sin(V.y),Math.sin(L.y),Ke.ellipsoidRenderLatitudeSinMinMax)),ft)if(ct.ELLIPSOID_HAS_SHAPE_BOUNDS_LATITUDE=!0,Te<u)Ke.ellipsoidUvToShapeUvLatitude=D.fromElements(0,1,Ke.ellipsoidUvToShapeUvLatitude);else{let Co=(s.y-r.y)/Te,Es=(r.y-f.y)/Te;Ke.ellipsoidUvToShapeUvLatitude=D.fromElements(Co,Es,Ke.ellipsoidUvToShapeUvLatitude)}return this.shaderMaximumIntersectionsLength=Bt,!0};var Y_e=new le;lb.prototype.computeOrientedBoundingBoxForTile=function(e,t,n,i,o){let r=1/Math.pow(2,e),s=t*r,a=(t+1)*r,c=n*r,d=(n+1)*r,u=i*r,m=(i+1)*r,p=le.subsection(this._rectangle,s,c,a,d,Y_e),b=P.lerp(this._minimumHeight,this._maximumHeight,u),f=P.lerp(this._minimumHeight,this._maximumHeight,m);return i8(p,b,f,this._ellipsoid,this._translation,this._rotation,o)};var D_e=new h,B_e=new h,b0t=new h;lb.prototype.computeOrientedBoundingBoxForSample=function(e,t,n,i){let o=1/Math.pow(2,e.level),r=h.divideComponents(h.ONE,t,D_e),s=h.multiplyByScalar(r,o,D_e),a=h.multiplyByScalar(h.fromElements(e.x+n.x,e.y+n.y,e.z+n.z,B_e),o,B_e),c=h.add(a,s,b0t),d=le.subsection(this._rectangle,a.x,a.y,c.x,c.y,Y_e),u=P.lerp(this._minimumHeight,this._maximumHeight,a.z),m=P.lerp(this._minimumHeight,this._maximumHeight,c.z);return i8(d,u,m,this._ellipsoid,this._translation,this._rotation,i)};function i8(e,t,n,i,o,r,s){return s=Zn.fromRectangle(e,t,n,i,s),s.center=h.add(s.center,o,s.center),s.halfAxes=$.multiply(s.halfAxes,r,s.halfAxes),s}lb.DefaultMinBounds=Object.freeze(new h(-P.PI,-P.PI_OVER_TWO,-oe.WGS84.minimumRadius));lb.DefaultMaxBounds=Object.freeze(new h(P.PI,P.PI_OVER_TWO,10*oe.WGS84.maximumRadius));var UT=lb;var Kd={BOX:\"BOX\",ELLIPSOID:\"ELLIPSOID\",CYLINDER:\"CYLINDER\"};Kd.getMinBounds=function(e){switch(e){case Kd.BOX:return qf.DefaultMinBounds;case Kd.ELLIPSOID:return UT.DefaultMinBounds;case Kd.CYLINDER:return $f.DefaultMinBounds}};Kd.getMaxBounds=function(e){switch(e){case Kd.BOX:return qf.DefaultMaxBounds;case Kd.ELLIPSOID:return UT.DefaultMaxBounds;case Kd.CYLINDER:return $f.DefaultMaxBounds}};Kd.getShapeConstructor=function(e){switch(e){case Kd.BOX:return qf;case Kd.ELLIPSOID:return UT;case Kd.CYLINDER:return $f}};var Ii=Object.freeze(Kd);var aNi=T(S(),1);var d5i=T(S(),1);function Eh(e){this._comparator=e.comparator,this._maximumLength=e.maximumLength,this._array=l(e.maximumLength)?new Array(e.maximumLength):[],this._length=0}Object.defineProperties(Eh.prototype,{length:{get:function(){return this._length}},maximumLength:{get:function(){return this._maximumLength},set:function(e){if(l(e)){for(;this._length>e;)this.removeMinimum();this._array.length=e}this._maximumLength=e}},internalArray:{get:function(){return this._array}},comparator:{get:function(){return this._comparator}}});Eh.prototype.clone=function(){let e=this._maximumLength,t=this._comparator,n=this._array,i=this._length,o=new Eh({comparator:t,maximumLength:e});o._length=i;for(let r=0;r<i;r++)o._array[r]=n[r];return o};Eh.prototype.reset=function(){this._length=0;let e=this._maximumLength;if(l(e))for(let t=0;t<e;t++)this._array[t]=void 0;else this._array.length=0};Eh.prototype.resort=function(){let e=this._length;for(let t=0;t<e;t++)O_e(this,t)};Eh.prototype.insert=function(e){let t,n=this._maximumLength;if(l(n)){if(n===0)return;if(this._length===n){let o=this._array[0];if(this._comparator(e,o)<=0)return e;t=this.removeMinimum()}}let i=this._length;return this._array[i]=e,this._length++,O_e(this,i),t};Eh.prototype.removeMinimum=function(){let e=this._length;if(e===0)return;this._length--;let t=this._array[0];return e>=2&&(this._array[0]=this._array[e-1],z_e(this,0)),this._array[e-1]=void 0,t};Eh.prototype.removeMaximum=function(){let e=this._length;if(e===0)return;this._length--;let t;if(e<=2)t=this._array[e-1];else{let n=o8(this,1,2)?1:2;t=this._array[n],this._array[n]=this._array[e-1],e>=4&&z_e(this,n)}return this._array[e-1]=void 0,t};Eh.prototype.getMinimum=function(){if(this._length!==0)return this._array[0]};Eh.prototype.getMaximum=function(){let e=this._length;if(e!==0)return e<=2?this._array[e-1]:this._array[o8(this,1,2)?1:2]};function h3(e,t,n){let i=e._array,o=i[t];i[t]=i[n],i[n]=o}function c9(e,t,n){return e._comparator(e._array[t],e._array[n])<0}function o8(e,t,n){return e._comparator(e._array[t],e._array[n])>0}function O_e(e,t){if(t===0)return;let n=Math.floor(P.log2(t+1))%2===0,i=Math.floor((t-1)/2),o=c9(e,t,i);for(o!==n&&(h3(e,t,i),t=i);t>=3;){let r=Math.floor((t-3)/4);if(c9(e,t,r)!==o)break;h3(e,t,r),t=r}}function z_e(e,t){let n=e._length,i=Math.floor(P.log2(t+1))%2===0,o;for(;(o=2*t+1)<n;){let r=o,s=o+1;if(s<n){c9(e,s,r)===i&&(r=s);let a=2*o+1,c=Math.max(Math.min(n-a,4),0);for(let d=0;d<c;d++){let u=a+d;c9(e,u,r)===i&&(r=u)}}if(c9(e,r,t)===i&&(h3(e,r,t),r!==o&&r!==s)){let a=Math.floor((r-1)/2);o8(e,r,a)===i&&h3(e,r,a)}t=r}}var DT=Eh;var m5i=T(S(),1),H_e=Object.freeze({UNLOADED:0,RECEIVING:1,RECEIVED:2,LOADED:3,FAILED:4,UNAVAILABLE:5});function f3(e,t){this.spatialNode=e,this.keyframe=t,this.state=H_e.UNLOADED,this.metadata=[],this.megatextureIndex=-1,this.priority=-Number.MAX_VALUE,this.highPriorityFrameNumber=-1}f3.priorityComparator=function(e,t){return e.priority-t.priority};f3.searchComparator=function(e,t){return e.keyframe-t.keyframe};f3.LoadState=H_e;var ji=f3;var W5i=T(S(),1);function Lg(e,t,n,i,o){i===sn.UNSIGNED_SHORT&&(i=sn.FLOAT32);let r=e.floatingPointTexture;if(i===sn.FLOAT32&&!r)throw new ue(\"Floating point texture not supported\");let s;i===sn.FLOAT32||i===sn.FLOAT64?s=Qe.FLOAT:i===sn.UINT8&&(s=Qe.UNSIGNED_BYTE);let a;n===1?a=e.webgl2?at.RED:at.LUMINANCE:n===2?a=e.webgl2?at.RG:at.LUMINANCE_ALPHA:n===3?a=at.RGB:n===4&&(a=at.RGBA);let c=512*1024*1024,d=128*1024*1024;o=Math.min(g(o,d),c);let u=Yt.maximumTextureSize,m=sn.getSizeInBytes(i),p=Math.floor(o/(n*m)),b=Math.min(u,P.previousPowerOfTwo(Math.floor(Math.sqrt(p)))),f=Math.ceil(Math.sqrt(t.x)),x=Math.ceil(t.z/f),_=f*t.x,C=x*t.y,V=Math.floor(b/_),L=Math.floor(b/C);if(V===0||L===0)throw new ue(\"Tileset is too large to fit into megatexture\");this.channelCount=n,this.componentType=i,this.voxelCountPerTile=h.clone(t,new h),this.maximumTileCount=V*L,this.regionCountPerMegatexture=new D(V,L),this.voxelCountPerRegion=new D(_,C),this.sliceCountPerRegion=new D(f,x),this.voxelSizeUv=new D(1/b,1/b),this.sliceSizeUv=new D(t.x/b,t.y/b),this.regionSizeUv=new D(_/b,C/b),this.texture=new Ft({context:e,pixelFormat:a,pixelDatatype:s,flipY:!1,width:b,height:b,sampler:new mn({wrapS:En.CLAMP_TO_EDGE,wrapT:En.CLAMP_TO_EDGE,minificationFilter:dn.LINEAR,magnificationFilter:yi.LINEAR})});let R=sn.toComponentDatatype(i);this.tileVoxelDataTemp=Q.createTypedArray(R,_*C*n),this.nodes=new Array(this.maximumTileCount);for(let G=0;G<this.maximumTileCount;G++)this.nodes[G]=new y0t(G);for(let G=0;G<this.maximumTileCount;G++){let X=this.nodes[G];X.previousNode=G>0?this.nodes[G-1]:void 0,X.nextNode=G<this.maximumTileCount-1?this.nodes[G+1]:void 0}this.occupiedList=void 0,this.emptyList=this.nodes[0],this.occupiedCount=0}function y0t(e){this.index=e,this.nextNode=void 0,this.previousNode=void 0}Lg.prototype.add=function(e){if(this.isFull())throw new fe(\"Trying to add when there are no empty spots\");let t=this.emptyList;this.emptyList=this.emptyList.nextNode,l(this.emptyList)&&(this.emptyList.previousNode=void 0),t.nextNode=this.occupiedList,l(t.nextNode)&&(t.nextNode.previousNode=t),this.occupiedList=t;let n=t.index;return this.writeDataToTexture(n,e),this.occupiedCount++,n};Lg.prototype.remove=function(e){if(e<0||e>=this.maximumTileCount)throw new fe(\"Megatexture index out of bounds\");let t=this.nodes[e];l(t.previousNode)&&(t.previousNode.nextNode=t.nextNode),l(t.nextNode)&&(t.nextNode.previousNode=t.previousNode),t.nextNode=this.emptyList,l(t.nextNode)&&(t.nextNode.previousNode=t),t.previousNode=void 0,this.emptyList=t,this.occupiedCount--};Lg.prototype.isFull=function(){return this.emptyList===void 0};Lg.getApproximateTextureMemoryByteLength=function(e,t,n,i){i===sn.UNSIGNED_SHORT&&(i=sn.FLOAT32);let o=sn.getSizeInBytes(i),r=e*t.x*t.y*t.z,s=Math.ceil(Math.sqrt(t.x)),a=Math.ceil(t.z/s),c=s*t.x,d=a*t.y,u=P.previousPowerOfTwo(Math.floor(Math.sqrt(r)));for(;;){let p=Math.floor(u/c),b=Math.floor(u/d);if(p*b>=e)break;u*=2}return u*u*n*o};Lg.prototype.writeDataToTexture=function(e,t){let n=t.constructor===Uint16Array?new Float32Array(t):t,i=this.voxelCountPerTile,o=this.sliceCountPerRegion,r=this.voxelCountPerRegion,s=this.channelCount,a=this.tileVoxelDataTemp;for(let x=0;x<i.z;x++){let _=x%o.x*i.x,C=Math.floor(x/o.x)*i.y;for(let V=0;V<i.y;V++)for(let L=0;L<i.x;L++){let R=x*i.y*i.x+V*i.x+L,G=(C+V)*r.x+(_+L);for(let X=0;X<s;X++)a[G*s+X]=n[R*s+X]}}let c=this.regionCountPerMegatexture,d=r.x,u=r.y,m=e%c.x*r.x,p=Math.floor(e/c.x)*r.y,f={source:{arrayBufferView:a,width:d,height:u},xOffset:m,yOffset:p};this.texture.copyFrom(f)};Lg.prototype.isDestroyed=function(){return!1};Lg.prototype.destroy=function(){return this.texture=this.texture&&this.texture.destroy(),me(this)};var QV=Lg;var D5i=T(S(),1);function rm(e,t,n,i,o,r,s){this.children=void 0,this.parent=o,this.level=e,this.x=t,this.y=n,this.z=i,this.dimensions=h.clone(s),this.keyframeNodes=[],this.renderableKeyframeNodes=[],this.renderableKeyframeNodeLerp=0,this.renderableKeyframeNodePrevious=void 0,this.renderableKeyframeNodeNext=void 0,this.orientedBoundingBox=new Zn,this.approximateVoxelSize=0,this.screenSpaceError=0,this.visitedFrameNumber=-1,this.computeBoundingVolumes(r)}var g0t=new h;rm.prototype.computeBoundingVolumes=function(e){this.orientedBoundingBox=e.computeOrientedBoundingBoxForTile(this.level,this.x,this.y,this.z,this.orientedBoundingBox);let t=$.getScale(this.orientedBoundingBox.halfAxes,g0t),n=2*h.maximumComponent(t);this.approximateVoxelSize=n/h.minimumComponent(this.dimensions)};rm.prototype.constructChildNodes=function(e){let{level:t,x:n,y:i,z:o}=this,r=n*2,s=i*2,a=o*2,c=s+1,d=r+1,u=a+1,m=t+1,p=[[m,r,s,a],[m,d,s,a],[m,r,c,a],[m,d,c,a],[m,r,s,u],[m,d,s,u],[m,r,c,u],[m,d,c,u]];this.children=p.map(([b,f,x,_])=>new rm(b,f,x,_,this,e,this.dimensions))};rm.prototype.visibility=function(e,t){let n=this.orientedBoundingBox;return e.cullingVolume.computeVisibilityWithPlaneMask(n,t)};rm.prototype.computeScreenSpaceError=function(e,t){let n=this.orientedBoundingBox,i=Math.sqrt(n.distanceSquaredTo(e));i=Math.max(i,P.EPSILON7);let o=this.approximateVoxelSize,r=t*(o/i);this.screenSpaceError=r};var K_e={keyframe:0};function l9(e,t){return K_e.keyframe=e,Lo(t,K_e,ji.searchComparator)}rm.prototype.computeSurroundingRenderableKeyframeNodes=function(e){let t=this,n=t.level,i=Math.floor(e),o=Math.ceil(e),r,s,a=+Number.MAX_VALUE,c=+Number.MAX_VALUE;for(;l(t);){let{renderableKeyframeNodes:m}=t;if(m.length>=1){let p=x0t(i,m),b=m[p],f=o===i||i<b.keyframe?p:Math.min(p+1,m.length-1),x=m[f],_=i-b.keyframe,C=J_e(n-t.level,_);C<a&&(a=C,r=b);let V=x.keyframe-o,L=J_e(n-t.level,V);if(L<c&&(c=L,s=x),_===0&&V===0)break}t=t.parent}if(this.renderableKeyframeNodePrevious=r,this.renderableKeyframeNodeNext=s,!l(r)||!l(s))return;let d=r.keyframe,u=s.keyframe;this.renderableKeyframeNodeLerp=d===u?0:P.clamp((e-d)/(u-d),0,1)};function x0t(e,t){let n=l9(e,t);return n<0?P.clamp(~n-1,0,t.length-1):n}function J_e(e,t){let n=Math.exp(e*4),i=t>=0?1:-200;return e*n+t*i}rm.prototype.isVisited=function(e){return this.visitedFrameNumber===e};rm.prototype.createKeyframeNode=function(e){let t=l9(e,this.keyframeNodes);if(t<0){t=~t;let n=new ji(this,e);this.keyframeNodes.splice(t,0,n)}};rm.prototype.destroyKeyframeNode=function(e,t){let n=e.keyframe,i=l9(n,this.keyframeNodes);if(i<0)throw new fe(\"Keyframe node does not exist.\");if(this.keyframeNodes.splice(i,1),e.megatextureIndex!==-1){for(let r=0;r<t.length;r++)t[r].remove(e.megatextureIndex);let o=l9(n,this.renderableKeyframeNodes);if(o<0)throw new fe(\"Renderable keyframe node does not exist.\");this.renderableKeyframeNodes.splice(o,1)}e.spatialNode=void 0,e.state=ji.LoadState.UNLOADED,e.metadata={},e.megatextureIndex=-1,e.priority=-Number.MAX_VALUE,e.highPriorityFrameNumber=-1};rm.prototype.addKeyframeNodeToMegatextures=function(e,t){if(e.state!==ji.LoadState.RECEIVED||e.megatextureIndex!==-1||e.metadata.length!==t.length)throw new fe(\"Keyframe node cannot be added to megatexture\");for(let o=0;o<t.length;o++){let r=t[o];e.megatextureIndex=r.add(e.metadata[o])}e.state=ji.LoadState.LOADED;let n=this.renderableKeyframeNodes,i=l9(e.keyframe,n);if(i>=0)throw new fe(\"Keyframe already renderable\");i=~i,n.splice(i,0,e)};rm.prototype.isRenderable=function(e){let t=this.renderableKeyframeNodePrevious,n=this.renderableKeyframeNodeNext,i=this.level;return l(t)&&l(n)&&(t.spatialNode.level===i||n.spatialNode.level===i)&&this.visitedFrameNumber===e};var d9=rm;function db(e,t,n,i,o,r,s){this._primitive=e,this.megatextures=new Array(i.length);for(let f=0;f<i.length;f++){let x=i[f],_=Kt.getComponentCount(x),C=o[f];this.megatextures[f]=new QV(t,n,_,C,s)}let a=this.megatextures[0].maximumTileCount;this._simultaneousRequestCount=0,this._debugPrint=!1,this._frameNumber=0;let c=e._shape;this.rootNode=new d9(0,0,0,0,void 0,c,n),this._priorityQueue=new DT({maximumLength:a,comparator:ji.priorityComparator}),this._highPriorityKeyframeNodes=new Array(a),this._keyframeNodesInMegatexture=new Array(a),this._keyframeCount=r,this._sampleCount=void 0,this._keyframeLocation=0,this._binaryTreeKeyframeWeighting=new Array(r);let d=this._binaryTreeKeyframeWeighting;d[0]=0,d[r-1]=0,r8(d,1,r-2,0);let u=9,m=2048,p=Math.floor(m/u),b=Math.ceil(a/p);this.internalNodeTexture=new Ft({context:t,pixelFormat:at.RGBA,pixelDatatype:Qe.UNSIGNED_BYTE,flipY:!1,width:m,height:b,sampler:new mn({minificationFilter:dn.NEAREST,magnificationFilter:yi.NEAREST})}),this.internalNodeTilesPerRow=p,this.internalNodeTexelSizeUv=new D(1/m,1/b),this.leafNodeTexture=void 0,this.leafNodeTilesPerRow=void 0,this.leafNodeTexelSizeUv=new D}db.prototype.findKeyframeNode=function(e){return this._keyframeNodesInMegatexture.find(function(t){return t.megatextureIndex===e})};function r8(e,t,n,i){if(t>n)return;let o=Math.floor((t+n)/2);e[o]=i,r8(e,t,o-1,i+1),r8(e,o+1,n,i+1)}db.simultaneousRequestCountMaximum=50;db.prototype.update=function(e,t,n,i){let o=this._primitive,r=e.context,s=this.megatextures[0].maximumTileCount,a=this._keyframeCount,c=o._levelBlendFactor,d=c>0,u=a>1,m=(d?2:1)*(u?2:1);this._sampleCount=m;let p=m>=2;if(p&&!l(this.leafNodeTexture)){let V=Math.floor(512),L=Math.ceil(s/V);this.leafNodeTexture=new Ft({context:r,pixelFormat:at.RGBA,pixelDatatype:Qe.UNSIGNED_BYTE,flipY:!1,width:1024,height:L,sampler:new mn({minificationFilter:dn.NEAREST,magnificationFilter:yi.NEAREST})}),this.leafNodeTexelSizeUv=D.fromElements(1/1024,1/L,this.leafNodeTexelSizeUv),this.leafNodeTilesPerRow=V}else!p&&l(this.leafNodeTexture)&&(this.leafNodeTexture=this.leafNodeTexture.destroy());if(this._keyframeLocation=P.clamp(t,0,a-1),n&&Q_e(this,this.rootNode),i)return;this._frameNumber=e.frameNumber;let b=fi();S0t(this,e);let f=fi();L0t(this,m,c);let x=fi();if(this._debugPrint){let _=f-b,C=x-f,V=x-b;V0t(this,_,C,V)}};db.prototype.isRenderable=function(e){return e.isRenderable(this._frameNumber)};db.prototype.isDestroyed=function(){return!1};db.prototype.destroy=function(){let e=this.megatextures,t=e.length;for(let n=0;n<t;n++)e[n]=e[n]&&e[n].destroy();return this.internalNodeTexture=this.internalNodeTexture&&this.internalNodeTexture.destroy(),this.leafNodeTexture=this.leafNodeTexture&&this.leafNodeTexture.destroy(),me(this)};function Q_e(e,t){if(t.computeBoundingVolumes(e._primitive._shape),l(t.children))for(let n=0;n<8;n++){let i=t.children[n];Q_e(e,i)}}function _0t(e,t){if(e._simultaneousRequestCount>=db.simultaneousRequestCountMaximum)return;let n=e._primitive._provider;function i(c){e._simultaneousRequestCount--;let d=n.types.length;if(!l(c))t.state=ji.LoadState.UNAVAILABLE;else if(c===ji.LoadState.FAILED)t.state=ji.LoadState.FAILED;else if(!Array.isArray(c)||c.length!==d)t.state=ji.LoadState.FAILED;else{let u=e.megatextures;for(let m=0;m<d;m++){let{voxelCountPerTile:p,channelCount:b}=u[m],{x:f,y:x,z:_}=p,C=f*x*_,V=c[m],L=C*b;if(V.length===L)t.metadata[m]=V,t.state=ji.LoadState.RECEIVED;else{t.state=ji.LoadState.FAILED;break}}}}function o(){e._simultaneousRequestCount--,t.state=ji.LoadState.FAILED}let{keyframe:r,spatialNode:s}=t,a=n.requestData({tileLevel:s.level,tileX:s.x,tileY:s.y,tileZ:s.z,keyframe:r});l(a)?(e._simultaneousRequestCount++,t.state=ji.LoadState.RECEIVING,a.then(i).catch(o)):t.state=ji.LoadState.FAILED}function T0t(e){return e/(1+e)}function S0t(e,t){let n=e._frameNumber,i=e._primitive,o=i._shape,r=i.screenSpaceError,s=e._priorityQueue,a=e._keyframeCount,c=P.clamp(Math.floor(e._keyframeLocation),0,a-2),d=c+1,{camera:u,context:m,pixelRatio:p}=t,{positionWC:b,frustum:f}=u,_=m.drawingBufferHeight/p/f.sseDenominator;function C(A,y){if(A.computeScreenSpaceError(b,_),y=A.visibility(t,y),y===os.MASK_OUTSIDE)return;if(A.visitedFrameNumber=n,a===1)A.createKeyframeNode(0);else if(A.keyframeNodes.length!==a)for(let k=0;k<a;k++)A.createKeyframeNode(k);let{screenSpaceError:Z,keyframeNodes:E}=A,I=T0t(Z),w=!1;for(let k=0;k<E.length;k++){let B=E[k];B.priority=10*I+C0t(c,B.keyframe,d,e),B.state!==ji.LoadState.UNAVAILABLE&&B.state!==ji.LoadState.FAILED&&B.priority!==-Number.MAX_VALUE&&s.insert(B),B.state===ji.LoadState.LOADED&&(w=!0)}if(Z<r||!w){A.children=void 0;return}l(A.children)||A.constructChildNodes(o);for(let k=0;k<8;k++){let B=A.children[k];C(B,y)}}s.reset(),C(e.rootNode,os.MASK_INDETERMINATE);let V=e._highPriorityKeyframeNodes,L=0,R;for(;s.length>0;)R=s.removeMaximum(),R.highPriorityFrameNumber=n,V[L]=R,L++;let G=e._keyframeNodesInMegatexture,X=e.megatextures[0],v=X.occupiedCount;G.length=v,G.sort(function(A,y){return A.highPriorityFrameNumber===y.highPriorityFrameNumber?y.priority-A.priority:y.highPriorityFrameNumber-A.highPriorityFrameNumber});let W=0,F=0;for(let A=0;A<L;A++)if(R=V[A],!(R.state===ji.LoadState.LOADED||R.spatialNode===void 0)&&(R.state===ji.LoadState.UNLOADED&&_0t(e,R),R.state===ji.LoadState.RECEIVED)){let y=0;if(X.isFull()){y=v-1-W,W++;let Z=G[y];Z.spatialNode.destroyKeyframeNode(Z,e.megatextures)}else y=v+F,F++;R.spatialNode.addKeyframeNodeToMegatextures(R,e.megatextures),G[y]=R}}function C0t(e,t,n,i){let o=Math.min(Math.abs(t-e),Math.abs(t-n)),r=Math.max(e,i._keyframeCount-n-1,1),s=Math.pow(1-o/r,4),a=Math.exp(-i._binaryTreeKeyframeWeighting[t]);return P.lerp(a,s,.15+.85*s)}function V0t(e,t,n,i){let o=e._keyframeCount,r=e.rootNode,s=Object.keys(ji.LoadState).length,a=new Array(s),c=new Array(s),d=0;for(let C=0;C<s;C++){let V=new Array(o);a[C]=V;for(let L=0;L<o;L++)V[L]=0;c[C]=0}function u(C){let V=C.keyframeNodes;for(let L=0;L<V.length;L++){let R=V[L],G=R.keyframe,X=R.state;a[X][G]+=1,c[X]+=1,d++}if(l(C.children))for(let L=0;L<8;L++){let R=C.children[L];u(R)}}u(r);let m=`KEYFRAMES: ${a[ji.LoadState.LOADED]}`,p=`UNLOADED: ${c[ji.LoadState.UNLOADED]} | RECEIVING: ${c[ji.LoadState.RECEIVING]} | RECEIVED: ${c[ji.LoadState.RECEIVED]} | LOADED: ${c[ji.LoadState.LOADED]} | FAILED: ${c[ji.LoadState.FAILED]} | UNAVAILABLE: ${c[ji.LoadState.UNAVAILABLE]} | TOTAL: ${d}`,b=Math.round(t*100)/100,f=Math.round(n*100)/100,x=Math.round(i*100)/100,_=`LOAD: ${b} | OCT: ${f} | ALL: ${x}`;console.log(`${m} || ${p} || ${_}`)}var p3={INTERNAL:0,LEAF:1,PACKED_LEAF_FROM_PARENT:2};function L0t(e,t,n){let i=e._primitive._screenSpaceError,o=e._keyframeLocation,r=e._frameNumber,s=t>=2,a=0,c=0,d=[],u=[];function m(b,f,x,_,C){let V=!1;if(l(b.children))for(let L=0;L<8;L++){let R=b.children[L];R.computeSurroundingRenderableKeyframeNodes(o),R.isRenderable(r)&&(V=!0)}if(V){d[C]=p3.INTERNAL<<16|f,d[x]=_,a++,_=f,C=_*9+1;for(let L=0;L<8;L++){let R=b.children[L];f=a,x=f*9+0,m(R,f,x,_,C+L)}}else{if(s){let L=c*5,R=b.renderableKeyframeNodePrevious,G=b.level-R.spatialNode.level,X=R.spatialNode.parent,v=l(X)?X.renderableKeyframeNodePrevious:R,W=Z0t(b,i,n),F=G,A=1,y=R.megatextureIndex,Z=v.megatextureIndex;u[L+0]=W,u[L+1]=F,u[L+2]=A,u[L+3]=y,u[L+4]=Z,d[C]=p3.LEAF<<16|c}else{let L=b.renderableKeyframeNodePrevious,G=b.level-L.spatialNode.level===0?p3.LEAF:p3.PACKED_LEAF_FROM_PARENT;d[C]=G<<16|L.megatextureIndex}c++}}let p=e.rootNode;p.computeSurroundingRenderableKeyframeNodes(o),p.isRenderable(r)&&m(p,0,0,0,0),R0t(d,9,e.internalNodeTilesPerRow,e.internalNodeTexture),s&&G0t(u,2,e.leafNodeTilesPerRow,e.leafNodeTexture)}function Z0t(e,t,n){if(e.parent===void 0)return 0;let i=e.screenSpaceError,o=e.parent.screenSpaceError,s=((t-i)/(o-i)+n-1)/n;return P.clamp(s,0,1)}function R0t(e,t,n,i){let o=at.componentsLength(i.pixelFormat),r=Math.ceil(e.length/t),s=Math.max(1,t*Math.min(r,n)),a=Math.max(1,Math.ceil(r/n)),c=new Uint8Array(s*a*o);for(let m=0;m<e.length;m++){let p=e[m],b=m*o;for(let f=0;f<o;f++)c[b+f]=p>>>f*8&255}let u={source:{arrayBufferView:c,width:s,height:a},xOffset:0,yOffset:0};i.copyFrom(u)}function G0t(e,t,n,i){let o=at.componentsLength(i.pixelFormat),r=5,s=Math.ceil(e.length/r),a=Math.max(1,t*Math.min(s,n)),c=Math.max(1,Math.ceil(s/n)),d=new Uint8Array(a*c*o);for(let p=0;p<s;p++){let b=e[p*r+0],f=e[p*r+1],x=e[p*r+2],_=e[p*r+3],C=e[p*r+4],V=P.clamp(Math.floor(65536*b),0,65535);d[p*8+0]=V>>>0&255,d[p*8+1]=V>>>8&255,d[p*8+2]=f&255,d[p*8+3]=x&255,d[p*8+4]=_>>>0&255,d[p*8+5]=_>>>8&255,d[p*8+6]=C>>>0&255,d[p*8+7]=C>>>8&255}let m={source:{arrayBufferView:d,width:a,height:c},xOffset:0,yOffset:0};i.copyFrom(m)}db.getApproximateTextureMemoryByteLength=function(e,t,n,i){let o=0,r=n.length;for(let s=0;s<r;s++){let a=n[s],c=i[s],d=Kt.getComponentCount(a);o+=QV.getApproximateTextureMemoryByteLength(e,t,d,c)}return o};var jV=db;var WNi=T(S(),1);var lNi=T(S(),1),E0t={FLOAT:\"float\",VEC2:\"vec2\",VEC3:\"vec3\",VEC4:\"vec4\",INT:\"int\",INT_VEC2:\"ivec2\",INT_VEC3:\"ivec3\",INT_VEC4:\"ivec4\",BOOL:\"bool\",BOOL_VEC2:\"bvec2\",BOOL_VEC3:\"bvec3\",BOOL_VEC4:\"bvec4\",MAT2:\"mat2\",MAT3:\"mat3\",MAT4:\"mat4\",SAMPLER_2D:\"sampler2D\",SAMPLER_CUBE:\"samplerCube\"},qV=Object.freeze(E0t);var SNi=T(S(),1);var uNi=T(S(),1);function X0t(e,t,n){let i=new Uint8ClampedArray(e.buffer),o=new ImageData(i,t,n),r=document.createElement(\"canvas\");return r.width=t,r.height=n,r.getContext(\"2d\").putImageData(o,0,0),r}var u9=X0t;function $V(){this._defaultTexture=void 0,this._textures={},this._loadedImages=[],this._lastUpdatedFrame=-1}$V.prototype.getTexture=function(e){return this._textures[e]};function I0t(e,t,n){n.resource.fetchImage().then(function(i){e._loadedImages.push({id:t,image:i,textureUniform:n})}).catch(function(){let i=e._textures[t];l(i)&&i!==e._defaultTexture&&i.destroy(),e._textures[t]=e._defaultTexture})}$V.prototype.loadTexture2D=function(e,t){l(t.typedArray)?this._loadedImages.push({id:e,textureUniform:t}):I0t(this,e,t)};function W0t(e,t,n){let{id:i,textureUniform:o,image:r}=t,s=n.webgl2?b3(o,r,n):P0t(o,r,n),a=e._textures[i];l(a)&&a!==n.defaultTexture&&a.destroy(),e._textures[i]=s}function b3(e,t,n){let{typedArray:i,sampler:o}=e,r=l(i)?q_e(e,n):new Ft({context:n,source:t,sampler:o});return j_e(o)&&r.generateMipmap(),r}function P0t(e,t,n){let{typedArray:i,sampler:o}=e,r=j_e(o),s=o.wrapS===En.REPEAT||o.wrapS===En.MIRRORED_REPEAT||o.wrapT===En.REPEAT||o.wrapT===En.MIRRORED_REPEAT,{width:a,height:c}=l(i)?e:t,d=[a,c].every(P.isPowerOfTwo);if((r||s)&&!d)if(l(i)){if(e.pixelDatatype===Qe.UNSIGNED_BYTE){let m=u9(i,a,c),p=ty(m);return b3({sampler:o},p,n)}}else{let m=ty(t);return b3(e,m,n)}else return b3(e,t,n);return r?console.warn(\"Texture requires resizing for mipmaps but pixelDataType cannot be resized. The texture may be rendered incorrectly.\"):s&&console.warn(\"Texture requires resizing for wrapping but pixelDataType cannot be resized. The texture may be rendered incorrectly.\"),q_e(e,n)}function j_e(e){return[dn.NEAREST_MIPMAP_NEAREST,dn.NEAREST_MIPMAP_LINEAR,dn.LINEAR_MIPMAP_NEAREST,dn.LINEAR_MIPMAP_LINEAR].includes(e.minificationFilter)}function q_e(e,t){let{pixelFormat:n,pixelDatatype:i,width:o,height:r,typedArray:s,sampler:a}=e;return new Ft({context:t,pixelFormat:n,pixelDatatype:i,source:{arrayBufferView:s,width:o,height:r},sampler:a,flipY:!1})}$V.prototype.update=function(e){if(e.frameNumber===this._lastUpdatedFrame)return;this._lastUpdatedFrame=e.frameNumber;let t=e.context;this._defaultTexture=t.defaultTexture;let n=this._loadedImages;for(let i=0;i<n.length;i++){let o=n[i];W0t(this,o,t)}n.length=0};$V.prototype.isDestroyed=function(){return!1};$V.prototype.destroy=function(){let e=this._textures;for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];n!==this._defaultTexture&&n.destroy()}return me(this)};var m9=$V;function h9(e){e=g(e,g.EMPTY_OBJECT),this.mode=g(e.mode,n0.MODIFY_MATERIAL),this.lightingModel=e.lightingModel,this.uniforms=g(e.uniforms,g.EMPTY_OBJECT),this.varyings=g(e.varyings,g.EMPTY_OBJECT),this.vertexShaderText=e.vertexShaderText,this.fragmentShaderText=e.fragmentShaderText,this.translucencyMode=g(e.translucencyMode,hy.INHERIT),this._textureManager=new m9,this._defaultTexture=void 0,this.uniformMap=v0t(this),this.usedVariablesVertex={attributeSet:{},featureIdSet:{},metadataSet:{}},this.usedVariablesFragment={attributeSet:{},featureIdSet:{},metadataSet:{},materialSet:{}},A0t(this),M0t(this)}function v0t(e){let t=e.uniforms,n={};for(let i in t)if(t.hasOwnProperty(i)){let o=t[i];o.type===qV.SAMPLER_2D?(e._textureManager.loadTexture2D(i,o.value),n[i]=w0t(e,i)):n[i]=F0t(e,i)}return n}function w0t(e,t){return function(){return g(e._textureManager.getTexture(t),e._defaultTexture)}}function F0t(e,t){return function(){return e.uniforms[t].value}}function BT(e,t,n){let i;for(;(i=t.exec(e))!==null;){let o=i[1];n[o]=!0}}function A0t(e){let t=/[vf]sInput\\.attributes\\.(\\w+)/g,n=/[vf]sInput\\.featureIds\\.(\\w+)/g,i=/[vf]sInput\\.metadata.(\\w+)/g,o,r=e.vertexShaderText;l(r)&&(o=e.usedVariablesVertex.attributeSet,BT(r,t,o),o=e.usedVariablesVertex.featureIdSet,BT(r,n,o),o=e.usedVariablesVertex.metadataSet,BT(r,i,o));let s=e.fragmentShaderText;if(l(s)){o=e.usedVariablesFragment.attributeSet,BT(s,t,o),o=e.usedVariablesFragment.featureIdSet,BT(s,n,o),o=e.usedVariablesFragment.metadataSet,BT(s,i,o);let a=/material\\.(\\w+)/g,c=e.usedVariablesFragment.materialSet;BT(s,a,c)}}function $_e(e){let t=/^.*MC$/,n=/^.*WC$/,i=/^.*EC$/;return t.test(e)?`${e} (model coordinates)`:n.test(e)?`${e} (Cartesian world coordinates)`:i.test(e)?`${e} (eye coordinates)`:e}function Lc(e,t,n,i){if(e.hasOwnProperty(t)){let o=`${$_e(t)} is not available in the ${i} shader. Did you mean ${$_e(n)} instead?`;throw new fe(o)}}function M0t(e){let t=e.usedVariablesVertex.attributeSet;Lc(t,\"position\",\"positionMC\",\"vertex\"),Lc(t,\"normal\",\"normalMC\",\"vertex\"),Lc(t,\"tangent\",\"tangentMC\",\"vertex\"),Lc(t,\"bitangent\",\"bitangentMC\",\"vertex\"),Lc(t,\"positionWC\",\"positionMC\",\"vertex\"),Lc(t,\"positionEC\",\"positionMC\",\"vertex\"),Lc(t,\"normalEC\",\"normalMC\",\"vertex\"),Lc(t,\"tangentEC\",\"tangentMC\",\"vertex\"),Lc(t,\"bitangentEC\",\"bitangentMC\",\"vertex\");let n=e.usedVariablesFragment.attributeSet;Lc(n,\"position\",\"positionEC\",\"fragment\"),Lc(n,\"normal\",\"normalEC\",\"fragment\"),Lc(n,\"tangent\",\"tangentEC\",\"fragment\"),Lc(n,\"bitangent\",\"bitangentEC\",\"fragment\"),Lc(n,\"normalMC\",\"normalEC\",\"fragment\"),Lc(n,\"tangentMC\",\"tangentEC\",\"fragment\"),Lc(n,\"bitangentMC\",\"bitangentEC\",\"fragment\")}h9.prototype.setUniform=function(e,t){let n=this.uniforms[e];n.type===qV.SAMPLER_2D?this._textureManager.loadTexture2D(e,t):l(t.clone)?n.value=t.clone(n.value):n.value=t};h9.prototype.update=function(e){this._defaultTexture=e.context.defaultTexture,this._textureManager.update(e)};h9.prototype.isDestroyed=function(){return!1};h9.prototype.destroy=function(){this._textureManager=this._textureManager&&this._textureManager.destroy(),me(this)};var YT=h9;function ep(e){e=g(e,g.EMPTY_OBJECT),this._ready=!1,this._provider=g(e.provider,ep.DefaultProvider),this._traversal=void 0,this._shape=void 0,this._shapeVisible=!1,this._paddingBefore=new h,this._paddingAfter=new h,this._minBounds=new h,this._minBoundsOld=new h,this._maxBounds=new h,this._maxBoundsOld=new h,this._exaggeratedMinBounds=new h,this._exaggeratedMinBoundsOld=new h,this._exaggeratedMaxBounds=new h,this._exaggeratedMaxBoundsOld=new h,this._minClippingBounds=new h,this._minClippingBoundsOld=new h,this._maxClippingBounds=new h,this._maxClippingBoundsOld=new h,this._clippingPlanes=void 0,this._clippingPlanesState=0,this._clippingPlanesEnabled=!1,this._modelMatrix=M.clone(g(e.modelMatrix,M.IDENTITY)),this._exaggeratedModelMatrix=M.clone(this._modelMatrix),this._compoundModelMatrix=new M,this._compoundModelMatrixOld=new M,this._customShader=g(e.customShader,ep.DefaultCustomShader),this._customShaderCompilationEvent=new ge,this._shaderDirty=!0,this._drawCommand=void 0,this._drawCommandPick=void 0,this._pickId=void 0,this._clock=e.clock,this._transformPositionWorldToUv=new M,this._transformPositionUvToWorld=new M,this._transformDirectionWorldToLocal=new $,this._transformNormalLocalToWorld=new $,this._jitter=!1,this._nearestSampling=!1,this._levelBlendFactor=0,this._stepSizeMultiplier=1,this._depthTest=!0,this._useLogDepth=void 0,this._screenSpaceError=4,this._debugPolylines=new zm,this._debugDraw=!1,this._disableRender=!1,this._disableUpdate=!1,this._uniforms={octreeInternalNodeTexture:void 0,octreeInternalNodeTilesPerRow:0,octreeInternalNodeTexelSizeUv:new D,octreeLeafNodeTexture:void 0,octreeLeafNodeTilesPerRow:0,octreeLeafNodeTexelSizeUv:new D,megatextureTextures:[],megatextureSliceDimensions:new D,megatextureTileDimensions:new D,megatextureVoxelSizeUv:new D,megatextureSliceSizeUv:new D,megatextureTileSizeUv:new D,dimensions:new h,paddingBefore:new h,paddingAfter:new h,transformPositionViewToUv:new M,transformPositionUvToView:new M,transformDirectionViewToLocal:new $,transformNormalLocalToWorld:new $,cameraPositionUv:new h,ndcSpaceAxisAlignedBoundingBox:new se,clippingPlanesTexture:void 0,clippingPlanesMatrix:new M,stepSize:0,pickColor:new O},this._shapeDefinesOld={},this._uniformMap={};let t=this._uniforms,n=this._uniformMap;for(let o in t)if(t.hasOwnProperty(o)){let r=`u_${o}`;n[r]=function(){return t[o]}}let i=this._provider;N0t(this,i)}function N0t(e,t){let{shape:n,minBounds:i=Ii.getMinBounds(n),maxBounds:o=Ii.getMaxBounds(n)}=t;e.minBounds=i,e.maxBounds=o,e.minClippingBounds=Ii.getMinBounds(n),e.maxClippingBounds=Ii.getMaxBounds(n),e._exaggeratedMinBounds=h.clone(e._minBounds,e._exaggeratedMinBounds),e._exaggeratedMaxBounds=h.clone(e._maxBounds,e._exaggeratedMaxBounds),e._exaggeratedModelMatrix=M.clone(e._modelMatrix,e._exaggeratedModelMatrix),tTe(e,t);let r=Ii.getShapeConstructor(n);e._shape=new r,e._shapeVisible=nTe(e,e._shape,t)}Object.defineProperties(ep.prototype,{ready:{get:function(){return this._ready}},provider:{get:function(){return this._provider}},boundingSphere:{get:function(){return this._shape.boundingSphere}},orientedBoundingBox:{get:function(){return this._shape.orientedBoundingBox}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=M.clone(e,this._modelMatrix)}},shape:{get:function(){return this._provider.shape}},dimensions:{get:function(){return this._provider.dimensions}},minimumValues:{get:function(){return this._provider.minimumValues}},maximumValues:{get:function(){return this._provider.maximumValues}},show:{get:function(){return!this._disableRender},set:function(e){this._disableRender=!e}},disableUpdate:{get:function(){return this._disableUpdate},set:function(e){this._disableUpdate=e}},debugDraw:{get:function(){return this._debugDraw},set:function(e){this._debugDraw=e}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._shaderDirty=!0)}},jitter:{get:function(){return this._jitter},set:function(e){this._jitter!==e&&(this._jitter=e,this._shaderDirty=!0)}},nearestSampling:{get:function(){return this._nearestSampling},set:function(e){this._nearestSampling!==e&&(this._nearestSampling=e,this._shaderDirty=!0)}},levelBlendFactor:{get:function(){return this._levelBlendFactor},set:function(e){this._levelBlendFactor=P.clamp(e,0,1)}},screenSpaceError:{get:function(){return this._screenSpaceError},set:function(e){this._screenSpaceError=e}},stepSize:{get:function(){return this._stepSizeMultiplier},set:function(e){this._stepSizeMultiplier=e}},minBounds:{get:function(){return this._minBounds},set:function(e){this._minBounds=h.clone(e,this._minBounds)}},maxBounds:{get:function(){return this._maxBounds},set:function(e){this._maxBounds=h.clone(e,this._maxBounds)}},minClippingBounds:{get:function(){return this._minClippingBounds},set:function(e){this._minClippingBounds=h.clone(e,this._minClippingBounds)}},maxClippingBounds:{get:function(){return this._maxClippingBounds},set:function(e){this._maxClippingBounds=h.clone(e,this._maxClippingBounds)}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){fs.setOwner(e,this,\"_clippingPlanes\")}},customShader:{get:function(){return this._customShader},set:function(e){if(this._customShader!==e){let t=this._uniformMap,i=this._customShader.uniformMap;for(let o in i)i.hasOwnProperty(o)&&delete t[o];l(e)?this._customShader=e:this._customShader=ep.DefaultCustomShader,this._shaderDirty=!0}}},customShaderCompilationEvent:{get:function(){return this._customShaderCompilationEvent}}});var k0t=new h,U0t=new se,D0t=new se,B0t=new h,Y0t=new h,O0t=new $,z0t=new $,H0t=new M,K0t=new M,J0t=new M,Q0t=M.fromRotationTranslation($.fromUniformScale(.5,new $),new h(.5,.5,.5),new M),j0t=M.fromRotationTranslation($.fromUniformScale(2,new $),new h(-1,-1,-1),new M);ep.prototype.update=function(e){let t=this._provider;this._customShader.update(e);let n=e.context;if(!this._ready){ibt(this,t,n),e.afterRender.push(()=>(this._ready=!0,!0));return}tbt(this,e);let i=tTe(this,t),o=this._shape;if(i&&(this._shapeVisible=nTe(this,o,t),sbt(this,o)&&(this._shaderDirty=!0)),!this._shapeVisible)return;let r=abt(t.timeIntervalCollection,this._clock),s=this._traversal,a=s._sampleCount;if(s.update(e,r,i,this._disableUpdate),a!==s._sampleCount&&(this._shaderDirty=!0),!s.isRenderable(s.rootNode)||(this._debugDraw&&pbt(this,e),this._disableRender))return;this._useLogDepth!==e.useLogDepth&&(this._useLogDepth=e.useLogDepth,this._shaderDirty=!0),cbt(this,e)&&(this._shaderDirty=!0);let d=s.leafNodeTexture,u=this._uniforms;l(d)&&(u.octreeLeafNodeTexture=s.leafNodeTexture,u.octreeLeafNodeTexelSizeUv=D.clone(s.leafNodeTexelSizeUv,u.octreeLeafNodeTexelSizeUv),u.octreeLeafNodeTilesPerRow=s.leafNodeTilesPerRow),this._shaderDirty&&(a9(this,n),this._shaderDirty=!1);let m=n.uniformState.viewProjection,p=o.orientedBoundingBox,b=ubt(p,m,D0t);if(b.x===1||b.y===1||b.z===-1||b.w===-1)return;u.ndcSpaceAxisAlignedBoundingBox=se.clone(b,u.ndcSpaceAxisAlignedBoundingBox);let x=n.uniformState.inverseView;u.transformPositionViewToUv=M.multiplyTransformation(this._transformPositionWorldToUv,x,u.transformPositionViewToUv);let _=n.uniformState.view;u.transformPositionUvToView=M.multiplyTransformation(_,this._transformPositionUvToWorld,u.transformPositionUvToView);let C=n.uniformState.inverseViewRotation;u.transformDirectionViewToLocal=$.multiply(this._transformDirectionWorldToLocal,C,u.transformDirectionViewToLocal),u.transformNormalLocalToWorld=$.clone(this._transformNormalLocalToWorld,u.transformNormalLocalToWorld);let V=e.camera.positionWC;u.cameraPositionUv=M.multiplyByPoint(this._transformPositionWorldToUv,V,u.cameraPositionUv),u.stepSize=this._stepSizeMultiplier;let L=e.passes.pick?this._drawCommandPick:e.passes.pickVoxel?this._drawCommandPickVoxel:this._drawCommand;L.boundingVolume=o.boundingSphere,e.commandList.push(L)};var q0t=new h,s8=new h,$0t=new he,ebt=new h;function tbt(e,t){if(e._exaggeratedMinBounds=h.clone(e._minBounds,e._exaggeratedMinBounds),e._exaggeratedMaxBounds=h.clone(e._maxBounds,e._exaggeratedMaxBounds),e.shape===Ii.ELLIPSOID){let n=t.verticalExaggerationRelativeHeight,i=t.verticalExaggeration;e._exaggeratedMinBounds.z=(e._minBounds.z-n)*i+n,e._exaggeratedMaxBounds.z=(e._maxBounds.z-n)*i+n}else if(e.shape===Ii.BOX){let n=h.fromElements(1,1,t.verticalExaggeration,q0t);e._exaggeratedModelMatrix=M.multiplyByScale(e._modelMatrix,n,e._exaggeratedModelMatrix),e._exaggeratedModelMatrix=M.multiplyByTranslation(e._exaggeratedModelMatrix,nbt(e,t),e._exaggeratedModelMatrix)}}function nbt(e,t){let{shapeTransform:n=M.IDENTITY,globalTransform:i=M.IDENTITY}=e._provider,o=M.getTranslation(n,s8),r=M.multiplyByPoint(e._modelMatrix,o,s8),s=M.multiplyByPoint(i,r,s8),c=oe.WGS84.cartesianToCartographic(s,$0t),d=0;l(c)&&(d=c.height);let u=pr.getHeight(d,t.verticalExaggeration,t.verticalExaggerationRelativeHeight);return h.fromElements(0,0,(u-d)/t.verticalExaggeration,ebt)}function ibt(e,t,n){let i=e._uniforms;e._pickId=n.createPickId({primitive:e}),i.pickColor=O.clone(e._pickId.color,i.pickColor);let{shaderDefines:o,shaderUniforms:r}=e._shape;e._shapeDefinesOld=Oe(o,!0);let s=e._uniformMap;for(let a in r)if(r.hasOwnProperty(a)){let c=`u_${a}`;s[c]=function(){return r[a]}}i.dimensions=h.clone(t.dimensions,i.dimensions),e._paddingBefore=h.clone(g(t.paddingBefore,h.ZERO),e._paddingBefore),i.paddingBefore=h.clone(e._paddingBefore,i.paddingBefore),e._paddingAfter=h.clone(g(t.paddingAfter,h.ZERO),e._paddingBefore),i.paddingAfter=h.clone(e._paddingAfter,i.paddingAfter),e._traversal=obt(e,t,n),rbt(e._traversal,i)}function tTe(e,t){let n=g(t.shapeTransform,M.IDENTITY),i=g(t.globalTransform,M.IDENTITY);return M.multiplyTransformation(i,e._exaggeratedModelMatrix,e._compoundModelMatrix),M.multiplyTransformation(e._compoundModelMatrix,n,e._compoundModelMatrix),OT(e,\"_compoundModelMatrix\",\"_compoundModelMatrixOld\")+OT(e,\"_minBounds\",\"_minBoundsOld\")+OT(e,\"_maxBounds\",\"_maxBoundsOld\")+OT(e,\"_exaggeratedMinBounds\",\"_exaggeratedMinBoundsOld\")+OT(e,\"_exaggeratedMaxBounds\",\"_exaggeratedMaxBoundsOld\")+OT(e,\"_minClippingBounds\",\"_minClippingBoundsOld\")+OT(e,\"_maxClippingBounds\",\"_maxClippingBoundsOld\")>0}function OT(e,t,n){let i=e[t],o=e[n],r=!i.equals(o);return r&&i.clone(o),r?1:0}function nTe(e,t,n){if(!t.update(e._compoundModelMatrix,e._exaggeratedMinBounds,e._exaggeratedMaxBounds,e.minClippingBounds,e.maxClippingBounds))return!1;let o=t.shapeTransform,r=M.inverse(o,H0t),s=M.getRotation(o,O0t),a=M.getScale(o,B0t),c=h.maximumComponent(a),d=h.divideByScalar(a,c,Y0t),u=$.multiplyByScale(s,d,z0t);return e._transformPositionWorldToUv=M.multiplyTransformation(Q0t,r,e._transformPositionWorldToUv),e._transformPositionUvToWorld=M.multiplyTransformation(o,j0t,e._transformPositionUvToWorld),e._transformDirectionWorldToLocal=M.getMatrix3(r,e._transformDirectionWorldToLocal),e._transformNormalLocalToWorld=$.inverseTranspose(u,e._transformNormalLocalToWorld),!0}function obt(e,t,n){let i=h.clone(t.dimensions,k0t);h.add(i,e._paddingBefore,i),h.add(i,e._paddingAfter,i);let o=t.maximumTileCount,r=l(o)?jV.getApproximateTextureMemoryByteLength(o,i,t.types,t.componentTypes):void 0,s=g(t.keyframeCount,1);return new jV(e,n,i,t.types,t.componentTypes,s,r)}function rbt(e,t){t.octreeInternalNodeTexture=e.internalNodeTexture,t.octreeInternalNodeTexelSizeUv=D.clone(e.internalNodeTexelSizeUv,t.octreeInternalNodeTexelSizeUv),t.octreeInternalNodeTilesPerRow=e.internalNodeTilesPerRow;let n=e.megatextures,i=n[0],o=n.length;t.megatextureTextures=new Array(o);for(let r=0;r<o;r++)t.megatextureTextures[r]=n[r].texture;t.megatextureSliceDimensions=D.clone(i.sliceCountPerRegion,t.megatextureSliceDimensions),t.megatextureTileDimensions=D.clone(i.regionCountPerMegatexture,t.megatextureTileDimensions),t.megatextureVoxelSizeUv=D.clone(i.voxelSizeUv,t.megatextureVoxelSizeUv),t.megatextureSliceSizeUv=D.clone(i.sliceSizeUv,t.megatextureSliceSizeUv),t.megatextureTileSizeUv=D.clone(i.regionSizeUv,t.megatextureTileSizeUv)}function sbt(e,t){let n=t.shaderDefines,i=Object.keys(n).some(o=>n[o]!==e._shapeDefinesOld[o]);return i&&(e._shapeDefinesOld=Oe(n,!0)),i}function abt(e,t){if(!l(e)||!l(t))return 0;let n=t.currentTime,i,o=e.indexOf(n);o>=0?i=e.get(o):(o=~o,o===e.length?(o=e.length-1,i=e.get(o),n=i.stop):(i=e.get(o),n=i.start));let r=te.secondsDifference(i.stop,i.start),a=te.secondsDifference(n,i.start)/r;return o+a}function cbt(e,t){let n=e.clippingPlanes;if(!l(n))return!1;n.update(t);let{clippingPlanesState:i,enabled:o}=n;if(o){let r=e._uniforms;r.clippingPlanesTexture=n.texture,r.clippingPlanesMatrix=M.transpose(M.multiplyTransformation(M.inverse(n.modelMatrix,r.clippingPlanesMatrix),e._transformPositionUvToWorld,r.clippingPlanesMatrix),r.clippingPlanesMatrix)}return e._clippingPlanesState===i&&e._clippingPlanesEnabled===o?!1:(e._clippingPlanesState=i,e._clippingPlanesEnabled=o,!0)}ep.prototype.isDestroyed=function(){return!1};ep.prototype.destroy=function(){let e=this._drawCommand;l(e)&&(e.shaderProgram=e.shaderProgram&&e.shaderProgram.destroy());let t=this._drawCommandPick;return l(t)&&(t.shaderProgram=t.shaderProgram&&t.shaderProgram.destroy()),this._pickId=this._pickId&&this._pickId.destroy(),this._traversal=this._traversal&&this._traversal.destroy(),this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy(),me(this)};var eTe=new Array(new se(-1,-1,-1,1),new se(1,-1,-1,1),new se(-1,1,-1,1),new se(1,1,-1,1),new se(-1,-1,1,1),new se(1,-1,1,1),new se(-1,1,1,1),new se(1,1,1,1)),lbt=new Array(1,2,4,0,3,5,0,3,6,1,2,7,0,5,6,1,4,7,2,4,7,3,5,6),dbt=new Array(new se,new se,new se,new se,new se,new se,new se,new se);function ubt(e,t,n){let i=M.fromRotationTranslation(e.halfAxes,e.center,K0t),o=M.multiply(t,i,J0t),r=+Number.MAX_VALUE,s=-Number.MAX_VALUE,a=+Number.MAX_VALUE,c=-Number.MAX_VALUE,d,u=dbt,m=eTe.length;for(d=0;d<m;d++)M.multiplyByVector(o,eTe[d],u[d]);for(d=0;d<m;d++){let p=u[d];if(p.z>=-p.w){let b=p.x/p.w,f=p.y/p.w;r=Math.min(r,b),s=Math.max(s,b),a=Math.min(a,f),c=Math.max(c,f)}else for(let b=0;b<3;b++){let f=lbt[d*3+b],x=u[f];if(x.z>=-x.w){let _=p.z+p.w,C=x.z+x.w,V=_/(_-C),L=se.lerp(p,x,V,U0t),R=L.x/L.w,G=L.y/L.w;r=Math.min(r,R),s=Math.max(s,R),a=Math.min(a,G),c=Math.max(c,G)}}}return r=P.clamp(r,-1,1),a=P.clamp(a,-1,1),s=P.clamp(s,-1,1),c=P.clamp(c,-1,1),n=se.fromElements(r,a,s,c,n),n}var a8=3e7,mbt=new h(a8,0,0),hbt=new h(0,a8,0),fbt=new h(0,0,a8);function pbt(e,t){let n=e._traversal,i=e._debugPolylines;i.removeAll();function o(c,d,u,m){i.add({positions:[c,d],width:m,material:ki.fromType(\"Color\",{color:u})})}function r(c,d,u){let m=c.computeCorners();o(m[0],m[1],d,u),o(m[2],m[3],d,u),o(m[4],m[5],d,u),o(m[6],m[7],d,u),o(m[0],m[2],d,u),o(m[4],m[6],d,u),o(m[1],m[3],d,u),o(m[5],m[7],d,u),o(m[0],m[4],d,u),o(m[2],m[6],d,u),o(m[1],m[5],d,u),o(m[3],m[7],d,u)}function s(c){if(!n.isRenderable(c))return;let d=c.level,m=Math.max(1,5/Math.pow(2,d)),b=[O.RED,O.LIME,O.BLUE][d%3];if(r(c.orientedBoundingBox,b,m),l(c.children))for(let f=0;f<8;f++)s(c.children[f])}r(e._shape.orientedBoundingBox,O.WHITE,5),s(n.rootNode);let a=10;o(h.ZERO,mbt,O.RED,a),o(h.ZERO,hbt,O.LIME,a),o(h.ZERO,fbt,O.BLUE,a),i.update(t)}ep.DefaultCustomShader=new YT({fragmentShaderText:`void fragmentMain(FragmentInput fsInput, inout czm_modelMaterial material) { material.diffuse ="
}