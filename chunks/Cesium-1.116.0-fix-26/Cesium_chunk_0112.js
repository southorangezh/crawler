{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 112,
    "total_chunks": 194,
    "chunk_size": 58094,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.714Z"
  },
  "content": "h,jme=new h;function eT(e){e=g(e,g.EMPTY_OBJECT);let t=e.positions,n=e.maximumHeights,i=e.minimumHeights,o=g(e.granularity,P.RADIANS_PER_DEGREE),r=g(e.ellipsoid,oe.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=n,this._granularity=o,this._ellipsoid=oe.clone(r),this._workerName=\"createWallOutlineGeometry\";let s=1+t.length*h.packedLength+2;l(i)&&(s+=i.length),l(n)&&(s+=n.length),this.packedLength=s+oe.packedLength+1}eT.pack=function(e,t,n){n=g(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._minimumHeights;if(r=l(s)?s.length:0,t[n++]=r,l(s))for(i=0;i<r;++i)t[n++]=s[i];let a=e._maximumHeights;if(r=l(a)?a.length:0,t[n++]=r,l(a))for(i=0;i<r;++i)t[n++]=a[i];return oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,t[n]=e._granularity,t};var qme=oe.clone(oe.UNIT_SPHERE),MP={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:qme,granularity:void 0};eT.unpack=function(e,t,n){t=g(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s;if(o>0)for(s=new Array(o),i=0;i<o;++i)s[i]=e[t++];o=e[t++];let a;if(o>0)for(a=new Array(o),i=0;i<o;++i)a[i]=e[t++];let c=oe.unpack(e,t,qme);t+=oe.packedLength;let d=e[t];return l(n)?(n._positions=r,n._minimumHeights=s,n._maximumHeights=a,n._ellipsoid=oe.clone(c,n._ellipsoid),n._granularity=d,n):(MP.positions=r,MP.minimumHeights=s,MP.maximumHeights=a,MP.granularity=d,new eT(MP))};eT.fromConstantHeights=function(e){e=g(e,g.EMPTY_OBJECT);let t=e.positions,n,i,o=e.minimumHeight,r=e.maximumHeight,s=l(o),a=l(r);if(s||a){let d=t.length;n=s?new Array(d):void 0,i=a?new Array(d):void 0;for(let u=0;u<d;++u)s&&(n[u]=o),a&&(i[u]=r)}let c={positions:t,maximumHeights:i,minimumHeights:n,ellipsoid:e.ellipsoid};return new eT(c)};eT.createGeometry=function(e){let t=e._positions,n=e._minimumHeights,i=e._maximumHeights,o=e._granularity,r=e._ellipsoid,s=q_.computePositions(r,t,i,n,o,!1);if(!l(s))return;let a=s.bottomPositions,c=s.topPositions,d=c.length,u=d*2,m=new Float64Array(u),p=0;d/=3;let b;for(b=0;b<d;++b){let V=b*3,L=h.fromArray(c,V,Qme),R=h.fromArray(a,V,jme);m[p++]=R.x,m[p++]=R.y,m[p++]=R.z,m[p++]=L.x,m[p++]=L.y,m[p++]=L.z}let f=new hn({position:new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:m})}),x=u/3;u=2*x-4+x;let _=Ae.createTypedArray(x,u),C=0;for(b=0;b<x-2;b+=2){let V=b,L=b+2,R=h.fromArray(m,V*3,Qme),G=h.fromArray(m,L*3,jme);if(h.equalsEpsilon(R,G,P.EPSILON10))continue;let X=b+1,v=b+3;_[C++]=X,_[C++]=V,_[C++]=X,_[C++]=v,_[C++]=V,_[C++]=L}return _[C++]=x-2,_[C++]=x-1,new ut({attributes:f,indices:_,primitiveType:we.LINES,boundingSphere:new ce.fromVertices(m)})};var NP=eT;var $me=new O;function d6e(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function ah(e,t){ii.call(this,{entity:e,scene:t,geometryOptions:new d6e(e),geometryPropertyName:\"wall\",observedPropertyNames:[\"availability\",\"wall\"]}),this._onEntityPropertyChanged(e,\"wall\",e.wall,void 0)}l(Object.create)&&(ah.prototype=Object.create(ii.prototype),ah.prototype.constructor=ah);ah.prototype.createFillGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i,o,r=new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=kn.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof kt){let c;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(c=this._materialProperty.color.getValue(e,$me)),l(c)||(c=O.WHITE),o=Ot.fromColor(c),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};return new Vt({id:t,geometry:new AP(this._options),attributes:i})};ah.prototype.createOutlineGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i=K.getValueOrDefault(this._outlineColorProperty,e,O.BLACK,$me),o=this._distanceDisplayConditionProperty.getValue(e);return new Vt({id:t,geometry:new NP(this._options),attributes:{show:new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Ot.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o)}})};ah.prototype._isHidden=function(e,t){return!l(t.positions)||ii.prototype._isHidden.call(this,e,t)};ah.prototype._getIsClosed=function(e){return!1};ah.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!K.isConstant(t.minimumHeights)||!K.isConstant(t.maximumHeights)||!K.isConstant(t.outlineWidth)||!K.isConstant(t.granularity)};ah.prototype._setStaticOptions=function(e,t){let n=t.minimumHeights,i=t.maximumHeights,o=t.granularity,r=this._materialProperty instanceof kt,s=this._options;s.vertexFormat=r?ln.VERTEX_FORMAT:so.MaterialSupport.TEXTURED.vertexFormat,s.positions=t.positions.getValue(Be.MINIMUM_VALUE,s.positions),s.minimumHeights=l(n)?n.getValue(Be.MINIMUM_VALUE,s.minimumHeights):void 0,s.maximumHeights=l(i)?i.getValue(Be.MINIMUM_VALUE,s.maximumHeights):void 0,s.granularity=l(o)?o.getValue(Be.MINIMUM_VALUE):void 0};ah.DynamicGeometryUpdater=J1;function J1(e,t,n){ni.call(this,e,t,n)}l(Object.create)&&(J1.prototype=Object.create(ni.prototype),J1.prototype.constructor=J1);J1.prototype._isHidden=function(e,t,n){return!l(this._options.positions)||ni.prototype._isHidden.call(this,e,t,n)};J1.prototype._setOptions=function(e,t,n){let i=this._options;i.positions=K.getValueOrUndefined(t.positions,n,i.positions),i.minimumHeights=K.getValueOrUndefined(t.minimumHeights,n,i.minimumHeights),i.maximumHeights=K.getValueOrUndefined(t.maximumHeights,n,i.maximumHeights),i.granularity=K.getValueOrUndefined(t.granularity,n)};var kP=ah;var tT=[uX,rP,Q2,gP,_P,CP,RP,vP,wP,kP];function nT(e,t){this.entity=e,this.scene=t;let n=new Array(tT.length),i=new ge,o=new Xr;for(let r=0;r<n.length;r++){let s=new tT[r](e,t);o.add(s.geometryChanged,a=>{i.raiseEvent(a)}),n[r]=s}this.updaters=n,this.geometryChanged=i,this.eventHelper=o,this._removeEntitySubscription=e.definitionChanged.addEventListener(nT.prototype._onEntityPropertyChanged,this)}nT.prototype._onEntityPropertyChanged=function(e,t,n,i){let o=this.updaters;for(let r=0;r<o.length;r++)o[r]._onEntityPropertyChanged(e,t,n,i)};nT.prototype.forEach=function(e){let t=this.updaters;for(let n=0;n<t.length;n++)e(t[n])};nT.prototype.destroy=function(){this.eventHelper.removeAll();let e=this.updaters;for(let t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),me(this)};nT.registerUpdater=function(e){tT.includes(e)||tT.push(e)};nT.unregisterUpdater=function(e){if(tT.includes(e)){let t=tT.indexOf(e);tT.splice(t,1)}};var iT=nT;var Hti=T(S(),1);var ehe=new O,u6e=new It,m6e=new It,h6e=h.ZERO,f6e=new h;function ch(e,t,n,i,o,r,s){this.translucent=t,this.appearanceType=n,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=o,this.depthFailMaterial=void 0,this.closed=r,this.shadows=s,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new Lt,this.updaters=new Lt,this.updatersWithAttributes=new Lt,this.attributes=new Lt,this.subscriptions=new Lt,this.showsUpdated=new Lt,this.itemsToRemove=[],this.invalidated=!1;let a;l(o)&&(a=o.definitionChanged.addEventListener(ch.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=a}ch.prototype.onMaterialChanged=function(){this.invalidated=!0};ch.prototype.isMaterial=function(e){let t=this.depthFailMaterialProperty,n=e.depthFailMaterialProperty;return n===t?!0:l(t)?t.equals(n):!1};ch.prototype.add=function(e,t){let n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),!e.hasConstantFill||!e.fillMaterialProperty.isConstant||!K.isConstant(e.distanceDisplayConditionProperty)||!K.isConstant(e.terrainOffsetProperty))this.updatersWithAttributes.set(n,e);else{let i=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener(function(o,r,s,a){r===\"isShowing\"&&i.showsUpdated.set(e.id,e)}))}};ch.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return l(n)&&(n(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};ch.prototype.update=function(e){let t=!0,n=0,i=this.primitive,o=this.primitives,r;if(this.createPrimitive){let s=this.geometry.values;if(s.length>0){l(i)&&(l(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i);let c;l(this.depthFailAppearanceType)&&(l(this.depthFailMaterialProperty)&&(this.depthFailMaterial=Oo.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),c=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),i=new Rn({show:!1,asynchronous:!0,geometryInstances:s.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:c,shadows:this.shadows}),o.add(i),t=!1}else{l(i)&&(o.remove(i),i=void 0);let c=this.oldPrimitive;l(c)&&(o.remove(c),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(l(i)&&i.ready){i.show=!0,l(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0),l(this.depthFailAppearanceType)&&!(this.depthFailMaterialProperty instanceof kt)&&(this.depthFailMaterial=Oo.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);let s=this.updatersWithAttributes.values,a=s.length,c=this.waitingOnCreate;for(r=0;r<a;r++){let d=s[r],u=this.geometry.get(d.id),m=this.attributes.get(u.id.id);if(l(m)||(m=i.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,m)),!d.fillMaterialProperty.isConstant||c){let _=d.fillMaterialProperty.color,C=K.getValueOrDefault(_,e,O.WHITE,ehe);O.equals(m._lastColor,C)||(m._lastColor=O.clone(C,m._lastColor),m.color=Ot.toValue(C,m.color),(this.translucent&&m.color[3]===255||!this.translucent&&m.color[3]!==255)&&(this.itemsToRemove[n++]=d))}if(l(this.depthFailAppearanceType)&&d.depthFailMaterialProperty instanceof kt&&(!d.depthFailMaterialProperty.isConstant||c)){let _=d.depthFailMaterialProperty.color,C=K.getValueOrDefault(_,e,O.WHITE,ehe);O.equals(m._lastDepthFailColor,C)||(m._lastDepthFailColor=O.clone(C,m._lastDepthFailColor),m.depthFailColor=Ot.toValue(C,m.depthFailColor))}let p=d.entity.isShowing&&(d.hasConstantFill||d.isFilled(e)),b=m.show[0]===1;p!==b&&(m.show=xn.toValue(p,m.show));let f=d.distanceDisplayConditionProperty;if(!K.isConstant(f)){let _=K.getValueOrDefault(f,e,m6e,u6e);It.equals(_,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=It.clone(_,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=kn.toValue(_,m.distanceDisplayCondition))}let x=d.terrainOffsetProperty;if(!K.isConstant(x)){let _=K.getValueOrDefault(x,e,h6e,f6e);h.equals(_,m._lastOffset)||(m._lastOffset=h.clone(_,m._lastOffset),m.offset=Ji.toValue(_,m.offset))}}this.updateShows(i),this.waitingOnCreate=!1}else l(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t};ch.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);l(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));let a=o.entity.isShowing,c=s.show[0]===1;a!==c&&(s.show=xn.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()};ch.prototype.contains=function(e){return this.updaters.contains(e.id)};ch.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ht.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!l(i)||!l(i.boundingSphere)||l(i.show)&&i.show[0]===0?ht.FAILED:(i.boundingSphere.clone(t),ht.DONE)};ch.prototype.destroy=function(){let e=this.primitive,t=this.primitives;l(e)&&t.remove(e);let n=this.oldPrimitive;l(n)&&t.remove(n),l(this.removeMaterialSubscription)&&this.removeMaterialSubscription()};function Q1(e,t,n,i,o){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=n,this._closed=i,this._shadows=o}Q1.prototype.add=function(e,t){let n,i,o=t.createFillGeometryInstance(e);o.attributes.color.value[3]===255?(n=this._solidItems,i=!1):(n=this._translucentItems,i=!0);let r=n.length;for(let a=0;a<r;a++){let c=n[a];if(c.isMaterial(t)){c.add(t,o);return}}let s=new ch(this._primitives,i,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);s.add(t,o),n.push(s)};function the(e,t){let n=e.length;for(let i=n-1;i>=0;i--){let o=e[i];if(o.remove(t))return o.updaters.length===0&&(e.splice(i,1),o.destroy()),!0}return!1}Q1.prototype.remove=function(e){the(this._solidItems,e)||the(this._translucentItems,e)};function nhe(e,t,n){let i=!1,o=t.length;for(let r=0;r<o;++r){let s=t[r],a=s.itemsToRemove,c=a.length;if(c>0)for(r=0;r<c;r++){let d=a[r];s.remove(d),e.add(n,d),i=!0}}return i}function Vk(e,t,n,i){let o=t.length,r;for(r=o-1;r>=0;r--){let s=t[r];if(s.invalidated){t.splice(r,1);let a=s.updaters.values,c=a.length;for(let d=0;d<c;d++)e.add(n,a[d]);s.destroy()}}for(o=t.length,r=0;r<o;++r)i=t[r].update(n)&&i;return i}Q1.prototype.update=function(e){let t=Vk(this,this._solidItems,e,!0);t=Vk(this,this._translucentItems,e,t)&&t;let n=nhe(this,this._solidItems,e),i=nhe(this,this._translucentItems,e);return(n||i)&&(t=Vk(this,this._solidItems,e,t)&&t,t=Vk(this,this._translucentItems,e,t)&&t),t};function ihe(e,t,n){let i=e.length;for(let o=0;o<i;o++){let r=e[o];if(r.contains(t))return r.getBoundingSphere(t,n)}return ht.FAILED}Q1.prototype.getBoundingSphere=function(e,t){let n=ihe(this._solidItems,e,t);return n===ht.FAILED?ihe(this._translucentItems,e,t):n};function ohe(e){let t=e.length;for(let n=0;n<t;n++)e[n].destroy();e.length=0}Q1.prototype.removeAllPrimitives=function(){ohe(this._solidItems),ohe(this._translucentItems)};var Du=Q1;var lni=T(S(),1);var p6e=new It,b6e=new It,y6e=h.ZERO,g6e=new h;function lh(e,t,n,i,o,r,s){this.primitives=e,this.appearanceType=t,this.materialProperty=n,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=o,this.closed=r,this.shadows=s,this.updaters=new Lt,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new Lt,this.material=void 0,this.depthFailMaterial=void 0,this.updatersWithAttributes=new Lt,this.attributes=new Lt,this.invalidated=!1,this.removeMaterialSubscription=n.definitionChanged.addEventListener(lh.prototype.onMaterialChanged,this),this.subscriptions=new Lt,this.showsUpdated=new Lt}lh.prototype.onMaterialChanged=function(){this.invalidated=!0};lh.prototype.isMaterial=function(e){let t=this.materialProperty,n=e.fillMaterialProperty,i=this.depthFailMaterialProperty,o=e.depthFailMaterialProperty;if(n===t&&o===i)return!0;let r=l(t)&&t.equals(n);return r=(!l(i)&&!l(o)||l(i)&&i.equals(o))&&r,r};lh.prototype.add=function(e,t){let n=t.id;if(this.updaters.set(n,t),this.geometry.set(n,t.createFillGeometryInstance(e)),!t.hasConstantFill||!t.fillMaterialProperty.isConstant||!K.isConstant(t.distanceDisplayConditionProperty)||!K.isConstant(t.terrainOffsetProperty))this.updatersWithAttributes.set(n,t);else{let i=this;this.subscriptions.set(n,t.entity.definitionChanged.addEventListener(function(o,r,s,a){r===\"isShowing\"&&i.showsUpdated.set(t.id,t)}))}this.createPrimitive=!0};lh.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return l(n)&&(n(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};var x6e=new O;lh.prototype.update=function(e){let t=!0,n=this.primitive,i=this.primitives,o=this.geometry.values,r;if(this.createPrimitive){if(o.length>0){l(n)&&(l(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),this.material=Oo.getValue(e,this.materialProperty,this.material);let a;l(this.depthFailMaterialProperty)&&(this.depthFailMaterial=Oo.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),a=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed})),n=new Rn({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:a,shadows:this.shadows}),i.add(n),t=!1}else{l(n)&&(i.remove(n),n=void 0);let a=this.oldPrimitive;l(a)&&(i.remove(a),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(l(n)&&n.ready){n.show=!0,l(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=Oo.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material,l(this.depthFailAppearanceType)&&!(this.depthFailMaterialProperty instanceof kt)&&(this.depthFailMaterial=Oo.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);let s=this.updatersWithAttributes.values,a=s.length;for(r=0;r<a;r++){let c=s[r],d=c.entity,u=this.geometry.get(c.id),m=this.attributes.get(u.id.id);if(l(m)||(m=n.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,m)),l(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof kt&&!c.depthFailMaterialProperty.isConstant){let _=c.depthFailMaterialProperty.color,C=K.getValueOrDefault(_,e,O.WHITE,x6e);O.equals(m._lastDepthFailColor,C)||(m._lastDepthFailColor=O.clone(C,m._lastDepthFailColor),m.depthFailColor=Ot.toValue(C,m.depthFailColor))}let p=d.isShowing&&(c.hasConstantFill||c.isFilled(e)),b=m.show[0]===1;p!==b&&(m.show=xn.toValue(p,m.show));let f=c.distanceDisplayConditionProperty;if(!K.isConstant(f)){let _=K.getValueOrDefault(f,e,b6e,p6e);It.equals(_,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=It.clone(_,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=kn.toValue(_,m.distanceDisplayCondition))}let x=c.terrainOffsetProperty;if(!K.isConstant(x)){let _=K.getValueOrDefault(x,e,y6e,g6e);h.equals(_,m._lastOffset)||(m._lastOffset=h.clone(_,m._lastOffset),m.offset=Ji.toValue(_,m.offset))}}this.updateShows(n)}else l(n)&&!n.ready&&(t=!1);return t};lh.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=o.entity,s=this.geometry.get(o.id),a=this.attributes.get(s.id.id);l(a)||(a=e.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a));let c=r.isShowing,d=a.show[0]===1;c!==d&&(a.show=xn.toValue(c,a.show),s.attributes.show.value[0]=a.show[0])}this.showsUpdated.removeAll()};lh.prototype.contains=function(e){return this.updaters.contains(e.id)};lh.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ht.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!l(i)||!l(i.boundingSphere)||l(i.show)&&i.show[0]===0?ht.FAILED:(i.boundingSphere.clone(t),ht.DONE)};lh.prototype.destroy=function(){let e=this.primitive,t=this.primitives;l(e)&&t.remove(e);let n=this.oldPrimitive;l(n)&&t.remove(n),this.removeMaterialSubscription()};function j1(e,t,n,i,o){this._items=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=n,this._closed=i,this._shadows=o}j1.prototype.add=function(e,t){let n=this._items,i=n.length;for(let r=0;r<i;r++){let s=n[r];if(s.isMaterial(t)){s.add(e,t);return}}let o=new lh(this._primitives,this._appearanceType,t.fillMaterialProperty,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);o.add(e,t),n.push(o)};j1.prototype.remove=function(e){let t=this._items,n=t.length;for(let i=n-1;i>=0;i--){let o=t[i];if(o.remove(e)){o.updaters.length===0&&(t.splice(i,1),o.destroy());break}}};j1.prototype.update=function(e){let t,n=this._items,i=n.length;for(t=i-1;t>=0;t--){let r=n[t];if(r.invalidated){n.splice(t,1);let s=r.updaters.values,a=s.length;for(let c=0;c<a;c++)this.add(e,s[c]);r.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o};j1.prototype.getBoundingSphere=function(e,t){let n=this._items,i=n.length;for(let o=0;o<i;o++){let r=n[o];if(r.contains(e))return r.getBoundingSphere(e,t)}return ht.FAILED};j1.prototype.removeAllPrimitives=function(){let e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var Bu=j1;var Lni=T(S(),1);var mni=T(S(),1),she=T(rhe(),1);function Lk(){this._tree=new she.default}function oT(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.id=\"\"}oT.fromRectangleAndId=function(e,t,n){return n.minX=t.west,n.minY=t.south,n.maxX=t.east,n.maxY=t.north,n.id=e,n};Lk.prototype.insert=function(e,t){let n=oT.fromRectangleAndId(e,t,new oT);this._tree.insert(n)};function _6e(e,t){return e.id===t.id}var T6e=new oT;Lk.prototype.remove=function(e,t){let n=oT.fromRectangleAndId(e,t,T6e);this._tree.remove(n,_6e)};var S6e=new oT;Lk.prototype.collides=function(e){let t=oT.fromRectangleAndId(\"\",e,S6e);return this._tree.collides(t)};var rT=Lk;var C6e=new O,V6e=new It,L6e=new It;function A0(e,t,n,i){this.primitives=e,this.zIndex=i,this.classificationType=t,this.color=n,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new Lt,this.updaters=new Lt,this.updatersWithAttributes=new Lt,this.attributes=new Lt,this.subscriptions=new Lt,this.showsUpdated=new Lt,this.itemsToRemove=[],this.isDirty=!1,this.rectangleCollisionCheck=new rT}A0.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)};A0.prototype.add=function(e,t){let n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),this.rectangleCollisionCheck.insert(n,t.geometry.rectangle),!e.hasConstantFill||!e.fillMaterialProperty.isConstant||!K.isConstant(e.distanceDisplayConditionProperty))this.updatersWithAttributes.set(n,e);else{let i=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener(function(o,r,s,a){r===\"isShowing\"&&i.showsUpdated.set(e.id,e)}))}};A0.prototype.remove=function(e){let t=e.id,n=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,n.geometry.rectangle),this.updatersWithAttributes.remove(t);let i=this.subscriptions.get(t);return l(i)&&(i(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};A0.prototype.update=function(e){let t=!0,n=0,i=this.primitive,o=this.primitives,r;if(this.createPrimitive){let s=this.geometry.values;if(s.length>0)l(i)&&(l(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i),i=new Mc({show:!1,asynchronous:!0,geometryInstances:s.slice(),classificationType:this.classificationType}),o.add(i,this.zIndex),t=!1;else{l(i)&&(o.remove(i),i=void 0);let c=this.oldPrimitive;l(c)&&(o.remove(c),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(l(i)&&i.ready){i.show=!0,l(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0);let s=this.updatersWithAttributes.values,a=s.length,c=this.waitingOnCreate;for(r=0;r<a;r++){let d=s[r],u=this.geometry.get(d.id),m=this.attributes.get(u.id.id);if(l(m)||(m=i.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,m)),!d.fillMaterialProperty.isConstant||c){let x=d.fillMaterialProperty.color,_=K.getValueOrDefault(x,e,O.WHITE,C6e);O.equals(m._lastColor,_)||(m._lastColor=O.clone(_,m._lastColor),m.color=Ot.toValue(_,m.color))}let p=d.entity.isShowing&&(d.hasConstantFill||d.isFilled(e)),b=m.show[0]===1;p!==b&&(m.show=xn.toValue(p,m.show));let f=d.distanceDisplayConditionProperty;if(!K.isConstant(f)){let x=K.getValueOrDefault(f,e,L6e,V6e);It.equals(x,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=It.clone(x,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=kn.toValue(x,m.distanceDisplayCondition))}}this.updateShows(i),this.waitingOnCreate=!1}else l(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t};A0.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);l(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));let a=o.entity.isShowing,c=s.show[0]===1;a!==c&&(s.show=xn.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()};A0.prototype.contains=function(e){return this.updaters.contains(e.id)};A0.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ht.PENDING;let i=n.getBoundingSphere(e.entity);return l(i)?(i.clone(t),ht.DONE):ht.FAILED};A0.prototype.removeAllPrimitives=function(){let e=this.primitives,t=this.primitive;l(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());let n=this.oldPrimitive;l(n)&&(e.remove(n),this.oldPrimitive=void 0)};function q1(e,t){this._batches=[],this._primitives=e,this._classificationType=t}q1.prototype.add=function(e,t){let n=t.createFillGeometryInstance(e),i=this._batches,o=K.getValueOrDefault(t.zIndex,0),r,s=i.length;for(let a=0;a<s;++a){let c=i[a];if(c.zIndex===o&&!c.overlapping(n.geometry.rectangle)){r=c;break}}return l(r)||(r=new A0(this._primitives,this._classificationType,n.attributes.color.value,o),i.push(r)),r.add(t,n),r};q1.prototype.remove=function(e){let t=this._batches,n=t.length;for(let i=0;i<n;++i)if(t[i].remove(e))return};q1.prototype.update=function(e){let t,n,i=!0,o=this._batches,r=o.length;for(t=0;t<r;++t)i=o[t].update(e)&&i;for(t=0;t<r;++t){let s=o[t],a=s.itemsToRemove,c=a.length;for(let d=0;d<c;d++){n=a[d],s.remove(n);let u=this.add(e,n);s.isDirty=!0,u.isDirty=!0}}for(t=r-1;t>=0;--t){let s=o[t];s.isDirty&&(i=o[t].update(e)&&i,s.isDirty=!1),s.geometry.length===0&&o.splice(t,1)}return i};q1.prototype.getBoundingSphere=function(e,t){let n=this._batches,i=n.length;for(let o=0;o<i;++o){let r=n[o];if(r.contains(e))return r.getBoundingSphere(e,t)}return ht.FAILED};q1.prototype.removeAllPrimitives=function(){let e=this._batches,t=e.length;for(let n=0;n<t;++n)e[n].removeAllPrimitives()};var $1=q1;var Nni=T(S(),1);var Z6e=new It,R6e=new It;function Yu(e,t,n,i,o,r){this.primitives=e,this.classificationType=t,this.appearanceType=n,this.materialProperty=i,this.updaters=new Lt,this.createPrimitive=!0,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new Lt,this.material=void 0,this.updatersWithAttributes=new Lt,this.attributes=new Lt,this.invalidated=!1,this.removeMaterialSubscription=i.definitionChanged.addEventListener(Yu.prototype.onMaterialChanged,this),this.subscriptions=new Lt,this.showsUpdated=new Lt,this.usingSphericalTextureCoordinates=o,this.zIndex=r,this.rectangleCollisionCheck=new rT}Yu.prototype.onMaterialChanged=function(){this.invalidated=!0};Yu.prototype.overlapping=function(e){return this.rectangleCollisionCheck.collides(e)};Yu.prototype.isMaterial=function(e){let t=this.materialProperty,n=e.fillMaterialProperty;return n===t||n instanceof kt&&t instanceof kt?!0:l(t)&&t.equals(n)};Yu.prototype.add=function(e,t,n){let i=t.id;if(this.updaters.set(i,t),this.geometry.set(i,n),this.rectangleCollisionCheck.insert(i,n.geometry.rectangle),!t.hasConstantFill||!t.fillMaterialProperty.isConstant||!K.isConstant(t.distanceDisplayConditionProperty))this.updatersWithAttributes.set(i,t);else{let o=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener(function(r,s,a,c){s===\"isShowing\"&&o.showsUpdated.set(t.id,t)}))}this.createPrimitive=!0};Yu.prototype.remove=function(e){let t=e.id,n=this.geometry.get(t);if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.rectangleCollisionCheck.remove(t,n.geometry.rectangle),this.updatersWithAttributes.remove(t);let i=this.subscriptions.get(t);return l(i)&&(i(),this.subscriptions.remove(t)),!0}return!1};Yu.prototype.update=function(e){let t=!0,n=this.primitive,i=this.primitives,o=this.geometry.values,r;if(this.createPrimitive){if(o.length>0)l(n)&&(l(this.oldPrimitive)?i.remove(n):this.oldPrimitive=n),this.material=Oo.getValue(e,this.materialProperty,this.material),n=new Mc({show:!1,asynchronous:!0,geometryInstances:o.slice(),appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),i.add(n,this.zIndex),t=!1;else{l(n)&&(i.remove(n),n=void 0);let a=this.oldPrimitive;l(a)&&(i.remove(a),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=n,this.createPrimitive=!1}else if(l(n)&&n.ready){n.show=!0,l(this.oldPrimitive)&&(i.remove(this.oldPrimitive),this.oldPrimitive=void 0),this.material=Oo.getValue(e,this.materialProperty,this.material),this.primitive.appearance.material=this.material;let s=this.updatersWithAttributes.values,a=s.length;for(r=0;r<a;r++){let c=s[r],d=c.entity,u=this.geometry.get(c.id),m=this.attributes.get(u.id.id);l(m)||(m=n.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,m));let p=d.isShowing&&(c.hasConstantFill||c.isFilled(e)),b=m.show[0]===1;p!==b&&(m.show=xn.toValue(p,m.show));let f=c.distanceDisplayConditionProperty;if(!K.isConstant(f)){let x=K.getValueOrDefault(f,e,R6e,Z6e);It.equals(x,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=It.clone(x,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=kn.toValue(x,m.distanceDisplayCondition))}}this.updateShows(n)}else l(n)&&!n.ready&&(t=!1);return t};Yu.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=o.entity,s=this.geometry.get(o.id),a=this.attributes.get(s.id.id);l(a)||(a=e.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,a));let c=r.isShowing,d=a.show[0]===1;c!==d&&(a.show=xn.toValue(c,a.show),s.attributes.show.value[0]=a.show[0])}this.showsUpdated.removeAll()};Yu.prototype.contains=function(e){return this.updaters.contains(e.id)};Yu.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ht.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!l(i)||!l(i.boundingSphere)||l(i.show)&&i.show[0]===0?ht.FAILED:(i.boundingSphere.clone(t),ht.DONE)};Yu.prototype.destroy=function(){let e=this.primitive,t=this.primitives;l(e)&&t.remove(e);let n=this.oldPrimitive;l(n)&&t.remove(n),this.removeMaterialSubscription()};function eV(e,t,n){this._items=[],this._primitives=e,this._classificationType=t,this._appearanceType=n}eV.prototype.add=function(e,t){let n=this._items,i=n.length,o=t.createFillGeometryInstance(e),r=ld.shouldUseSphericalCoordinates(o.geometry.rectangle),s=K.getValueOrDefault(t.zIndex,0);for(let c=0;c<i;++c){let d=n[c];if(d.isMaterial(t)&&d.usingSphericalTextureCoordinates===r&&d.zIndex===s&&!d.overlapping(o.geometry.rectangle)){d.add(e,t,o);return}}let a=new Yu(this._primitives,this._classificationType,this._appearanceType,t.fillMaterialProperty,r,s);a.add(e,t,o),n.push(a)};eV.prototype.remove=function(e){let t=this._items,n=t.length;for(let i=n-1;i>=0;i--){let o=t[i];if(o.remove(e)){o.updaters.length===0&&(t.splice(i,1),o.destroy());break}}};eV.prototype.update=function(e){let t,n=this._items,i=n.length;for(t=i-1;t>=0;t--){let r=n[t];if(r.invalidated){n.splice(t,1);let s=r.updaters.values,a=s.length;for(let c=0;c<a;c++)this.add(e,s[c]);r.destroy()}}let o=!0;for(t=0;t<n.length;t++)o=n[t].update(e)&&o;return o};eV.prototype.getBoundingSphere=function(e,t){let n=this._items,i=n.length;for(let o=0;o<i;o++){let r=n[o];if(r.contains(e))return r.getBoundingSphere(e,t)}return ht.FAILED};eV.prototype.removeAllPrimitives=function(){let e=this._items,t=e.length;for(let n=0;n<t;n++)e[n].destroy();this._items.length=0};var UP=eV;var eii=T(S(),1);var G6e=new O,E6e=new It,X6e=new It,I6e=h.ZERO,W6e=new h;function M0(e,t,n,i){this.translucent=t,this.width=n,this.shadows=i,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new Lt,this.updaters=new Lt,this.updatersWithAttributes=new Lt,this.attributes=new Lt,this.itemsToRemove=[],this.subscriptions=new Lt,this.showsUpdated=new Lt}M0.prototype.add=function(e,t){let n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),!e.hasConstantOutline||!e.outlineColorProperty.isConstant||!K.isConstant(e.distanceDisplayConditionProperty)||!K.isConstant(e.terrainOffsetProperty))this.updatersWithAttributes.set(n,e);else{let i=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener(function(o,r,s,a){r===\"isShowing\"&&i.showsUpdated.set(e.id,e)}))}};M0.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return l(n)&&(n(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};M0.prototype.update=function(e){let t=!0,n=0,i=this.primitive,o=this.primitives,r;if(this.createPrimitive){let s=this.geometry.values;if(s.length>0)l(i)&&(l(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i),i=new Rn({show:!1,asynchronous:!0,geometryInstances:s.slice(),appearance:new ln({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),o.add(i),t=!1;else{l(i)&&(o.remove(i),i=void 0);let c=this.oldPrimitive;l(c)&&(o.remove(c),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(l(i)&&i.ready){i.show=!0,l(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0);let s=this.updatersWithAttributes.values,a=s.length,c=this.waitingOnCreate;for(r=0;r<a;r++){let d=s[r],u=this.geometry.get(d.id),m=this.attributes.get(u.id.id);if(l(m)||(m=i.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,m)),!d.outlineColorProperty.isConstant||c){let _=d.outlineColorProperty,C=K.getValueOrDefault(_,e,O.WHITE,G6e);O.equals(m._lastColor,C)||(m._lastColor=O.clone(C,m._lastColor),m.color=Ot.toValue(C,m.color),(this.translucent&&m.color[3]===255||!this.translucent&&m.color[3]!==255)&&(this.itemsToRemove[n++]=d))}let p=d.entity.isShowing&&(d.hasConstantOutline||d.isOutlineVisible(e)),b=m.show[0]===1;p!==b&&(m.show=xn.toValue(p,m.show));let f=d.distanceDisplayConditionProperty;if(!K.isConstant(f)){let _=K.getValueOrDefault(f,e,X6e,E6e);It.equals(_,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=It.clone(_,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=kn.toValue(_,m.distanceDisplayCondition))}let x=d.terrainOffsetProperty;if(!K.isConstant(x)){let _=K.getValueOrDefault(x,e,I6e,W6e);h.equals(_,m._lastOffset)||(m._lastOffset=h.clone(_,m._lastOffset),m.offset=Ji.toValue(_,m.offset))}}this.updateShows(i),this.waitingOnCreate=!1}else l(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t};M0.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);l(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));let a=o.entity.isShowing,c=s.show[0]===1;a!==c&&(s.show=xn.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()};M0.prototype.contains=function(e){return this.updaters.contains(e.id)};M0.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ht.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!l(i)||!l(i.boundingSphere)||l(i.show)&&i.show[0]===0?ht.FAILED:(i.boundingSphere.clone(t),ht.DONE)};M0.prototype.removeAllPrimitives=function(){let e=this.primitives,t=this.primitive;l(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());let n=this.oldPrimitive;l(n)&&(e.remove(n),this.oldPrimitive=void 0)};function tV(e,t,n){this._primitives=e,this._scene=t,this._shadows=n,this._solidBatches=new Lt,this._translucentBatches=new Lt}tV.prototype.add=function(e,t){let n=t.createOutlineGeometryInstance(e),i=this._scene.clampLineWidth(t.outlineWidth),o,r;n.attributes.color.value[3]===255?(o=this._solidBatches,r=o.get(i),l(r)||(r=new M0(this._primitives,!1,i,this._shadows),o.set(i,r)),r.add(t,n)):(o=this._translucentBatches,r=o.get(i),l(r)||(r=new M0(this._primitives,!0,i,this._shadows),o.set(i,r)),r.add(t,n))};tV.prototype.remove=function(e){let t,n=this._solidBatches.values,i=n.length;for(t=0;t<i;t++)if(n[t].remove(e))return;let o=this._translucentBatches.values,r=o.length;for(t=0;t<r;t++)if(o[t].remove(e))return};tV.prototype.update=function(e){let t,n,i,o,r=this._solidBatches.values,s=r.length,a=this._translucentBatches.values,c=a.length,d,u=!0,m=!1;do{for(m=!1,n=0;n<s;n++){o=r[n],u=o.update(e),d=o.itemsToRemove;let p=d.length;if(p>0)for(m=!0,t=0;t<p;t++)i=d[t],o.remove(i),this.add(e,i)}for(n=0;n<c;n++){o=a[n],u=o.update(e),d=o.itemsToRemove;let p=d.length;if(p>0)for(m=!0,t=0;t<p;t++)i=d[t],o.remove(i),this.add(e,i)}}while(m);return u};tV.prototype.getBoundingSphere=function(e,t){let n,i=this._solidBatches.values,o=i.length;for(n=0;n<o;n++){let a=i[n];if(a.contains(e))return a.getBoundingSphere(e,t)}let r=this._translucentBatches.values,s=r.length;for(n=0;n<s;n++){let a=r[n];if(a.contains(e))return a.getBoundingSphere(e,t)}return ht.FAILED};tV.prototype.removeAllPrimitives=function(){let e,t=this._solidBatches.values,n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();let i=this._translucentBatches.values,o=i.length;for(e=0;e<o;e++)i[e].removeAllPrimitives()};var nV=tV;var P6e=[];function kl(e,t,n,i){n=g(n,e.primitives),i=g(i,e.groundPrimitives),this._scene=e,this._primitives=n,this._groundPrimitives=i,this._entityCollection=void 0,this._addedObjects=new Lt,this._removedObjects=new Lt,this._changedObjects=new Lt;let o=_n.NUMBER_OF_SHADOW_MODES;this._outlineBatches=new Array(o*2),this._closedColorBatches=new Array(o*2),this._closedMaterialBatches=new Array(o*2),this._openColorBatches=new Array(o*2),this._openMaterialBatches=new Array(o*2);let r=zo.supportsMaterialsforEntitiesOnTerrain(e);this._supportsMaterialsforEntitiesOnTerrain=r;let s;for(s=0;s<o;++s)this._outlineBatches[s]=new nV(n,e,s,!1),this._outlineBatches[o+s]=new nV(n,e,s,!0),this._closedColorBatches[s]=new Du(n,ln,void 0,!0,s,!0),this._closedColorBatches[o+s]=new Du(n,ln,void 0,!0,s,!1),this._closedMaterialBatches[s]=new Bu(n,so,void 0,!0,s,!0),this._closedMaterialBatches[o+s]=new Bu(n,so,void 0,!0,s,!1),this._openColorBatches[s]=new Du(n,ln,void 0,!1,s,!0),this._openColorBatches[o+s]=new Du(n,ln,void 0,!1,s,!1),this._openMaterialBatches[s]=new Bu(n,so,void 0,!1,s,!0),this._openMaterialBatches[o+s]=new Bu(n,so,void 0,!1,s,!1);let a=Un.NUMBER_OF_CLASSIFICATION_TYPES,c=new Array(a),d=[];if(r)for(s=0;s<a;++s)d.push(new UP(i,s,so)),c[s]=new $1(i,s);else for(s=0;s<a;++s)c[s]=new $1(i,s);this._groundColorBatches=c,this._groundMaterialBatches=d,this._dynamicBatch=new O_(n,i),this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch),this._subscriptions=new Lt,this._updaterSets=new Lt,this._entityCollection=t,t.collectionChanged.addEventListener(kl.prototype._onCollectionChanged,this),this._onCollectionChanged(t,t.values,P6e)}kl.registerUpdater=function(e){iT.registerUpdater(e)};kl.unregisterUpdater=function(e){iT.unregisterUpdater(e)};kl.prototype.update=function(e){let t=this._addedObjects,n=t.values,i=this._removedObjects,o=i.values,r=this._changedObjects,s=r.values,a,c,d,u,m=this;for(a=s.length-1;a>-1;a--)c=s[a],d=c.id,u=this._updaterSets.get(d),u.entity===c?u.forEach(function(x){m._removeUpdater(x),m._insertUpdaterIntoBatch(e,x)}):(o.push(c),n.push(c));for(a=o.length-1;a>-1;a--)c=o[a],d=c.id,u=this._updaterSets.get(d),u.forEach(this._removeUpdater.bind(this)),u.destroy(),this._updaterSets.remove(d),this._subscriptions.get(d)(),this._subscriptions.remove(d);for(a=n.length-1;a>-1;a--)c=n[a],d=c.id,u=new iT(c,this._scene),this._updaterSets.set(d,u),u.forEach(function(x){m._insertUpdaterIntoBatch(e,x)}),this._subscriptions.set(d,u.geometryChanged.addEventListener(kl._onGeometryChanged,this));t.removeAll(),i.removeAll(),r.removeAll();let p=!0,b=this._batches,f=b.length;for(a=0;a<f;a++)p=b[a].update(e)&&p;return p};var v6e=[],w6e=new ce;kl.prototype.getBoundingSphere=function(e,t){let n=v6e,i=w6e,o=0,r=ht.DONE,s=this._batches,a=s.length,c=e.id,d=this._updaterSets.get(c).updaters;for(let u=0;u<d.length;u++){let m=d[u];for(let p=0;p<a;p++){if(r=s[p].getBoundingSphere(m,i),r===ht.PENDING)return ht.PENDING;r===ht.DONE&&(n[o]=ce.clone(i,n[o]),o++)}}return o===0?ht.FAILED:(n.length=o,ce.fromBoundingSpheres(n,t),ht.DONE)};kl.prototype.isDestroyed=function(){return!1};kl.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(kl.prototype._onCollectionChanged,this),this._addedObjects.removeAll(),this._removedObjects.removeAll();let e,t=this._batches,n=t.length;for(e=0;e<n;e++)t[e].removeAllPrimitives();let i=this._subscriptions.values;for(n=i.length,e=0;e<n;e++)i[e]();this._subscriptions.removeAll();let o=this._updaterSets.values;for(n=o.length,e=0;e<n;e++)o[e].destroy();return this._updaterSets.removeAll(),me(this)};kl.prototype._removeUpdater=function(e){let t=this._batches,n=t.length;for(let i=0;i<n;i++)t[i].remove(e)};kl.prototype._insertUpdaterIntoBatch=function(e,t){if(t.isDynamic){this._dynamicBatch.add(e,t);return}let n;(t.outlineEnabled||t.fillEnabled)&&(n=t.shadowsProperty.getValue(e));let i=_n.NUMBER_OF_SHADOW_MODES;if(t.outlineEnabled&&(l(t.terrainOffsetProperty)?this._outlineBatches[i+n].add(e,t):this._outlineBatches[n].add(e,t)),t.fillEnabled)if(t.onTerrain){let o=t.classificationTypeProperty.getValue(e);t.fillMaterialProperty instanceof kt?this._groundColorBatches[o].add(e,t):this._groundMaterialBatches[o].add(e,t)}else t.isClosed?t.fillMaterialProperty instanceof kt?l(t.terrainOffsetProperty)?this._closedColorBatches[i+n].add(e,t):this._closedColorBatches[n].add(e,t):l(t.terrainOffsetProperty)?this._closedMaterialBatches[i+n].add(e,t):this._closedMaterialBatches[n].add(e,t):t.fillMaterialProperty instanceof kt?l(t.terrainOffsetProperty)?this._openColorBatches[i+n].add(e,t):this._openColorBatches[n].add(e,t):l(t.terrainOffsetProperty)?this._openMaterialBatches[i+n].add(e,t):this._openMaterialBatches[n].add(e,t)};kl._onGeometryChanged=function(e){let t=this._removedObjects,n=this._changedObjects,i=e.entity,o=i.id;!l(t.get(o))&&!l(n.get(o))&&n.set(o,i)};kl.prototype._onCollectionChanged=function(e,t,n){let i=this._addedObjects,o=this._removedObjects,r=this._changedObjects,s,a,c;for(s=n.length-1;s>-1;s--)c=n[s],a=c.id,i.remove(a)||(o.set(a,c),r.remove(a));for(s=t.length-1;s>-1;s--)c=t[s],a=c.id,o.remove(a)?r.set(a,c):i.set(a,c)};var DP=kl;var Mii=T(S(),1);var F6e=1,A6e=\"30px sans-serif\",M6e=wo.FILL,N6e=O.WHITE,k6e=O.BLACK,U6e=1,D6e=!1,B6e=new O(.165,.165,.165,.8),Y6e=new D(7,5),O6e=D.ZERO,z6e=h.ZERO,H6e=Je.NONE,K6e=ui.CENTER,J6e=Wn.CENTER,Q6e=new h,j6e=new O,q6e=new O,$6e=new O,eqe=new D,tqe=new h,nqe=new D,iqe=new At,oqe=new At,rqe=new At,sqe=new It;function ahe(e){this.entity=e,this.label=void 0,this.index=void 0}function Yy(e,t){t.collectionChanged.addEventListener(Yy.prototype._onCollectionChanged,this),this._cluster=e,this._entityCollection=t,this._items=new Lt,this._onCollectionChanged(t,t.values,[],[])}Yy.prototype.update=function(e){let t=this._items.values,n=this._cluster;for(let i=0,o=t.length;i<o;i++){let r=t[i],s=r.entity,a=s._label,c,d=r.label,u=s.isShowing&&s.isAvailable(e)&&K.getValueOrDefault(a._show,e,!0),m;if(u&&(m=K.getValueOrUndefined(s._position,e,Q6e),c=K.getValueOrUndefined(a._text,e),u=l(m)&&l(c)),!u){cJ(r,s,n);continue}K.isConstant(s._position)||(n._clusterDirty=!0);let p=!1,b=K.getValueOrDefault(a._heightReference,e,H6e);l(d)||(d=n.getLabel(s),d.id=s,r.label=d,p=h.equals(d.position,m)&&d.heightReference===b),d.show=!0,d.position=m,d.text=c,d.scale=K.getValueOrDefault(a._scale,e,F6e),d.font=K.getValueOrDefault(a._font,e,A6e),d.style=K.getValueOrDefault(a._style,e,M6e),d.fillColor=K.getValueOrDefault(a._fillColor,e,N6e,j6e),d.outlineColor=K.getValueOrDefault(a._outlineColor,e,k6e,q6e),d.outlineWidth=K.getValueOrDefault(a._outlineWidth,e,U6e),d.showBackground=K.getValueOrDefault(a._showBackground,e,D6e),d.backgroundColor=K.getValueOrDefault(a._backgroundColor,e,B6e,$6e),d.backgroundPadding=K.getValueOrDefault(a._backgroundPadding,e,Y6e,eqe),d.pixelOffset=K.getValueOrDefault(a._pixelOffset,e,O6e,nqe),d.eyeOffset=K.getValueOrDefault(a._eyeOffset,e,z6e,tqe),d.heightReference=b,d.horizontalOrigin=K.getValueOrDefault(a._horizontalOrigin,e,K6e),d.verticalOrigin=K.getValueOrDefault(a._verticalOrigin,e,J6e),d.translucencyByDistance=K.getValueOrUndefined(a._translucencyByDistance,e,iqe),d.pixelOffsetScaleByDistance=K.getValueOrUndefined(a._pixelOffsetScaleByDistance,e,oqe),d.scaleByDistance=K.getValueOrUndefined(a._scaleByDistance,e,rqe),d.distanceDisplayCondition=K.getValueOrUndefined(a._distanceDisplayCondition,e,sqe),d.disableDepthTestDistance=K.getValueOrUndefined(a._disableDepthTestDistance,e),d.depthFailTranslucency=K.getValueOrUndefined(a._depthFailTranslucency,e),p&&d._updateClamping()}return!0};Yy.prototype.getBoundingSphere=function(e,t){let n=this._items.get(e.id);if(!l(n)||!l(n.label))return ht.FAILED;let i=n.label;return t.center=h.clone(g(i._clampedPosition,i.position),t.center),t.radius=0,ht.DONE};Yy.prototype.isDestroyed=function(){return!1};Yy.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Yy.prototype._onCollectionChanged,this);let e=this._entityCollection.values;for(let t=0;t<e.length;t++)this._cluster.removeLabel(e[t]);return me(this)};Yy.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s=this._items,a=this._cluster;for(o=t.length-1;o>-1;o--)r=t[o],l(r._label)&&l(r._position)&&s.set(r.id,new ahe(r));for(o=i.length-1;o>-1;o--)r=i[o],l(r._label)&&l(r._position)?s.contains(r.id)||s.set(r.id,new ahe(r)):(cJ(s.get(r.id),r,a),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],cJ(s.get(r.id),r,a),s.remove(r.id)};function cJ(e,t,n){l(e)&&(e.label=void 0,n.removeLabel(t))}var BP=Yy;var roi=T(S(),1);var aqe=1,cqe=0,lqe=!0,dqe=!0,uqe=_n.ENABLED,mqe=Je.NONE,hqe=O.RED,fqe=0,pqe=O.WHITE,bqe=ac.HIGHLIGHT,yqe=.5,gqe=new D(1,1),xqe=new M,_qe=new M,che=new O,lhe=new Array(4),Tqe=new h;function Oy(e,t){t.collectionChanged.addEventListener(Oy.prototype._onCollectionChanged,this),this._scene=e,this._primitives=e.primitives,this._entityCollection=t,this._modelHash={},this._entitiesToVisualize=new Lt,this._onCollectionChanged(t,t.values,[],[])}async function Sqe(e,t,n,i){let o=e._primitives,r=e._modelHash;try{let s=await Ym.fromGltfAsync({url:n,incrementallyLoadTextures:i,scene:e._scene});if(e.isDestroyed()||!l(r[t.id]))return;s.id=t,o.add(s),r[t.id].modelPrimitive=s,s.errorEvent.addEventListener(a=>{l(r[t.id])&&(console.log(a),a.name!==\"TextureError\"&&s.incrementallyLoadTextures&&(r[t.id].loadFailed=!0))})}catch(s){if(e.isDestroyed()||!l(r[t.id]))return;console.log(s),r[t.id].loadFailed=!0}}Oy.prototype.update=function(e){let t=this._entitiesToVisualize.values,n=this._modelHash,i=this._primitives;for(let o=0,r=t.length;o<r;o++){let s=t[o],a=s._model,c,d=n[s.id],u=s.isShowing&&s.isAvailable(e)&&K.getValueOrDefault(a._show,e,!0),m;if(u&&(m=s.computeModelMatrix(e,xqe),c=Xe.createIfNeeded(K.getValueOrUndefined(a._uri,e)),u=l(m)&&l(c)),!u){l(d)&&d.modelPrimitive&&(d.modelPrimitive.show=!1);continue}if(!l(d)||c.url!==d.url){l(d?.modelPrimitive)&&(i.removeAndDestroy(d.modelPrimitive),delete n[s.id]),d={modelPrimitive:void 0,url:c.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFailed:!1,modelUpdated:!1},n[s.id]=d;let f=K.getValueOrDefault(a._incrementallyLoadTextures,e,lqe);Sqe(this,s,c,f)}let p=d.modelPrimitive;if(!l(p))continue;p.show=!0,p.scale=K.getValueOrDefault(a._scale,e,aqe),p.minimumPixelSize=K.getValueOrDefault(a._minimumPixelSize,e,cqe),p.maximumScale=K.getValueOrUndefined(a._maximumScale,e),p.modelMatrix=M.clone(m,p.modelMatrix),p.shadows=K.getValueOrDefault(a._shadows,e,uqe),p.heightReference=K.getValueOrDefault(a._heightReference,e,mqe),p.distanceDisplayCondition=K.getValueOrUndefined(a._distanceDisplayCondition,e),p.silhouetteColor=K.getValueOrDefault(a._silhouetteColor,e,hqe,che),p.silhouetteSize=K.getValueOrDefault(a._silhouetteSize,e,fqe),p.color=K.getValueOrDefault(a._color,e,pqe,che),p.colorBlendMode=K.getValueOrDefault(a._colorBlendMode,e,bqe),p.colorBlendAmount=K.getValueOrDefault(a._colorBlendAmount,e,yqe),p.clippingPlanes=K.getValueOrUndefined(a._clippingPlanes,e),p.clampAnimations=K.getValueOrDefault(a._clampAnimations,e,dqe),p.imageBasedLighting.imageBasedLightingFactor=K.getValueOrDefault(a._imageBasedLightingFactor,e,gqe);let b=K.getValueOrUndefined(a._lightColor,e);if(l(b)&&(O.pack(b,lhe,0),b=h.unpack(lhe,0,Tqe)),p.lightColor=b,p.customShader=K.getValueOrUndefined(a._customShader,e),n[s.id].modelUpdated=!0,p.ready){let f=K.getValueOrDefault(a._runAnimations,e,!0);d.animationsRunning!==f&&(f?p.activeAnimations.addAll({loop:Pl.REPEAT}):p.activeAnimations.removeAll(),d.animationsRunning=f);let x=K.getValueOrUndefined(a._nodeTransformations,e,d.nodeTransformationsScratch);if(l(x)){let V=Object.keys(x);for(let L=0,R=V.length;L<R;++L){let G=V[L],X=x[G];if(!l(X))continue;let v=p.getNode(G);if(!l(v))continue;let W=M.fromTranslationRotationScale(X,_qe);v.matrix=M.multiply(v.originalMatrix,W,W)}}let _=!1,C=K.getValueOrUndefined(a._articulations,e,d.articulationsScratch);if(l(C)){let V=Object.keys(C);for(let L=0,R=V.length;L<R;++L){let G=V[L],X=C[G];l(X)&&(_=!0,p.setArticulationStage(G,X))}}_&&p.applyArticulations()}}return!0};Oy.prototype.isDestroyed=function(){return!1};Oy.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Oy.prototype._onCollectionChanged,this);let e=this._entitiesToVisualize.values,t=this._modelHash,n=this._primitives;for(let i=e.length-1;i>-1;i--)lJ(this,e[i],t,n);return me(this)};var Zk=new h,Cqe=new he;Oy.prototype.getBoundingSphere=function(e,t){let n=this._modelHash[e.id];if(!l(n))return ht.FAILED;if(n.loadFailed)return ht.FAILED;let i=n.modelPrimitive;if(!l(i)||!i.show)return ht.PENDING;if(!i.ready||!n.modelUpdated)return ht.PENDING;let o=this._scene,r=o.globe,s=g(r?.ellipsoid,oe.WGS84);if(i.heightReference!==Je.NONE){let c=i.modelMatrix;Zk.x=c[12],Zk.y=c[13],Zk.z=c[14];let d=s.cartesianToCartographic(Zk,Cqe),u=o.getHeight(d,i.heightReference);return l(u)&&(cu(i.heightReference)?d.height=u:d.height+=u),ce.clone(i.boundingSphere,t),t.center=s.cartographicToCartesian(d),ht.DONE}return ce.clone(i.boundingSphere,t),ht.DONE};Oy.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s=this._entitiesToVisualize,a=this._modelHash,c=this._primitives;for(o=t.length-1;o>-1;o--)r=t[o],l(r._model)&&l(r._position)&&s.set(r.id,r);for(o=i.length-1;o>-1;o--)r=i[o],l(r._model)&&l(r._position)?(Vqe(r,a),s.set(r.id,r)):(lJ(this,r,a,c),s.remove(r.id));for(o=n.length-1;o>-1;o--)r=n[o],lJ(this,r,a,c),s.remove(r.id)};function lJ(e,t,n,i){let o=n[t.id];l(o)&&(i.removeAndDestroy(o.modelPrimitive),delete n[t.id])}function Vqe(e,t){let n=t[e.id];l(n)&&(n.nodeTransformationsScratch={},n.articulationsScratch={})}var YP=Oy;var voi=T(S(),1);var moi=T(S(),1);function zy(e){this._definitionChanged=new ge,this._value=void 0,this._removeSubscription=void 0,this.setValue(e)}Object.defineProperties(zy.prototype,{isConstant:{get:function(){return K.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return l(this._value)?this._value.referenceFrame:no.FIXED}}});zy.prototype.getValue=function(e,t){return this.getValueInReferenceFrame(e,no.FIXED,t)};zy.prototype.setValue=function(e){this._value!==e&&(this._value=e,l(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),l(e)&&(this._removeSubscription=e.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))};zy.prototype.getValueInReferenceFrame=function(e,t,n){if(l(this._value))return n=this._value.getValueInReferenceFrame(e,t,n),l(n)?oe.WGS84.scaleToGeodeticSurface(n,n):void 0};zy.prototype.equals=function(e){return this===e||e instanceof zy&&this._value===e._value};zy.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};var Lf=zy;var Lqe=60,Zqe=1,mhe=new Sn,dJ=new Sn,uJ=new Sn;function dhe(e){this.entity=e,this.polyline=void 0,this.index=void 0,this.updater=void 0}function Rqe(e,t,n,i,o,r,s,a,c){let d=a,u;u=e.getValueInReferenceFrame(t,r,c[d]),l(u)&&(c[d++]=u);let m=!l(o)||te.lessThanOrEquals(o,t)||te.greaterThanOrEquals(o,n),p=0,b=i.length,f=i[p],x=n,_=!1,C,V,L;for(;p<b;){if(!m&&te.greaterThanOrEquals(f,o)&&(u=e.getValueInReferenceFrame(o,r,c[d]),l(u)&&(c[d++]=u),m=!0),te.greaterThan(f,t)&&te.lessThan(f,x)&&!f.equals(o)&&(u=e.getValueInReferenceFrame(f,r,c[d]),l(u)&&(c[d++]=u)),p<b-1){if(s>0&&!_){let R=i[p+1],G=te.secondsDifference(R,f);_=G>s,_&&(C=Math.ceil(G/s),V=0,L=G/Math.max(C,2),C=Math.max(C-1,1))}if(_&&V<C){f=te.addSeconds(f,L,new te),V++;continue}}_=!1,p++,f=i[p]}return u=e.getValueInReferenceFrame(n,r,c[d]),l(u)&&(c[d++]=u),d}function Gqe(e,t,n,i,o,r,s,a){let c,d=0,u=s,m=t,p=Math.max(r,60),b=!l(i)||te.lessThanOrEquals(i,t)||te.greaterThanOrEquals(i,n);for(;te.lessThan(m,n);)!b&&te.greaterThanOrEquals(m,i)&&(b=!0,c=e.getValueInReferenceFrame(i,o,a[u]),l(c)&&(a[u]=c,u++)),c=e.getValueInReferenceFrame(m,o,a[u]),l(c)&&(a[u]=c,u++),d++,m=te.addSeconds(t,p*d,new te);return c=e.getValueInReferenceFrame(n,o,a[u]),l(c)&&(a[u]=c,u++),u}function Eqe(e,t,n,i,o,r,s,a){uJ.start=t,uJ.stop=n;let c=s,d=e.intervals;for(let u=0;u<d.length;u++){let m=d.get(u);if(!Sn.intersect(m,uJ,mhe).isEmpty){let p=m.start;m.isStartIncluded||(m.isStopIncluded?p=m.stop:p=te.addSeconds(m.start,te.secondsDifference(m.stop,m.start)/2,new te));let b=e.getValueInReferenceFrame(p,o,a[c]);l(b)&&(a[c]=b,c++)}}return c}function Xqe(e,t,n,i,o,r,s,a){let c=e.getValueInReferenceFrame(t,o,a[s]);return l(c)&&(a[s++]=c),s}function Iqe(e,t,n,i,o,r,s,a){dJ.start=t,dJ.stop=n;let c=s,d=e.intervals;for(let u=0;u<d.length;u++){let m=d.get(u);if(!Sn.intersect(m,dJ,mhe).isEmpty){let p=m.start,b=m.stop,f=t;te.greaterThan(p,f)&&(f=p);let x=n;te.lessThan(b,x)&&(x=b),c=hhe(m.data,f,x,i,o,r,c,a)}}return c}function hhe(e,t,n,i,o,r,s,a){for(;e instanceof I0;)e=e.resolvedProperty;if(e instanceof la){let c=e._property._times;s=Rqe(e,t,n,c,i,o,r,s,a)}else e instanceof aa?s=Iqe(e,t,n,i,o,r,s,a):e instanceof W0?s=Eqe(e,t,n,i,o,r,s,a):e instanceof kc||e instanceof Lf&&K.isConstant(e)?s=Xqe(e,t,n,i,o,r,s,a):s=Gqe(e,t,n,i,o,r,s,a);return s}function fhe(e,t,n,i,o,r,s){l(s)||(s=[]);let a=hhe(e,t,n,i,o,r,0,s);return s.length=a,s}var uhe=new $;function OP(e,t){this._unusedIndexes=[],this._polylineCollection=new zm,this._scene=e,this._referenceFrame=t,e.primitives.add(this._polylineCollection)}OP.prototype.update=function(e){if(this._referenceFrame===no.INERTIAL){let t=Wt.computeIcrfToFixedMatrix(e,uhe);l(t)||(t=Wt.computeTemeToPseudoFixedMatrix(e,uhe)),M.fromRotationTranslation(t,h.ZERO,this._polylineCollection.modelMatrix)}};OP.prototype.updateObject=function(e,t){let n=t.entity,i=n._path,o=n._position,r,s,a=i._show,c=t.polyline,d=n.isShowing&&n.isAvailable(e)&&(!l(a)||a.getValue(e));if(d){let m=K.getValueOrUndefined(i._leadTime,e),p=K.getValueOrUndefined(i._trailTime,e),b=n._availability,f=l(b),x=l(m),_=l(p);if(d=f||x&&_,d){if(_&&(r=te.addSeconds(e,-p,new te)),x&&(s=te.addSeconds(e,m,new te)),f){let C=b.start,V=b.stop;(!_||te.greaterThan(C,r))&&(r=C),(!x||te.lessThan(V,s))&&(s=V)}d=te.lessThan(r,s)}}if(!d){l(c)&&(this._unusedIndexes.push(t.index),t.polyline=void 0,c.show=!1,t.index=void 0);return}if(!l(c)){let m=this._unusedIndexes;if(m.length>0){let b=m.pop();c=this._polylineCollection.get(b),t.index=b}else t.index=this._polylineCollection.length,c=this._polylineCollection.add();c.id=n,t.polyline=c}let u=K.getValueOrDefault(i._resolution,e,Lqe);c.show=!0,c.positions=fhe(o,r,s,e,this._referenceFrame,u,c.positions.slice()),c.material=Oo.getValue(e,i._material,c.material),c.width=K.getValueOrDefault(i._width,e,Zqe),c.distanceDisplayCondition=K.getValueOrUndefined(i._distanceDisplayCondition,e,c.distanceDisplayCondition)};OP.prototype.removeObject=function(e){let t=e.polyline;l(t)&&(this._unusedIndexes.push(e.index),e.polyline=void 0,t.show=!1,t.id=void 0,e.index=void 0)};OP.prototype.destroy=function(){return this._scene.primitives.remove(this._polylineCollection),me(this)};function Hy(e,t){t.collectionChanged.addEventListener(Hy.prototype._onCollectionChanged,this),this._scene=e,this._updaters={},this._entityCollection=t,this._items=new Lt,this._onCollectionChanged(t,t.values,[],[])}Hy.prototype.update=function(e){let t=this._updaters;for(let i in t)t.hasOwnProperty(i)&&t[i].update(e);let n=this._items.values;if(n.length===0&&l(this._updaters)&&Object.keys(this._updaters).length>0){for(let i in t)t.hasOwnProperty(i)&&t[i].destroy();this._updaters={}}for(let i=0,o=n.length;i<o;i++){let r=n[i],a=r.entity._position,c=r.updater,d=no.FIXED;this._scene.mode===ie.SCENE3D&&(d=a.referenceFrame);let u=this._updaters[d];if(c===u&&l(u)){u.updateObject(e,r);continue}l(c)&&c.removeObject(r),l(u)||(u=new OP(this._scene,d),u.update(e),this._updaters[d]=u),r.updater=u,l(u)&&u.updateObject(e,r)}return!0};Hy.prototype.isDestroyed=function(){return!1};Hy.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(Hy.prototype._onCollectionChanged,this);let e=this._updaters;for(let t in e)e.hasOwnProperty(t)&&e[t].destroy();return me(this)};Hy.prototype._onCollectionChanged=function(e,t,n,i){let o,r,s,a=this._items;for(o=t.length-1;o>-1;o--)r=t[o],l(r._path)&&l(r._position)&&a.set(r.id,new dhe(r));for(o=i.length-1;o>-1;o--)r=i[o],l(r._path)&&l(r._position)?a.contains(r.id)||a.set(r.id,new"
}