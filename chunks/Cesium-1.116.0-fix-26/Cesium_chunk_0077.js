{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 77,
    "total_chunks": 194,
    "chunk_size": 28007,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.692Z"
  },
  "content": "parseInt(n[1])}var z5e={gltfSemantic:void 0,renamedSemantic:void 0,modelSemantic:void 0};function Ez(e,t,n){let i=n;e._renameBatchIdSemantic&&(n===\"_BATCHID\"||n===\"BATCHID\")&&(i=\"_FEATURE_ID_0\");let o=t.fromGltfSemantic(i),r=z5e;return r.gltfSemantic=n,r.renamedSemantic=i,r.modelSemantic=o,r}function H5e(e){let t=e===St.POSITION,n=e===St.FEATURE_ID,i=e===St.TEXCOORD;return t||n||i}function K5e(e,t,n,i){if(e.byteOffset=0,e.byteStride=void 0,e.quantization=t.quantization,n&&(e.buffer=t.buffer),i){let o=l(t.quantization)?t.quantization.componentDatatype:e.componentDatatype;e.typedArray=Q.createArrayBufferView(o,t.typedArray.buffer)}}function J5e(e,t,n,i,o,r){if(o&&(n.buffer=i.buffer),r){let s=i.typedArray;n.typedArray=mre(e,t,s),o||(n.byteOffset=0,n.byteStride=void 0)}}function fre(e,t,n,i,o,r,s,a){let c=t.accessors[n],d=c.bufferView,u=i.gltfSemantic,m=i.renamedSemantic,p=i.modelSemantic,b=l(p)?hre(m):void 0,x=O5e(t,n,u,p,b);if(!l(o)&&!l(d))return x;let _=v5e(e,t,n,u,o,r,s,a),C=e._geometryLoaders.length;e._geometryLoaders.push(_);let V=_.load();return e._loaderPromises.push(V),e._geometryCallbacks[C]=()=>{l(o)&&l(o.attributes)&&l(o.attributes[u])?K5e(x,_,r,s):J5e(t,c,x,_,r,s)},x}function pre(e,t,n,i,o,r,s,a){let c=i.modelSemantic,d=c===St.POSITION,u=c===St.FEATURE_ID,m=d&&!r&&e._loadAttributesFor2D&&!a.scene3DOnly,p=d&&e._enablePick&&!a.context.webgl2,b=e._loadForClassification&&u,f=e._loadAttributesAsTypedArray,x=!f,_=f||m||p||b,L=fre(e,t,n,i,o,s?!1:x,s?!0:_,a),R=new a_.AttributeLoadPlan(L);return R.loadBuffer=x,R.loadTypedArray=_,R}function Q5e(e,t,n,i,o,r){let s=l(i.ROTATION),a=l(i.TRANSLATION)&&l(t.accessors[i.TRANSLATION].min)&&l(t.accessors[i.TRANSLATION].max),c=Ez(e,zr,o),d=c.modelSemantic,u=d===zr.TRANSLATION||d===zr.ROTATION||d===zr.SCALE,m=d===zr.TRANSLATION,p=e._loadAttributesAsTypedArray||s&&u||!r.context.instancedArrays,b=e._enablePick&&!r.context.webgl2,f=!p,x=e._loadAttributesFor2D&&!r.scene3DOnly;return fre(e,t,n,c,void 0,f,p||m&&(!a||x||b),r)}function j5e(e,t,n,i,o,r,s){let a=t.accessors[n],c=a.bufferView;if(!l(i)&&!l(c))return;let d=new d5e;d.count=a.count;let u=e._loadAttributesAsTypedArray,m=(e._loadIndicesForWireframe||e._enablePick)&&!s.context.webgl2,p=e._loadForClassification&&o,f=!u,x=u||m||p,V=w5e(e,t,n,i,r?!1:f,r?!0:x,s),L=e._geometryLoaders.length;e._geometryLoaders.push(V);let R=V.load();e._loaderPromises.push(R),e._geometryCallbacks[L]=()=>{d.indexDatatype=V.indexDatatype,d.buffer=V.buffer,d.typedArray=V.typedArray};let G=new a_.IndicesLoadPlan(d);return G.loadBuffer=f,G.loadTypedArray=x,G}function zp(e,t,n,i,o,r){let s=Il.getImageIdFromTexture({gltf:t,textureId:n.index,supportedImageFormats:i});if(!l(s))return;let a=Di.getTextureLoader({gltf:t,textureInfo:n,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:i,frameState:o,asynchronous:e._asynchronous}),c=Il.createModelTextureReader({textureInfo:n}),d=e._textureLoaders.length;e._textureLoaders.push(a);let u=a.load().catch(m=>{if(!e.isDestroyed()){if(!e._incrementallyLoadTextures)throw m;e._textureState=Eo.FAILED,e._textureErrors.push(m)}});return e._texturesPromises.push(u),e._textureCallbacks[d]=()=>{c.texture=a.texture,l(r)&&(c.texture.sampler=r)},c}function q5e(e,t,n,i,o){let r=new G5e,s=g(n.extensions,g.EMPTY_OBJECT),a=s.KHR_materials_pbrSpecularGlossiness,c=n.pbrMetallicRoughness;if(r.unlit=l(s.KHR_materials_unlit),l(a)){let d=new R5e;r.specularGlossiness=d,l(a.diffuseTexture)&&(d.diffuseTexture=zp(e,t,a.diffuseTexture,i,o)),l(a.specularGlossinessTexture)&&l(a.specularGlossinessTexture)&&(d.specularGlossinessTexture=zp(e,t,a.specularGlossinessTexture,i,o)),d.diffuseFactor=yu(se,a.diffuseFactor),d.specularFactor=yu(h,a.specularFactor),d.glossinessFactor=a.glossinessFactor,r.pbrSpecularGlossiness=a}else if(l(c)){let d=new Z5e;l(c.baseColorTexture)&&(d.baseColorTexture=zp(e,t,c.baseColorTexture,i,o)),l(c.metallicRoughnessTexture)&&(d.metallicRoughnessTexture=zp(e,t,c.metallicRoughnessTexture,i,o)),d.baseColorFactor=yu(se,c.baseColorFactor),d.metallicFactor=c.metallicFactor,d.roughnessFactor=c.roughnessFactor,r.metallicRoughness=d}return l(n.emissiveTexture)&&(r.emissiveTexture=zp(e,t,n.emissiveTexture,i,o)),l(n.normalTexture)&&!e._loadForClassification&&(r.normalTexture=zp(e,t,n.normalTexture,i,o)),l(n.occlusionTexture)&&(r.occlusionTexture=zp(e,t,n.occlusionTexture,i,o)),r.emissiveFactor=yu(h,n.emissiveFactor),r.alphaMode=n.alphaMode,r.alphaCutoff=n.alphaCutoff,r.doubleSided=n.doubleSided,r}function bre(e,t){let n=new lre;return n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.propertyTableId=e.propertyTable,n.setIndex=e.attribute,n.label=e.label,n.positionalLabel=t,n}function yre(e,t,n,i){let o=new lre,r=e.featureIds;return o.featureCount=n,o.propertyTableId=t,o.setIndex=hre(r.attribute),o.positionalLabel=i,o}function gre(e,t){let n=new ure;return n.propertyTableId=e.propertyTable,n.featureCount=e.featureCount,n.nullFeatureId=e.nullFeatureId,n.label=e.label,n.positionalLabel=t,n.offset=0,n.repeat=1,n}function xre(e,t,n,i){let o=new ure,r=e.featureIds;o.propertyTableId=t,o.featureCount=n,o.offset=g(r.constant,0);let s=g(r.divisor,0);return o.repeat=s===0?void 0:s,o.positionalLabel=i,o}function $5e(e,t,n,i,o,r){let s=new dre;s.featureCount=n.featureCount,s.nullFeatureId=n.nullFeatureId,s.propertyTableId=n.propertyTable,s.label=n.label,s.positionalLabel=r;let a=n.texture;s.textureReader=zp(e,t,a,i,o,mn.NEAREST);let d=(l(a.channels)?a.channels:[0]).map(function(u){return\"rgba\".charAt(u)}).join(\"\");return s.textureReader.channels=d,s}function eNe(e,t,n,i,o,r,s,a){let c=new dre,d=n.featureIds,u=d.texture;return c.featureCount=s,c.propertyTableId=i,c.textureReader=zp(e,t,u,o,r,mn.NEAREST),c.textureReader.channels=d.channels,c.positionalLabel=a,c}function tNe(e,t,n,i,o,r){let s=new u5e,a=void 0,c=!1;for(let d in n)if(n.hasOwnProperty(d)){let u=n[d],m=Ez(e,St,d),p=pre(e,t,u,m,a,c,i,r);s.attributes.push(p.attribute),o.attributePlans.push(p)}return s}function nNe(e,t,n,i,o,r){let s=new m5e,a=new a_(s);e._primitiveLoadPlans.push(a);let c=n.material;l(c)&&(s.material=q5e(e,t,t.materials[c],o,r));let d=g(n.extensions,g.EMPTY_OBJECT),u=!1,m=d.CESIUM_primitive_outline;e._loadPrimitiveOutline&&l(m)&&(u=!0,a.needsOutlines=!0,a.outlineIndices=iNe(e,t,m,a));let p=e._loadForClassification,b=d.KHR_draco_mesh_compression,f=!1,x=n.attributes;if(l(x)){for(let v in x)if(x.hasOwnProperty(v)){let W=x[v],F=Ez(e,St,v),A=F.modelSemantic;if(p&&!H5e(A))continue;A===St.FEATURE_ID&&(f=!0);let y=pre(e,t,W,F,b,i,u,r);a.attributePlans.push(y),s.attributes.push(y.attribute)}}let _=n.targets;if(l(_)&&!p){let v=_.length;for(let W=0;W<v;++W)s.morphTargets.push(tNe(e,t,_[W],u,a,r))}let C=n.indices;if(l(C)){let v=j5e(e,t,C,b,f,u,r);l(v)&&(a.indicesPlan=v,s.indices=v.indices)}let V=d.EXT_structural_metadata,L=d.EXT_mesh_features,R=d.EXT_feature_metadata,G=l(R);l(L)?oNe(e,t,s,L,o,r):G&&rNe(e,t,s,R,o,r),l(V)?sNe(s,V):G&&aNe(e,s,R);let X=n.mode;if(p&&X!==we.TRIANGLES)throw new ue(\"Only triangle meshes can be used for classification.\");return s.primitiveType=X,s}function iNe(e,t,n){let i=n.indices;return rN(e,t,i,!1)}function oNe(e,t,n,i,o,r){let s;l(i)&&l(i.featureIds)?s=i.featureIds:s=[];for(let a=0;a<s.length;a++){let c=s[a],d=`featureId_${a}`,u;l(c.texture)?u=$5e(e,t,c,o,r,d):l(c.attribute)?u=bre(c,d):u=gre(c,d),n.featureIds.push(u)}}function rNe(e,t,n,i,o,r){let s=t.extensions.EXT_feature_metadata.featureTables,a=0,c=i.featureIdAttributes;if(l(c)){let u=c.length;for(let m=0;m<u;++m){let p=c[m],b=p.featureTable,f=e._sortedPropertyTableIds.indexOf(b),x=s[b].count,_=`featureId_${a}`;a++;let C;l(p.featureIds.attribute)?C=yre(p,f,x,_):C=xre(p,f,x,_),n.featureIds.push(C)}}let d=i.featureIdTextures;if(l(d)){let u=d.length;for(let m=0;m<u;++m){let p=d[m],b=p.featureTable,f=e._sortedPropertyTableIds.indexOf(b),x=s[b].count,_=`featureId_${a}`;a++;let C=eNe(e,t,p,f,o,r,x,_);n.featureIds.push(C)}}}function sNe(e,t){l(t)&&(l(t.propertyTextures)&&(e.propertyTextureIds=t.propertyTextures),l(t.propertyAttributes)&&(e.propertyAttributeIds=t.propertyAttributes))}function aNe(e,t,n){l(n.featureTextures)&&(t.propertyTextureIds=n.featureTextures.map(function(i){return e._sortedFeatureTextureIds.indexOf(i)}))}function cNe(e,t,n,i){let o=n.EXT_mesh_gpu_instancing,r=new h5e,s=o.attributes;if(l(s)){for(let u in s)if(s.hasOwnProperty(u)){let m=s[u];r.attributes.push(Q5e(e,t,m,s,u,i))}}let a=g(o.extensions,g.EMPTY_OBJECT),c=n.EXT_instance_features,d=a.EXT_feature_metadata;return l(c)?lNe(r,c):l(d)&&dNe(t,r,d,e._sortedPropertyTableIds),r}function lNe(e,t){let n=t.featureIds;for(let i=0;i<n.length;i++){let o=n[i],r=`instanceFeatureId_${i}`,s;l(o.attribute)?s=bre(o,r):s=gre(o,r),e.featureIds.push(s)}}function dNe(e,t,n,i){let o=e.extensions.EXT_feature_metadata.featureTables,r=n.featureIdAttributes;if(l(r)){let s=r.length;for(let a=0;a<s;++a){let c=r[a],d=c.featureTable,u=i.indexOf(d),m=o[d].count,p=`instanceFeatureId_${a}`,b;l(c.featureIds.attribute)?b=yre(c,u,m,p):b=xre(c,u,m,p),t.featureIds.push(b)}}}function uNe(e,t,n,i,o){let r=new p5e;r.name=n.name,r.matrix=yu(M,n.matrix),r.translation=yu(h,n.translation),r.rotation=yu(Fe,n.rotation),r.scale=yu(h,n.scale);let s=g(n.extensions,g.EMPTY_OBJECT),a=s.EXT_mesh_gpu_instancing,c=s.AGI_articulations;if(l(a)){if(e._loadForClassification)throw new ue(\"Models with the EXT_mesh_gpu_instancing extension cannot be used for classification.\");r.instances=cNe(e,t,s,o)}l(c)&&(r.articulationName=c.articulationName);let d=n.mesh;if(l(d)){let u=t.meshes[d],m=u.primitives,p=m.length;for(let _=0;_<p;++_)r.primitives.push(nNe(e,t,m[_],l(r.instances),i,o));let b=g(n.weights,u.weights),x=r.primitives[0].morphTargets.length;r.morphWeights=l(b)?b.slice():new Array(x).fill(0)}return r}function mNe(e,t,n,i){if(!l(t.nodes))return[];let o,r,s=t.nodes.length,a=new Array(s);for(o=0;o<s;++o){let c=uNe(e,t,t.nodes[o],n,i);c.index=o,a[o]=c}for(o=0;o<s;++o){let c=t.nodes[o].children;if(l(c)){let d=c.length;for(r=0;r<d;++r)a[o].children.push(a[c[r]])}}return a}function hNe(e,t,n,i){let o=new f5e,r=n.joints,s=r.length,a=new Array(s);for(let d=0;d<s;++d)a[d]=i[r[d]];o.joints=a;let c=n.inverseBindMatrices;return l(c)?o.inverseBindMatrices=rN(e,t,c):o.inverseBindMatrices=new Array(s).fill(M.IDENTITY),o}function fNe(e,t,n){let i=t.skins;if(e._loadForClassification||!l(i))return[];let o=t.skins.length,r=new Array(o);for(let a=0;a<o;++a){let c=hNe(e,t,t.skins[a],n);c.index=a,r[a]=c}let s=n.length;for(let a=0;a<s;++a){let c=t.nodes[a].skin;l(c)&&(n[a].skin=r[c])}return r}async function pNe(e,t,n,i,o,r){let s=new jX({gltf:t,extension:n,extensionLegacy:i,gltfResource:e._gltfResource,baseResource:e._baseResource,supportedImageFormats:o,frameState:r,asynchronous:e._asynchronous});return e._structuralMetadataLoader=s,s.load()}function bNe(e,t,n){let i=new y5e,o=n.input;i.input=rN(e,t,o);let r=n.interpolation;i.interpolation=g(Nm[r],Nm.LINEAR);let s=n.output;return i.output=rN(e,t,s,!0),i}function yNe(e,t){let n=new g5e,i=e.node;if(!l(i))return;n.node=t[i];let o=e.path.toUpperCase();return n.path=b5e[o],n}function gNe(e,t,n){let i=new x5e,o=e.sampler;return i.sampler=t[o],i.target=yNe(e.target,n),i}function xNe(e,t,n,i){let o,r=new _5e;r.name=n.name;let s=n.samplers,a=s.length,c=new Array(a);for(o=0;o<a;o++){let p=bNe(e,t,s[o]);p.index=o,c[o]=p}let d=n.channels,u=d.length,m=new Array(u);for(o=0;o<u;o++)m[o]=gNe(d[o],c,i);return r.samplers=c,r.channels=m,r}function _Ne(e,t,n){let i=t.animations;if(e._loadForClassification||!l(i))return[];let o=t.animations.length,r=new Array(o);for(let s=0;s<o;++s){let a=xNe(e,t,t.animations[s],n);a.index=s,r[s]=a}return r}function TNe(e){let t=new T5e;t.name=e.name;let n=e.type.toUpperCase();return t.type=cc[n],t.minimumValue=e.minimumValue,t.maximumValue=e.maximumValue,t.initialValue=e.initialValue,t}function SNe(e){let t=new S5e;t.name=e.name;let n=e.stages,i=n.length,o=new Array(i);for(let r=0;r<i;r++){let s=TNe(n[r]);o[r]=s}return t.stages=o,t}function CNe(e){let n=g(e.extensions,g.EMPTY_OBJECT).AGI_articulations;if(!l(n))return[];let i=n.articulations;if(!l(i))return[];let o=i.length,r=new Array(o);for(let s=0;s<o;s++){let a=SNe(i[s]);r[s]=a}return r}function VNe(e){let t;return l(e.scenes)&&l(e.scene)&&(t=e.scenes[e.scene].nodes),t=g(t,e.nodes),t=l(t)?t:[],t}function LNe(e,t){let n=new V5e,i=VNe(e);return n.nodes=i.map(function(o){return t[o]}),n}var ZNe=new h;function RNe(e,t,n,i){let o=g(t.extensions,g.EMPTY_OBJECT),r=o.EXT_structural_metadata,s=o.EXT_feature_metadata,a=o.CESIUM_RTC;if(l(s)){let C=s.featureTables,V=s.featureTextures,L=l(C)?C:[],R=l(V)?V:[];e._sortedPropertyTableIds=Object.keys(L).sort(),e._sortedFeatureTextureIds=Object.keys(R).sort()}let c=mNe(e,t,n,i),d=fNe(e,t,c),u=_Ne(e,t,c),m=CNe(t),p=LNe(t,c),b=new L5e,f=new C5e,x=t.asset.copyright;if(l(x)){let C=x.split(\";\").map(function(V){return new Zt(V.trim())});f.credits=C}if(b.asset=f,b.scene=p,b.nodes=c,b.skins=d,b.animations=u,b.articulations=m,b.upAxis=e._upAxis,b.forwardAxis=e._forwardAxis,l(a)){let C=h.fromArray(a.center,0,ZNe);b.transform=M.fromTranslation(C,b.transform)}if(e._components=b,l(r)||l(s)){let C=pNe(e,t,r,s,n,i);e._loaderPromises.push(C)}let _=[];return _.push.apply(_,e._loaderPromises),e._incrementallyLoadTextures||_.push.apply(_,e._texturesPromises),Promise.all(_)}function GNe(e){let t=e._textureLoaders,n=t.length;for(let i=0;i<n;++i)t[i]=!t[i].isDestroyed()&&Di.unload(t[i]);e._textureLoaders.length=0}function _re(e){let t=e._bufferViewLoaders,n=t.length;for(let i=0;i<n;++i)t[i]=!t[i].isDestroyed()&&Di.unload(t[i]);e._bufferViewLoaders.length=0}function ENe(e){let t=e._geometryLoaders,n=t.length;for(let i=0;i<n;++i)t[i]=!t[i].isDestroyed()&&Di.unload(t[i]);e._geometryLoaders.length=0}function XNe(e){let t=e._postProcessBuffers,n=t.length;for(let i=0;i<n;i++){let o=t[i];o.isDestroyed()||o.destroy()}t.length=0}function INe(e){l(e._structuralMetadataLoader)&&!e._structuralMetadataLoader.isDestroyed()&&(e._structuralMetadataLoader.destroy(),e._structuralMetadataLoader=void 0)}km.prototype.isUnloaded=function(){return this._state===Eo.UNLOADED};km.prototype.unload=function(){l(this._gltfJsonLoader)&&!this._gltfJsonLoader.isDestroyed()&&Di.unload(this._gltfJsonLoader),this._gltfJsonLoader=void 0,GNe(this),_re(this),ENe(this),XNe(this),INe(this),this._components=void 0,this._typedArray=void 0,this._state=Eo.UNLOADED};var Hp=km;var zpn=T(S(),1);var Dpn=T(S(),1);var Zpn=T(S(),1),$X=`uniform sampler2D u_pointCloud_colorGBuffer; uniform sampler2D u_pointCloud_depthGBuffer; uniform vec2 u_distanceAndEdlStrength; in vec2 v_textureCoordinates; vec2 neighborContribution(float log2Depth, vec2 offset) { float dist = u_distanceAndEdlStrength.x; vec2 texCoordOrig = v_textureCoordinates + offset * dist; vec2 texCoord0 = v_textureCoordinates + offset * floor(dist); vec2 texCoord1 = v_textureCoordinates + offset * ceil(dist); float depthOrLogDepth0 = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, texCoord0)); float depthOrLogDepth1 = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, texCoord1)); // ignore depth values that are the clear depth if (depthOrLogDepth0 == 0.0 || depthOrLogDepth1 == 0.0) { return vec2(0.0); } // interpolate the two adjacent depth values float depthMix = mix(depthOrLogDepth0, depthOrLogDepth1, fract(dist)); vec4 eyeCoordinate = czm_windowToEyeCoordinates(texCoordOrig, depthMix); return vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0); } void main() { float depthOrLogDepth = czm_unpackDepth(texture(u_pointCloud_depthGBuffer, v_textureCoordinates)); vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth); eyeCoordinate /= eyeCoordinate.w; float log2Depth = log2(-eyeCoordinate.z); if (depthOrLogDepth == 0.0) // 0.0 is the clear value for the gbuffer { discard; } vec4 color = texture(u_pointCloud_colorGBuffer, v_textureCoordinates); // sample from neighbors left, right, down, up vec2 texelSize = 1.0 / czm_viewport.zw; vec2 responseAndCount = vec2(0.0); responseAndCount += neighborContribution(log2Depth, vec2(-texelSize.x, 0.0)); responseAndCount += neighborContribution(log2Depth, vec2(+texelSize.x, 0.0)); responseAndCount += neighborContribution(log2Depth, vec2(0.0, -texelSize.y)); responseAndCount += neighborContribution(log2Depth, vec2(0.0, +texelSize.y)); float response = responseAndCount.x / responseAndCount.y; float strength = u_distanceAndEdlStrength.y; float shade = exp(-response * 300.0 * strength); color.rgb *= shade; out_FragColor = vec4(color); // Input and output depth are the same. gl_FragDepth = depthOrLogDepth; } `;function VC(){this._framebuffer=new li({colorAttachmentsLength:2,depth:!0,supportsDepthTexture:!0}),this._drawCommand=void 0,this._clearCommand=void 0,this._strength=1,this._radius=1}Object.defineProperties(VC.prototype,{framebuffer:{get:function(){return this._framebuffer.framebuffer}},colorGBuffer:{get:function(){return this._framebuffer.getColorTexture(0)}},depthGBuffer:{get:function(){return this._framebuffer.getColorTexture(1)}}});function WNe(e){e._framebuffer.destroy(),e._drawCommand=void 0,e._clearCommand=void 0}var Xz=new D;function PNe(e,t){let n=new Ue({defines:[\"LOG_DEPTH_WRITE\"],sources:[$X]}),i={u_pointCloud_colorGBuffer:function(){return e.colorGBuffer},u_pointCloud_depthGBuffer:function(){return e.depthGBuffer},u_distanceAndEdlStrength:function(){return Xz.x=e._radius,Xz.y=e._strength,Xz}},o=Ne.fromCache({blending:un.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:Mt.setCesium3DTileBit(),stencilMask:Mt.CESIUM_3D_TILE_MASK});e._drawCommand=t.createViewportQuadCommand(n,{uniformMap:i,renderState:o,pass:Ze.CESIUM_3D_TILE,owner:e}),e._clearCommand=new ei({framebuffer:e.framebuffer,color:new O(0,0,0,0),depth:1,renderState:Ne.fromCache(),pass:Ze.CESIUM_3D_TILE,owner:e})}function vNe(e,t){let n=t.drawingBufferWidth,i=t.drawingBufferHeight;e._framebuffer.update(t,n,i),PNe(e,t)}function Tre(e){return e.drawBuffers&&e.fragmentDepth}VC.isSupported=Tre;function wNe(e,t){let n=e.shaderCache.getDerivedShaderProgram(t,\"EC\");if(!l(n)){let i=t._attributeLocations,o=t.fragmentShaderSource.clone();o.sources.splice(0,0,`layout (location = 0) out vec4 out_FragData_0; layout (location = 1) out vec4 out_FragData_1;`),o.sources=o.sources.map(function(r){return r=Ue.replaceMain(r,\"czm_point_cloud_post_process_main\"),r=r.replaceAll(/out_FragColor/g,\"out_FragData_0\"),r}),o.sources.push(`void main() { czm_point_cloud_post_process_main(); #ifdef LOG_DEPTH czm_writeLogDepth(); out_FragData_1 = czm_packDepth(gl_FragDepth); #else out_FragData_1 = czm_packDepth(gl_FragCoord.z); #endif }`),n=e.shaderCache.createDerivedShaderProgram(t,\"EC\",{vertexShaderSource:t.vertexShaderSource,fragmentShaderSource:o,attributeLocations:i})}return n}VC.prototype.update=function(e,t,n,i){if(!Tre(e.context))return;this._strength=n.eyeDomeLightingStrength,this._radius=n.eyeDomeLightingRadius*e.pixelRatio,vNe(this,e.context);let o,r=e.commandList,s=r.length;for(o=t;o<s;++o){let d=r[o];if(d.primitiveType!==we.POINTS||d.pass===Ze.TRANSLUCENT)continue;let u,m,p=d.derivedCommands.pointCloudProcessor;l(p)&&(u=p.command,m=p.originalShaderProgram),(!l(u)||d.dirty||m!==d.shaderProgram||u.framebuffer!==this.framebuffer)&&(u=je.shallowClone(d,u),u.framebuffer=this.framebuffer,u.shaderProgram=wNe(e.context,d.shaderProgram),u.castShadows=!1,u.receiveShadows=!1,l(p)||(p={command:u,originalShaderProgram:d.shaderProgram},d.derivedCommands.pointCloudProcessor=p),p.originalShaderProgram=d.shaderProgram),r[o]=u}let a=this._clearCommand,c=this._drawCommand;c.boundingVolume=i,r.push(c),r.push(a)};VC.prototype.isDestroyed=function(){return!1};VC.prototype.destroy=function(){return WNe(this),me(this)};var Kp=VC;function Sre(e){let t=g(e,{});this.attenuation=g(t.attenuation,!1),this.geometricErrorScale=g(t.geometricErrorScale,1),this.maximumAttenuation=t.maximumAttenuation,this.baseResolution=t.baseResolution,this.ignoreGeometricError=g(t.ignoreGeometricError,!1),this.minimumPointSize=t.minimumPointSize,this.eyeDomeLighting=g(t.eyeDomeLighting,!0),this.eyeDomeLightingStrength=g(t.eyeDomeLightingStrength,1),this.eyeDomeLightingRadius=g(t.eyeDomeLightingRadius,1),this.backFaceCulling=g(t.backFaceCulling,!1),this.normalShading=g(t.normalShading,!0)}Sre.isSupported=function(e){return Kp.isSupported(e.context)};var cf=Sre;var s0n=T(S(),1);var Ia={},FNe=new se(0,0,0,1),dc=new se,ANe=new ze,Iz=new D,Wz=new D;Ia.wgs84ToWindowCoordinates=function(e,t,n){return Ia.wgs84WithEyeOffsetToWindowCoordinates(e,t,h.ZERO,n)};var Cre=new se,Vre=new h;function eI(e,t,n,i){let o=n.viewMatrix,r=M.multiplyByVector(o,se.fromElements(e.x,e.y,e.z,1,Cre),Cre),s=h.multiplyComponents(t,h.normalize(r,Vre),Vre);return r.x+=t.x+s.x,r.y+=t.y+s.y,r.z+=s.z,M.multiplyByVector(n.frustum.projectionMatrix,r,i)}var MNe=new he(Math.PI,P.PI_OVER_TWO),NNe=new h,kNe=new h;Ia.wgs84WithEyeOffsetToWindowCoordinates=function(e,t,n,i){let o=e.frameState,r=Ia.computeActualWgs84Position(o,t,FNe);if(!l(r))return;let s=e.canvas,a=ANe;a.x=0,a.y=0,a.width=s.clientWidth,a.height=s.clientHeight;let c=e.camera,d=!1;if(o.mode===ie.SCENE2D){let u=e.mapProjection,m=MNe,p=u.project(m,NNe),b=h.clone(c.position,kNe),f=c.frustum.clone(),x=M.computeViewportTransformation(a,0,1,new M),_=c.frustum.projectionMatrix,C=c.positionWC.y,V=h.fromElements(P.sign(C)*p.x-C,0,-c.positionWC.x),L=Wt.pointToGLWindowCoordinates(_,x,V);if(C===0||L.x<=0||L.x>=s.clientWidth)d=!0;else{if(L.x>s.clientWidth*.5){a.width=L.x,c.frustum.right=p.x-C,dc=eI(r,n,c,dc),Ia.clipToGLWindowCoordinates(a,dc,Iz),a.x+=L.x,c.position.x=-c.position.x;let R=c.frustum.right;c.frustum.right=-c.frustum.left,c.frustum.left=-R,dc=eI(r,n,c,dc),Ia.clipToGLWindowCoordinates(a,dc,Wz)}else{a.x+=L.x,a.width-=L.x,c.frustum.left=-p.x-C,dc=eI(r,n,c,dc),Ia.clipToGLWindowCoordinates(a,dc,Iz),a.x=a.x-a.width,c.position.x=-c.position.x;let R=c.frustum.left;c.frustum.left=-c.frustum.right,c.frustum.right=-R,dc=eI(r,n,c,dc),Ia.clipToGLWindowCoordinates(a,dc,Wz)}h.clone(b,c.position),c.frustum=f.clone(),i=D.clone(Iz,i),(i.x<0||i.x>s.clientWidth)&&(i.x=Wz.x)}}if(o.mode!==ie.SCENE2D||d){if(dc=eI(r,n,c,dc),dc.z<0&&!(c.frustum instanceof rn)&&!(c.frustum instanceof Vr))return;i=Ia.clipToGLWindowCoordinates(a,dc,i)}return i.y=s.clientHeight-i.y,i};Ia.wgs84ToDrawingBufferCoordinates=function(e,t,n){if(n=Ia.wgs84ToWindowCoordinates(e,t,n),!!l(n))return Ia.transformWindowToDrawingBuffer(e,n,n)};var Jp=new h,UNe=new he;Ia.computeActualWgs84Position=function(e,t,n){let i=e.mode;if(i===ie.SCENE3D)return h.clone(t,n);let o=e.mapProjection,r=o.ellipsoid.cartesianToCartographic(t,UNe);if(!l(r))return;if(o.project(r,Jp),i===ie.COLUMBUS_VIEW)return h.fromElements(Jp.z,Jp.x,Jp.y,n);if(i===ie.SCENE2D)return h.fromElements(0,Jp.x,Jp.y,n);let s=e.morphTime;return h.fromElements(P.lerp(Jp.z,t.x,s),P.lerp(Jp.x,t.y,s),P.lerp(Jp.y,t.z,s),n)};var Lre=new h,Zre=new h,Rre=new M;Ia.clipToGLWindowCoordinates=function(e,t,n){return h.divideByScalar(t,t.w,Lre),M.computeViewportTransformation(e,0,1,Rre),M.multiplyByPoint(Rre,Lre,Zre),D.fromCartesian3(Zre,n)};Ia.transformWindowToDrawingBuffer=function(e,t,n){let i=e.canvas,o=e.drawingBufferWidth/i.clientWidth,r=e.drawingBufferHeight/i.clientHeight;return D.fromElements(t.x*o,t.y*r,n)};var DNe=new se,Gre=new se;Ia.drawingBufferToWgs84Coordinates=function(e,t,n,i){let r=e.context.uniformState,s=r.currentFrustum,a=s.x,c=s.y;if(e.frameState.useLogDepth){let b=n*r.log2FarDepthFromNearPlusOne,f=Math.pow(2,b)-1;n=c*(1-a/(f+a))/(c-a)}let d=e.view.passState.viewport,u=se.clone(se.UNIT_W,DNe);u.x=(t.x-d.x)/d.width*2-1,u.y=(t.y-d.y)/d.height*2-1,u.z=n*2-1,u.w=1;let m,p=e.camera.frustum;if(l(p.fovy)){m=M.multiplyByVector(r.inverseViewProjection,u,Gre);let b=1/m.w;h.multiplyByScalar(m,b,m)}else{let b=p.offCenterFrustum;l(b)&&(p=b),m=Gre,m.x=(u.x*(p.right-p.left)+p.left+p.right)*.5,m.y=(u.y*(p.top-p.bottom)+p.bottom+p.top)*.5,m.z=(u.z*(a-c)-a-c)*.5,m.w=1,m=M.multiplyByVector(r.inverseView,m,m)}return h.fromCartesian4(m,i)};var Zi=Ia;var c0n=T(S(),1),BNe={LEFT:-1,UP:-1,NONE:0,RIGHT:1,DOWN:1},Hc=Object.freeze(BNe);var ibn=T(S(),1);var f0n=T(S(),1);var LC={};LC._deprecationWarning=Is;var Qp=Uint32Array.BYTES_PER_ELEMENT;LC.parse=function(e,t){let n=g(t,0);t=n;let i=new Uint8Array(e),o=new DataView(e);t+=Qp;let r=o.getUint32(t,!0);if(r!==1)throw new ue(`Only Batched 3D Model version 1 is supported. Version ${r} is not.`);t+=Qp;let s=o.getUint32(t,!0);t+=Qp;let a=o.getUint32(t,!0);t+=Qp;let c=o.getUint32(t,!0);t+=Qp;let d=o.getUint32(t,!0);t+=Qp;let u=o.getUint32(t,!0);t+=Qp;let m;d>=570425344?(t-=Qp*2,m=a,d=c,u=0,a=0,c=0,LC._deprecationWarning(\"b3dm-legacy-header\",\"This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.\")):u>=570425344&&(t-=Qp,m=d,d=a,u=c,a=0,c=0,LC._deprecationWarning(\"b3dm-legacy-header\",\"This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/CesiumGS/3d-tiles/tree/main/specification/TileFormats/Batched3DModel.\"));let p;a===0?p={BATCH_LENGTH:g(m,0)}:(p=Go(i,t,a),t+=a);let b=new Uint8Array(e,t,c);t+=c;let f,x;d>0&&(f=Go(i,t,d),t+=d,u>0&&(x=new Uint8Array(e,t,u),x=new Uint8Array(x),t+=u));let _=n+s-t;if(_===0)throw new ue(\"glTF byte length must be greater than 0.\");let C;return t%4===0?C=new Uint8Array(e,t,_):(LC._deprecationWarning(\"b3dm-glb-unaligned\",\"The embedded glb is not aligned to a 4-byte boundary.\"),C=new Uint8Array(i.subarray(t,t+_))),{batchLength:m,featureTableJson:p,featureTableBinary:b,batchTableJson:f,batchTableBinary:x,gltf:C}};var tI=LC;var x0n=T(S(),1);function nI(e,t){this.json=e,this.buffer=t,this._cachedTypedArrays={},this.featuresLength=0}function Ere(e,t,n,i,o,r){let s=e._cachedTypedArrays,a=s[t];return l(a)||(a=Q.createArrayBufferView(n,e.buffer.buffer,e.buffer.byteOffset+r,o*i),s[t]=a),a}function YNe(e,t,n,i){let o=e._cachedTypedArrays,r=o[t];return l(r)||(r=Q.createTypedArray(n,i),o[t]=r),r}nI.prototype.getGlobalProperty=function(e,t,n){let i=this.json[e];if(l(i))return l(i.byteOffset)?(t=g(t,Q.UNSIGNED_INT),n=g(n,1),Ere(this,e,t,n,1,i.byteOffset)):i};nI.prototype.hasProperty=function(e){return l(this.json[e])};nI.prototype.getPropertyArray=function(e,t,n){let i=this.json[e];if(l(i))return l(i.byteOffset)?(l(i.componentType)&&(t=Q.fromName(i.componentType)),Ere(this,e,t,n,this.featuresLength,i.byteOffset)):YNe(this,e,t,i)};nI.prototype.getProperty=function(e,t,n,i,o){let r=this.json[e];if(!l(r))return;let s=this.getPropertyArray(e,t,n);if(n===1)return s[i];for(let a=0;a<n;++a)o[a]=s[n*i+a];return o};var Um=nI;var M0n=T(S(),1);function iI(e){let t=e.count,n=e.batchTable,i=e.binaryBody,o=g(e.parseAsPropertyAttributes,!1),r=e.customAttributeOutput,s=ONe(n),a;l(s.jsonProperties)&&(a=new Op({count:t,properties:s.jsonProperties}));let c;l(s.hierarchy)&&(c=new Nx({extension:s.hierarchy,binaryBody:i}));let d=wm.BATCH_TABLE_CLASS_NAME,u=s.binaryProperties,m,p,b;if(o){let _=HNe(t,d,u,i,r);b=_.transcodedSchema,p=[new r_({propertyAttribute:_.propertyAttributeJson,class:_.transcodedClass})]}else{let _=zNe(t,d,u,i);b=_.transcodedSchema;let C=_.featureTableJson;m=new El({count:C.count,properties:C.properties,class:_.transcodedClass,bufferViews:_.bufferViewsTypedArrays}),p=[]}let f=[];if(l(m)||l(a)||l(c)){let _=new zc({id:0,name:\"Batch Table\",count:t,metadataTable:m,jsonMetadataTable:a,batchTableHierarchy:c});f.push(_)}let x={schema:b,propertyTables:f,propertyAttributes:p,extensions:s.extensions,extras:s.extras};return new Xa(x)}function ONe(e){let t=e.HIERARCHY,n=e.extras,i=e.extensions,o;l(t)?(iI._deprecationWarning(\"batchTableHierarchyExtension\",\"The batch table HIERARCHY property has been"
}