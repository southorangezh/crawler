{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 133,
    "total_chunks": 194,
    "chunk_size": 53382,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.730Z"
  },
  "content": "h(21e-6,21e-6,21e-6),atmosphereRayleighScaleHeight:1e4,atmosphereMieScaleHeight:3200,atmosphereMieAnisotropy:.9,hsbShift:new h,center3D:void 0,rtc:new h,modifiedModelView:new M,tileRectangle:new se,verticalExaggerationAndRelativeHeight:new D(1,0),dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureNightAlpha:[],dayTextureDayAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],southAndNorthLatitude:new D,southMercatorYAndOneOverHeight:new D,waterMask:void 0,waterMaskTranslationAndScale:new se,minMaxHeight:new D,scaleAndBias:new M,clippingPlanesEdgeColor:O.clone(O.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new se,frontFaceAlphaByDistance:new se,backFaceAlphaByDistance:new se,localizedTranslucencyRectangle:new se,undergroundColor:O.clone(O.TRANSPARENT),undergroundColorAlphaByDistance:new se,lambertDiffuseMultiplier:0,vertexShadowDarkness:0,dayTileUVCorrections:[]}};return l(t.materialUniformMap)?Ct(n,t.materialUniformMap):n}function xst(e,t,n){let i=n.data,o,r;if(l(i.vertexArray)?(o=i.mesh,r=i.vertexArray):l(i.fill)&&l(i.fill.vertexArray)&&(o=i.fill.mesh,r=i.fill.vertexArray),!(!l(o)||!l(r))){if(l(i.wireframeVertexArray)){if(i.wireframeVertexArray.mesh===o)return;i.wireframeVertexArray.destroy(),i.wireframeVertexArray=void 0}i.wireframeVertexArray=_st(e,r,o),i.wireframeVertexArray.mesh=o}}function _st(e,t,n){let o={indices:n.indices,primitiveType:we.TRIANGLES};An.toWireframe(o);let r=o.indices,s=pt.createIndexBuffer({context:e,typedArray:r,usage:Me.STATIC_DRAW,indexDatatype:Ae.fromSizeInBytes(r.BYTES_PER_ELEMENT)});return new ti({context:e,attributes:t._attributes,indexBuffer:s})}var mye,hye,xD;(function(){let e=new Vt({geometry:Tm.fromDimensions({dimensions:new h(2,2,2)})}),t=new Vt({geometry:new p0({radius:1})}),n=new M,i,o;function r(s){return new Rn({geometryInstances:s,appearance:new ln({translucent:!1,flat:!0}),asynchronous:!1})}mye=function(s,a){return s===i||(xD(),i=s,n=M.fromRotationTranslation(s.halfAxes,s.center,n),e.modelMatrix=n,e.attributes.color=Ot.fromColor(a),o=r(e)),o},hye=function(s,a){return s===i||(xD(),i=s,n=M.fromTranslation(s.center,n),n=M.multiplyByUniformScale(n,s.radius,n),t.modelMatrix=n,t.attributes.color=Ot.fromColor(a),o=r(t)),o},xD=function(){l(o)&&(o.destroy(),o=void 0,i=void 0)}})();var Tst=new se(0,0,0,0),Sst={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applyDayNightAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,dynamicAtmosphereLighting:void 0,dynamicAtmosphereLightingFromSun:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0,hasGeodeticSurfaceNormals:void 0,hasExaggeration:void 0,applyTileUVCorrection:void 0},Cst=O.TRANSPARENT,Vst=new At;function Lst(e,t,n){let i=t.data;l(i.vertexArray)||(i.fill===void 0&&(i.fill=new FV(t)),i.fill.update(e,n));let o=n.creditDisplay,r=i.terrainData;if(l(r)&&l(r.credits)){let be=r.credits;for(let Ve=0,Bt=be.length;Ve<Bt;++Ve)o.addCreditToNextFrame(be[Ve])}let s=Yt.maximumTextureImageUnits,a=i.waterMaskTexture,c=i.waterMaskTranslationAndScale;!l(a)&&l(i.fill)&&(a=i.fill.waterMaskTexture,c=i.fill.waterMaskTranslationAndScale);let d=n.cameraUnderground,u=n.globeTranslucencyState,m=u.translucent,p=u.frontFaceAlphaByDistance,b=u.backFaceAlphaByDistance,f=u.rectangle,x=g(e.undergroundColor,Cst),_=g(e.undergroundColorAlphaByDistance,Vst),C=uye(e,n)&&n.mode===ie.SCENE3D&&x.alpha>0&&(_.nearValue>0||_.farValue>0),V=e.lambertDiffuseMultiplier,L=e.vertexShadowDarkness,R=e.hasWaterMask&&l(a),G=e.oceanNormalMap,X=R&&l(G),v=e.terrainProvider,W=l(v)&&e.terrainProvider.hasVertexNormals,F=n.fog.enabled&&n.fog.renderable&&!d,A=e.showGroundAtmosphere&&n.mode===ie.SCENE3D,y=_n.castShadows(e.shadows)&&!m,Z=_n.receiveShadows(e.shadows)&&!m,E=e.hueShift,I=e.saturationShift,w=e.brightnessShift,k=!(P.equalsEpsilon(E,0,P.EPSILON7)&&P.equalsEpsilon(I,0,P.EPSILON7)&&P.equalsEpsilon(w,0,P.EPSILON7)),B=!1;if(A){let be=h.magnitude(n.camera.positionWC),Ve=e.nightFadeOutDistance;B=be>Ve}R&&--s,X&&--s,l(n.shadowState)&&n.shadowState.shadowsEnabled&&--s,l(e.clippingPlanes)&&e.clippingPlanes.enabled&&--s,s-=u.numberOfTextureUniforms;let U=i.renderedMesh,Y=U.center,N=U.encoding,J=i.tileBoundingRegion,z=n.verticalExaggeration,ee=n.verticalExaggerationRelativeHeight,H=z!==1,j=N.hasGeodeticSurfaceNormals,q=cst,pe=0,_e=0,ae=0,ye=0,Te=!1;if(n.mode!==ie.SCENE3D){let be=n.mapProjection,Ve=be.project(le.southwest(t.rectangle),mst),Bt=be.project(le.northeast(t.rectangle),hst);if(q.x=Ve.x,q.y=Ve.y,q.z=Bt.x,q.w=Bt.y,n.mode!==ie.MORPHING&&(Y=ust,Y.x=0,Y.y=(q.z+q.x)*.5,Y.z=(q.w+q.y)*.5,q.x-=Y.y,q.y-=Y.z,q.z-=Y.y,q.w-=Y.z),n.mode===ie.SCENE2D&&N.quantization===Os.BITS12){let mt=1/(Math.pow(2,12)-1)*.5,Pi=(q.z-q.x)*mt,Co=(q.w-q.y)*mt;q.x-=Pi,q.y-=Co,q.z+=Pi,q.w+=Co}be instanceof Li&&(pe=t.rectangle.south,_e=t.rectangle.north,ae=Li.geodeticLatitudeToMercatorAngle(pe),ye=1/(Li.geodeticLatitudeToMercatorAngle(_e)-ae),Te=!0)}let Le=Sst;Le.frameState=n,Le.surfaceTile=i,Le.showReflectiveOcean=R,Le.showOceanWaves=X,Le.enableLighting=e.enableLighting,Le.dynamicAtmosphereLighting=e.dynamicAtmosphereLighting,Le.dynamicAtmosphereLightingFromSun=e.dynamicAtmosphereLightingFromSun,Le.showGroundAtmosphere=A,Le.atmosphereLightIntensity=e.atmosphereLightIntensity,Le.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,Le.atmosphereMieCoefficient=e.atmosphereMieCoefficient,Le.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,Le.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,Le.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,Le.perFragmentGroundAtmosphere=B,Le.hasVertexNormals=W,Le.useWebMercatorProjection=Te,Le.clippedByBoundaries=i.clippedByBoundaries,Le.hasGeodeticSurfaceNormals=j,Le.hasExaggeration=H;let Re=i.imagery,ke=0,rt=Re.length,yt=e.showSkirts&&!d&&!m,Dt=e.backFaceCulling&&!d&&!m,it=Dt?e._renderState:e._disableCullingRenderState,Ie=Dt?e._blendRenderState:e._disableCullingBlendRenderState,ft=it,Ke=e._firstPassInitialColor,ct=n.context;if(l(e._debug.boundingSphereTile)||xD(),e._materialUniformMap!==e.materialUniformMap){e._materialUniformMap=e.materialUniformMap;let be=e._drawCommands.length;for(let Ve=0;Ve<be;++Ve)e._uniformMaps[Ve]=cye(n,e)}do{let be=0,Ve,Bt;if(e._drawCommands.length<=e._usedDrawCommands?(Ve=new je,Ve.owner=t,Ve.cull=!1,Ve.boundingVolume=new ce,Ve.orientedBoundingBox=void 0,Bt=cye(n,e),e._drawCommands.push(Ve),e._uniformMaps.push(Bt)):(Ve=e._drawCommands[e._usedDrawCommands],Bt=e._uniformMaps[e._usedDrawCommands]),Ve.owner=t,++e._usedDrawCommands,t===e._debug.boundingSphereTile){let vi=J.boundingVolume,ga=J.boundingSphere;l(vi)?mye(vi,O.RED).update(n):l(ga)&&hye(ga,O.RED).update(n)}let mt=Bt.properties;se.clone(Ke,mt.initialColor),mt.oceanNormalMap=G,mt.lightingFadeDistance.x=e.lightingFadeOutDistance,mt.lightingFadeDistance.y=e.lightingFadeInDistance,mt.nightFadeDistance.x=e.nightFadeOutDistance,mt.nightFadeDistance.y=e.nightFadeInDistance,mt.atmosphereLightIntensity=e.atmosphereLightIntensity,mt.atmosphereRayleighCoefficient=e.atmosphereRayleighCoefficient,mt.atmosphereMieCoefficient=e.atmosphereMieCoefficient,mt.atmosphereRayleighScaleHeight=e.atmosphereRayleighScaleHeight,mt.atmosphereMieScaleHeight=e.atmosphereMieScaleHeight,mt.atmosphereMieAnisotropy=e.atmosphereMieAnisotropy,mt.zoomedOutOceanSpecularIntensity=e.zoomedOutOceanSpecularIntensity;let Pi=d?b:p,Co=d?p:b;l(Pi)&&(se.fromElements(Pi.near,Pi.nearValue,Pi.far,Pi.farValue,mt.frontFaceAlphaByDistance),se.fromElements(Co.near,Co.nearValue,Co.far,Co.farValue,mt.backFaceAlphaByDistance)),se.fromElements(_.near,_.nearValue,_.far,_.farValue,mt.undergroundColorAlphaByDistance),O.clone(x,mt.undergroundColor),mt.lambertDiffuseMultiplier=V,mt.vertexShadowDarkness=L;let Es=!l(i.vertexArray)&&l(e.fillHighlightColor)&&e.fillHighlightColor.alpha>0;Es&&O.clone(e.fillHighlightColor,mt.fillHighlightColor),mt.verticalExaggerationAndRelativeHeight.x=z,mt.verticalExaggerationAndRelativeHeight.y=ee,mt.center3D=U.center,h.clone(Y,mt.rtc),se.clone(q,mt.tileRectangle),mt.southAndNorthLatitude.x=pe,mt.southAndNorthLatitude.y=_e,mt.southMercatorYAndOneOverHeight.x=ae,mt.southMercatorYAndOneOverHeight.y=ye;let $r=lst,Nr=gD(t.rectangle,e.cartographicLimitRectangle),Qs=dst,De=gD(t.rectangle,f);h.fromElements(E,I,w,mt.hsbShift);let et=t.rectangle,qe=1/et.width,Ye=1/et.height;$r.x=(Nr.west-et.west)*qe,$r.y=(Nr.south-et.south)*Ye,$r.z=(Nr.east-et.west)*qe,$r.w=(Nr.north-et.south)*Ye,se.clone($r,mt.localizedCartographicLimitRectangle),Qs.x=(De.west-et.west)*qe,Qs.y=(De.south-et.south)*Ye,Qs.z=(De.east-et.west)*qe,Qs.w=(De.north-et.south)*Ye,se.clone(Qs,mt.localizedTranslucencyRectangle);let gt=F&&P.fog(t._distance,n.fog.density)>P.EPSILON3;k=k&&(gt||A);let zt=!1,Gn=!1,Vo=!1,tr=!1,Da=!1,nr=!1,ir=!1,zi=!1,ds=!1,es=!1;for(Le.applyTileUVCorrection=!1;be<s&&ke<rt;){let vi=Re[ke],ga=vi.readyImagery;if(++ke,!l(ga)||ga.imageryLayer.alpha===0)continue;let Tr=vi.useWebMercatorT?ga.textureWebMercator:ga.texture,kr=ga.imageryLayer;l(vi.textureTranslationAndScale)||(vi.textureTranslationAndScale=kr._calculateTextureTranslationAndScale(t,vi)),mt.dayTextures[be]=Tr,mt.dayTextureTranslationAndScale[be]=vi.textureTranslationAndScale,mt.dayTextureTexCoordsRectangle[be]=vi.textureCoordinateRectangle,mt.dayTextureUseWebMercatorT[be]=vi.useWebMercatorT,mt.dayTextureAlpha[be]=kr.alpha,nr=nr||mt.dayTextureAlpha[be]!==1,mt.dayTextureNightAlpha[be]=kr.nightAlpha,ir=ir||mt.dayTextureNightAlpha[be]!==1,mt.dayTextureDayAlpha[be]=kr.dayAlpha,ir=ir||mt.dayTextureDayAlpha[be]!==1,mt.dayTextureBrightness[be]=kr.brightness,zt=zt||mt.dayTextureBrightness[be]!==ha.DEFAULT_BRIGHTNESS,mt.dayTextureContrast[be]=kr.contrast,Gn=Gn||mt.dayTextureContrast[be]!==ha.DEFAULT_CONTRAST,mt.dayTextureHue[be]=kr.hue,Vo=Vo||mt.dayTextureHue[be]!==ha.DEFAULT_HUE,mt.dayTextureSaturation[be]=kr.saturation,tr=tr||mt.dayTextureSaturation[be]!==ha.DEFAULT_SATURATION,mt.dayTextureOneOverGamma[be]=1/kr.gamma,Da=Da||mt.dayTextureOneOverGamma[be]!==1/ha.DEFAULT_GAMMA,mt.dayTextureSplit[be]=kr.splitDirection,zi=zi||mt.dayTextureSplit[be]!==0;let po=mt.dayTextureCutoutRectangles[be];if(l(po)||(po=mt.dayTextureCutoutRectangles[be]=new se),se.clone(se.ZERO,po),l(kr.cutoutRectangle)){let _a=gD(et,kr.cutoutRectangle),um=le.simpleIntersection(_a,et,dye);ds=l(um)||ds,po.x=(_a.west-et.west)*qe,po.y=(_a.south-et.south)*Ye,po.z=(_a.east-et.west)*qe,po.w=(_a.north-et.south)*Ye}let xa=mt.colorsToAlpha[be];l(xa)||(xa=mt.colorsToAlpha[be]=new se);let yb=l(kr.colorToAlpha)&&kr.colorToAlphaThreshold>0;if(es=es||yb,yb){let _a=kr.colorToAlpha;xa.x=_a.red,xa.y=_a.green,xa.z=_a.blue,xa.w=kr.colorToAlphaThreshold}else xa.w=-1;if(l(ga.credits)){let _a=ga.credits;for(let um=0,mm=_a.length;um<mm;++um)o.addCreditToNextFrame(_a[um])}$.equalsEpsilon(vi.correctionMatrix,$.ZERO)||(mt.dayTileUVCorrections[be]=vi.correctionMatrix,Le.applyTileUVCorrection=!0),++be}mt.dayTextures.length=be,mt.dayTileUVCorrections.length=be,mt.waterMask=a,se.clone(c,mt.waterMaskTranslationAndScale),mt.minMaxHeight.x=N.minimumHeight,mt.minMaxHeight.y=N.maximumHeight,M.clone(N.matrix,mt.scaleAndBias);let dl=e._clippingPlanes,Uo=l(dl)&&dl.enabled&&t.isClipped;Uo&&(mt.clippingPlanesEdgeColor=O.clone(dl.edgeColor,mt.clippingPlanesEdgeColor),mt.clippingPlanesEdgeWidth=dl.edgeWidth),Le.numberOfDayTextures=be,Le.applyBrightness=zt,Le.applyContrast=Gn,Le.applyHue=Vo,Le.applySaturation=tr,Le.applyGamma=Da,Le.applyAlpha=nr,Le.applyDayNightAlpha=ir,Le.applySplit=zi,Le.enableFog=gt,Le.enableClippingPlanes=Uo,Le.clippingPlanes=dl,Le.hasImageryLayerCutout=ds,Le.colorCorrect=k,Le.highlightFillTile=Es,Le.colorToAlpha=es,Le.showUndergroundColor=C,Le.translucent=m;let ur=i.renderedMesh.indices.length;yt||(ur=i.renderedMesh.indexCountWithoutSkirts),Ve.shaderProgram=e._surfaceShaderSet.getShaderProgram(Le),Ve.castShadows=y,Ve.receiveShadows=Z,Ve.renderState=ft,Ve.primitiveType=we.TRIANGLES,Ve.vertexArray=i.vertexArray||i.fill.vertexArray,Ve.count=ur,Ve.uniformMap=Bt,Ve.pass=Ze.GLOBE,e._debug.wireframe&&(xst(ct,e,t),l(i.wireframeVertexArray)&&(Ve.vertexArray=i.wireframeVertexArray,Ve.primitiveType=we.LINES,Ve.count=ur*2));let Ec=Ve.boundingVolume,ul=Ve.orientedBoundingBox;n.mode!==ie.SCENE3D?(ce.fromRectangleWithHeights2D(t.rectangle,n.mapProjection,J.minimumHeight,J.maximumHeight,Ec),h.fromElements(Ec.center.z,Ec.center.x,Ec.center.y,Ec.center),n.mode===ie.MORPHING&&(Ec=ce.union(J.boundingSphere,Ec,Ec))):(Ve.boundingVolume=ce.clone(J.boundingSphere,Ec),Ve.orientedBoundingBox=Zn.clone(J.boundingVolume,ul)),Ve.dirty=!0,m&&u.updateDerivedCommands(Ve,n),lye(Ve,n),ft=Ie,Ke=Tst}while(ke<rt)}var aw=qo;var x1i=T(S(),1);function fye(){this._enabled=!1,this._frontFaceAlpha=1,this._frontFaceAlphaByDistance=void 0,this._backFaceAlpha=1,this._backFaceAlphaByDistance=void 0,this._rectangle=le.clone(le.MAX_VALUE)}Object.defineProperties(fye.prototype,{enabled:{get:function(){return this._enabled},set:function(e){this._enabled=e}},frontFaceAlpha:{get:function(){return this._frontFaceAlpha},set:function(e){this._frontFaceAlpha=e}},frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance},set:function(e){this._frontFaceAlphaByDistance=At.clone(e,this._frontFaceAlphaByDistance)}},backFaceAlpha:{get:function(){return this._backFaceAlpha},set:function(e){this._backFaceAlpha=e}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance},set:function(e){this._backFaceAlphaByDistance=At.clone(e,this._backFaceAlphaByDistance)}},rectangle:{get:function(){return this._rectangle},set:function(e){l(e)||(e=le.clone(le.MAX_VALUE)),le.clone(e,this._rectangle)}}});var cw=fye;var G1i=T(S(),1);function Zs(){this._layers=[],this.layerAdded=new ge,this.layerRemoved=new ge,this.layerMoved=new ge,this.layerShownOrHidden=new ge}Object.defineProperties(Zs.prototype,{length:{get:function(){return this._layers.length}}});Zs.prototype.add=function(e,t){l(t)?this._layers.splice(t,0,e):(t=this._layers.length,this._layers.push(e)),this._update(),this.layerAdded.raiseEvent(e,t);let i=e.readyEvent.addEventListener(()=>{this.layerShownOrHidden.raiseEvent(e,e._layerIndex,e.show),i()})};Zs.prototype.addImageryProvider=function(e,t){let n=new ha(e);return this.add(n,t),n};Zs.prototype.remove=function(e,t){t=g(t,!0);let n=this._layers.indexOf(e);return n!==-1?(this._layers.splice(n,1),this._update(),this.layerRemoved.raiseEvent(e,n),t&&e.destroy(),!0):!1};Zs.prototype.removeAll=function(e){e=g(e,!0);let t=this._layers;for(let n=0,i=t.length;n<i;n++){let o=t[n];this.layerRemoved.raiseEvent(o,n),e&&o.destroy()}this._layers=[]};Zs.prototype.contains=function(e){return this.indexOf(e)!==-1};Zs.prototype.indexOf=function(e){return this._layers.indexOf(e)};Zs.prototype.get=function(e){return this._layers[e]};function _D(e,t){return e.indexOf(t)}function pye(e,t,n){let i=e._layers;if(t=P.clamp(t,0,i.length-1),n=P.clamp(n,0,i.length-1),t===n)return;let o=i[t];i[t]=i[n],i[n]=o,e._update(),e.layerMoved.raiseEvent(o,n,t)}Zs.prototype.raise=function(e){let t=_D(this._layers,e);pye(this,t,t+1)};Zs.prototype.lower=function(e){let t=_D(this._layers,e);pye(this,t,t-1)};Zs.prototype.raiseToTop=function(e){let t=_D(this._layers,e);t!==this._layers.length-1&&(this._layers.splice(t,1),this._layers.push(e),this._update(),this.layerMoved.raiseEvent(e,this._layers.length-1,t))};Zs.prototype.lowerToBottom=function(e){let t=_D(this._layers,e);t!==0&&(this._layers.splice(t,1),this._layers.splice(0,0,e),this._update(),this.layerMoved.raiseEvent(e,0,t))};var Zst=new le;function bye(e,t,n,i){let o=e.globe._surface._tilesToRender,r;for(let a=0;!l(r)&&a<o.length;++a){let c=o[a];le.contains(c.rectangle,t)&&(r=c)}if(!l(r))return;let s=r.data.imagery;for(let a=s.length-1;a>=0;--a){let c=s[a],d=c.readyImagery;if(!l(d)||!d.imageryLayer.ready)continue;let u=d.imageryLayer.imageryProvider;if(n&&!l(u.pickFeatures)||!le.contains(d.rectangle,t))continue;let m=Zst,p=1/1024;m.west=P.lerp(r.rectangle.west,r.rectangle.east,c.textureCoordinateRectangle.x-p),m.east=P.lerp(r.rectangle.west,r.rectangle.east,c.textureCoordinateRectangle.z+p),m.south=P.lerp(r.rectangle.south,r.rectangle.north,c.textureCoordinateRectangle.y-p),m.north=P.lerp(r.rectangle.south,r.rectangle.north,c.textureCoordinateRectangle.w+p),le.contains(m,t)&&i(d)}}Zs.prototype.pickImageryLayers=function(e,t){let n=t.globe.pick(e,t);if(!l(n))return;let i=t.globe.ellipsoid.cartesianToCartographic(n),o=[];if(bye(t,i,!1,function(r){o.push(r.imageryLayer)}),o.length!==0)return o};Zs.prototype.pickImageryLayerFeatures=function(e,t){let n=t.globe.pick(e,t);if(!l(n))return;let i=t.globe.ellipsoid.cartesianToCartographic(n),o=[],r=[];if(bye(t,i,!0,function(s){if(!s.imageryLayer.ready)return;let c=s.imageryLayer.imageryProvider.pickFeatures(s.x,s.y,s.level,i.longitude,i.latitude);l(c)&&(o.push(c),r.push(s.imageryLayer))}),o.length!==0)return Promise.all(o).then(function(s){let a=[];for(let c=0;c<s.length;++c){let d=s[c],u=r[c];if(l(d)&&d.length>0)for(let m=0;m<d.length;++m){let p=d[m];p.imageryLayer=u,l(p.position)||(p.position=i),a.push(p)}}return a})};Zs.prototype.queueReprojectionCommands=function(e){let t=this._layers;for(let n=0,i=t.length;n<i;++n)t[n].queueReprojectionCommands(e)};Zs.prototype.cancelReprojections=function(){let e=this._layers;for(let t=0,n=e.length;t<n;++t)e[t].cancelReprojections()};Zs.prototype.isDestroyed=function(){return!1};Zs.prototype.destroy=function(){return this.removeAll(!0),me(this)};Zs.prototype._update=function(){let e=!0,t=this._layers,n,i,o,r;for(o=0,r=t.length;o<r;++o)i=t[o],i._layerIndex=o,i.show?(i._isBaseLayer=e,e=!1):i._isBaseLayer=!1,i.show!==i._show&&(l(i._show)&&(l(n)||(n=[]),n.push(i)),i._show=i.show);if(l(n))for(o=0,r=n.length;o<r;++o)i=n[o],this.layerShownOrHidden.raiseEvent(i,i._layerIndex,i.show)};var lw=Zs;var cVi=T(S(),1);var W1i=T(S(),1);function yye(e){this._ellipsoid=new L0(e.ellipsoid,h.ZERO)}Object.defineProperties(yye.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var dw=yye;var M1i=T(S(),1);function il(e){this._tilingScheme=e.tilingScheme,this._x=e.x,this._y=e.y,this._level=e.level,this._parent=e.parent,this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level),this._southwestChild=void 0,this._southeastChild=void 0,this._northwestChild=void 0,this._northeastChild=void 0,this.replacementPrevious=void 0,this.replacementNext=void 0,this._distance=0,this._loadPriority=0,this._customData=[],this._frameUpdated=void 0,this._lastSelectionResult=Kn.NONE,this._lastSelectionResultFrame=void 0,this._loadedCallbacks={},this.state=zs.START,this.renderable=!1,this.upsampledFromParent=!1,this.data=void 0}il.createLevelZeroTiles=function(e){let t=e.getNumberOfXTilesAtLevel(0),n=e.getNumberOfYTilesAtLevel(0),i=new Array(t*n),o=0;for(let r=0;r<n;++r)for(let s=0;s<t;++s)i[o++]=new il({tilingScheme:e,x:s,y:r,level:0});return i};il.prototype._updateCustomData=function(e,t,n){let i=this.customData,o,r,s;if(l(t)&&l(n)){for(s=this._rectangle,o=0;o<t.length;++o)r=t[o],le.contains(s,r.positionCartographic)&&i.push(r);i=i.filter(function(a){return n.indexOf(a)===-1}),this._customData=i,this._frameUpdated=e}else{let a=this._parent;if(l(a)&&this._frameUpdated!==a._frameUpdated){i.length=0,s=this._rectangle;let c=a.customData;for(o=0;o<c.length;++o)r=c[o],le.contains(s,r.positionCartographic)&&i.push(r);this._frameUpdated=a._frameUpdated}}};Object.defineProperties(il.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){return l(this._southwestChild)||(this._southwestChild=new il({tilingScheme:this.tilingScheme,x:this.x*2,y:this.y*2+1,level:this.level+1,parent:this})),this._southwestChild}},southeastChild:{get:function(){return l(this._southeastChild)||(this._southeastChild=new il({tilingScheme:this.tilingScheme,x:this.x*2+1,y:this.y*2+1,level:this.level+1,parent:this})),this._southeastChild}},northwestChild:{get:function(){return l(this._northwestChild)||(this._northwestChild=new il({tilingScheme:this.tilingScheme,x:this.x*2,y:this.y*2,level:this.level+1,parent:this})),this._northwestChild}},northeastChild:{get:function(){return l(this._northeastChild)||(this._northeastChild=new il({tilingScheme:this.tilingScheme,x:this.x*2+1,y:this.y*2,level:this.level+1,parent:this})),this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<zs.DONE}},eligibleForUnloading:{get:function(){let e=!0;return l(this.data)&&(e=this.data.eligibleForUnloading,l(e)||(e=!0)),e}}});il.prototype.findLevelZeroTile=function(e,t,n){let i=this.tilingScheme.getNumberOfXTilesAtLevel(0);if(t<0?t+=i:t>=i&&(t-=i),!(n<0||n>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return e.filter(function(o){return o.x===t&&o.y===n})[0]};il.prototype.findTileToWest=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x-1,this.y);if(t.southeastChild===this)return t.southwestChild;if(t.northeastChild===this)return t.northwestChild;let n=t.findTileToWest(e);if(n!==void 0)return t.southwestChild===this?n.southeastChild:n.northeastChild};il.prototype.findTileToEast=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x+1,this.y);if(t.southwestChild===this)return t.southeastChild;if(t.northwestChild===this)return t.northeastChild;let n=t.findTileToEast(e);if(n!==void 0)return t.southeastChild===this?n.southwestChild:n.northwestChild};il.prototype.findTileToSouth=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x,this.y+1);if(t.northwestChild===this)return t.southwestChild;if(t.northeastChild===this)return t.southeastChild;let n=t.findTileToSouth(e);if(n!==void 0)return t.southwestChild===this?n.northwestChild:n.northeastChild};il.prototype.findTileToNorth=function(e){let t=this.parent;if(t===void 0)return this.findLevelZeroTile(e,this.x,this.y-1);if(t.southwestChild===this)return t.northwestChild;if(t.southeastChild===this)return t.northeastChild;let n=t.findTileToNorth(e);if(n!==void 0)return t.northwestChild===this?n.southwestChild:n.southeastChild};il.prototype.freeResources=function(){this.state=zs.START,this.renderable=!1,this.upsampledFromParent=!1,l(this.data)&&l(this.data.freeResources)&&this.data.freeResources(),TD(this._southwestChild),this._southwestChild=void 0,TD(this._southeastChild),this._southeastChild=void 0,TD(this._northwestChild),this._northwestChild=void 0,TD(this._northeastChild),this._northeastChild=void 0};function TD(e){l(e)&&e.freeResources()}var uw=il;var U1i=T(S(),1);function SD(){this.head=void 0,this.tail=void 0,this.count=0,this._lastBeforeStartOfFrame=void 0}SD.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head};SD.prototype.trimTiles=function(e){let t=this.tail,n=!0;for(;n&&l(this._lastBeforeStartOfFrame)&&this.count>e&&l(t);){n=t!==this._lastBeforeStartOfFrame;let i=t.replacementPrevious;t.eligibleForUnloading&&(t.freeResources(),gye(this,t)),t=i}};function gye(e,t){let n=t.replacementPrevious,i=t.replacementNext;t===e._lastBeforeStartOfFrame&&(e._lastBeforeStartOfFrame=i),t===e.head?e.head=i:n.replacementNext=i,t===e.tail?e.tail=n:i.replacementPrevious=n,t.replacementPrevious=void 0,t.replacementNext=void 0,--e.count}SD.prototype.markTileRendered=function(e){let t=this.head;if(t===e){e===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=e.replacementNext);return}if(++this.count,!l(t)){e.replacementPrevious=void 0,e.replacementNext=void 0,this.head=e,this.tail=e;return}(l(e.replacementPrevious)||l(e.replacementNext))&&gye(this,e),e.replacementPrevious=void 0,e.replacementNext=t,t.replacementPrevious=e,this.head=e};var mw=SD;function $u(e){this._tileProvider=e.tileProvider,this._tileProvider.quadtree=this,this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};let n=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[],this._tileLoadQueueHigh=[],this._tileLoadQueueMedium=[],this._tileLoadQueueLow=[],this._tileReplacementQueue=new mw,this._levelZeroTiles=void 0,this._loadQueueTimeSlice=5,this._tilesInvalidated=!1,this._addHeightCallbacks=[],this._removeHeightCallbacks=[],this._tileToUpdateHeights=[],this._lastTileIndex=0,this._updateHeightsTimeSlice=2,this._cameraPositionCartographic=void 0,this._cameraReferenceFrameOriginCartographic=void 0,this.maximumScreenSpaceError=g(e.maximumScreenSpaceError,2),this.tileCacheSize=g(e.tileCacheSize,100),this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this._occluders=new dw({ellipsoid:n}),this._tileLoadProgressEvent=new ge,this._lastTileLoadQueueLength=0,this._lastSelectionFrameNumber=void 0}Object.defineProperties($u.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},occluders:{get:function(){return this._occluders}}});$u.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0};function Rst(e){let t=e._tileReplacementQueue;t.head=void 0,t.tail=void 0,t.count=0,_ye(e);let n=e._levelZeroTiles;if(l(n))for(let i=0;i<n.length;++i){let r=n[i].customData,s=r.length;for(let a=0;a<s;++a){let c=r[a];c.level=0,e._addHeightCallbacks.push(c)}n[i].freeResources()}e._levelZeroTiles=void 0,e._tileProvider.cancelReprojections()}$u.prototype.forEachLoadedTile=function(e){let t=this._tileReplacementQueue.head;for(;l(t);)t.state!==zs.START&&e(t),t=t.replacementNext};$u.prototype.forEachRenderedTile=function(e){let t=this._tilesToRender;for(let n=0,i=t.length;n<i;++n)e(t[n])};$u.prototype.updateHeight=function(e,t){let n=this,i={positionOnEllipsoidSurface:void 0,positionCartographic:e,level:-1,callback:t};return i.removeFunc=function(){let o=n._addHeightCallbacks,r=o.length;for(let s=0;s<r;++s)if(o[s]===i){o.splice(s,1);break}n._removeHeightCallbacks.push(i),i.callback&&(i.callback=void 0)},n._addHeightCallbacks.push(i),i.removeFunc};$u.prototype.update=function(e){l(this._tileProvider.update)&&this._tileProvider.update(e)};function _ye(e){let t=e._debug;t.maxDepth=0,t.maxDepthVisited=0,t.tilesVisited=0,t.tilesCulled=0,t.tilesRendered=0,t.tilesWaitingForChildren=0,e._tileLoadQueueHigh.length=0,e._tileLoadQueueMedium.length=0,e._tileLoadQueueLow.length=0}$u.prototype.beginFrame=function(e){e.passes.render&&(this._tilesInvalidated&&(Rst(this),this._tilesInvalidated=!1),this._tileProvider.initialize(e),_ye(this),!this._debug.suspendLodUpdate&&this._tileReplacementQueue.markStartOfRenderFrame())};$u.prototype.render=function(e){let t=e.passes,n=this._tileProvider;t.render&&(n.beginUpdate(e),Ist(this,e),Ust(this,e),n.endUpdate(e)),t.pick&&this._tilesToRender.length>0&&n.updateForPick(e)};function Gst(e,t){let n=e._tileLoadQueueHigh.length+e._tileLoadQueueMedium.length+e._tileLoadQueueLow.length;if(n!==e._lastTileLoadQueueLength||e._tilesInvalidated){let o=ge.prototype.raiseEvent.bind(e._tileLoadProgressEvent,n);t.afterRender.push(()=>(o(),!0)),e._lastTileLoadQueueLength=n}let i=e._debug;i.enableDebugOutput&&!i.suspendLodUpdate&&(i.maxDepth=e._tilesToRender.reduce(function(o,r){return Math.max(o,r.level)},-1),i.tilesRendered=e._tilesToRender.length,(i.tilesVisited!==i.lastTilesVisited||i.tilesRendered!==i.lastTilesRendered||i.tilesCulled!==i.lastTilesCulled||i.maxDepth!==i.lastMaxDepth||i.tilesWaitingForChildren!==i.lastTilesWaitingForChildren||i.maxDepthVisited!==i.lastMaxDepthVisited)&&(console.log(`Visited ${i.tilesVisited}, Rendered: ${i.tilesRendered}, Culled: ${i.tilesCulled}, Max Depth Rendered: ${i.maxDepth}, Max Depth Visited: ${i.maxDepthVisited}, Waiting for children: ${i.tilesWaitingForChildren}`),i.lastTilesVisited=i.tilesVisited,i.lastTilesRendered=i.tilesRendered,i.lastTilesCulled=i.tilesCulled,i.lastMaxDepth=i.maxDepth,i.lastTilesWaitingForChildren=i.tilesWaitingForChildren,i.lastMaxDepthVisited=i.maxDepthVisited))}$u.prototype.endFrame=function(e){!e.passes.render||e.mode===ie.MORPHING||(Ast(this,e),kst(this,e),Gst(this,e))};$u.prototype.isDestroyed=function(){return!1};$u.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};var fw,xye=new he;function Est(e,t){let n=le.center(e.rectangle,xye),i=n.longitude-fw.longitude,o=n.latitude-fw.latitude;n=le.center(t.rectangle,xye);let r=n.longitude-fw.longitude,s=n.latitude-fw.latitude;return i*i+o*o-(r*r+s*s)}var Xst=new h,hw=[];function Ist(e,t){let n=e._debug;if(n.suspendLodUpdate)return;let i=e._tilesToRender;i.length=0;let o,r=e._tileProvider;if(!l(e._levelZeroTiles)){let x=r.tilingScheme;if(l(x)){let _=r.tilingScheme;e._levelZeroTiles=uw.createLevelZeroTiles(_);let C=e._levelZeroTiles.length;if(hw.length<C)for(hw=new Array(C),o=0;o<C;++o)hw[o]===void 0&&(hw[o]=new pw)}else return}e._occluders.ellipsoid.cameraPosition=t.camera.positionWC;let s,a=e._levelZeroTiles,c=a.length>1?e._occluders:void 0;fw=t.camera.positionCartographic,a.sort(Est);let d=e._addHeightCallbacks,u=e._removeHeightCallbacks,m=t.frameNumber,p;if(d.length>0||u.length>0){for(o=0,p=a.length;o<p;++o)s=a[o],s._updateCustomData(m,d,u);d.length=0,u.length=0}let b=t.camera;e._cameraPositionCartographic=b.positionCartographic;let f=M.getTranslation(b.transform,Xst);for(e._cameraReferenceFrameOriginCartographic=e.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(f,e._cameraReferenceFrameOriginCartographic),o=0,p=a.length;o<p;++o)s=a[o],e._tileReplacementQueue.markTileRendered(s),s.renderable?Ma(e,s,r,t,c,!1,hw[o]):($0(e,e._tileLoadQueueHigh,s,t),++n.tilesWaitingForChildren);e._lastSelectionFrameNumber=m}function $0(e,t,n,i){n.needsLoading&&(e.tileProvider.computeTileLoadPriority!==void 0&&(n._loadPriority=e.tileProvider.computeTileLoadPriority(n,i)),t.push(n))}function pw(){this.allAreRenderable=!0,this.anyWereRenderedLastFrame=!1,this.notYetRenderableCount=0}function Tye(){this.southwest=new pw,this.southeast=new pw,this.northwest=new pw,this.northeast=new pw}Tye.prototype.combine=function(e){let t=this.southwest,n=this.southeast,i=this.northwest,o=this.northeast;e.allAreRenderable=t.allAreRenderable&&n.allAreRenderable&&i.allAreRenderable&&o.allAreRenderable,e.anyWereRenderedLastFrame=t.anyWereRenderedLastFrame||n.anyWereRenderedLastFrame||i.anyWereRenderedLastFrame||o.anyWereRenderedLastFrame,e.notYetRenderableCount=t.notYetRenderableCount+n.notYetRenderableCount+i.notYetRenderableCount+o.notYetRenderableCount};var F4=new Array(31);for(let e=0;e<F4.length;++e)F4[e]=new Tye;function Wst(e,t,n,i,o){let r=e._debug;++r.tilesVisited,e._tileReplacementQueue.markTileRendered(n),n._updateCustomData(t.frameNumber),n.level>r.maxDepthVisited&&(r.maxDepthVisited=n.level);let s=wst(e,t,n)<e.maximumScreenSpaceError,a=n.southwestChild,c=n.southeastChild,d=n.northwestChild,u=n.northeastChild,m=e._lastSelectionFrameNumber,p=n._lastSelectionResultFrame===m?n._lastSelectionResult:Kn.NONE,b=e.tileProvider;if(s||i){let f=Kn.originalResult(p)===Kn.RENDERED,x=Kn.originalResult(p)===Kn.CULLED||p===Kn.NONE,_=n.state===zs.DONE,C=f||x||_;if(C||l(b.canRenderWithoutLosingDetail)&&(C=b.canRenderWithoutLosingDetail(n)),C){s&&$0(e,e._tileLoadQueueMedium,n,t),CD(e,n),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=p===Kn.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Kn.RENDERED,o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n);return}i=!0,s&&$0(e,e._tileLoadQueueHigh,n,t)}if(b.canRefine(n)){if(a.upsampledFromParent&&c.upsampledFromParent&&d.upsampledFromParent&&u.upsampledFromParent){CD(e,n),$0(e,e._tileLoadQueueMedium,n,t),e._tileReplacementQueue.markTileRendered(a),e._tileReplacementQueue.markTileRendered(c),e._tileReplacementQueue.markTileRendered(d),e._tileReplacementQueue.markTileRendered(u),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=p===Kn.RENDERED,o.notYetRenderableCount=n.renderable?0:1,n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Kn.RENDERED,o.anyWereRenderedLastFrame||e._tileToUpdateHeights.push(n);return}n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Kn.REFINED;let x=e._tilesToRender.length,_=e._tileLoadQueueLow.length,C=e._tileLoadQueueMedium.length,V=e._tileLoadQueueHigh.length,L=e._tileToUpdateHeights.length;if(Pst(e,a,c,d,u,t,i,o),x!==e._tilesToRender.length){let R=o.allAreRenderable,G=o.anyWereRenderedLastFrame,X=o.notYetRenderableCount,v=!1;if(!R&&!G){let W=e._tilesToRender;for(let A=x;A<W.length;++A){let y=W[A];for(;y!==void 0&&y._lastSelectionResult!==Kn.KICKED&&y!==n;)y._lastSelectionResult=Kn.kick(y._lastSelectionResult),y=y.parent}e._tilesToRender.length=x,e._tileToUpdateHeights.length=L,CD(e,n),n._lastSelectionResult=Kn.RENDERED;let F=p===Kn.RENDERED;!F&&X>e.loadingDescendantLimit&&(e._tileLoadQueueLow.length=_,e._tileLoadQueueMedium.length=C,e._tileLoadQueueHigh.length=V,$0(e,e._tileLoadQueueMedium,n,t),o.notYetRenderableCount=n.renderable?0:1,v=!0),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=F,F||e._tileToUpdateHeights.push(n),++r.tilesWaitingForChildren}e.preloadAncestors&&!v&&$0(e,e._tileLoadQueueLow,n,t)}return}n._lastSelectionResultFrame=t.frameNumber,n._lastSelectionResult=Kn.RENDERED,CD(e,n),$0(e,e._tileLoadQueueHigh,n,t),o.allAreRenderable=n.renderable,o.anyWereRenderedLastFrame=p===Kn.RENDERED,o.notYetRenderableCount=n.renderable?0:1}function Pst(e,t,n,i,o,r,s,a){let c=r.camera.positionCartographic,d=e._tileProvider,u=e._occluders,m=F4[t.level],p=m.southwest,b=m.southeast,f=m.northwest,x=m.northeast;c.longitude<t.rectangle.east?c.latitude<t.rectangle.north?(Ma(e,t,d,r,u,s,p),Ma(e,n,d,r,u,s,b),Ma(e,i,d,r,u,s,f),Ma(e,o,d,r,u,s,x)):(Ma(e,i,d,r,u,s,f),Ma(e,t,d,r,u,s,p),Ma(e,o,d,r,u,s,x),Ma(e,n,d,r,u,s,b)):c.latitude<t.rectangle.north?(Ma(e,n,d,r,u,s,b),Ma(e,t,d,r,u,s,p),Ma(e,o,d,r,u,s,x),Ma(e,i,d,r,u,s,f)):(Ma(e,o,d,r,u,s,x),Ma(e,i,d,r,u,s,f),Ma(e,n,d,r,u,s,b),Ma(e,t,d,r,u,s,p)),m.combine(a)}function vst(e,t){let n=t.rectangle;return l(e._cameraPositionCartographic)&&le.contains(n,e._cameraPositionCartographic)||l(e._cameraReferenceFrameOriginCartographic)&&le.contains(n,e._cameraReferenceFrameOriginCartographic)}function Ma(e,t,n,i,o,r,s){if(n.computeTileVisibility(t,i,o)!==lr.NONE)return Wst(e,i,t,r,s);if(++e._debug.tilesCulled,e._tileReplacementQueue.markTileRendered(t),s.allAreRenderable=!0,s.anyWereRenderedLastFrame=!1,s.notYetRenderableCount=0,vst(e,t)){(!l(t.data)||!l(t.data.vertexArray))&&$0(e,e._tileLoadQueueMedium,t,i);let a=e._lastSelectionFrameNumber,c=t._lastSelectionResultFrame===a?t._lastSelectionResult:Kn.NONE;c!==Kn.CULLED_BUT_NEEDED&&c!==Kn.RENDERED&&e._tileToUpdateHeights.push(t),t._lastSelectionResult=Kn.CULLED_BUT_NEEDED}else e.preloadSiblings||t.level===0?($0(e,e._tileLoadQueueLow,t,i),t._lastSelectionResult=Kn.CULLED):t._lastSelectionResult=Kn.CULLED;t._lastSelectionResultFrame=i.frameNumber}function wst(e,t,n){if(t.mode===ie.SCENE2D||t.camera.frustum instanceof rn||t.camera.frustum instanceof Vr)return Fst(e,t,n);let i=e._tileProvider.getLevelMaximumGeometricError(n.level),o=n._distance,r=t.context.drawingBufferHeight,s=t.camera.frustum.sseDenominator,a=i*r/(o*s);return t.fog.enabled&&(a-=P.fog(o,t.fog.density)*t.fog.sse),a/=t.pixelRatio,a}function Fst(e,t,n){let o=t.camera.frustum,r=o.offCenterFrustum;l(r)&&(o=r);let s=t.context,a=s.drawingBufferWidth,c=s.drawingBufferHeight,d=e._tileProvider.getLevelMaximumGeometricError(n.level),u=Math.max(o.top-o.bottom,o.right-o.left)/Math.max(a,c),m=d/u;return t.fog.enabled&&t.mode!==ie.SCENE2D&&(m-=P.fog(n._distance,t.fog.density)*t.fog.sse),m/=t.pixelRatio,m}function CD(e,t){e._tilesToRender.push(t)}function Ast(e,t){let n=e._tileLoadQueueHigh,i=e._tileLoadQueueMedium,o=e._tileLoadQueueLow;if(n.length===0&&i.length===0&&o.length===0)return;e._tileReplacementQueue.trimTiles(e.tileCacheSize);let r=fi()+e._loadQueueTimeSlice,s=e._tileProvider,a=v4(e,t,s,r,n,!1);a=v4(e,t,s,r,i,a),v4(e,t,s,r,o,a)}function Mst(e,t){return e._loadPriority-t._loadPriority}function v4(e,t,n,i,o,r){n.computeTileLoadPriority!==void 0&&o.sort(Mst);for(let s=0,a=o.length;s<a&&(fi()<i||!r);++s){let c=o[s];e._tileReplacementQueue.markTileRendered(c),n.loadTile(t,c),r=!0}return r}var AV=new bn,w4=new he,pg=new h,Nst=[];function kst(e,t){if(!l(e.tileProvider.tilingScheme))return;let n=Nst;n.length=0;let i=e._tileToUpdateHeights,o=fi(),r=e._updateHeightsTimeSlice,s=o+r,a=t.mode,c=t.mapProjection,d=e.tileProvider.tilingScheme.ellipsoid,u;for(;i.length>0;){let m=i[0];if(!l(m.data)||!l(m.data.mesh)){let x=m._lastSelectionResultFrame===e._lastSelectionFrameNumber?m._lastSelectionResult:Kn.NONE;(x===Kn.RENDERED||x===Kn.CULLED_BUT_NEEDED)&&n.push(m),i.shift(),e._lastTileIndex=0;continue}let p=m.customData,b=p.length,f=!1;for(u=e._lastTileIndex;u<b;++u){let x=p[u],_=m.data.terrainData,C=l(_)&&_.wasCreatedByUpsampling();if(m.level>x.level&&!C){if(l(x.positionOnEllipsoidSurface)||(x.positionOnEllipsoidSurface=h.fromRadians(x.positionCartographic.longitude,x.positionCartographic.latitude,0,d)),a===ie.SCENE3D){let L=d.geodeticSurfaceNormal(x.positionOnEllipsoidSurface,AV.direction),R=d.getSurfaceNormalIntersectionWithZAxis(x.positionOnEllipsoidSurface,11500,AV.origin);if(!l(R)){let G=0;l(m.data.tileBoundingRegion)&&(G=m.data.tileBoundingRegion.minimumHeight);let X=Math.min(G,-11500),v=h.multiplyByScalar(L,Math.abs(X)+1,pg);h.subtract(x.positionOnEllipsoidSurface,v,AV.origin)}}else he.clone(x.positionCartographic,w4),w4.height=-11500,c.project(w4,pg),h.fromElements(pg.z,pg.x,pg.y,pg),h.clone(pg,AV.origin),h.clone(h.UNIT_X,AV.direction);let V=m.data.pick(AV,a,c,!1,pg);l(V)&&(l(x.callback)&&x.callback(V),x.level=m.level)}if(fi()>=s){f=!0;break}}if(f){e._lastTileIndex=u;break}else e._lastTileIndex=0,i.shift()}for(u=0;u<n.length;u++)i.push(n[u])}function Ust(e,t){let n=e._tileProvider,i=e._tilesToRender;for(let o=0,r=i.length;o<r;++o){let s=i[o];n.showTileThisFrame(s,t)}}var bw=$u;function Sh(e){e=g(e,oe.WGS84);let t=new kf({ellipsoid:e}),n=new lw;this._ellipsoid=e,this._imageryLayerCollection=n,this._surfaceShaderSet=new Nv,this._material=void 0,this._surface=new bw({tileProvider:new aw({terrainProvider:t,imageryLayers:n,surfaceShaderSet:this._surfaceShaderSet})}),this._terrainProvider=t,this._terrainProviderChanged=new ge,this._undergroundColor=O.clone(O.BLACK),this._undergroundColorAlphaByDistance=new At(e.maximumRadius/1e3,0,e.maximumRadius/5,1),this._translucency=new cw,M4(this),this.show=!0,this._oceanNormalMapResourceDirty=!0,this._oceanNormalMapResource=new Xe({url:on(\"Assets/Textures/waterNormalsSmall.jpg\")}),this.maximumScreenSpaceError=2,this.tileCacheSize=100,this.loadingDescendantLimit=20,this.preloadAncestors=!0,this.preloadSiblings=!1,this.fillHighlightColor=void 0,this.enableLighting=!1,this.lambertDiffuseMultiplier=.9,this.dynamicAtmosphereLighting=!0,this.dynamicAtmosphereLightingFromSun=!1,this.showGroundAtmosphere=!0,this.atmosphereLightIntensity=10,this.atmosphereRayleighCoefficient=new h(55e-7,13e-6,284e-7),this.atmosphereMieCoefficient=new h(21e-6,21e-6,21e-6),this.atmosphereRayleighScaleHeight=1e4,this.atmosphereMieScaleHeight=3200,this.atmosphereMieAnisotropy=.9,this.lightingFadeOutDistance=1e7,this.lightingFadeInDistance=2e7,this.nightFadeOutDistance=1e7,this.nightFadeInDistance=5e7,this.showWaterEffect=!0,this.depthTestAgainstTerrain=!1,this.shadows=_n.RECEIVE_ONLY,this.atmosphereHueShift=0,this.atmosphereSaturationShift=0,this.atmosphereBrightnessShift=0,this.showSkirts=!0,this.backFaceCulling=!0,this.enableOrthographicOccludersJudge=!1,this._oceanNormalMap=void 0,this._zoomedOutOceanSpecularIntensity=void 0,this.vertexShadowDarkness=.3}Object.defineProperties(Sh.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return l(this._surface)?this._surface._tileLoadQueueHigh.length===0&&this._surface._tileLoadQueueMedium.length===0&&this._surface._tileLoadQueueLow.length===0:!0}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(e){this._surface.tileProvider.baseColor=e}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(e){this._surface.tileProvider.clippingPlanes=e}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(e){l(e)||(e=le.clone(le.MAX_VALUE)),this._surface.tileProvider.cartographicLimitRectangle=e}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(e){this._oceanNormalMapResource.url=e,this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(e){e!==this._terrainProvider&&(this._terrainProvider=e,this._terrainProviderChanged.raiseEvent(e),l(this._material)&&M4(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},material:{get:function(){return this._material},set:function(e){this._material!==e&&(this._material=e,M4(this))}},undergroundColor:{get:function(){return this._undergroundColor},set:function(e){this._undergroundColor=O.clone(e,this._undergroundColor)}},undergroundColorAlphaByDistance:{get:function(){return this._undergroundColorAlphaByDistance},set:function(e){this._undergroundColorAlphaByDistance=At.clone(e,this._undergroundColorAlphaByDistance)}},translucency:{get:function(){return this._translucency}}});function M4(e){let t=[],n=l(e._material)&&(l(e._material.shaderSource.match(/slope/))||l(e._material.shaderSource.match(\"normalEC\"))),i=[H0,TV];l(e._material)&&(!n||e._terrainProvider.requestVertexNormals)?(i.push(e._material.shaderSource),t.push(\"APPLY_MATERIAL\"),e._surface._tileProvider.materialUniformMap=e._material._uniforms):e._surface._tileProvider.materialUniformMap=void 0,i.push(Av),e._surfaceShaderSet.baseVertexShaderSource=new Ue({sources:[H0,TV,Mv],defines:t}),e._surfaceShaderSet.baseFragmentShaderSource=new Ue({sources:i,defines:t}),e._surfaceShaderSet.material=e._material}function Dst(e){return function(t,n){let i=ce.distanceSquaredTo(t.pickBoundingSphere,e),o=ce.distanceSquaredTo(n.pickBoundingSphere,e);return i-o}}var Bst=[],Yst={start:0,stop:0};Sh.prototype.pickWorldCoordinates=function(e,t,n,i){n=g(n,!0);let o=t.mode,r=t.mapProjection,s=Bst;s.length=0;let a=this._surface._tilesToRender,c=a.length,d,u;for(u=0;u<c;++u){d=a[u];let p=d.data;if(!l(p))continue;let b=p.pickBoundingSphere;if(o!==ie.SCENE3D)p.pickBoundingSphere=b=ce.fromRectangleWithHeights2D(d.rectangle,r,p.tileBoundingRegion.minimumHeight,p.tileBoundingRegion.maximumHeight,b),h.fromElements(b.center.z,b.center.x,b.center.y,b.center);else if(l(p.renderedMesh))ce.clone(p.tileBoundingRegion.boundingSphere,b);else continue;let f=jn.raySphere(e,b,Yst);l(f)&&s.push(p)}s.sort(Dst(e.origin));let m;for(c=s.length,u=0;u<c&&(m=s[u].pick(e,t.mode,t.mapProjection,n,i),!l(m));++u);return m};var Ost=new he;Sh.prototype.pick=function(e,t,n){if(n=this.pickWorldCoordinates(e,t,!0,n),l(n)&&t.mode!==ie.SCENE3D){n=h.fromElements(n.y,n.z,n.x,n);let i=t.mapProjection.unproject(n,Ost);n=t.globe.ellipsoid.cartographicToCartesian(i,n)}return n};var zst=new h,Sye=new h,Hst=new he,Kst=new bn;function A4(e,t){return l(e)&&le.contains(e.rectangle,t)?e:void 0}Sh.prototype.getHeight=function(e){let t=this._surface._levelZeroTiles;if(!l(t))return;let n,i,o=t.length;for(i=0;i<o&&(n=t[i],!le.contains(n.rectangle,e));++i);if(i>=o)return;let r=n;for(;l(n);)n=A4(n._southwestChild,e)||A4(n._southeastChild,e)||A4(n._northwestChild,e)||n._northeastChild,l(n)&&l(n.data)&&l(n.data.renderedMesh)&&(r=n);if(n=r,!l(n)||!l(n.data)||!l(n.data.renderedMesh))return;let s=this._surface._tileProvider.tilingScheme.projection,a=this._surface._tileProvider.tilingScheme.ellipsoid,c=h.fromRadians(e.longitude,e.latitude,0,a,zst),d=Kst,u=a.geodeticSurfaceNormal(c,d.direction),m=a.getSurfaceNormalIntersectionWithZAxis(c,11500,d.origin);if(!l(m)){let b;l(n.data.tileBoundingRegion)&&(b=n.data.tileBoundingRegion.minimumHeight);let f=Math.min(g(b,0),-11500),x=h.multiplyByScalar(u,Math.abs(f)+1,Sye);h.subtract(c,x,d.origin)}let p=n.data.pick(d,void 0,s,!1,Sye);if(l(p))return a.cartesianToCartographic(p,Hst).height};Sh.prototype.update=function(e){this.show&&e.passes.render&&this._surface.update(e)};Sh.prototype.beginFrame=function(e){let t=this._surface,n=t.tileProvider,i=this.terrainProvider,o=this.showWaterEffect&&l(i)&&i.hasWaterMask&&i.hasWaterMask;if(o&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;let a=this._oceanNormalMapResource,c=a.url;if(l(c)){let d=this;a.fetchImage().then(function(u){c===d._oceanNormalMapResource.url&&(d._oceanNormalMap=d._oceanNormalMap&&d._oceanNormalMap.destroy(),d._oceanNormalMap=new Ft({context:e.context,source:u}))})}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}let r=e.passes,s=e.mode;r.render&&(this.showGroundAtmosphere?this._zoomedOutOceanSpecularIntensity=.4:this._zoomedOutOceanSpecularIntensity=.5,t.maximumScreenSpaceError=this.maximumScreenSpaceError,t.tileCacheSize=this.tileCacheSize,t.loadingDescendantLimit=this.loadingDescendantLimit,t.preloadAncestors=this.preloadAncestors,t.preloadSiblings=this.preloadSiblings,n.terrainProvider=this.terrainProvider,n.lightingFadeOutDistance=this.lightingFadeOutDistance,n.lightingFadeInDistance=this.lightingFadeInDistance,n.nightFadeOutDistance=this.nightFadeOutDistance,n.nightFadeInDistance=this.nightFadeInDistance,n.zoomedOutOceanSpecularIntensity=s===ie.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,n.hasWaterMask=o,n.oceanNormalMap=this._oceanNormalMap,n.enableLighting=this.enableLighting,n.dynamicAtmosphereLighting=this.dynamicAtmosphereLighting,n.dynamicAtmosphereLightingFromSun=this.dynamicAtmosphereLightingFromSun,n.showGroundAtmosphere=this.showGroundAtmosphere,n.atmosphereLightIntensity=this.atmosphereLightIntensity,n.atmosphereRayleighCoefficient=this.atmosphereRayleighCoefficient,n.atmosphereMieCoefficient=this.atmosphereMieCoefficient,n.atmosphereRayleighScaleHeight=this.atmosphereRayleighScaleHeight,n.atmosphereMieScaleHeight=this.atmosphereMieScaleHeight,n.atmosphereMieAnisotropy=this.atmosphereMieAnisotropy,n.shadows=this.shadows,n.hueShift=this.atmosphereHueShift,n.saturationShift=this.atmosphereSaturationShift,n.brightnessShift=this.atmosphereBrightnessShift,n.fillHighlightColor=this.fillHighlightColor,n.showSkirts=this.showSkirts,n.backFaceCulling=this.backFaceCulling,n.vertexShadowDarkness=this.vertexShadowDarkness,n.undergroundColor=this._undergroundColor,n.undergroundColorAlphaByDistance=this._undergroundColorAlphaByDistance,n.enableOrthographicOccludersJudge=this.enableOrthographicOccludersJudge,n.lambertDiffuseMultiplier=this.lambertDiffuseMultiplier,t.beginFrame(e))};Sh.prototype.render=function(e){this.show&&(l(this._material)&&this._material.update(e.context),this._surface.render(e))};Sh.prototype.endFrame=function(e){this.show&&e.passes.render&&this._surface.endFrame(e)};Sh.prototype.isDestroyed=function(){return!1};Sh.prototype.destroy=function(){return this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy(),this._surface=this._surface&&this._surface.destroy(),this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy(),me(this)};var yw=Sh;var zLi=T(S(),1);var iLi=T(S(),1);var KVi=T(S(),1);var UVi=T(S(),1);function Jst(e,t,n,i){this.rightAscension=e,this.declination=t,this.rotation=n,this.rotationRate=i}var gw=Jst;var Fye={},Qst=32.184,jst=2451545,Cye=-.0529921,Vye=-.1059842,Lye=13.0120009,Zye=13.3407154,Rye=.9856003,Gye=26.4057084,Eye=13.064993,Xye=.3287146,Iye=1.7484877,Wye=-.1589763,Pye=.0036096,vye=.1643573,wye=12.9590088,N4=new te;Fye.ComputeMoon=function(e,t){l(e)||(e=te.now()),N4=te.addSeconds(e,Qst,N4);let n=te.totalDays(N4)-jst,i=n/Hn.DAYS_PER_JULIAN_CENTURY,o=(125.045+Cye*n)*P.RADIANS_PER_DEGREE,r=(250.089+Vye*n)*P.RADIANS_PER_DEGREE,s=(260.008+Lye*n)*P.RADIANS_PER_DEGREE,a=(176.625+Zye*n)*P.RADIANS_PER_DEGREE,c=(357.529+Rye*n)*P.RADIANS_PER_DEGREE,d=(311.589+Gye*n)*P.RADIANS_PER_DEGREE,u=(134.963+Eye*n)*P.RADIANS_PER_DEGREE,m=(276.617+Xye*n)*P.RADIANS_PER_DEGREE,p=(34.226+Iye*n)*P.RADIANS_PER_DEGREE,b=(15.134+Wye*n)*P.RADIANS_PER_DEGREE,f=(119.743+Pye*n)*P.RADIANS_PER_DEGREE,x=(239.961+vye*n)*P.RADIANS_PER_DEGREE,_=(25.053+wye*n)*P.RADIANS_PER_DEGREE,C=Math.sin(o),V=Math.sin(r),L=Math.sin(s),R=Math.sin(a),G=Math.sin(c),X=Math.sin(d),v=Math.sin(u),W=Math.sin(m),F=Math.sin(p),A=Math.sin(b),y=Math.sin(f),Z=Math.sin(x),E=Math.sin(_),I=Math.cos(o),w=Math.cos(r),k=Math.cos(s),B=Math.cos(a),U=Math.cos(c),Y=Math.cos(d),N=Math.cos(u),J=Math.cos(m),z=Math.cos(p),ee=Math.cos(b),H=Math.cos(f),j=Math.cos(x),q=Math.cos(_),pe=(269.9949+.0031*i-3.8787*C-.1204*V+.07*L-.0172*R+.0072*X-.0052*A+.0043*E)*P.RADIANS_PER_DEGREE,_e=(66.5392+.013*i+1.5419*I+.0239*w-.0278*k+.0068*B-.0029*Y+9e-4*N+8e-4*ee-9e-4*q)*P.RADIANS_PER_DEGREE,ae=(38.3213+13.17635815*n-14e-13*n*n+3.561*C+.1208*V-.0642*L+.0158*R+.0252*G-.0066*X-.0047*v-.0046*W+.0028*F+.0052*A+.004*y+.0019*Z-.0044*E)*P.RADIANS_PER_DEGREE,ye=(13.17635815-14e-13*(2*n)+3.561*I*Cye+.1208*w*Vye-.0642*k*Lye+.0158*B*Zye+.0252*U*Rye-.0066*Y*Gye-.0047*N*Eye-.0046*J*Xye+.0028*z*Iye+.0052*ee*Wye+.004*H*Pye+.0019*j*vye-.0044*q*wye)/86400*P.RADIANS_PER_DEGREE;return l(t)||(t=new gw),t.rightAscension=pe,t.declination=_e,t.rotation=ae,t.rotationRate=ye,t};var xw=Fye;function Aye(e){(!l(e)||typeof e!=\"function\")&&(e=xw.ComputeMoon),this._computeFunction=e}var qst=new h,$st=new h,eat=new h;function tat(e,t,n){let i=qst;i.x=Math.cos(e+P.PI_OVER_TWO),i.y=Math.sin(e+P.PI_OVER_TWO),i.z=0;let o=Math.cos(t),r=eat;r.x=o*Math.cos(e),r.y=o*Math.sin(e),r.z=Math.sin(t);let s=h.cross(r,i,$st);return l(n)||(n=new $),n[0]=i.x,n[1]=s.x,n[2]=r.x,n[3]=i.y,n[4]=s.y,n[5]=r.y,n[6]=i.z,n[7]=s.z,n[8]=r.z,n}var nat=new $,iat=new Fe;Aye.prototype.evaluate=function(e,t){l(e)||(e=te.now());let n=this._computeFunction(e),i=tat(n.rightAscension,n.declination,t),o=P.zeroToTwoPi(n.rotation),r=Fe.fromAxisAngle(h.UNIT_Z,o,iat),s=$.fromQuaternion(Fe.conjugate(r,r),nat);return $.multiply(s,i,i)};var _w=Aye;var ILi=T(S(),1);var rLi=T(S(),1),MV=`uniform vec3 u_radii; uniform vec3 u_oneOverEllipsoidRadiiSquared; in vec3 v_positionEC; vec4 computeEllipsoidColor(czm_ray ray, float intersection, float side) { vec3 positionEC = czm_pointAlongRay(ray, intersection); vec3 positionMC = (czm_inverseModelView * vec4(positionEC, 1.0)).xyz; vec3 geodeticNormal = normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared)); vec3 sphericalNormal = normalize(positionMC / u_radii); vec3 normalMC = geodeticNormal * side; // normalized surface normal (always facing the viewer) in model coordinates vec3 normalEC = normalize(czm_normal * normalMC); // normalized surface normal in eye coordinates vec2 st = czm_ellipsoidWgs84TextureCoordinates(sphericalNormal); vec3 positionToEyeEC = -positionEC; czm_materialInput materialInput; materialInput.s = st.s; materialInput.st = st; materialInput.str = (positionMC + u_radii) / u_radii; materialInput.normalEC = normalEC; materialInput.tangentToEyeMatrix = czm_eastNorthUpToEyeCoordinates(positionMC, normalEC); materialInput.positionToEyeEC = positionToEyeEC; czm_material material = czm_getMaterial(materialInput); #ifdef ONLY_SUN_LIGHTING return czm_private_phong(normalize(positionToEyeEC), material, czm_sunDirectionEC); #else return czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC); #endif } void main() { // PERFORMANCE_TODO: When dynamic branching is available, compute ratio of maximum and minimum radii // in the vertex shader. Only when it is larger than some constant, march along the ray. // Otherwise perform one intersection test which will be the common case. // Test if the ray intersects a sphere with the ellipsoid's maximum radius. // For very oblate ellipsoids, using the ellipsoid's radii for an intersection test // may cause false negatives. This will discard fragments before marching the ray forward. float maxRadius = max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5; vec3 direction = normalize(v_positionEC); vec3 ellipsoidCenter = czm_modelView[3].xyz; float t1 = -1.0; float t2 = -1.0; float b = -2.0 * dot(direction,"
}