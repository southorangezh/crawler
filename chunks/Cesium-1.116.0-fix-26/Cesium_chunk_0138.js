{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 138,
    "total_chunks": 194,
    "chunk_size": 30800,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.734Z"
  },
  "content": "ndt(e){let t=DD,n=t.length;if(e<t[0])return fa=0,fa;if(e>t[n-1])return fa=n-2,fa;if(e>=t[fa]){if(fa+1<n&&e<t[fa+1])return fa;if(fa+2<n&&e<t[fa+2])return++fa,fa}else if(fa-1>=0&&e>=t[fa-1])return--fa,fa;let i;for(i=0;i<n-2&&!(e>=t[i]&&e<t[i+1]);++i);return fa=i,fa}var idt=new h;Xge.prototype.update=function(e){if(!(e.fog.enabled=this.enabled))return;e.fog.renderable=this.renderable;let n=e.camera,i=n.positionCartographic;if(!l(i)||i.height>8e5||e.mode!==ie.SCENE3D){e.fog.enabled=!1,e.fog.density=0;return}let o=i.height,r=ndt(o),s=P.clamp((o-DD[r])/(DD[r+1]-DD[r]),0,1),a=P.lerp(Of[r],Of[r+1],s),c=this.density*1e6,d=c/Ige*sj;a=a*(c-d)*1e-6;let u=h.normalize(n.positionWC,idt),m=Math.abs(h.dot(n.directionWC,u));a*=1-m,e.fog.density=a,e.fog.sse=this.screenSpaceErrorFactor,e.fog.minimumBrightness=this.minimumBrightness};var zw=Xge;var PEi=T(S(),1);function odt(e,t,n){this.context=e,this.commandList=[],this.shadowMaps=[],this.brdfLutGenerator=void 0,this.environmentMap=void 0,this.sphericalHarmonicCoefficients=void 0,this.specularEnvironmentMaps=void 0,this.specularEnvironmentMapsMaximumLOD=void 0,this.mode=ie.SCENE3D,this.morphTime=ie.getMorphTime(ie.SCENE3D),this.frameNumber=0,this.newFrame=!1,this.time=void 0,this.jobScheduler=n,this.mapProjection=void 0,this.camera=void 0,this.cameraUnderground=!1,this.globeTranslucencyState=void 0,this.cullingVolume=void 0,this.occluder=void 0,this.maximumScreenSpaceError=void 0,this.pixelRatio=1,this.passes={render:!1,pick:!1,pickVoxel:!1,depth:!1,postProcess:!1,offscreen:!1,uranusDepth:!1},this.creditDisplay=t,this.afterRender=[],this.scene3DOnly=!1,this.fog={enabled:!1,renderable:!1,density:void 0,sse:void 0,minimumBrightness:void 0},this.atmosphere=void 0,this.verticalExaggeration=1,this.verticalExaggerationRelativeHeight=0,this.shadowState={shadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5e3,closestObjectSize:1e3,lastDirtyTime:0,outOfView:!0},this.splitPosition=0,this.splitMode=Xb.LEFT_RIGHT,this.frustumSplits=[],this.backgroundColor=void 0,this.light=void 0,this.minimumDisableDepthTestDistance=void 0,this.invertClassification=!1,this.invertClassificationColor=void 0,this.useLogDepth=!1,this.tilesetPassState=void 0,this.minimumTerrainHeight=0}var Hw=odt;var HEi=T(S(),1);var pa={OPAQUE_FRONT_FACE:0,OPAQUE_BACK_FACE:1,DEPTH_ONLY_FRONT_FACE:2,DEPTH_ONLY_BACK_FACE:3,DEPTH_ONLY_FRONT_AND_BACK_FACE:4,TRANSLUCENT_FRONT_FACE:5,TRANSLUCENT_BACK_FACE:6,TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:7,TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:8,PICK_FRONT_FACE:9,PICK_BACK_FACE:10,DERIVED_COMMANDS_MAXIMUM_LENGTH:11},CT=pa.DERIVED_COMMANDS_MAXIMUM_LENGTH,Uge=[\"opaqueFrontFaceCommand\",\"opaqueBackFaceCommand\",\"depthOnlyFrontFaceCommand\",\"depthOnlyBackFaceCommand\",\"depthOnlyFrontAndBackFaceCommand\",\"translucentFrontFaceCommand\",\"translucentBackFaceCommand\",\"translucentFrontFaceManualDepthTestCommand\",\"translucentBackFaceManualDepthTestCommand\",\"pickFrontFaceCommand\",\"pickBackFaceCommand\"];function VT(){this._frontFaceAlphaByDistance=new At(0,1,0,1),this._backFaceAlphaByDistance=new At(0,1,0,1),this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._requiresManualDepthTest=!1,this._sunVisibleThroughGlobe=!1,this._environmentVisible=!1,this._useDepthPlane=!1,this._numberOfTextureUniforms=0,this._globeTranslucencyFramebuffer=void 0,this._rectangle=le.clone(le.MAX_VALUE),this._derivedCommandKey=0,this._derivedCommandsDirty=!1,this._derivedCommandPacks=void 0,this._derivedCommandTypes=new Array(CT),this._derivedBlendCommandTypes=new Array(CT),this._derivedPickCommandTypes=new Array(CT),this._derivedCommandTypesToUpdate=new Array(CT),this._derivedCommandsLength=0,this._derivedBlendCommandsLength=0,this._derivedPickCommandsLength=0,this._derivedCommandsToUpdateLength=0}Object.defineProperties(VT.prototype,{frontFaceAlphaByDistance:{get:function(){return this._frontFaceAlphaByDistance}},backFaceAlphaByDistance:{get:function(){return this._backFaceAlphaByDistance}},translucent:{get:function(){return this._frontFaceTranslucent}},sunVisibleThroughGlobe:{get:function(){return this._sunVisibleThroughGlobe}},environmentVisible:{get:function(){return this._environmentVisible}},useDepthPlane:{get:function(){return this._useDepthPlane}},numberOfTextureUniforms:{get:function(){return this._numberOfTextureUniforms}},rectangle:{get:function(){return this._rectangle}}});VT.prototype.update=function(e){let t=e.globe;if(!l(t)||!t.show){this._frontFaceTranslucent=!1,this._backFaceTranslucent=!1,this._sunVisibleThroughGlobe=!0,this._environmentVisible=!0,this._useDepthPlane=!1;return}this._frontFaceAlphaByDistance=Wge(t.translucency.enabled,t.translucency.frontFaceAlpha,t.translucency.frontFaceAlphaByDistance,this._frontFaceAlphaByDistance),this._backFaceAlphaByDistance=Wge(t.translucency.enabled,t.translucency.backFaceAlpha,t.translucency.backFaceAlphaByDistance,this._backFaceAlphaByDistance),this._frontFaceTranslucent=Pge(t.translucency.enabled,this._frontFaceAlphaByDistance,t),this._backFaceTranslucent=Pge(t.translucency.enabled,this._backFaceAlphaByDistance,t),this._requiresManualDepthTest=cdt(this,e,t),this._sunVisibleThroughGlobe=rdt(this,e),this._environmentVisible=sdt(this,e),this._useDepthPlane=adt(this,e),this._numberOfTextureUniforms=ldt(this),this._rectangle=le.clone(t.translucency.rectangle,this._rectangle),ddt(this,e)};function Wge(e,t,n,i){return e?l(n)?(At.clone(n,i),i.nearValue*=t,i.farValue*=t,i):(i.nearValue=t,i.farValue=t,i):(i.nearValue=1,i.farValue=1,i)}function Pge(e,t,n){return e&&(n.baseColor.alpha<1||t.nearValue<1||t.farValue<1)}function rdt(e,t){let n=e._frontFaceTranslucent,i=e._backFaceTranslucent;return n&&(t.cameraUnderground||i)}function sdt(e,t){return!t.cameraUnderground||e._frontFaceTranslucent}function adt(e,t){return!t.cameraUnderground&&!e._frontFaceTranslucent}function cdt(e,t,n){return e._frontFaceTranslucent&&!e._backFaceTranslucent&&!n.depthTestAgainstTerrain&&t.mode!==ie.SCENE2D&&t.context.depthTexture}function ldt(e){let t=0;return e._frontFaceTranslucent&&++t,e._requiresManualDepthTest&&++t,t}function ddt(e,t){e._derivedCommandsLength=aj(e,t,!1,!1,e._derivedCommandTypes),e._derivedBlendCommandsLength=aj(e,t,!0,!1,e._derivedBlendCommandTypes),e._derivedPickCommandsLength=aj(e,t,!1,!0,e._derivedPickCommandTypes);let n,i=0;for(n=0;n<e._derivedCommandsLength;++n)i|=1<<e._derivedCommandTypes[n];for(n=0;n<e._derivedBlendCommandsLength;++n)i|=1<<e._derivedBlendCommandTypes[n];for(n=0;n<e._derivedPickCommandsLength;++n)i|=1<<e._derivedPickCommandTypes[n];let o=0;for(n=0;n<CT;++n)(i&1<<n)>0&&(e._derivedCommandTypesToUpdate[o++]=n);e._derivedCommandsToUpdateLength=o;let r=i!==e._derivedCommandKey;e._derivedCommandKey=i,e._derivedCommandsDirty=r,!l(e._derivedCommandPacks)&&e._frontFaceTranslucent&&(e._derivedCommandPacks=Ldt())}function aj(e,t,n,i,o){let r=0,s=e._frontFaceTranslucent,a=e._backFaceTranslucent;if(!s)return r;let c=t.cameraUnderground,d=e._requiresManualDepthTest,u=i?pa.PICK_FRONT_FACE:d?pa.TRANSLUCENT_FRONT_FACE_MANUAL_DEPTH_TEST:pa.TRANSLUCENT_FRONT_FACE,m=i?pa.PICK_BACK_FACE:d?pa.TRANSLUCENT_BACK_FACE_MANUAL_DEPTH_TEST:pa.TRANSLUCENT_BACK_FACE;return t.mode===ie.SCENE2D?(o[r++]=pa.DEPTH_ONLY_FRONT_FACE,o[r++]=u,r):(a?(n||(o[r++]=pa.DEPTH_ONLY_FRONT_AND_BACK_FACE),c?(o[r++]=u,o[r++]=m):(o[r++]=m,o[r++]=u)):c?(n||(o[r++]=pa.DEPTH_ONLY_BACK_FACE),o[r++]=pa.OPAQUE_FRONT_FACE,o[r++]=m):(n||(o[r++]=pa.DEPTH_ONLY_FRONT_FACE),o[r++]=pa.OPAQUE_BACK_FACE,o[r++]=u),r)}function tm(e,t){let n=e.indexOf(t);n>-1&&e.splice(n,1)}function vge(e,t){return e.indexOf(t)>-1}function udt(e,t){tm(e.defines,\"TRANSLUCENT\"),tm(t.defines,\"TRANSLUCENT\")}function mdt(e,t){tm(e.defines,\"GROUND_ATMOSPHERE\"),tm(t.defines,\"GROUND_ATMOSPHERE\"),tm(e.defines,\"FOG\"),tm(t.defines,\"FOG\"),tm(e.defines,\"TRANSLUCENT\"),tm(t.defines,\"TRANSLUCENT\")}function cj(e,t){if(vge(t.defines,\"TILE_LIMIT_RECTANGLE\")||vge(t.defines,\"ENABLE_CLIPPING_PLANES\"))return;let n=`void main() { out_FragColor = vec4(1.0); } `;t.sources=[n]}function lj(e,t){let n=t.sources,i=n.length;for(let r=0;r<i;++r)n[r]=Ue.replaceMain(n[r],\"czm_globe_translucency_main\");n.push(` uniform sampler2D u_classificationTexture; void main() { vec2 st = gl_FragCoord.xy / czm_viewport.zw; #ifdef MANUAL_DEPTH_TEST float logDepthOrDepth = czm_unpackDepth(texture(czm_globeDepthTexture, st)); if (logDepthOrDepth != 0.0) { vec4 eyeCoordinate = czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth); float depthEC = eyeCoordinate.z / eyeCoordinate.w; if (v_positionEC.z < depthEC) { discard; } } #endif czm_globe_translucency_main(); vec4 classificationColor = texture(u_classificationTexture, st); if (classificationColor.a > 0.0) { // Reverse premultiplication process to get the correct composited result of the classification primitives classificationColor.rgb /= classificationColor.a; } out_FragColor = classificationColor * vec4(classificationColor.aaa, 1.0) + out_FragColor * (1.0 - classificationColor.a); } `)}function Dge(e,t){lj(e,t),tm(e.defines,\"GROUND_ATMOSPHERE\"),tm(t.defines,\"GROUND_ATMOSPHERE\"),tm(e.defines,\"FOG\"),tm(t.defines,\"FOG\")}function hdt(e,t){lj(e,t),e.defines.push(\"GENERATE_POSITION\"),t.defines.push(\"MANUAL_DEPTH_TEST\")}function fdt(e,t){Dge(e,t),e.defines.push(\"GENERATE_POSITION\"),t.defines.push(\"MANUAL_DEPTH_TEST\")}function wge(e,t){let n=`uniform sampler2D u_classificationTexture; void main() { vec2 st = gl_FragCoord.xy / czm_viewport.zw; vec4 pickColor = texture(u_classificationTexture, st); if (pickColor == vec4(0.0)) { discard; } out_FragColor = pickColor; } `;t.sources=[n]}function pdt(e,t,n,i,o,r){if(!l(o))return t;if(!i&&l(n))return n;let s=e.shaderCache.getDerivedShaderProgram(t,r);if(!l(s)){let a=t._attributeLocations,c=t.vertexShaderSource.clone(),d=t.fragmentShaderSource.clone();c.defines=l(c.defines)?c.defines.slice(0):[],d.defines=l(d.defines)?d.defines.slice(0):[],o(c,d),s=e.shaderCache.createDerivedShaderProgram(t,r,{vertexShaderSource:c,fragmentShaderSource:d,attributeLocations:a})}return s}function bdt(e){e.cull.face=mi.BACK,e.cull.enabled=!0}function ydt(e){e.cull.face=mi.FRONT,e.cull.enabled=!0}function gdt(e){e.cull.face=mi.BACK,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function xdt(e){e.cull.face=mi.FRONT,e.cull.enabled=!0,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function _dt(e){e.cull.enabled=!1,e.colorMask={red:!1,green:!1,blue:!1,alpha:!1}}function Fge(e){e.cull.face=mi.BACK,e.cull.enabled=!0,e.depthMask=!1,e.blending=un.ALPHA_BLEND}function Age(e){e.cull.face=mi.FRONT,e.cull.enabled=!0,e.depthMask=!1,e.blending=un.ALPHA_BLEND}function Tdt(e){e.cull.face=mi.BACK,e.cull.enabled=!0,e.blending.enabled=!1}function Sdt(e){e.cull.face=mi.FRONT,e.cull.enabled=!0,e.blending.enabled=!1}function Cdt(e,t,n,i,o){if(!l(i))return e;if(!n&&l(t))return t;let r=o[e.id];if(!l(r)){let s=Ne.getState(e);i(s),r=Ne.fromCache(s),o[e.id]=r}return r}function DV(e){return{u_classificationTexture:function(){return e._globeTranslucencyFramebuffer.classificationTexture}}}function Vdt(e,t,n,i,o){return l(o)?!i&&l(n)?n:Ct(t,o(e),!1):t}function Vh(e){this.pass=e.pass,this.pickOnly=e.pickOnly,this.getShaderProgramFunction=e.getShaderProgramFunction,this.getRenderStateFunction=e.getRenderStateFunction,this.getUniformMapFunction=e.getUniformMapFunction,this.renderStateCache={}}function Ldt(){return[new Vh({pass:Ze.GLOBE,pickOnly:!1,getShaderProgramFunction:udt,getRenderStateFunction:bdt,getUniformMapFunction:void 0}),new Vh({pass:Ze.GLOBE,pickOnly:!1,getShaderProgramFunction:mdt,getRenderStateFunction:ydt,getUniformMapFunction:void 0}),new Vh({pass:Ze.GLOBE,pickOnly:!1,getShaderProgramFunction:cj,getRenderStateFunction:gdt,getUniformMapFunction:void 0}),new Vh({pass:Ze.GLOBE,pickOnly:!1,getShaderProgramFunction:cj,getRenderStateFunction:xdt,getUniformMapFunction:void 0}),new Vh({pass:Ze.GLOBE,pickOnly:!1,getShaderProgramFunction:cj,getRenderStateFunction:_dt,getUniformMapFunction:void 0}),new Vh({pass:Ze.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:lj,getRenderStateFunction:Fge,getUniformMapFunction:DV}),new Vh({pass:Ze.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:Dge,getRenderStateFunction:Age,getUniformMapFunction:DV}),new Vh({pass:Ze.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:hdt,getRenderStateFunction:Fge,getUniformMapFunction:DV}),new Vh({pass:Ze.TRANSLUCENT,pickOnly:!1,getShaderProgramFunction:fdt,getRenderStateFunction:Age,getUniformMapFunction:DV}),new Vh({pass:Ze.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:wge,getRenderStateFunction:Tdt,getUniformMapFunction:DV}),new Vh({pass:Ze.TRANSLUCENT,pickOnly:!0,getShaderProgramFunction:wge,getRenderStateFunction:Sdt,getUniformMapFunction:DV})]}var Mge=new Array(CT),Nge=new Array(CT);VT.prototype.updateDerivedCommands=function(e,t){let n=this._derivedCommandTypesToUpdate,i=this._derivedCommandsToUpdateLength;if(i!==0){for(let o=0;o<i;++o)Nge[o]=this._derivedCommandPacks[n[o]],Mge[o]=Uge[n[o]];Zdt(this,e,i,n,Mge,Nge,t)}};function Zdt(e,t,n,i,o,r,s){let a=t.derivedCommands.globeTranslucency,c=e._derivedCommandsDirty;if(t.dirty||!l(a)||c){t.dirty=!1,l(a)||(a={},t.derivedCommands.globeTranslucency=a);let d=s.frameNumber,u=g(a.uniformMapDirtyFrame,0),m=g(a.shaderProgramDirtyFrame,0),p=g(a.renderStateDirtyFrame,0),b=a.uniformMap!==t.uniformMap,f=a.shaderProgramId!==t.shaderProgram.id,x=a.renderStateId!==t.renderState.id;b&&(a.uniformMapDirtyFrame=d),f&&(a.shaderProgramDirtyFrame=d),x&&(a.renderStateDirtyFrame=d),a.uniformMap=t.uniformMap,a.shaderProgramId=t.shaderProgram.id,a.renderStateId=t.renderState.id;for(let _=0;_<n;++_){let C=r[_],V=i[_],L=o[_],R=a[L],G,X,v;l(R)?(G=R.uniformMap,X=R.shaderProgram,v=R.renderState):(G=void 0,X=void 0,v=void 0),R=je.shallowClone(t,R),a[L]=R;let W=g(R.derivedCommands.uniformMapDirtyFrame,0),F=g(R.derivedCommands.shaderProgramDirtyFrame,0),A=g(R.derivedCommands.renderStateDirtyFrame,0),y=b||W<u,Z=f||F<m,E=x||A<p;y&&(R.derivedCommands.uniformMapDirtyFrame=d),Z&&(R.derivedCommands.shaderProgramDirtyFrame=d),E&&(R.derivedCommands.renderStateDirtyFrame=d),R.derivedCommands.type=V,R.pass=C.pass,R.pickOnly=C.pickOnly,R.uniformMap=Vdt(e,t.uniformMap,G,y,C.getUniformMapFunction),R.shaderProgram=pdt(s.context,t.shaderProgram,X,Z,C.getShaderProgramFunction,L),R.renderState=Cdt(t.renderState,v,E,C.getRenderStateFunction,C.renderStateCache)}}}VT.prototype.pushDerivedCommands=function(e,t,n){let i=n.passes.pick||n.passes.pickVoxel;if(i&&t)return;let o=this._derivedCommandTypes,r=this._derivedCommandsLength;if(i?(o=this._derivedPickCommandTypes,r=this._derivedPickCommandsLength):t&&(o=this._derivedBlendCommandTypes,r=this._derivedBlendCommandsLength),r===0){n.commandList.push(e);return}let s=e.derivedCommands.globeTranslucency;for(let a=0;a<r;++a){let c=Uge[o[a]];n.commandList.push(s[c])}};function Bge(e,t,n,i,o,r,s){for(let a=0;a<t;++a){let c=e[a],d=c.derivedCommands.type;(!l(s)||s.indexOf(d)>-1)&&n(c,i,o,r)}}function kge(e,t,n,i,o,r){for(let s=0;s<t;++s)n(e[s],i,o,r)}var Rdt=[pa.OPAQUE_FRONT_FACE,pa.OPAQUE_BACK_FACE],Gdt=[pa.DEPTH_ONLY_FRONT_FACE,pa.DEPTH_ONLY_BACK_FACE,pa.DEPTH_ONLY_FRONT_AND_BACK_FACE];VT.prototype.executeGlobeCommands=function(e,t,n,i,o){let r=i.context,s=e.commands[Ze.GLOBE],a=e.indices[Ze.GLOBE];a!==0&&(this._globeTranslucencyFramebuffer=n,n.clearClassification(r,o),Bge(s,a,t,i,r,o,Rdt))};VT.prototype.executeGlobeClassificationCommands=function(e,t,n,i,o){let r=i.context,s=e.commands[Ze.GLOBE],a=e.indices[Ze.GLOBE],c=e.commands[Ze.TERRAIN_CLASSIFICATION],d=e.indices[Ze.TERRAIN_CLASSIFICATION];if(a===0||d===0)return;let u=this._frontFaceTranslucent,m=this._backFaceTranslucent;if((!u||!m)&&kge(c,d,t,i,r,o),!u&&!m)return;this._globeTranslucencyFramebuffer=n;let p=r.uniformState.globeDepthTexture,b=o.framebuffer;if(o.framebuffer=n.classificationFramebuffer,Bge(s,a,t,i,r,o,Gdt),r.depthTexture){let f=n.packDepth(r,o);r.uniformState.globeDepthTexture=f}kge(c,d,t,i,r,o),r.uniformState.globeDepthTexture=p,o.framebuffer=b};var Kw=VT;var fXi=T(S(),1);var JEi=T(S(),1),Ql=`uniform sampler2D colorTexture; in vec2 v_textureCoordinates; void main() { out_FragColor = texture(colorTexture, v_textureCoordinates); } `;function zf(){this._numSamples=1,this.previousFramebuffer=void 0,this._previousFramebuffer=void 0,this._depthStencilTexture=void 0,this._depthStencilRenderbuffer=void 0,this._fbo=new li({depthStencil:!0,createDepthAttachments:!1}),this._fboClassified=new li({depthStencil:!0,createDepthAttachments:!1}),this._rsUnclassified=void 0,this._rsClassified=void 0,this._unclassifiedCommand=void 0,this._classifiedCommand=void 0,this._translucentCommand=void 0,this._clearColorCommand=new ei({color:new O(0,0,0,0),owner:this}),this._clearCommand=new ei({color:new O(0,0,0,0),depth:1,stencil:0});let e=this;this._uniformMap={colorTexture:function(){return e._fbo.getColorTexture()},depthTexture:function(){return e._depthStencilTexture},classifiedTexture:function(){return e._fboClassified.getColorTexture()}}}Object.defineProperties(zf.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}});zf.isTranslucencySupported=function(e){return e.depthTexture&&e.fragmentDepth};var Edt={depthMask:!1,stencilTest:{enabled:!0,frontFunction:vn.EQUAL,frontOperation:{fail:dt.KEEP,zFail:dt.KEEP,zPass:dt.KEEP},backFunction:vn.NEVER,reference:0,mask:Mt.CLASSIFICATION_MASK},blending:un.ALPHA_BLEND},Xdt={depthMask:!1,stencilTest:{enabled:!0,frontFunction:vn.NOT_EQUAL,frontOperation:{fail:dt.KEEP,zFail:dt.KEEP,zPass:dt.KEEP},backFunction:vn.NEVER,reference:0,mask:Mt.CLASSIFICATION_MASK},blending:un.ALPHA_BLEND},Idt={depthMask:!0,depthTest:{enabled:!0},stencilTest:Mt.setCesium3DTileBit(),stencilMask:Mt.CESIUM_3D_TILE_MASK,blending:un.ALPHA_BLEND},Wdt=`uniform sampler2D colorTexture; uniform sampler2D depthTexture; uniform sampler2D classifiedTexture; in vec2 v_textureCoordinates; void main() { vec4 color = texture(colorTexture, v_textureCoordinates); if (color.a == 0.0) { discard; } bool isClassified = all(equal(texture(classifiedTexture, v_textureCoordinates), vec4(0.0))); #ifdef UNCLASSIFIED vec4 highlightColor = czm_invertClassificationColor; if (isClassified) { discard; } #else vec4 highlightColor = vec4(1.0); if (!isClassified) { discard; } #endif out_FragColor = color * highlightColor; gl_FragDepth = texture(depthTexture, v_textureCoordinates).r; } `,Pdt=`uniform sampler2D colorTexture; in vec2 v_textureCoordinates; void main() { vec4 color = texture(colorTexture, v_textureCoordinates); if (color.a == 0.0) { discard; } #ifdef UNCLASSIFIED out_FragColor = color * czm_invertClassificationColor; #else out_FragColor = color; #endif } `;zf.prototype.update=function(e,t,n){let i=this._fbo.getColorTexture(),o=this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;let r=this._numSamples!==t,s=e.drawingBufferWidth,a=e.drawingBufferHeight,c=!l(i)||i.width!==s||i.height!==a;if((c||o||r)&&(this._numSamples=t,this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy(),l(this._previousFramebuffer)||(this._depthStencilTexture=new Ft({context:e,width:s,height:a,pixelFormat:at.DEPTH_STENCIL,pixelDatatype:Qe.UNSIGNED_INT_24_8}),t>1&&(this._depthStencilRenderbuffer=new rd({context:e,width:s,height:a,format:Pc.DEPTH24_STENCIL8,numSamples:t})))),!l(this._fbo.framebuffer)||c||o||r){this._fbo.destroy(),this._fboClassified.destroy();let d,u;l(this._previousFramebuffer)?(d=n.getDepthStencilTexture(),u=n.getDepthStencilRenderbuffer()):(d=this._depthStencilTexture,u=this._depthStencilRenderbuffer),this._fbo.setDepthStencilTexture(d),l(u)&&this._fbo.setDepthStencilRenderbuffer(u),this._fbo.update(e,s,a,t),l(this._previousFramebuffer)||(this._fboClassified.setDepthStencilTexture(d),this._fboClassified.update(e,s,a))}if(l(this._rsUnclassified)||(this._rsUnclassified=Ne.fromCache(Edt),this._rsClassified=Ne.fromCache(Xdt),this._rsDefault=Ne.fromCache(Idt)),!l(this._unclassifiedCommand)||o||r){l(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());let d=l(this._previousFramebuffer)?Pdt:Wdt,u=new Ue({defines:[\"UNCLASSIFIED\"],sources:[d]}),m=new Ue({sources:[d]});this._unclassifiedCommand=e.createViewportQuadCommand(u,{renderState:l(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=e.createViewportQuadCommand(m,{renderState:l(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),l(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),l(this._previousFramebuffer)||(this._translucentCommand=e.createViewportQuadCommand(Ql,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))}};zf.prototype.prepareTextures=function(e,t){this._fbo._numSamples>1&&this._fbo.prepareTextures(e,t)};zf.prototype.clear=function(e,t){l(this._previousFramebuffer)?this._fbo.clear(e,this._clearColorCommand,t):(this._fbo.clear(e,this._clearCommand,t),this._fboClassified.clear(e,this._clearCommand,t))};zf.prototype.executeClassified=function(e,t){if(!l(this._previousFramebuffer)){let n=t.framebuffer;this.prepareTextures(e,!0),t.framebuffer=this._fboClassified.framebuffer,this._translucentCommand.execute(e,t),t.framebuffer=n}this._classifiedCommand.execute(e,t)};zf.prototype.executeUnclassified=function(e,t){this._unclassifiedCommand.execute(e,t)};zf.prototype.isDestroyed=function(){return!1};zf.prototype.destroy=function(){return this._fbo.destroy(),this._fboClassified.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy(),l(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),me(this)};var BV=zf;var xXi=T(S(),1);function BD(e){this._total=e,this.usedThisFrame=0,this.stolenFromMeThisFrame=0,this.starvedThisFrame=!1,this.starvedLastFrame=!1}Object.defineProperties(BD.prototype,{total:{get:function(){return this._total}}});function gg(e){let t=new Array(Ea.NUMBER_OF_JOB_TYPES);t[Ea.TEXTURE]=new BD(l(e)?e[Ea.TEXTURE]:10),t[Ea.PROGRAM]=new BD(l(e)?e[Ea.PROGRAM]:10),t[Ea.BUFFER]=new BD(l(e)?e[Ea.BUFFER]:30);let n=t.length,i,o=0;for(i=0;i<n;++i)o+=t[i].total;let r=new Array(n);for(i=0;i<n;++i)r[i]=!1;this._totalBudget=o,this._totalUsedThisFrame=0,this._budgets=t,this._executedThisFrame=r}gg.getTimestamp=fi;Object.defineProperties(gg.prototype,{totalBudget:{get:function(){return this._totalBudget}}});gg.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget};gg.prototype.resetBudgets=function(){let e=this._budgets,t=e.length;for(let n=0;n<t;++n){let i=e[n];i.starvedLastFrame=i.starvedThisFrame,i.starvedThisFrame=!1,i.usedThisFrame=0,i.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0};gg.prototype.execute=function(e,t){let n=this._budgets,i=n[t],o=this._executedThisFrame[t];if(this._totalUsedThisFrame>=this._totalBudget&&o)return i.starvedThisFrame=!0,!1;let r;if(i.usedThisFrame+i.stolenFromMeThisFrame>=i.total){let c=n.length,d;for(d=0;d<c&&(r=n[d],!(r.usedThisFrame+r.stolenFromMeThisFrame<r.total&&!r.starvedLastFrame));++d);if(d===c&&o)return!1;o&&(i.starvedThisFrame=!0)}let s=gg.getTimestamp();e.execute();let a=gg.getTimestamp()-s;return this._totalUsedThisFrame+=a,r?r.stolenFromMeThisFrame+=a:i.usedThisFrame+=a,this._executedThisFrame[t]=!0,!0};var Jw=gg;var LXi=T(S(),1);function YD(e){e=g(e,g.EMPTY_OBJECT);let t=Xn(e.container);this._container=t;let n=document.createElement(\"div\");n.className=\"cesium-performanceDisplay\";let i=document.createElement(\"div\");i.className=\"cesium-performanceDisplay-fps\",this._fpsText=document.createTextNode(\"\"),i.appendChild(this._fpsText);let o=document.createElement(\"div\");o.className=\"cesium-performanceDisplay-ms\",this._msText=document.createTextNode(\"\"),o.appendChild(this._msText),n.appendChild(o),n.appendChild(i),this._container.appendChild(n),this._lastFpsSampleTime=fi(),this._lastMsSampleTime=fi(),this._fpsFrameCount=0,this._msFrameCount=0,this._throttled=!1;let r=document.createElement(\"div\");r.className=\"cesium-performanceDisplay-throttled\",this._throttledText=document.createTextNode(\"\"),r.appendChild(this._throttledText),n.appendChild(r)}Object.defineProperties(YD.prototype,{throttled:{get:function(){return this._throttled},set:function(e){this._throttled!==e&&(e?this._throttledText.nodeValue=\"(throttled)\":this._throttledText.nodeValue=\"\",this._throttled=e)}}});YD.prototype.update=function(e){let t=fi(),n=g(e,!0);this._fpsFrameCount++;let i=t-this._lastFpsSampleTime;if(i>1e3){let r=\"N/A\";n&&(r=this._fpsFrameCount*1e3/i|0),this._fpsText.nodeValue=`${r} FPS`,this._lastFpsSampleTime=t,this._fpsFrameCount=0}this._msFrameCount++;let o=t-this._lastMsSampleTime;if(o>200){let r=\"N/A\";n&&(r=(o/this._msFrameCount).toFixed(2)),this._msText.nodeValue=`${r} MS`,this._lastMsSampleTime=t,this._msFrameCount=0}};YD.prototype.destroy=function(){return me(this)};var tb=YD;var LPi=T(S(),1);var SIi=T(S(),1);var EXi=T(S(),1);function LT(){}LT.getShadowCastShaderKeyword=function(e,t,n,i){return`castShadow ${e} ${t} ${n} ${i}`};LT.createShadowCastVertexShader=function(e,t,n){let i=e.defines.slice(0),o=e.sources.slice(0);i.push(\"SHADOW_MAP\"),n&&i.push(\"GENERATE_POSITION\");let r=Ue.findPositionVarying(e),s=l(r);if(t&&!s){let a=o.length;for(let d=0;d<a;++d)o[d]=Ue.replaceMain(o[d],\"czm_shadow_cast_main\");o.push(`out vec3 v_positionEC; void main() { czm_shadow_cast_main(); v_positionEC = (czm_inverseProjection * gl_Position).xyz; }`)}return new Ue({defines:i,sources:o})};LT.createShadowCastFragmentShader=function(e,t,n,i){let o=e.defines.slice(0),r=e.sources.slice(0);o.push(\"SHADOW_MAP\");let s=Ue.findPositionVarying(e),a=l(s);a||(s=\"v_positionEC\");let c=r.length;for(let u=0;u<c;++u)r[u]=Ue.replaceMain(r[u],\"czm_shadow_cast_main\");let d=\"\";return t&&(a||(d+=`in vec3 v_positionEC; `),d+=`uniform vec4 shadowMap_lightPositionEC; `),i?d+=`void main() { `:d+=`void main() { czm_shadow_cast_main(); if (out_FragColor.a == 0.0) { discard; } `,t?d+=` float distance = length(${s}); if (distance >= shadowMap_lightPositionEC.w) { discard; } distance /= shadowMap_lightPositionEC.w; // radius out_FragColor = czm_packDepth(distance); `:n?d+=` out_FragColor = vec4(1.0); `:d+=` out_FragColor = czm_packDepth(gl_FragCoord.z); `,d+=`} `,r.push(d),new Ue({defines:o,sources:r})};LT.getShadowReceiveShaderKeyword=function(e,t,n,i){let o=e._usesDepthTexture,r=e._polygonOffsetSupported,s=e._isPointLight,a=e._isSpotLight,c=e._numberOfCascades>1,d=e.debugCascadeColors,u=e.softShadows;return`receiveShadow ${o}${r}${s}${a}${c}${d}${u}${t}${n}${i}`};LT.createShadowReceiveVertexShader=function(e,t,n){let i=e.defines.slice(0),o=e.sources.slice(0);return i.push(\"SHADOW_MAP\"),t&&(n?i.push(\"GENERATE_POSITION_AND_NORMAL\"):i.push(\"GENERATE_POSITION\")),new Ue({defines:i,sources:o})};LT.createShadowReceiveFragmentShader=function(e,t,n,i,o){let r=Ue.findNormalVarying(e),s=!i&&l(r)||i&&o,a=Ue.findPositionVarying(e),c=l(a),d=t._usesDepthTexture,u=t._polygonOffsetSupported,m=t._isPointLight,p=t._isSpotLight,b=t._numberOfCascades>1,f=t.debugCascadeColors,x=t.softShadows,_=m?t._pointBias:i?t._terrainBias:t._primitiveBias,C=e.defines.slice(0),V=e.sources.slice(0),L=V.length;for(let X=0;X<L;++X)V[X]=Ue.replaceMain(V[X],\"czm_shadow_receive_main\");m?C.push(\"USE_CUBE_MAP_SHADOW\"):d&&C.push(\"USE_SHADOW_DEPTH_TEXTURE\"),x&&!m&&C.push(\"USE_SOFT_SHADOWS\"),b&&n&&i&&(s?C.push(\"ENABLE_VERTEX_LIGHTING\"):C.push(\"ENABLE_DAYNIGHT_SHADING\")),n&&_.normalShading&&s&&(C.push(\"USE_NORMAL_SHADING\"),_.normalShadingSmooth>0&&C.push(\"USE_NORMAL_SHADING_SMOOTH\"));let R=\"\";m?R+=`uniform samplerCube shadowMap_textureCube; `:R+=`uniform sampler2D shadowMap_texture; `;let G;return c?G=` return vec4(${a}, 1.0); `:G=`#ifndef LOG_DEPTH return czm_windowToEyeCoordinates(gl_FragCoord); #else return vec4(v_logPositionEC, 1.0); #endif `,R+=`uniform mat4 shadowMap_matrix; uniform vec3 shadowMap_lightDirectionEC; uniform vec4 shadowMap_lightPositionEC; uniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; uniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; #ifdef LOG_DEPTH in vec3 v_logPositionEC; #endif vec4 getPositionEC() { ${G}} vec3 getNormalEC() { ${s?` return normalize(${r}); `:` return vec3(1.0); `}} void applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) { ${_.normalOffset&&s?` float normalOffset = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; float normalOffsetScale = 1.0 - nDotL; vec3 offset = normalOffset * normalOffsetScale * normalEC; positionEC.xyz += offset; `:\"\"}} `,R+=`void main() { czm_shadow_receive_main(); vec4 positionEC = getPositionEC(); vec3 normalEC = getNormalEC(); float depth = -positionEC.z; `,R+=` czm_shadowParameters shadowParameters; shadowParameters.texelStepSize = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; shadowParameters.depthBias = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; shadowParameters.normalShadingSmooth = shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; shadowParameters.darkness = shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; `,i?R+=` shadowParameters.depthBias *= max(depth * 0.01, 1.0); `:u||(R+=` shadowParameters.depthBias *= mix(1.0, 100.0, depth * 0.0015); `),m?R+=` vec3 directionEC = positionEC.xyz - shadowMap_lightPositionEC.xyz; float distance = length(directionEC); directionEC = normalize(directionEC); float radius = shadowMap_lightPositionEC.w; // Stop early if the fragment is beyond the point light radius if (distance > radius) { return; } vec3 directionWC = czm_inverseViewRotation * directionEC; shadowParameters.depth = distance / radius; shadowParameters.nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); shadowParameters.texCoords = directionWC; float visibility = czm_shadowVisibility(shadowMap_textureCube, shadowParameters); `:p?R+=` vec3 directionEC = normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); float nDotL = clamp(dot(normalEC, -directionEC), 0.0, 1.0); applyNormalOffset(positionEC, normalEC, nDotL); vec4 shadowPosition = shadowMap_matrix * positionEC; // Spot light uses a perspective projection, so perform"
}