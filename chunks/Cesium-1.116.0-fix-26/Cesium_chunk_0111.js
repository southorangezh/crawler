{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 111,
    "total_chunks": 194,
    "chunk_size": 55801,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.714Z"
  },
  "content": "d=Math.max(a,c);c=Math.min(a,c),a=d}this._ellipsoid=oe.clone(n),this._granularity=i,this._height=a,this._extrudedHeight=c,this._arcType=s,this._polygonHierarchy=t,this._perPositionHeight=o,this._perPositionHeightExtrude=r,this._offsetAttribute=e.offsetAttribute,this._workerName=\"createPolygonOutlineGeometry\",this.packedLength=Dn.computeHierarchyPackedLength(t,h)+oe.packedLength+8}Q_.pack=function(e,t,n){return n=g(n,0),n=Dn.packPolygonHierarchy(e._polygonHierarchy,t,n,h),oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,t[n++]=e._height,t[n++]=e._extrudedHeight,t[n++]=e._granularity,t[n++]=e._perPositionHeightExtrude?1:0,t[n++]=e._perPositionHeight?1:0,t[n++]=e._arcType,t[n++]=g(e._offsetAttribute,-1),t[n]=e.packedLength,t};var Z7e=oe.clone(oe.UNIT_SPHERE),R7e={polygonHierarchy:{}};Q_.unpack=function(e,t,n){t=g(t,0);let i=Dn.unpackPolygonHierarchy(e,t,h);t=i.startingIndex,delete i.startingIndex;let o=oe.unpack(e,t,Z7e);t+=oe.packedLength;let r=e[t++],s=e[t++],a=e[t++],c=e[t++]===1,d=e[t++]===1,u=e[t++],m=e[t++],p=e[t];return l(n)||(n=new Q_(R7e)),n._polygonHierarchy=i,n._ellipsoid=oe.clone(o,n._ellipsoid),n._height=r,n._extrudedHeight=s,n._granularity=a,n._perPositionHeight=d,n._perPositionHeightExtrude=c,n._arcType=u,n._offsetAttribute=m===-1?void 0:m,n.packedLength=p,n};Q_.fromPositions=function(e){e=g(e,g.EMPTY_OBJECT);let t={polygonHierarchy:{positions:e.positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute};return new Q_(t)};Q_.createGeometry=function(e){let t=e._ellipsoid,n=e._granularity,i=e._polygonHierarchy,o=e._perPositionHeight,r=e._arcType,s=Dn.polygonOutlinesFromHierarchy(i,!o,t);if(s.length===0)return;let a,c=[],d=P.chordLength(n,t.maximumRadius),u=e._height,m=e._extrudedHeight,p=e._perPositionHeightExtrude||!P.equalsEpsilon(u,m,0,P.EPSILON2),b,f;if(p)for(f=0;f<s.length;f++){if(a=L7e(t,s[f],d,o,r),a.geometry=Dn.scaleToGeodeticHeightExtruded(a.geometry,u,m,t,o),l(e._offsetAttribute)){let C=a.geometry.attributes.position.values.length/3,V=new Uint8Array(C);e._offsetAttribute===cn.TOP?V=V.fill(1,0,C/2):(b=e._offsetAttribute===cn.NONE?0:1,V=V.fill(b)),a.geometry.attributes.applyOffset=new Ee({componentDatatype:Q.UNSIGNED_BYTE,componentsPerAttribute:1,values:V})}c.push(a)}else for(f=0;f<s.length;f++){if(a=V7e(t,s[f],d,o,r),a.geometry.attributes.position.values=si.scaleToGeodeticHeight(a.geometry.attributes.position.values,u,t,!o),l(e._offsetAttribute)){let C=a.geometry.attributes.position.values.length;b=e._offsetAttribute===cn.NONE?0:1;let V=new Uint8Array(C/3).fill(b);a.geometry.attributes.applyOffset=new Ee({componentDatatype:Q.UNSIGNED_BYTE,componentsPerAttribute:1,values:V})}c.push(a)}let x=An.combineInstances(c)[0],_=ce.fromVertices(x.attributes.position.values);return new ut({attributes:x.attributes,indices:x.indices,primitiveType:x.primitiveType,boundingSphere:_,offsetAttribute:e._offsetAttribute})};var ZP=Q_;var _me=\"Entity polygons cannot have both height and perPositionHeight. height will be ignored\",Tme=\"heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored\",Sme=new O,Cme=h.ZERO,Vme=new h,Lme=new le,G7e=[],E7e=new D;function X7e(e){this.id=e,this.vertexFormat=void 0,this.polygonHierarchy=void 0,this.perPositionHeight=void 0,this.closeTop=void 0,this.closeBottom=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.offsetAttribute=void 0,this.arcType=void 0,this.textureCoordinates=void 0}function Xd(e,t){On.call(this,{entity:e,scene:t,geometryOptions:new X7e(e),geometryPropertyName:\"polygon\",observedPropertyNames:[\"availability\",\"polygon\"]}),this._onEntityPropertyChanged(e,\"polygon\",e.polygon,void 0)}l(Object.create)&&(Xd.prototype=Object.create(On.prototype),Xd.prototype.constructor=Xd);Xd.prototype.createFillGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i=this._options,o={show:new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:kn.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof kt){let s;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(s=this._materialProperty.color.getValue(e,Sme)),l(s)||(s=O.WHITE),o.color=Ot.fromColor(s)}l(i.offsetAttribute)&&(o.offset=Ji.fromCartesian3(K.getValueOrDefault(this._terrainOffsetProperty,e,Cme,Vme)));let r;return i.perPositionHeight&&!l(i.extrudedHeight)?r=new LP(i):r=new J_(i),new Vt({id:t,geometry:r,attributes:o})};Xd.prototype.createOutlineGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i=this._options,o=K.getValueOrDefault(this._outlineColorProperty,e,O.BLACK,Sme),r=this._distanceDisplayConditionProperty.getValue(e),s={show:new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Ot.fromColor(o),distanceDisplayCondition:kn.fromDistanceDisplayCondition(r),offset:void 0};l(i.offsetAttribute)&&(s.offset=Ji.fromCartesian3(K.getValueOrDefault(this._terrainOffsetProperty,e,Cme,Vme)));let a;return i.perPositionHeight&&!l(i.extrudedHeight)?a=new Wu(i):a=new ZP(i),new Vt({id:t,geometry:a,attributes:s})};Xd.prototype._computeCenter=function(e,t){let n=K.getValueOrUndefined(this._entity.polygon.hierarchy,e);if(!l(n))return;let i=n.positions;if(i.length===0)return;let o=this._scene.mapProjection.ellipsoid,r=Dr.fromPoints(i,o),s=r.projectPointsOntoPlane(i,G7e),a=s.length,c=0,d=a-1,u=new D;for(let p=0;p<a;d=p++){let b=s[p],f=s[d],x=b.x*f.y-f.x*b.y,_=D.add(b,f,E7e);_=D.multiplyByScalar(_,x,_),u=D.add(u,_,u),c+=x}let m=1/(c*3);return u=D.multiplyByScalar(u,m,u),r.projectPointOntoEllipsoid(u,t)};Xd.prototype._isHidden=function(e,t){return!l(t.hierarchy)||ii.prototype._isHidden.call(this,e,t)};Xd.prototype._isOnTerrain=function(e,t){let n=On.prototype._isOnTerrain.call(this,e,t),i=t.perPositionHeight,o=l(i)&&(i.isConstant?i.getValue(Be.MINIMUM_VALUE):!0);return n&&!o};Xd.prototype._isDynamic=function(e,t){return!t.hierarchy.isConstant||!K.isConstant(t.height)||!K.isConstant(t.extrudedHeight)||!K.isConstant(t.granularity)||!K.isConstant(t.stRotation)||!K.isConstant(t.textureCoordinates)||!K.isConstant(t.outlineWidth)||!K.isConstant(t.perPositionHeight)||!K.isConstant(t.closeTop)||!K.isConstant(t.closeBottom)||!K.isConstant(t.zIndex)||!K.isConstant(t.arcType)||this._onTerrain&&!K.isConstant(this._materialProperty)&&!(this._materialProperty instanceof kt)};Xd.prototype._setStaticOptions=function(e,t){let n=this._materialProperty instanceof kt,i=this._options;i.vertexFormat=n?ln.VERTEX_FORMAT:so.MaterialSupport.TEXTURED.vertexFormat;let o=t.hierarchy.getValue(Be.MINIMUM_VALUE),r=K.getValueOrUndefined(t.height,Be.MINIMUM_VALUE),s=K.getValueOrDefault(t.heightReference,Be.MINIMUM_VALUE,Je.NONE),a=K.getValueOrUndefined(t.extrudedHeight,Be.MINIMUM_VALUE),c=K.getValueOrDefault(t.extrudedHeightReference,Be.MINIMUM_VALUE,Je.NONE),d=K.getValueOrDefault(t.perPositionHeight,Be.MINIMUM_VALUE,!1);r=On.getGeometryHeight(r,s);let u;if(d?(l(r)&&(r=void 0,wt(_me)),s!==Je.NONE&&d&&(r=void 0,wt(Tme))):(l(a)&&!l(r)&&(r=0),u=On.computeGeometryOffsetAttribute(r,s,a,c)),i.polygonHierarchy=o,i.granularity=K.getValueOrUndefined(t.granularity,Be.MINIMUM_VALUE),i.stRotation=K.getValueOrUndefined(t.stRotation,Be.MINIMUM_VALUE),i.perPositionHeight=d,i.closeTop=K.getValueOrDefault(t.closeTop,Be.MINIMUM_VALUE,!0),i.closeBottom=K.getValueOrDefault(t.closeBottom,Be.MINIMUM_VALUE,!0),i.offsetAttribute=u,i.height=r,i.arcType=K.getValueOrDefault(t.arcType,Be.MINIMUM_VALUE,$t.GEODESIC),i.textureCoordinates=K.getValueOrUndefined(t.textureCoordinates,Be.MINIMUM_VALUE),a=On.getGeometryExtrudedHeight(a,c),a===On.CLAMP_TO_GROUND){let m=J_.computeRectangleFromPositions(i.polygonHierarchy.positions,i.ellipsoid,i.arcType,Lme);a=ai.getMinimumMaximumHeights(m).minimumTerrainHeight}i.extrudedHeight=a};Xd.prototype._getIsClosed=function(e){let t=e.height,n=e.extrudedHeight,i=l(n)&&n!==t;return!e.perPositionHeight&&(!i&&t===0||i&&e.closeTop&&e.closeBottom)};Xd.DynamicGeometryUpdater=Y1;function Y1(e,t,n){ni.call(this,e,t,n)}l(Object.create)&&(Y1.prototype=Object.create(ni.prototype),Y1.prototype.constructor=Y1);Y1.prototype._isHidden=function(e,t,n){return!l(this._options.polygonHierarchy)||ni.prototype._isHidden.call(this,e,t,n)};Y1.prototype._setOptions=function(e,t,n){let i=this._options;i.polygonHierarchy=K.getValueOrUndefined(t.hierarchy,n);let o=K.getValueOrUndefined(t.height,n),r=K.getValueOrDefault(t.heightReference,n,Je.NONE),s=K.getValueOrDefault(t.extrudedHeightReference,n,Je.NONE),a=K.getValueOrUndefined(t.extrudedHeight,n),c=K.getValueOrUndefined(t.perPositionHeight,n);o=On.getGeometryHeight(o,s);let d;if(c?(l(o)&&(o=void 0,wt(_me)),r!==Je.NONE&&c&&(o=void 0,wt(Tme))):(l(a)&&!l(o)&&(o=0),d=On.computeGeometryOffsetAttribute(o,r,a,s)),i.granularity=K.getValueOrUndefined(t.granularity,n),i.stRotation=K.getValueOrUndefined(t.stRotation,n),i.textureCoordinates=K.getValueOrUndefined(t.textureCoordinates,n),i.perPositionHeight=K.getValueOrUndefined(t.perPositionHeight,n),i.closeTop=K.getValueOrDefault(t.closeTop,n,!0),i.closeBottom=K.getValueOrDefault(t.closeBottom,n,!0),i.offsetAttribute=d,i.height=o,i.arcType=K.getValueOrDefault(t.arcType,n,$t.GEODESIC),a=On.getGeometryExtrudedHeight(a,s),a===On.CLAMP_TO_GROUND){let u=J_.computeRectangleFromPositions(i.polygonHierarchy.positions,i.ellipsoid,i.arcType,Lme);a=ai.getMinimumMaximumHeights(u).minimumTerrainHeight}i.extrudedHeight=a};var RP=Xd;var y$n=T(S(),1);var Pqn=T(S(),1);function I7e(e,t,n,i){let o=new hn;i.position&&(o.position=new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:e}));let r=t.length,s=e.length/3,a=(s-r*2)/(r*2),c=si.triangulate(t),d=(a-1)*r*6+c.length*2,u=Ae.createTypedArray(s,d),m,p,b,f,x,_,C=r*2,V=0;for(m=0;m<a-1;m++){for(p=0;p<r-1;p++)b=p*2+m*r*2,_=b+C,f=b+1,x=f+C,u[V++]=f,u[V++]=b,u[V++]=x,u[V++]=x,u[V++]=b,u[V++]=_;b=r*2-2+m*r*2,f=b+1,x=f+C,_=b+C,u[V++]=f,u[V++]=b,u[V++]=x,u[V++]=x,u[V++]=b,u[V++]=_}if(i.st||i.tangent||i.bitangent){let G=new Float32Array(s*2),X=1/(a-1),v=1/n.height,W=n.height/2,F,A,y=0;for(m=0;m<a;m++){for(F=m*X,A=v*(t[0].y+W),G[y++]=F,G[y++]=A,p=1;p<r;p++)A=v*(t[p].y+W),G[y++]=F,G[y++]=A,G[y++]=F,G[y++]=A;A=v*(t[0].y+W),G[y++]=F,G[y++]=A}for(p=0;p<r;p++)F=0,A=v*(t[p].y+W),G[y++]=F,G[y++]=A;for(p=0;p<r;p++)F=(a-1)*X,A=v*(t[p].y+W),G[y++]=F,G[y++]=A;o.st=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:new Float32Array(G)})}let L=s-r*2;for(m=0;m<c.length;m+=3){let G=c[m]+L,X=c[m+1]+L,v=c[m+2]+L;u[V++]=G,u[V++]=X,u[V++]=v,u[V++]=v+r,u[V++]=X+r,u[V++]=G+r}let R=new ut({attributes:o,indices:u,boundingSphere:ce.fromVertices(e),primitiveType:we.TRIANGLES});if(i.normal&&(R=An.computeNormal(R)),i.tangent||i.bitangent){try{R=An.computeTangentAndBitangent(R)}catch{wt(\"polyline-volume-tangent-bitangent\",\"Unable to compute tangents and bitangents for polyline volume geometry\")}i.tangent||(R.attributes.tangent=void 0),i.bitangent||(R.attributes.bitangent=void 0),i.st||(R.attributes.st=void 0)}return R}function EP(e){e=g(e,g.EMPTY_OBJECT);let t=e.polylinePositions,n=e.shapePositions;this._positions=t,this._shape=n,this._ellipsoid=oe.clone(g(e.ellipsoid,oe.WGS84)),this._cornerType=g(e.cornerType,Gi.ROUNDED),this._vertexFormat=Pe.clone(g(e.vertexFormat,Pe.DEFAULT)),this._granularity=g(e.granularity,P.RADIANS_PER_DEGREE),this._workerName=\"createPolylineVolumeGeometry\";let i=1+t.length*h.packedLength;i+=1+n.length*D.packedLength,this.packedLength=i+oe.packedLength+Pe.packedLength+2}EP.pack=function(e,t,n){n=g(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._shape;for(r=s.length,t[n++]=r,i=0;i<r;++i,n+=D.packedLength)D.pack(s[i],t,n);return oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,Pe.pack(e._vertexFormat,t,n),n+=Pe.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};var Zme=oe.clone(oe.UNIT_SPHERE),Rme=new Pe,GP={polylinePositions:void 0,shapePositions:void 0,ellipsoid:Zme,vertexFormat:Rme,cornerType:void 0,granularity:void 0};EP.unpack=function(e,t,n){t=g(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s=new Array(o);for(i=0;i<o;++i,t+=D.packedLength)s[i]=D.unpack(e,t);let a=oe.unpack(e,t,Zme);t+=oe.packedLength;let c=Pe.unpack(e,t,Rme);t+=Pe.packedLength;let d=e[t++],u=e[t];return l(n)?(n._positions=r,n._shape=s,n._ellipsoid=oe.clone(a,n._ellipsoid),n._vertexFormat=Pe.clone(c,n._vertexFormat),n._cornerType=d,n._granularity=u,n):(GP.polylinePositions=r,GP.shapePositions=s,GP.cornerType=d,GP.granularity=u,new EP(GP))};var W7e=new ze;EP.createGeometry=function(e){let t=e._positions,n=yo(t,h.equalsEpsilon),i=e._shape;if(i=jm.removeDuplicatesFromShape(i),n.length<2||i.length<3)return;si.computeWindingOrder2D(i)===ns.CLOCKWISE&&i.reverse();let o=ze.fromPoints(i,W7e),r=jm.computePositions(n,i,o,e,!0);return I7e(r,i,o,e._vertexFormat)};var XP=EP;var e$n=T(S(),1);function P7e(e,t){let n=new hn;n.position=new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:e});let i=t.length,o=n.position.values.length/3,s=e.length/3/i,a=Ae.createTypedArray(o,2*i*(s+1)),c,d,u=0;c=0;let m=c*i;for(d=0;d<i-1;d++)a[u++]=d+m,a[u++]=d+m+1;for(a[u++]=i-1+m,a[u++]=m,c=s-1,m=c*i,d=0;d<i-1;d++)a[u++]=d+m,a[u++]=d+m+1;for(a[u++]=i-1+m,a[u++]=m,c=0;c<s-1;c++){let b=i*c,f=b+i;for(d=0;d<i;d++)a[u++]=d+b,a[u++]=d+f}return new ut({attributes:n,indices:Ae.createTypedArray(o,a),boundingSphere:ce.fromVertices(e),primitiveType:we.LINES})}function WP(e){e=g(e,g.EMPTY_OBJECT);let t=e.polylinePositions,n=e.shapePositions;this._positions=t,this._shape=n,this._ellipsoid=oe.clone(g(e.ellipsoid,oe.WGS84)),this._cornerType=g(e.cornerType,Gi.ROUNDED),this._granularity=g(e.granularity,P.RADIANS_PER_DEGREE),this._workerName=\"createPolylineVolumeOutlineGeometry\";let i=1+t.length*h.packedLength;i+=1+n.length*D.packedLength,this.packedLength=i+oe.packedLength+2}WP.pack=function(e,t,n){n=g(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._shape;for(r=s.length,t[n++]=r,i=0;i<r;++i,n+=D.packedLength)D.pack(s[i],t,n);return oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,t[n++]=e._cornerType,t[n]=e._granularity,t};var Gme=oe.clone(oe.UNIT_SPHERE),IP={polylinePositions:void 0,shapePositions:void 0,ellipsoid:Gme,height:void 0,cornerType:void 0,granularity:void 0};WP.unpack=function(e,t,n){t=g(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s=new Array(o);for(i=0;i<o;++i,t+=D.packedLength)s[i]=D.unpack(e,t);let a=oe.unpack(e,t,Gme);t+=oe.packedLength;let c=e[t++],d=e[t];return l(n)?(n._positions=r,n._shape=s,n._ellipsoid=oe.clone(a,n._ellipsoid),n._cornerType=c,n._granularity=d,n):(IP.polylinePositions=r,IP.shapePositions=s,IP.cornerType=c,IP.granularity=d,new WP(IP))};var v7e=new ze;WP.createGeometry=function(e){let t=e._positions,n=yo(t,h.equalsEpsilon),i=e._shape;if(i=jm.removeDuplicatesFromShape(i),n.length<2||i.length<3)return;si.computeWindingOrder2D(i)===ns.CLOCKWISE&&i.reverse();let o=ze.fromPoints(i,v7e),r=jm.computePositions(n,i,o,e,!1);return P7e(r,i)};var PP=WP;var Eme=new O;function w7e(e){this.id=e,this.vertexFormat=void 0,this.polylinePositions=void 0,this.shapePositions=void 0,this.cornerType=void 0,this.granularity=void 0}function Cf(e,t){ii.call(this,{entity:e,scene:t,geometryOptions:new w7e(e),geometryPropertyName:\"polylineVolume\",observedPropertyNames:[\"availability\",\"polylineVolume\"]}),this._onEntityPropertyChanged(e,\"polylineVolume\",e.polylineVolume,void 0)}l(Object.create)&&(Cf.prototype=Object.create(ii.prototype),Cf.prototype.constructor=Cf);Cf.prototype.createFillGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i,o,r=new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=kn.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof kt){let c;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(c=this._materialProperty.color.getValue(e,Eme)),l(c)||(c=O.WHITE),o=Ot.fromColor(c),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};return new Vt({id:t,geometry:new XP(this._options),attributes:i})};Cf.prototype.createOutlineGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i=K.getValueOrDefault(this._outlineColorProperty,e,O.BLACK,Eme),o=this._distanceDisplayConditionProperty.getValue(e);return new Vt({id:t,geometry:new PP(this._options),attributes:{show:new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Ot.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o)}})};Cf.prototype._isHidden=function(e,t){return!l(t.positions)||!l(t.shape)||ii.prototype._isHidden.call(this,e,t)};Cf.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!t.shape.isConstant||!K.isConstant(t.granularity)||!K.isConstant(t.outlineWidth)||!K.isConstant(t.cornerType)};Cf.prototype._setStaticOptions=function(e,t){let n=t.granularity,i=t.cornerType,o=this._options,r=this._materialProperty instanceof kt;o.vertexFormat=r?ln.VERTEX_FORMAT:so.MaterialSupport.TEXTURED.vertexFormat,o.polylinePositions=t.positions.getValue(Be.MINIMUM_VALUE,o.polylinePositions),o.shapePositions=t.shape.getValue(Be.MINIMUM_VALUE,o.shape),o.granularity=l(n)?n.getValue(Be.MINIMUM_VALUE):void 0,o.cornerType=l(i)?i.getValue(Be.MINIMUM_VALUE):void 0};Cf.DynamicGeometryUpdater=O1;function O1(e,t,n){ni.call(this,e,t,n)}l(Object.create)&&(O1.prototype=Object.create(ni.prototype),O1.prototype.constructor=O1);O1.prototype._isHidden=function(e,t,n){let i=this._options;return!l(i.polylinePositions)||!l(i.shapePositions)||ni.prototype._isHidden.call(this,e,t,n)};O1.prototype._setOptions=function(e,t,n){let i=this._options;i.polylinePositions=K.getValueOrUndefined(t.positions,n,i.polylinePositions),i.shapePositions=K.getValueOrUndefined(t.shape,n),i.granularity=K.getValueOrUndefined(t.granularity,n),i.cornerType=K.getValueOrUndefined(t.cornerType,n)};var vP=Cf;var fei=T(S(),1);var B$n=T(S(),1);var tJ=new h,Wme=new h,Pme=new h,vme=new h,wme=new le,F7e=new D,A7e=new ce,M7e=new ce;function Fme(e,t){let n=new ut({attributes:new hn,primitiveType:we.TRIANGLES});return n.attributes.position=new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:t.positions}),e.normal&&(n.attributes.normal=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:t.normals})),e.tangent&&(n.attributes.tangent=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:t.tangents})),e.bitangent&&(n.attributes.bitangent=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:t.bitangents})),n}function N7e(e,t,n,i){let o=e.length,r=t.normal?new Float32Array(o):void 0,s=t.tangent?new Float32Array(o):void 0,a=t.bitangent?new Float32Array(o):void 0,c=0,d=vme,u=Pme,m=Wme;if(t.normal||t.tangent||t.bitangent)for(let p=0;p<o;p+=3){let b=h.fromArray(e,p,tJ),f=c+1,x=c+2;m=n.geodeticSurfaceNormal(b,m),(t.tangent||t.bitangent)&&(h.cross(h.UNIT_Z,m,u),$.multiplyByVector(i,u,u),h.normalize(u,u),t.bitangent&&h.normalize(h.cross(m,u,d),d)),t.normal&&(r[c]=m.x,r[f]=m.y,r[x]=m.z),t.tangent&&(s[c]=u.x,s[f]=u.y,s[x]=u.z),t.bitangent&&(a[c]=d.x,a[f]=d.y,a[x]=d.z),c+=3}return Fme(t,{positions:e,normals:r,tangents:s,bitangents:a})}var nJ=new h,Ame=new h;function k7e(e,t,n){let i=e.length,o=t.normal?new Float32Array(i):void 0,r=t.tangent?new Float32Array(i):void 0,s=t.bitangent?new Float32Array(i):void 0,a=0,c=0,d=0,u=!0,m=vme,p=Pme,b=Wme;if(t.normal||t.tangent||t.bitangent)for(let f=0;f<i;f+=6){let x=h.fromArray(e,f,tJ),_=h.fromArray(e,(f+6)%i,nJ);if(u){let C=h.fromArray(e,(f+3)%i,Ame);h.subtract(_,x,_),h.subtract(C,x,C),b=h.normalize(h.cross(C,_,b),b),u=!1}h.equalsEpsilon(_,x,P.EPSILON10)&&(u=!0),(t.tangent||t.bitangent)&&(m=n.geodeticSurfaceNormal(x,m),t.tangent&&(p=h.normalize(h.cross(m,b,p),p))),t.normal&&(o[a++]=b.x,o[a++]=b.y,o[a++]=b.z,o[a++]=b.x,o[a++]=b.y,o[a++]=b.z),t.tangent&&(r[c++]=p.x,r[c++]=p.y,r[c++]=p.z,r[c++]=p.x,r[c++]=p.y,r[c++]=p.z),t.bitangent&&(s[d++]=m.x,s[d++]=m.y,s[d++]=m.z,s[d++]=m.x,s[d++]=m.y,s[d++]=m.z)}return Fme(t,{positions:e,normals:o,tangents:r,bitangents:s})}function Mme(e,t){let n=e._vertexFormat,i=e._ellipsoid,o=t.height,r=t.width,s=t.northCap,a=t.southCap,c=0,d=o,u=o,m=0;s&&(c=1,u-=1,m+=1),a&&(d-=1,u-=1,m+=1),m+=r*u;let p=n.position?new Float64Array(m*3):void 0,b=n.st?new Float32Array(m*2):void 0,f=0,x=0,_=tJ,C=F7e,V=Number.MAX_VALUE,L=Number.MAX_VALUE,R=-Number.MAX_VALUE,G=-Number.MAX_VALUE;for(let Z=c;Z<d;++Z)for(let E=0;E<r;++E)xs.computePosition(t,i,n.st,Z,E,_,C),p[f++]=_.x,p[f++]=_.y,p[f++]=_.z,n.st&&(b[x++]=C.x,b[x++]=C.y,V=Math.min(V,C.x),L=Math.min(L,C.y),R=Math.max(R,C.x),G=Math.max(G,C.y));if(s&&(xs.computePosition(t,i,n.st,0,0,_,C),p[f++]=_.x,p[f++]=_.y,p[f++]=_.z,n.st&&(b[x++]=C.x,b[x++]=C.y,V=C.x,L=C.y,R=C.x,G=C.y)),a&&(xs.computePosition(t,i,n.st,o-1,0,_,C),p[f++]=_.x,p[f++]=_.y,p[f]=_.z,n.st&&(b[x++]=C.x,b[x]=C.y,V=Math.min(V,C.x),L=Math.min(L,C.y),R=Math.max(R,C.x),G=Math.max(G,C.y))),n.st&&(V<0||L<0||R>1||G>1))for(let Z=0;Z<b.length;Z+=2)b[Z]=(b[Z]-V)/(R-V),b[Z+1]=(b[Z+1]-L)/(G-L);let X=N7e(p,n,i,t.tangentRotationMatrix),v=6*(r-1)*(u-1);s&&(v+=3*(r-1)),a&&(v+=3*(r-1));let W=Ae.createTypedArray(m,v),F=0,A=0,y;for(y=0;y<u-1;++y){for(let Z=0;Z<r-1;++Z){let E=F,I=E+r,w=I+1,k=E+1;W[A++]=E,W[A++]=I,W[A++]=k,W[A++]=k,W[A++]=I,W[A++]=w,++F}++F}if(s||a){let Z=m-1,E=m-1;s&&a&&(Z=m-2);let I,w;if(F=0,s)for(y=0;y<r-1;y++)I=F,w=I+1,W[A++]=Z,W[A++]=I,W[A++]=w,++F;if(a)for(F=(u-1)*r,y=0;y<r-1;y++)I=F,w=I+1,W[A++]=I,W[A++]=E,W[A++]=w,++F}return X.indices=W,n.st&&(X.attributes.st=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:b})),X}function z1(e,t,n,i,o){return e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n+2],e[t++]=o[n],e[t++]=o[n+1],e[t]=o[n+2],e}function H1(e,t,n,i){return e[t++]=i[n],e[t++]=i[n+1],e[t++]=i[n],e[t]=i[n+1],e}var iJ=new Pe;function U7e(e,t){let n=e._shadowVolume,i=e._offsetAttribute,o=e._vertexFormat,r=e._extrudedHeight,s=e._surfaceHeight,a=e._ellipsoid,c=t.height,d=t.width,u;if(n){let Ie=Pe.clone(o,iJ);Ie.normal=!0,e._vertexFormat=Ie}let m=Mme(e,t);n&&(e._vertexFormat=o);let p=si.scaleToGeodeticHeight(m.attributes.position.values,s,a,!1);p=new Float64Array(p);let b=p.length,f=b*2,x=new Float64Array(f);x.set(p);let _=si.scaleToGeodeticHeight(m.attributes.position.values,r,a);x.set(_,b),m.attributes.position.values=x;let C=o.normal?new Float32Array(f):void 0,V=o.tangent?new Float32Array(f):void 0,L=o.bitangent?new Float32Array(f):void 0,R=o.st?new Float32Array(f/3*2):void 0,G,X;if(o.normal){for(X=m.attributes.normal.values,C.set(X),u=0;u<b;u++)X[u]=-X[u];C.set(X,b),m.attributes.normal.values=C}if(n){X=m.attributes.normal.values,o.normal||(m.attributes.normal=void 0);let Ie=new Float32Array(f);for(u=0;u<b;u++)X[u]=-X[u];Ie.set(X,b),m.attributes.extrudeDirection=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:Ie})}let v,W=l(i);if(W){let Ie=b/3*2,ft=new Uint8Array(Ie);i===cn.TOP?ft=ft.fill(1,0,Ie/2):(v=i===cn.NONE?0:1,ft=ft.fill(v)),m.attributes.applyOffset=new Ee({componentDatatype:Q.UNSIGNED_BYTE,componentsPerAttribute:1,values:ft})}if(o.tangent){let Ie=m.attributes.tangent.values;for(V.set(Ie),u=0;u<b;u++)Ie[u]=-Ie[u];V.set(Ie,b),m.attributes.tangent.values=V}if(o.bitangent){let Ie=m.attributes.bitangent.values;L.set(Ie),L.set(Ie,b),m.attributes.bitangent.values=L}o.st&&(G=m.attributes.st.values,R.set(G),R.set(G,b/3*2),m.attributes.st.values=R);let F=m.indices,A=F.length,y=b/3,Z=Ae.createTypedArray(f/3,A*2);for(Z.set(F),u=0;u<A;u+=3)Z[u+A]=F[u+2]+y,Z[u+1+A]=F[u+1]+y,Z[u+2+A]=F[u]+y;m.indices=Z;let E=t.northCap,I=t.southCap,w=c,k=2,B=0,U=4,Y=4;E&&(k-=1,w-=1,B+=1,U-=2,Y-=1),I&&(k-=1,w-=1,B+=1,U-=2,Y-=1),B+=k*d+2*w-U;let N=(B+Y)*2,J=new Float64Array(N*3),z=n?new Float32Array(N*3):void 0,ee=W?new Uint8Array(N):void 0,H=o.st?new Float32Array(N*2):void 0,j=i===cn.TOP;W&&!j&&(v=i===cn.ALL?1:0,ee=ee.fill(v));let q=0,pe=0,_e=0,ae=0,ye=d*w,Te;for(u=0;u<ye;u+=d)Te=u*3,J=z1(J,q,Te,p,_),q+=6,o.st&&(H=H1(H,pe,u*2,G),pe+=4),n&&(_e+=3,z[_e++]=X[Te],z[_e++]=X[Te+1],z[_e++]=X[Te+2]),j&&(ee[ae++]=1,ae+=1);if(I){let Ie=E?ye+1:ye;for(Te=Ie*3,u=0;u<2;u++)J=z1(J,q,Te,p,_),q+=6,o.st&&(H=H1(H,pe,Ie*2,G),pe+=4),n&&(_e+=3,z[_e++]=X[Te],z[_e++]=X[Te+1],z[_e++]=X[Te+2]),j&&(ee[ae++]=1,ae+=1)}else for(u=ye-d;u<ye;u++)Te=u*3,J=z1(J,q,Te,p,_),q+=6,o.st&&(H=H1(H,pe,u*2,G),pe+=4),n&&(_e+=3,z[_e++]=X[Te],z[_e++]=X[Te+1],z[_e++]=X[Te+2]),j&&(ee[ae++]=1,ae+=1);for(u=ye-1;u>0;u-=d)Te=u*3,J=z1(J,q,Te,p,_),q+=6,o.st&&(H=H1(H,pe,u*2,G),pe+=4),n&&(_e+=3,z[_e++]=X[Te],z[_e++]=X[Te+1],z[_e++]=X[Te+2]),j&&(ee[ae++]=1,ae+=1);if(E){let Ie=ye;for(Te=Ie*3,u=0;u<2;u++)J=z1(J,q,Te,p,_),q+=6,o.st&&(H=H1(H,pe,Ie*2,G),pe+=4),n&&(_e+=3,z[_e++]=X[Te],z[_e++]=X[Te+1],z[_e++]=X[Te+2]),j&&(ee[ae++]=1,ae+=1)}else for(u=d-1;u>=0;u--)Te=u*3,J=z1(J,q,Te,p,_),q+=6,o.st&&(H=H1(H,pe,u*2,G),pe+=4),n&&(_e+=3,z[_e++]=X[Te],z[_e++]=X[Te+1],z[_e++]=X[Te+2]),j&&(ee[ae++]=1,ae+=1);let Le=k7e(J,o,a);o.st&&(Le.attributes.st=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:H})),n&&(Le.attributes.extrudeDirection=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:z})),W&&(Le.attributes.applyOffset=new Ee({componentDatatype:Q.UNSIGNED_BYTE,componentsPerAttribute:1,values:ee}));let Re=Ae.createTypedArray(N,B*6),ke,rt,yt,Dt;b=J.length/3;let it=0;for(u=0;u<b-1;u+=2){ke=u,Dt=(ke+2)%b;let Ie=h.fromArray(J,ke*3,nJ),ft=h.fromArray(J,Dt*3,Ame);h.equalsEpsilon(Ie,ft,P.EPSILON10)||(rt=(ke+1)%b,yt=(rt+2)%b,Re[it++]=ke,Re[it++]=rt,Re[it++]=Dt,Re[it++]=Dt,Re[it++]=rt,Re[it++]=yt)}return Le.indices=Re,Le=An.combineInstances([new Vt({geometry:m}),new Vt({geometry:Le})]),Le[0]}var D7e=[new h,new h,new h,new h],Nme=new he,B7e=new he;function oJ(e,t,n,i,o){if(n===0)return le.clone(e,o);let r=xs.computeOptions(e,t,n,0,wme,Nme),s=r.height,a=r.width,c=D7e;return xs.computePosition(r,i,!1,0,0,c[0]),xs.computePosition(r,i,!1,0,a-1,c[1]),xs.computePosition(r,i,!1,s-1,0,c[2]),xs.computePosition(r,i,!1,s-1,a-1,c[3]),le.fromCartesianArray(c,i,o)}function Vf(e){e=g(e,g.EMPTY_OBJECT);let t=e.rectangle,n=g(e.height,0),i=g(e.extrudedHeight,n);this._rectangle=le.clone(t),this._granularity=g(e.granularity,P.RADIANS_PER_DEGREE),this._ellipsoid=oe.clone(g(e.ellipsoid,oe.WGS84)),this._surfaceHeight=Math.max(n,i),this._rotation=g(e.rotation,0),this._stRotation=g(e.stRotation,0),this._vertexFormat=Pe.clone(g(e.vertexFormat,Pe.DEFAULT)),this._extrudedHeight=Math.min(n,i),this._shadowVolume=g(e.shadowVolume,!1),this._workerName=\"createRectangleGeometry\",this._offsetAttribute=e.offsetAttribute,this._rotatedRectangle=void 0,this._textureCoordinateRotationPoints=void 0}Vf.packedLength=le.packedLength+oe.packedLength+Pe.packedLength+7;Vf.pack=function(e,t,n){return n=g(n,0),le.pack(e._rectangle,t,n),n+=le.packedLength,oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,Pe.pack(e._vertexFormat,t,n),n+=Pe.packedLength,t[n++]=e._granularity,t[n++]=e._surfaceHeight,t[n++]=e._rotation,t[n++]=e._stRotation,t[n++]=e._extrudedHeight,t[n++]=e._shadowVolume?1:0,t[n]=g(e._offsetAttribute,-1),t};var kme=new le,Ume=oe.clone(oe.UNIT_SPHERE),By={rectangle:kme,ellipsoid:Ume,vertexFormat:iJ,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};Vf.unpack=function(e,t,n){t=g(t,0);let i=le.unpack(e,t,kme);t+=le.packedLength;let o=oe.unpack(e,t,Ume);t+=oe.packedLength;let r=Pe.unpack(e,t,iJ);t+=Pe.packedLength;let s=e[t++],a=e[t++],c=e[t++],d=e[t++],u=e[t++],m=e[t++]===1,p=e[t];return l(n)?(n._rectangle=le.clone(i,n._rectangle),n._ellipsoid=oe.clone(o,n._ellipsoid),n._vertexFormat=Pe.clone(r,n._vertexFormat),n._granularity=s,n._surfaceHeight=a,n._rotation=c,n._stRotation=d,n._extrudedHeight=u,n._shadowVolume=m,n._offsetAttribute=p===-1?void 0:p,n):(By.granularity=s,By.height=a,By.rotation=c,By.stRotation=d,By.extrudedHeight=u,By.shadowVolume=m,By.offsetAttribute=p===-1?void 0:p,new Vf(By))};Vf.computeRectangle=function(e,t){e=g(e,g.EMPTY_OBJECT);let n=e.rectangle,i=g(e.granularity,P.RADIANS_PER_DEGREE),o=g(e.ellipsoid,oe.WGS84),r=g(e.rotation,0);return oJ(n,i,r,o,t)};var Y7e=new $,Xme=new Fe,O7e=new he;Vf.createGeometry=function(e){if(P.equalsEpsilon(e._rectangle.north,e._rectangle.south,P.EPSILON10)||P.equalsEpsilon(e._rectangle.east,e._rectangle.west,P.EPSILON10))return;let t=e._rectangle,n=e._ellipsoid,i=e._rotation,o=e._stRotation,r=e._vertexFormat,s=xs.computeOptions(t,e._granularity,i,o,wme,Nme,B7e),a=Y7e;if(o!==0||i!==0){let b=le.center(t,O7e),f=n.geodeticSurfaceNormalCartographic(b,nJ);Fe.fromAxisAngle(f,-o,Xme),$.fromQuaternion(Xme,a)}else $.clone($.IDENTITY,a);let c=e._surfaceHeight,d=e._extrudedHeight,u=!P.equalsEpsilon(c,d,0,P.EPSILON2);s.lonScalar=1/e._rectangle.width,s.latScalar=1/e._rectangle.height,s.tangentRotationMatrix=a;let m,p;if(t=e._rectangle,u){m=U7e(e,s);let b=ce.fromRectangle3D(t,n,c,M7e),f=ce.fromRectangle3D(t,n,d,A7e);p=ce.union(b,f)}else{if(m=Mme(e,s),m.attributes.position.values=si.scaleToGeodeticHeight(m.attributes.position.values,c,n,!1),l(e._offsetAttribute)){let b=m.attributes.position.values.length,f=e._offsetAttribute===cn.NONE?0:1,x=new Uint8Array(b/3).fill(f);m.attributes.applyOffset=new Ee({componentDatatype:Q.UNSIGNED_BYTE,componentsPerAttribute:1,values:x})}p=ce.fromRectangle3D(t,n,c)}return r.position||delete m.attributes.position,new ut({attributes:m.attributes,indices:m.indices,primitiveType:m.primitiveType,boundingSphere:p,offsetAttribute:e._offsetAttribute})};Vf.createShadowVolume=function(e,t,n){let i=e._granularity,o=e._ellipsoid,r=t(i,o),s=n(i,o);return new Vf({rectangle:e._rectangle,rotation:e._rotation,ellipsoid:o,stRotation:e._stRotation,granularity:i,extrudedHeight:s,height:r,vertexFormat:Pe.POSITION_ONLY,shadowVolume:!0})};var Ime=new le,z7e=[new D,new D,new D],H7e=new qi,K7e=new he;function J7e(e){if(e._stRotation===0)return[0,0,0,1,1,0];let t=le.clone(e._rectangle,Ime),n=e._granularity,i=e._ellipsoid,o=e._rotation-e._stRotation,r=oJ(t,n,o,i,Ime),s=z7e;s[0].x=r.west,s[0].y=r.south,s[1].x=r.west,s[1].y=r.north,s[2].x=r.east,s[2].y=r.south;let a=e.rectangle,c=qi.fromRotation(e._stRotation,H7e),d=le.center(a,K7e);for(let f=0;f<3;++f){let x=s[f];x.x-=d.longitude,x.y-=d.latitude,qi.multiplyByVector(c,x,x),x.x+=d.longitude,x.y+=d.latitude,x.x=(x.x-a.west)/a.width,x.y=(x.y-a.south)/a.height}let u=s[0],m=s[1],p=s[2],b=new Array(6);return D.pack(u,b),D.pack(m,b,2),D.pack(p,b,4),b}Object.defineProperties(Vf.prototype,{rectangle:{get:function(){return l(this._rotatedRectangle)||(this._rotatedRectangle=oJ(this._rectangle,this._granularity,this._rotation,this._ellipsoid)),this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){return l(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=J7e(this)),this._textureCoordinateRotationPoints}}});var j_=Vf;var Dme=new O,Bme=h.ZERO,Yme=new h,Ome=new le,Q7e=new le,j7e=new he;function q7e(e){this.id=e,this.vertexFormat=void 0,this.rectangle=void 0,this.height=void 0,this.extrudedHeight=void 0,this.granularity=void 0,this.stRotation=void 0,this.rotation=void 0,this.offsetAttribute=void 0}function sh(e,t){On.call(this,{entity:e,scene:t,geometryOptions:new q7e(e),geometryPropertyName:\"rectangle\",observedPropertyNames:[\"availability\",\"rectangle\"]}),this._onEntityPropertyChanged(e,\"rectangle\",e.rectangle,void 0)}l(Object.create)&&(sh.prototype=Object.create(On.prototype),sh.prototype.constructor=sh);sh.prototype.createFillGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i={show:new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),distanceDisplayCondition:kn.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(e)),offset:void 0,color:void 0};if(this._materialProperty instanceof kt){let o;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(o=this._materialProperty.color.getValue(e,Dme)),l(o)||(o=O.WHITE),i.color=Ot.fromColor(o)}return l(this._options.offsetAttribute)&&(i.offset=Ji.fromCartesian3(K.getValueOrDefault(this._terrainOffsetProperty,e,Bme,Yme))),new Vt({id:t,geometry:new j_(this._options),attributes:i})};sh.prototype.createOutlineGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i=K.getValueOrDefault(this._outlineColorProperty,e,O.BLACK,Dme),o=this._distanceDisplayConditionProperty.getValue(e),r={show:new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Ot.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o),offset:void 0};return l(this._options.offsetAttribute)&&(r.offset=Ji.fromCartesian3(K.getValueOrDefault(this._terrainOffsetProperty,e,Bme,Yme))),new Vt({id:t,geometry:new S_(this._options),attributes:r})};sh.prototype._computeCenter=function(e,t){let n=K.getValueOrUndefined(this._entity.rectangle.coordinates,e,Q7e);if(!l(n))return;let i=le.center(n,j7e);return he.toCartesian(i,oe.WGS84,t)};sh.prototype._isHidden=function(e,t){return!l(t.coordinates)||ii.prototype._isHidden.call(this,e,t)};sh.prototype._isDynamic=function(e,t){return!t.coordinates.isConstant||!K.isConstant(t.height)||!K.isConstant(t.extrudedHeight)||!K.isConstant(t.granularity)||!K.isConstant(t.stRotation)||!K.isConstant(t.rotation)||!K.isConstant(t.outlineWidth)||!K.isConstant(t.zIndex)||this._onTerrain&&!K.isConstant(this._materialProperty)&&!(this._materialProperty instanceof kt)};sh.prototype._setStaticOptions=function(e,t){let n=this._materialProperty instanceof kt,i=K.getValueOrUndefined(t.height,Be.MINIMUM_VALUE),o=K.getValueOrDefault(t.heightReference,Be.MINIMUM_VALUE,Je.NONE),r=K.getValueOrUndefined(t.extrudedHeight,Be.MINIMUM_VALUE),s=K.getValueOrDefault(t.extrudedHeightReference,Be.MINIMUM_VALUE,Je.NONE);l(r)&&!l(i)&&(i=0);let a=this._options;a.vertexFormat=n?ln.VERTEX_FORMAT:so.MaterialSupport.TEXTURED.vertexFormat,a.rectangle=t.coordinates.getValue(Be.MINIMUM_VALUE,a.rectangle),a.granularity=K.getValueOrUndefined(t.granularity,Be.MINIMUM_VALUE),a.stRotation=K.getValueOrUndefined(t.stRotation,Be.MINIMUM_VALUE),a.rotation=K.getValueOrUndefined(t.rotation,Be.MINIMUM_VALUE),a.offsetAttribute=On.computeGeometryOffsetAttribute(i,o,r,s),a.height=On.getGeometryHeight(i,o),r=On.getGeometryExtrudedHeight(r,s),r===On.CLAMP_TO_GROUND&&(r=ai.getMinimumMaximumHeights(j_.computeRectangle(a,Ome)).minimumTerrainHeight),a.extrudedHeight=r};sh.DynamicGeometryUpdater=K1;function K1(e,t,n){ni.call(this,e,t,n)}l(Object.create)&&(K1.prototype=Object.create(ni.prototype),K1.prototype.constructor=K1);K1.prototype._isHidden=function(e,t,n){return!l(this._options.rectangle)||ni.prototype._isHidden.call(this,e,t,n)};K1.prototype._setOptions=function(e,t,n){let i=this._options,o=K.getValueOrUndefined(t.height,n),r=K.getValueOrDefault(t.heightReference,n,Je.NONE),s=K.getValueOrUndefined(t.extrudedHeight,n),a=K.getValueOrDefault(t.extrudedHeightReference,n,Je.NONE);l(s)&&!l(o)&&(o=0),i.rectangle=K.getValueOrUndefined(t.coordinates,n,i.rectangle),i.granularity=K.getValueOrUndefined(t.granularity,n),i.stRotation=K.getValueOrUndefined(t.stRotation,n),i.rotation=K.getValueOrUndefined(t.rotation,n),i.offsetAttribute=On.computeGeometryOffsetAttribute(o,r,s,a),i.height=On.getGeometryHeight(o,r),s=On.getGeometryExtrudedHeight(s,a),s===On.CLAMP_TO_GROUND&&(s=ai.getMinimumMaximumHeights(j_.computeRectangle(i,Ome)).minimumTerrainHeight),i.extrudedHeight=s};var wP=sh;var bti=T(S(),1);var Mei=T(S(),1);var Sei=T(S(),1);var zme={};function $7e(e,t){return P.equalsEpsilon(e.latitude,t.latitude,P.EPSILON10)&&P.equalsEpsilon(e.longitude,t.longitude,P.EPSILON10)}var e6e=new he,t6e=new he;function n6e(e,t,n,i){t=yo(t,h.equalsEpsilon);let o=t.length;if(o<2)return;let r=l(i),s=l(n),a=new Array(o),c=new Array(o),d=new Array(o),u=t[0];a[0]=u;let m=e.cartesianToCartographic(u,e6e);s&&(m.height=n[0]),c[0]=m.height,r?d[0]=i[0]:d[0]=0;let p=c[0],b=d[0],f=p===b,x=1;for(let _=1;_<o;++_){let C=t[_],V=e.cartesianToCartographic(C,t6e);s&&(V.height=n[_]),f=f&&V.height===0,$7e(m,V)?m.height<V.height&&(c[x-1]=V.height):(a[x]=C,c[x]=V.height,r?d[x]=i[_]:d[x]=0,f=f&&c[x]===d[x],he.clone(V,m),++x)}if(!(f||x<2))return a.length=x,c.length=x,d.length=x,{positions:a,topHeights:c,bottomHeights:d}}var i6e=new Array(2),o6e=new Array(2),r6e={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};zme.computePositions=function(e,t,n,i,o,r){let s=n6e(e,t,n,i);if(!l(s))return;t=s.positions,n=s.topHeights,i=s.bottomHeights;let a=t.length,c=a-2,d,u,m=P.chordLength(o,e.maximumRadius),p=r6e;if(p.minDistance=m,p.ellipsoid=e,r){let b=0,f;for(f=0;f<a-1;f++)b+=Ri.numberOfPoints(t[f],t[f+1],m)+1;d=new Float64Array(b*3),u=new Float64Array(b*3);let x=i6e,_=o6e;p.positions=x,p.height=_;let C=0;for(f=0;f<a-1;f++){x[0]=t[f],x[1]=t[f+1],_[0]=n[f],_[1]=n[f+1];let V=Ri.generateArc(p);d.set(V,C),_[0]=i[f],_[1]=i[f+1],u.set(Ri.generateArc(p),C),C+=V.length}}else p.positions=t,p.height=n,d=new Float64Array(Ri.generateArc(p)),p.height=i,u=new Float64Array(Ri.generateArc(p));return{bottomPositions:u,topPositions:d,numCorners:c}};var q_=zme;var rJ=new h,Ck=new h,s6e=new h,Hme=new h,a6e=new h,c6e=new h,l6e=new h;function $_(e){e=g(e,g.EMPTY_OBJECT);let t=e.positions,n=e.maximumHeights,i=e.minimumHeights,o=g(e.vertexFormat,Pe.DEFAULT),r=g(e.granularity,P.RADIANS_PER_DEGREE),s=g(e.ellipsoid,oe.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=n,this._vertexFormat=Pe.clone(o),this._granularity=r,this._ellipsoid=oe.clone(s),this._workerName=\"createWallGeometry\";let a=1+t.length*h.packedLength+2;l(i)&&(a+=i.length),l(n)&&(a+=n.length),this.packedLength=a+oe.packedLength+Pe.packedLength+1}$_.pack=function(e,t,n){n=g(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._minimumHeights;if(r=l(s)?s.length:0,t[n++]=r,l(s))for(i=0;i<r;++i)t[n++]=s[i];let a=e._maximumHeights;if(r=l(a)?a.length:0,t[n++]=r,l(a))for(i=0;i<r;++i)t[n++]=a[i];return oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,Pe.pack(e._vertexFormat,t,n),n+=Pe.packedLength,t[n]=e._granularity,t};var Kme=oe.clone(oe.UNIT_SPHERE),Jme=new Pe,FP={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:Kme,vertexFormat:Jme,granularity:void 0};$_.unpack=function(e,t,n){t=g(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s;if(o>0)for(s=new Array(o),i=0;i<o;++i)s[i]=e[t++];o=e[t++];let a;if(o>0)for(a=new Array(o),i=0;i<o;++i)a[i]=e[t++];let c=oe.unpack(e,t,Kme);t+=oe.packedLength;let d=Pe.unpack(e,t,Jme);t+=Pe.packedLength;let u=e[t];return l(n)?(n._positions=r,n._minimumHeights=s,n._maximumHeights=a,n._ellipsoid=oe.clone(c,n._ellipsoid),n._vertexFormat=Pe.clone(d,n._vertexFormat),n._granularity=u,n):(FP.positions=r,FP.minimumHeights=s,FP.maximumHeights=a,FP.granularity=u,new $_(FP))};$_.fromConstantHeights=function(e){e=g(e,g.EMPTY_OBJECT);let t=e.positions,n,i,o=e.minimumHeight,r=e.maximumHeight,s=l(o),a=l(r);if(s||a){let d=t.length;n=s?new Array(d):void 0,i=a?new Array(d):void 0;for(let u=0;u<d;++u)s&&(n[u]=o),a&&(i[u]=r)}let c={positions:t,maximumHeights:i,minimumHeights:n,ellipsoid:e.ellipsoid,vertexFormat:e.vertexFormat};return new $_(c)};$_.createGeometry=function(e){let t=e._positions,n=e._minimumHeights,i=e._maximumHeights,o=e._vertexFormat,r=e._granularity,s=e._ellipsoid,a=q_.computePositions(s,t,i,n,r,!0);if(!l(a))return;let c=a.bottomPositions,d=a.topPositions,u=a.numCorners,m=d.length,p=m*2,b=o.position?new Float64Array(p):void 0,f=o.normal?new Float32Array(p):void 0,x=o.tangent?new Float32Array(p):void 0,_=o.bitangent?new Float32Array(p):void 0,C=o.st?new Float32Array(p/3*2):void 0,V=0,L=0,R=0,G=0,X=0,v=l6e,W=c6e,F=a6e,A=!0;m/=3;let y,Z=0,E=1/(m-u-1);for(y=0;y<m;++y){let U=y*3,Y=h.fromArray(d,U,rJ),N=h.fromArray(c,U,Ck);if(o.position&&(b[V++]=N.x,b[V++]=N.y,b[V++]=N.z,b[V++]=Y.x,b[V++]=Y.y,b[V++]=Y.z),o.st&&(C[X++]=Z,C[X++]=0,C[X++]=Z,C[X++]=1),o.normal||o.tangent||o.bitangent){let J=h.clone(h.ZERO,Hme),z=h.subtract(Y,s.geodeticSurfaceNormal(Y,Ck),Ck);if(y+1<m&&(J=h.fromArray(d,U+3,Hme)),A){let ee=h.subtract(J,Y,s6e),H=h.subtract(z,Y,rJ);v=h.normalize(h.cross(H,ee,v),v),A=!1}h.equalsEpsilon(Y,J,P.EPSILON10)?A=!0:(Z+=E,o.tangent&&(W=h.normalize(h.subtract(J,Y,W),W)),o.bitangent&&(F=h.normalize(h.cross(v,W,F),F))),o.normal&&(f[L++]=v.x,f[L++]=v.y,f[L++]=v.z,f[L++]=v.x,f[L++]=v.y,f[L++]=v.z),o.tangent&&(x[G++]=W.x,x[G++]=W.y,x[G++]=W.z,x[G++]=W.x,x[G++]=W.y,x[G++]=W.z),o.bitangent&&(_[R++]=F.x,_[R++]=F.y,_[R++]=F.z,_[R++]=F.x,_[R++]=F.y,_[R++]=F.z)}}let I=new hn;o.position&&(I.position=new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:b})),o.normal&&(I.normal=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:f})),o.tangent&&(I.tangent=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:x})),o.bitangent&&(I.bitangent=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:3,values:_})),o.st&&(I.st=new Ee({componentDatatype:Q.FLOAT,componentsPerAttribute:2,values:C}));let w=p/3;p-=6*(u+1);let k=Ae.createTypedArray(w,p),B=0;for(y=0;y<w-2;y+=2){let U=y,Y=y+2,N=h.fromArray(b,U*3,rJ),J=h.fromArray(b,Y*3,Ck);if(h.equalsEpsilon(N,J,P.EPSILON10))continue;let z=y+1,ee=y+3;k[B++]=z,k[B++]=U,k[B++]=ee,k[B++]=ee,k[B++]=U,k[B++]=Y}return new ut({attributes:I,indices:k,primitiveType:we.TRIANGLES,boundingSphere:new ce.fromVertices(b)})};var AP=$_;var $ei=T(S(),1);var Qme=new h,jme=new h;function eT(e){e=g(e,g.EMPTY_OBJECT);let t=e.positions,n=e.maximumHeights,i=e.minimumHeights,o=g(e.granularity,P.RADIANS_PER_DEGREE),r=g(e.ellipsoid,oe.WGS84);this._positions=t,this._minimumHeights=i,this._maximumHeights=n,this._granularity=o,this._ellipsoid=oe.clone(r),this._workerName=\"createWallOutlineGeometry\";let s=1+t.length*h.packedLength+2;l(i)&&(s+=i.length),l(n)&&(s+=n.length),this.packedLength=s+oe.packedLength+1}eT.pack=function(e,t,n){n=g(n,0);let i,o=e._positions,r=o.length;for(t[n++]=r,i=0;i<r;++i,n+=h.packedLength)h.pack(o[i],t,n);let s=e._minimumHeights;if(r=l(s)?s.length:0,t[n++]=r,l(s))for(i=0;i<r;++i)t[n++]=s[i];let a=e._maximumHeights;if(r=l(a)?a.length:0,t[n++]=r,l(a))for(i=0;i<r;++i)t[n++]=a[i];return oe.pack(e._ellipsoid,t,n),n+=oe.packedLength,t[n]=e._granularity,t};var qme=oe.clone(oe.UNIT_SPHERE),MP={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:qme,granularity:void 0};eT.unpack=function(e,t,n){t=g(t,0);let i,o=e[t++],r=new Array(o);for(i=0;i<o;++i,t+=h.packedLength)r[i]=h.unpack(e,t);o=e[t++];let s;if(o>0)for(s=new Array(o),i=0;i<o;++i)s[i]=e[t++];o=e[t++];let a;if(o>0)for(a=new Array(o),i=0;i<o;++i)a[i]=e[t++];let c=oe.unpack(e,t,qme);t+=oe.packedLength;let d=e[t];return l(n)?(n._positions=r,n._minimumHeights=s,n._maximumHeights=a,n._ellipsoid=oe.clone(c,n._ellipsoid),n._granularity=d,n):(MP.positions=r,MP.minimumHeights=s,MP.maximumHeights=a,MP.granularity=d,new eT(MP))};eT.fromConstantHeights=function(e){e=g(e,g.EMPTY_OBJECT);let t=e.positions,n,i,o=e.minimumHeight,r=e.maximumHeight,s=l(o),a=l(r);if(s||a){let d=t.length;n=s?new Array(d):void 0,i=a?new Array(d):void 0;for(let u=0;u<d;++u)s&&(n[u]=o),a&&(i[u]=r)}let c={positions:t,maximumHeights:i,minimumHeights:n,ellipsoid:e.ellipsoid};return new eT(c)};eT.createGeometry=function(e){let t=e._positions,n=e._minimumHeights,i=e._maximumHeights,o=e._granularity,r=e._ellipsoid,s=q_.computePositions(r,t,i,n,o,!1);if(!l(s))return;let a=s.bottomPositions,c=s.topPositions,d=c.length,u=d*2,m=new Float64Array(u),p=0;d/=3;let b;for(b=0;b<d;++b){let V=b*3,L=h.fromArray(c,V,Qme),R=h.fromArray(a,V,jme);m[p++]=R.x,m[p++]=R.y,m[p++]=R.z,m[p++]=L.x,m[p++]=L.y,m[p++]=L.z}let f=new hn({position:new Ee({componentDatatype:Q.DOUBLE,componentsPerAttribute:3,values:m})}),x=u/3;u=2*x-4+x;let _=Ae.createTypedArray(x,u),C=0;for(b=0;b<x-2;b+=2){let V=b,L=b+2,R=h.fromArray(m,V*3,Qme),G=h.fromArray(m,L*3,jme);if(h.equalsEpsilon(R,G,P.EPSILON10))continue;let X=b+1,v=b+3;_[C++]=X,_[C++]=V,_[C++]=X,_[C++]=v,_[C++]=V,_[C++]=L}return _[C++]=x-2,_[C++]=x-1,new ut({attributes:f,indices:_,primitiveType:we.LINES,boundingSphere:new ce.fromVertices(m)})};var NP=eT;var $me=new O;function d6e(e){this.id=e,this.vertexFormat=void 0,this.positions=void 0,this.minimumHeights=void 0,this.maximumHeights=void 0,this.granularity=void 0}function ah(e,t){ii.call(this,{entity:e,scene:t,geometryOptions:new d6e(e),geometryPropertyName:\"wall\",observedPropertyNames:[\"availability\",\"wall\"]}),this._onEntityPropertyChanged(e,\"wall\",e.wall,void 0)}l(Object.create)&&(ah.prototype=Object.create(ii.prototype),ah.prototype.constructor=ah);ah.prototype.createFillGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i,o,r=new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._fillProperty.getValue(e)),s=this._distanceDisplayConditionProperty.getValue(e),a=kn.fromDistanceDisplayCondition(s);if(this._materialProperty instanceof kt){let c;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||n)&&(c=this._materialProperty.color.getValue(e,$me)),l(c)||(c=O.WHITE),o=Ot.fromColor(c),i={show:r,distanceDisplayCondition:a,color:o}}else i={show:r,distanceDisplayCondition:a};return new Vt({id:t,geometry:new AP(this._options),attributes:i})};ah.prototype.createOutlineGeometryInstance=function(e){let t=this._entity,n=t.isAvailable(e),i=K.getValueOrDefault(this._outlineColorProperty,e,O.BLACK,$me),o=this._distanceDisplayConditionProperty.getValue(e);return new Vt({id:t,geometry:new NP(this._options),attributes:{show:new xn(n&&t.isShowing&&this._showProperty.getValue(e)&&this._showOutlineProperty.getValue(e)),color:Ot.fromColor(i),distanceDisplayCondition:kn.fromDistanceDisplayCondition(o)}})};ah.prototype._isHidden=function(e,t){return!l(t.positions)||ii.prototype._isHidden.call(this,e,t)};ah.prototype._getIsClosed=function(e){return!1};ah.prototype._isDynamic=function(e,t){return!t.positions.isConstant||!K.isConstant(t.minimumHeights)||!K.isConstant(t.maximumHeights)||!K.isConstant(t.outlineWidth)||!K.isConstant(t.granularity)};ah.prototype._setStaticOptions=function(e,t){let n=t.minimumHeights,i=t.maximumHeights,o=t.granularity,r=this._materialProperty instanceof kt,s=this._options;s.vertexFormat=r?ln.VERTEX_FORMAT:so.MaterialSupport.TEXTURED.vertexFormat,s.positions=t.positions.getValue(Be.MINIMUM_VALUE,s.positions),s.minimumHeights=l(n)?n.getValue(Be.MINIMUM_VALUE,s.minimumHeights):void 0,s.maximumHeights=l(i)?i.getValue(Be.MINIMUM_VALUE,s.maximumHeights):void 0,s.granularity=l(o)?o.getValue(Be.MINIMUM_VALUE):void 0};ah.DynamicGeometryUpdater=J1;function J1(e,t,n){ni.call(this,e,t,n)}l(Object.create)&&(J1.prototype=Object.create(ni.prototype),J1.prototype.constructor=J1);J1.prototype._isHidden=function(e,t,n){return!l(this._options.positions)||ni.prototype._isHidden.call(this,e,t,n)};J1.prototype._setOptions=function(e,t,n){let i=this._options;i.positions=K.getValueOrUndefined(t.positions,n,i.positions),i.minimumHeights=K.getValueOrUndefined(t.minimumHeights,n,i.minimumHeights),i.maximumHeights=K.getValueOrUndefined(t.maximumHeights,n,i.maximumHeights),i.granularity=K.getValueOrUndefined(t.granularity,n)};var kP=ah;var tT=[uX,rP,Q2,gP,_P,CP,RP,vP,wP,kP];function nT(e,t){this.entity=e,this.scene=t;let n=new Array(tT.length),i=new ge,o=new Xr;for(let r=0;r<n.length;r++){let s=new tT[r](e,t);o.add(s.geometryChanged,a=>{i.raiseEvent(a)}),n[r]=s}this.updaters=n,this.geometryChanged=i,this.eventHelper=o,this._removeEntitySubscription=e.definitionChanged.addEventListener(nT.prototype._onEntityPropertyChanged,this)}nT.prototype._onEntityPropertyChanged=function(e,t,n,i){let o=this.updaters;for(let r=0;r<o.length;r++)o[r]._onEntityPropertyChanged(e,t,n,i)};nT.prototype.forEach=function(e){let t=this.updaters;for(let n=0;n<t.length;n++)e(t[n])};nT.prototype.destroy=function(){this.eventHelper.removeAll();let e=this.updaters;for(let t=0;t<e.length;t++)e[t].destroy();this._removeEntitySubscription(),me(this)};nT.registerUpdater=function(e){tT.includes(e)||tT.push(e)};nT.unregisterUpdater=function(e){if(tT.includes(e)){let t=tT.indexOf(e);tT.splice(t,1)}};var iT=nT;var Hti=T(S(),1);var ehe=new O,u6e=new It,m6e=new It,h6e=h.ZERO,f6e=new h;function ch(e,t,n,i,o,r,s){this.translucent=t,this.appearanceType=n,this.depthFailAppearanceType=i,this.depthFailMaterialProperty=o,this.depthFailMaterial=void 0,this.closed=r,this.shadows=s,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new Lt,this.updaters=new Lt,this.updatersWithAttributes=new Lt,this.attributes=new Lt,this.subscriptions=new Lt,this.showsUpdated=new Lt,this.itemsToRemove=[],this.invalidated=!1;let a;l(o)&&(a=o.definitionChanged.addEventListener(ch.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=a}ch.prototype.onMaterialChanged=function(){this.invalidated=!0};ch.prototype.isMaterial=function(e){let t=this.depthFailMaterialProperty,n=e.depthFailMaterialProperty;return n===t?!0:l(t)?t.equals(n):!1};ch.prototype.add=function(e,t){let n=e.id;if(this.createPrimitive=!0,this.geometry.set(n,t),this.updaters.set(n,e),!e.hasConstantFill||!e.fillMaterialProperty.isConstant||!K.isConstant(e.distanceDisplayConditionProperty)||!K.isConstant(e.terrainOffsetProperty))this.updatersWithAttributes.set(n,e);else{let i=this;this.subscriptions.set(n,e.entity.definitionChanged.addEventListener(function(o,r,s,a){r===\"isShowing\"&&i.showsUpdated.set(e.id,e)}))}};ch.prototype.remove=function(e){let t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);let n=this.subscriptions.get(t);return l(n)&&(n(),this.subscriptions.remove(t),this.showsUpdated.remove(t)),!0}return!1};ch.prototype.update=function(e){let t=!0,n=0,i=this.primitive,o=this.primitives,r;if(this.createPrimitive){let s=this.geometry.values;if(s.length>0){l(i)&&(l(this.oldPrimitive)?o.remove(i):this.oldPrimitive=i);let c;l(this.depthFailAppearanceType)&&(l(this.depthFailMaterialProperty)&&(this.depthFailMaterial=Oo.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),c=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),i=new Rn({show:!1,asynchronous:!0,geometryInstances:s.slice(),appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:c,shadows:this.shadows}),o.add(i),t=!1}else{l(i)&&(o.remove(i),i=void 0);let c=this.oldPrimitive;l(c)&&(o.remove(c),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=i,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(l(i)&&i.ready){i.show=!0,l(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0),l(this.depthFailAppearanceType)&&!(this.depthFailMaterialProperty instanceof kt)&&(this.depthFailMaterial=Oo.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);let s=this.updatersWithAttributes.values,a=s.length,c=this.waitingOnCreate;for(r=0;r<a;r++){let d=s[r],u=this.geometry.get(d.id),m=this.attributes.get(u.id.id);if(l(m)||(m=i.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,m)),!d.fillMaterialProperty.isConstant||c){let _=d.fillMaterialProperty.color,C=K.getValueOrDefault(_,e,O.WHITE,ehe);O.equals(m._lastColor,C)||(m._lastColor=O.clone(C,m._lastColor),m.color=Ot.toValue(C,m.color),(this.translucent&&m.color[3]===255||!this.translucent&&m.color[3]!==255)&&(this.itemsToRemove[n++]=d))}if(l(this.depthFailAppearanceType)&&d.depthFailMaterialProperty instanceof kt&&(!d.depthFailMaterialProperty.isConstant||c)){let _=d.depthFailMaterialProperty.color,C=K.getValueOrDefault(_,e,O.WHITE,ehe);O.equals(m._lastDepthFailColor,C)||(m._lastDepthFailColor=O.clone(C,m._lastDepthFailColor),m.depthFailColor=Ot.toValue(C,m.depthFailColor))}let p=d.entity.isShowing&&(d.hasConstantFill||d.isFilled(e)),b=m.show[0]===1;p!==b&&(m.show=xn.toValue(p,m.show));let f=d.distanceDisplayConditionProperty;if(!K.isConstant(f)){let _=K.getValueOrDefault(f,e,m6e,u6e);It.equals(_,m._lastDistanceDisplayCondition)||(m._lastDistanceDisplayCondition=It.clone(_,m._lastDistanceDisplayCondition),m.distanceDisplayCondition=kn.toValue(_,m.distanceDisplayCondition))}let x=d.terrainOffsetProperty;if(!K.isConstant(x)){let _=K.getValueOrDefault(x,e,h6e,f6e);h.equals(_,m._lastOffset)||(m._lastOffset=h.clone(_,m._lastOffset),m.offset=Ji.toValue(_,m.offset))}}this.updateShows(i),this.waitingOnCreate=!1}else l(i)&&!i.ready&&(t=!1);return this.itemsToRemove.length=n,t};ch.prototype.updateShows=function(e){let t=this.showsUpdated.values,n=t.length;for(let i=0;i<n;i++){let o=t[i],r=this.geometry.get(o.id),s=this.attributes.get(r.id.id);l(s)||(s=e.getGeometryInstanceAttributes(r.id),this.attributes.set(r.id.id,s));let a=o.entity.isShowing,c=s.show[0]===1;a!==c&&(s.show=xn.toValue(a,s.show),r.attributes.show.value[0]=s.show[0])}this.showsUpdated.removeAll()};ch.prototype.contains=function(e){return this.updaters.contains(e.id)};ch.prototype.getBoundingSphere=function(e,t){let n=this.primitive;if(!n.ready)return ht.PENDING;let i=n.getGeometryInstanceAttributes(e.entity);return!l(i)||!l(i.boundingSphere)||l(i.show)&&i.show[0]===0?ht.FAILED:(i.boundingSphere.clone(t),ht.DONE)};ch.prototype.destroy=function(){let e=this.primitive,t=this.primitives;l(e)&&t.remove(e);let n=this.oldPrimitive;l(n)&&t.remove(n),l(this.removeMaterialSubscription)&&this.removeMaterialSubscription()};function Q1(e,t,n,i,o){this._solidItems=[],this._translucentItems=[],this._primitives=e,this._appearanceType=t,this._depthFailAppearanceType=n,this._closed=i,this._shadows=o}Q1.prototype.add=function(e,t){let n,i,o=t.createFillGeometryInstance(e);o.attributes.color.value[3]===255?(n=this._solidItems,i=!1):(n=this._translucentItems,i=!0);let r=n.length;for(let a=0;a<r;a++){let c=n[a];if(c.isMaterial(t)){c.add(t,o);return}}let s=new ch(this._primitives,i,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);s.add(t,o),n.push(s)};function the(e,t){let n=e.length;for(let i=n-1;i>=0;i--){let o=e[i];if(o.remove(t))return o.updaters.length===0&&(e.splice(i,1),o.destroy()),!0}return!1}Q1.prototype.remove=function(e){the(this._solidItems,e)||the(this._translucentItems,e)};function nhe(e,t,n){let i=!1,o=t.length;for(let r=0;r<o;++r){let s=t[r],a=s.itemsToRemove,c=a.length;if(c>0)for(r=0;r<c;r++){let d=a[r];s.remove(d),e.add(n,d),i=!0}}return i}function Vk(e,t,n,i){let o=t.length,r;for(r=o-1;r>=0;r--){let s=t[r];if(s.invalidated){t.splice(r,1);let a=s.updaters.values,c=a.length;for(let d=0;d<c;d++)e.add(n,a[d]);s.destroy()}}for(o=t.length,r=0;r<o;++r)i=t[r].update(n)&&i;return i}Q1.prototype.update=function(e){let t=Vk(this,this._solidItems,e,!0);t=Vk(this,this._translucentItems,e,t)&&t;let n=nhe(this,this._solidItems,e),i=nhe(this,this._translucentItems,e);return(n||i)&&(t=Vk(this,this._solidItems,e,t)&&t,t=Vk(this,this._translucentItems,e,t)&&t),t};function ihe(e,t,n){let i=e.length;for(let o=0;o<i;o++){let r=e[o];if(r.contains(t))return r.getBoundingSphere(t,n)}return ht.FAILED}Q1.prototype.getBoundingSphere=function(e,t){let n=ihe(this._solidItems,e,t);return n===ht.FAILED?ihe(this._translucentItems,e,t):n};function ohe(e){let t=e.length;for(let n=0;n<t;n++)e[n].destroy();e.length=0}Q1.prototype.removeAllPrimitives=function(){ohe(this._solidItems),ohe(this._translucentItems)};var Du=Q1;var lni=T(S(),1);var p6e=new"
}