{
  "metadata": {
    "source_file": "Cesium-1.116.0-fix-26\\Cesium.js",
    "chunk_index": 102,
    "total_chunks": 194,
    "chunk_size": 61422,
    "word_count": 800,
    "model_kwargs": {
      "model": "text-embedding-3-large",
      "dimensions": 3072,
      "encoding_format": "float"
    },
    "text_splitter": {
      "split_by": "word",
      "chunk_size": 800,
      "chunk_overlap": 200
    },
    "created_at": "2025-12-17T23:57:49.707Z"
  },
  "content": "p=e.refine===vo.REPLACE,b=n.isSkippingLevelOfDetail;if(p&&!b||!n.foveatedScreenSpaceError||n.foveatedConeSize===1||e._priorityProgressiveResolution&&p&&b||n._pass===Io.PRELOAD_FLIGHT||n._pass===Io.PRELOAD)return!1;let f=1-Math.cos(s.frustum.fov*.5),x=n.foveatedConeSize*f;if(e._foveatedFactor<=x)return!1;let _=f-x,C=P.clamp((e._foveatedFactor-x)/_,0,1),V=n.foveatedInterpolationCallback(n.foveatedMinimumScreenSpaceErrorRelaxation,n.memoryAdjustedScreenSpaceError,C),L=e._screenSpaceError===0&&l(e.parent)?e.parent._screenSpaceError*.5:e._screenSpaceError;return n.memoryAdjustedScreenSpaceError-V<=L}var ule=new te;Jo.prototype.getScreenSpaceError=function(e,t,n){let i=this._tileset,o=g(n,1),r=l(this.parent)?this.parent.geometricError:i._scaledGeometricError,s=t?r:this.geometricError;if(s===0)return 0;let{camera:a,context:c}=e,d=a.frustum,u=c.drawingBufferWidth,m=c.drawingBufferHeight*o,p;if(e.mode===ie.SCENE2D||d instanceof rn){let b=d.offCenterFrustum;l(b)&&(d=b);let f=Math.max(d.top-d.bottom,d.right-d.left)/Math.max(u,m);p=s/f}else{let b=Math.max(this._distanceToCamera,P.EPSILON7),f=d.sseDenominator;if(p=s*m/(b*f),i.dynamicScreenSpaceError){let x=i._dynamicScreenSpaceErrorComputedDensity,_=i.dynamicScreenSpaceErrorFactor,C=P.fog(b,x)*_;p-=C}}return p/=e.pixelRatio,p};function GKe(e,t){if(e.progressiveResolutionHeightFraction<=0||e.progressiveResolutionHeightFraction>.5)return!1;let n=e.memoryAdjustedScreenSpaceError,i=t._screenSpaceErrorProgressiveResolution>n;t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;let o=t.parent,r=t._screenSpaceErrorProgressiveResolution<=n,s=l(o)&&o._screenSpaceErrorProgressiveResolution>n;return r&&s&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0,i=!0),i}function EKe(e,t){let n=t.parent,o=l(n)&&(!e.isSkippingLevelOfDetail||t._screenSpaceError===0||n.hasTilesetContent||n.hasImplicitContent)?n._screenSpaceError:t._screenSpaceError;return e.root._screenSpaceError-o}Jo.prototype.updateVisibility=function(e){let{parent:t,tileset:n}=this;if(this._updatedVisibilityFrame===n._updatedVisibilityFrame)return;let i=l(t)?t.computedTransform:n.modelMatrix,o=l(t)?t._visibilityPlaneMask:os.MASK_INDETERMINATE;this.updateTransform(i,e),this._distanceToCamera=this.distanceToTile(e),this._centerZDepth=this.distanceToTileCenter(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(e,!1,n.progressiveResolutionHeightFraction),this._visibilityPlaneMask=this.visibility(e,o),this._visible=this._visibilityPlaneMask!==os.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._priorityReverseScreenSpaceError=EKe(n,this),this._priorityProgressiveResolution=GKe(n,this),this.priorityDeferred=RKe(this,e),this._updatedVisibilityFrame=n._updatedVisibilityFrame};Jo.prototype.updateExpiration=function(){if(l(this.expireDate)&&this.contentReady&&!this.hasEmptyContent&&!this.hasMultipleContents){let e=te.now(ule);te.lessThan(this.expireDate,e)&&(this._contentState=Fo.EXPIRED,this._expiredContent=this._content)}};function XKe(e){if(!l(e.expireDuration))return;let t=te.now(ule);te.addSeconds(t,e.expireDuration,t),l(e.expireDate)?te.lessThan(e.expireDate,t)&&te.clone(t,e.expireDate):e.expireDate=te.clone(t)}function IKe(e){return function(){return e._priority}}Jo.prototype.requestContent=function(){if(!this.hasEmptyContent)return this.hasMultipleContents?WKe(this):vKe(this)};function WKe(e){let t=e._content,n=e._tileset;if(!l(t)){let o=oi(e._header,\"3DTILES_multiple_contents\")?e._header.extensions[\"3DTILES_multiple_contents\"]:e._header;t=new y2(n,e,e._contentResource.clone(),o),e._content=t}let i=t.requestInnerContents();if(l(i))return e._contentState=Fo.LOADING,i.then(o=>{if(!e.isDestroyed()&&l(o))return e._contentState=Fo.PROCESSING,t}).catch(o=>{if(!e.isDestroyed())throw e._contentState=Fo.FAILED,o})}async function PKe(e,t,n,i,o){let r=e._contentState;e._contentState=Fo.LOADING,++t.statistics.numberOfPendingRequests;let s;try{s=await o}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;if(n.cancelled||n.state===Qn.CANCELLED){e._contentState=r,++t.statistics.numberOfAttemptedRequests;return}throw e._contentState=Fo.FAILED,a}if(e.isDestroyed()){--t.statistics.numberOfPendingRequests;return}if(n.cancelled||n.state===Qn.CANCELLED){e._contentState=r,--t.statistics.numberOfPendingRequests,++t.statistics.numberOfAttemptedRequests;return}try{let a=await wKe(e,s);return--t.statistics.numberOfPendingRequests,e.isDestroyed()?void 0:(i&&(e.expireDate=void 0),e._content=a,e._contentState=Fo.PROCESSING,a)}catch(a){if(--t.statistics.numberOfPendingRequests,e.isDestroyed())return;throw e._contentState=Fo.FAILED,a}}function vKe(e){let t=e._contentResource.clone(),n=e.contentExpired;n&&t.setQueryParameters({expired:e.expireDate.toString()});let i=new Do({throttle:!0,throttleByServer:!0,type:is.TILES3D,priorityFunction:IKe(e),serverKey:e._serverKey});e._request=i,t.request=i;let o=e._tileset,r=t.fetchArrayBuffer();if(!l(r)){++o.statistics.numberOfAttemptedRequests;return}return PKe(e,o,i,n,r)}async function wKe(e,t){let n=bf(t),i=e._tileset;i._disableSkipLevelOfDetail=i._disableSkipLevelOfDetail||n.contentType===gs.GEOMETRY||n.contentType===gs.VECTOR,(n.contentType===gs.IMPLICIT_SUBTREE||n.contentType===gs.IMPLICIT_SUBTREE_JSON)&&(e.hasImplicitContent=!0),n.contentType===gs.EXTERNAL_TILESET&&(e.hasTilesetContent=!0);let o,r=g_[n.contentType];if(e.isDestroyed())return;l(n.binaryPayload)?o=await Promise.resolve(r(i,e,e._contentResource,n.binaryPayload.buffer,0)):o=await Promise.resolve(r(i,e,e._contentResource,n.jsonPayload));let s=e._contentHeader;if(e.hasImplicitContentMetadata){let c=e.implicitSubtree,d=e.implicitCoordinates;o.metadata=c.getContentMetadataView(d,0)}else e.hasImplicitContent||(o.metadata=x_(i,s));let a=__(i,s);return l(a)&&(o.group=new Mx({metadata:a})),o}Jo.prototype.cancelRequests=function(){this.hasMultipleContents?this._content.cancelRequests():this._request.cancel()};Jo.prototype.unloadContent=function(){this.hasRenderableContent&&(this._content=this._content&&this._content.destroy(),this._contentState=Fo.UNLOADED,this.lastStyleTime=0,this.clippingPlanesDirty=this._clippingPlanesState===0,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var mle=new ce;function zH(e,t){if(t.mode!==ie.SCENE3D&&!l(e._boundingVolume2D)){let n=e._boundingVolume.boundingSphere,i=ce.projectTo2D(n,t.mapProjection,mle);e._boundingVolume2D=new b0(i.center,i.radius)}return t.mode!==ie.SCENE3D?e._boundingVolume2D:e._boundingVolume}function FKe(e,t){if(t.mode!==ie.SCENE3D&&!l(e._contentBoundingVolume2D)){let n=e._contentBoundingVolume.boundingSphere,i=ce.projectTo2D(n,t.mapProjection,mle);e._contentBoundingVolume2D=new b0(i.center,i.radius)}return t.mode!==ie.SCENE3D?e._contentBoundingVolume2D:e._contentBoundingVolume}Jo.prototype.visibility=function(e,t){let n=e.cullingVolume,i=zH(this,e),o=this._tileset,r=o.clippingPlanes;if(l(r)&&r.enabled){let s=r.computeIntersectionWithBoundingVolume(i,o.clippingPlanesOriginMatrix);if(this._isClipped=s!==nn.INSIDE,s===nn.OUTSIDE)return os.MASK_OUTSIDE}return n.computeVisibilityWithPlaneMask(i,t)};Jo.prototype.contentVisibility=function(e){if(!l(this._contentBoundingVolume))return nn.INSIDE;if(this._visibilityPlaneMask===os.MASK_INSIDE)return nn.INSIDE;let t=e.cullingVolume,n=FKe(this,e),i=this._tileset,o=i.clippingPlanes;if(l(o)&&o.enabled){let r=o.computeIntersectionWithBoundingVolume(n,i.clippingPlanesOriginMatrix);if(this._isClipped=r!==nn.INSIDE,r===nn.OUTSIDE)return nn.OUTSIDE}return t.computeVisibility(n)};Jo.prototype.distanceToTile=function(e){return zH(this,e).distanceToCamera(e)};var AKe=new h;Jo.prototype.distanceToTileCenter=function(e){let n=zH(this,e).boundingVolume,i=h.subtract(n.center,e.camera.positionWC,AKe);return h.dot(e.camera.directionWC,i)};Jo.prototype.insideViewerRequestVolume=function(e){let t=this._viewerRequestVolume;return!l(t)||t.distanceToCamera(e)===0};var hle=new $,fle=new h,MKe=new $,HH=new h,ple=new le,ble=new Zn,OH=new M;function NKe(e,t,n){let i=h.fromElements(e[0],e[1],e[2],HH),o=$.fromArray(e,3,MKe);i=M.multiplyByPoint(t,i,i);let r=M.getMatrix3(t,hle);return o=$.multiply(r,o,o),l(n)?(n.update(i,o),n):new _d(i,o)}function kKe(e,t,n,i){let o=le.unpack(e,0,ple),r=e[4],s=e[5],a=Zn.fromRectangle(o,r,s,oe.WGS84,ble),c=a.center,d=a.halfAxes;t=M.multiplyTransformation(t,M.inverseTransformation(n,OH),OH),c=M.multiplyByPoint(t,c,c);let u=M.getMatrix3(t,hle);return d=$.multiply(u,d,d),l(i)&&i instanceof _d?(i.update(c,d),i):new _d(c,d)}function UKe(e,t,n,i){if(!M.equalsEpsilon(t,n,P.EPSILON8))return kKe(e,t,n,i);let o=le.unpack(e,0,ple);return l(i)?(i.rectangle=le.clone(o,i.rectangle),i.minimumHeight=e[4],i.maximumHeight=e[5],i.computeBoundingVolumes(oe.WGS84),i):new Iu({rectangle:o,minimumHeight:e[4],maximumHeight:e[5]})}function DKe(e,t,n){let i=h.fromElements(e[0],e[1],e[2],HH),o=e[3];i=M.multiplyByPoint(t,i,i);let r=M.getScale(t,fle),s=h.maximumComponent(r);return o*=s,l(n)?(n.update(i,o),n):new b0(i,o)}Jo.prototype.createBoundingVolume=function(e,t,n){let i=this.metadata,o;if(l(i)&&(o=n_.parseBoundingVolumeSemantic(\"TILE\",i)),l(o)&&(e=o),!l(e))throw new ue(\"boundingVolume must be defined\");if(oi(e,\"3DTILES_bounding_volume_S2\"))return new C2(e.extensions[\"3DTILES_bounding_volume_S2\"]);let{box:r,region:s,sphere:a}=e;if(l(r)){let c=NKe(r,t,n);return this._verticalExaggeration!==1&&cle(c,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c}if(l(s)){let c=UKe(s,t,this._initialTransform,n);return this._verticalExaggeration===1||(c instanceof _d?cle(c,this._verticalExaggeration,this._verticalExaggerationRelativeHeight):(c.minimumHeight=pr.getHeight(c.minimumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c.maximumHeight=pr.getHeight(c.maximumHeight,this._verticalExaggeration,this._verticalExaggerationRelativeHeight),c.computeBoundingVolumes(oe.WGS84))),c}if(l(a)){let c=DKe(a,t,n);if(this._verticalExaggeration!==1){let d=pr.getPosition(c.center,oe.WGS84,this._verticalExaggeration,this._verticalExaggerationRelativeHeight,HH),u=c.radius*this._verticalExaggeration;c.update(d,u)}return c}throw new ue(\"boundingVolume must contain a sphere, region, or box\")};var BKe=h.unpackArray(new Array(8*3).fill(0));function cle(e,t,n){let i=e.boundingVolume.computeCorners(BKe).map(r=>pr.getPosition(r,oe.WGS84,t,n,r)),o=Zn.fromPoints(i,ble);e.update(o.center,o.halfAxes)}Jo.prototype.updateTransform=function(e,t){e=g(e,M.IDENTITY);let n=M.multiplyTransformation(e,this.transform,OH),i=!M.equals(n,this.computedTransform),o=l(t)&&(this._verticalExaggeration!==t.verticalExaggeration||this._verticalExaggerationRelativeHeight!==t.verticalExaggerationRelativeHeight);if(!i&&!o)return;i&&M.clone(n,this.computedTransform),o&&(this._verticalExaggeration=t.verticalExaggeration,this._verticalExaggerationRelativeHeight=t.verticalExaggerationRelativeHeight);let r=this._header,s=this._contentHeader;this._boundingVolume=this.createBoundingVolume(r.boundingVolume,this.computedTransform,this._boundingVolume),l(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(s.boundingVolume,this.computedTransform,this._contentBoundingVolume)),l(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(r.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)),this.updateGeometricErrorScale(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()};Jo.prototype.updateGeometricErrorScale=function(){let e=M.getScale(this.computedTransform,fle),t=h.maximumComponent(e);if(this.geometricError=this._geometricError*t,!l(this.parent)){let n=this._tileset;n._scaledGeometricError=n._geometricError*t}};function YKe(e,t,n,i){if(!i.isRender)return;let o=l(e._contentHeader)&&l(e._contentHeader.boundingVolume),r=t.debugShowBoundingVolume||t.debugShowContentBoundingVolume&&!o;if(r){let c;e._finalResolution?e.hasRenderableContent?c=O.WHITE:c=O.DARKGRAY:c=O.YELLOW,l(e._debugBoundingVolume)||(e._debugBoundingVolume=e._boundingVolume.createDebugVolume(c)),e._debugBoundingVolume.update(n);let d=e._debugBoundingVolume.getGeometryInstanceAttributes(\"outline\");d.color=Ot.toValue(c,d.color)}else!r&&l(e._debugBoundingVolume)&&(e._debugBoundingVolume=e._debugBoundingVolume.destroy());t.debugShowContentBoundingVolume&&o?(l(e._debugContentBoundingVolume)||(e._debugContentBoundingVolume=e._contentBoundingVolume.createDebugVolume(O.BLUE)),e._debugContentBoundingVolume.update(n)):!t.debugShowContentBoundingVolume&&l(e._debugContentBoundingVolume)&&(e._debugContentBoundingVolume=e._debugContentBoundingVolume.destroy()),t.debugShowViewerRequestVolume&&l(e._viewerRequestVolume)?(l(e._debugViewerRequestVolume)||(e._debugViewerRequestVolume=e._viewerRequestVolume.createDebugVolume(O.YELLOW)),e._debugViewerRequestVolume.update(n)):!t.debugShowViewerRequestVolume&&l(e._debugViewerRequestVolume)&&(e._debugViewerRequestVolume=e._debugViewerRequestVolume.destroy());let s=t.debugColorizeTiles&&!e._debugColorizeTiles||l(t._heatmap.tilePropertyName),a=!t.debugColorizeTiles&&e._debugColorizeTiles;s?(t._heatmap.colorize(e,n),e._debugColorizeTiles=!0,e.color=e._debugColor):a&&(e._debugColorizeTiles=!1,e.color=O.WHITE),e._colorDirty&&(e._colorDirty=!1,e._content.applyDebugSettings(!0,e._color)),a&&t.makeStyleDirty()}function OKe(e,t,n){let i=e._expiredContent;if(!e.hasMultipleContents&&l(i)){if(!e.contentReady){try{i.update(t,n)}catch{}return}e._expiredContent.destroy(),e._expiredContent=void 0}if(l(e.content))try{e.content.update(t,n)}catch(o){throw e._contentState=Fo.FAILED,o}}function zKe(e,t){let n=t.clippingPlanes,i=0;l(n)&&e._isClipped&&n.enabled&&(i=n.clippingPlanesState),i!==e._clippingPlanesState&&(e._clippingPlanesState=i,e.clippingPlanesDirty=!0)}Jo.prototype.update=function(e,t,n){let{commandList:i}=t,o=i.length;zKe(this,e),YKe(this,e,t,n),OKe(this,e,t);let r=i.length;this._commandsLength=r-o;for(let s=o;s<r;++s){let a=i[s],c=a.pass===Ze.TRANSLUCENT;a.depthForTranslucentClassification=c}this.clippingPlanesDirty=!1};var lle=[];Jo.prototype.process=function(e,t){!this.contentExpired&&!this.contentReady&&this._content.ready&&(XKe(this),this._selectedFrame=0,this.lastStyleTime=0,te.now(this._loadTimestamp),this._contentState=Fo.READY,!this.hasTilesetContent&&!this.hasImplicitContent&&(e._statistics.incrementLoadCounts(this.content),++e._statistics.numberOfTilesWithContentReady,++e._statistics.numberOfLoadedTilesTotal,e._cache.add(this)));let n=t.commandList;t.commandList=lle;try{this._content.update(e,t)}catch(i){throw this._contentState=Fo.FAILED,i}lle.length=0,t.commandList=n};function dle(e,t,n){let i=e*Math.pow(10,t);return parseInt(i)*Math.pow(10,n)}function DN(e,t,n){return Math.max(P.normalize(e,t,n)-P.EPSILON7,0)}Jo.prototype.updatePriority=function(){let e=this.tileset,t=e.preferLeaves,n=e._minimumPriority,i=e._maximumPriority,o=4,r=1,s=0,a=o,c=s+a,d=o,u=c+d,m=r,p=Math.pow(10,u),b=u+m,f=r,x=Math.pow(10,b),_=b+f,C=Math.pow(10,_),V=DN(this._depth,n.depth,i.depth);V=t?1-V:V;let R=!e.isSkippingLevelOfDetail&&this.refine===vo.REPLACE?DN(this._priorityHolder._distanceToCamera,n.distance,i.distance):DN(this._priorityReverseScreenSpaceError,n.reverseScreenSpaceError,i.reverseScreenSpaceError),G=dle(R,a,s),X=this._priorityProgressiveResolution?0:p,v=DN(this._priorityHolder._foveatedFactor,n.foveatedFactor,i.foveatedFactor),W=dle(v,d,c),F=this.priorityDeferred?x:0,A=e._pass===Io.PRELOAD_FLIGHT?0:C;this._priority=V+G+X+W+F+A};Jo.prototype.isDestroyed=function(){return!1};Jo.prototype.destroy=function(){return this._content=this._content&&this._content.destroy(),this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy(),this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy(),me(this)};var Pu=Jo;var Z5n=T(S(),1);var p5n=T(S(),1);function y0(e){e=g(e,g.EMPTY_OBJECT);let t=e.id,n=e.group,i=e.class,o=l(n.properties)?n.properties:{};this._class=i,this._properties=o,this._id=t,this._extras=n.extras,this._extensions=n.extensions}Object.defineProperties(y0.prototype,{class:{get:function(){return this._class}},id:{get:function(){return this._id}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});y0.prototype.hasProperty=function(e){return Mn.hasProperty(e,this._properties,this._class)};y0.prototype.hasPropertyBySemantic=function(e){return Mn.hasPropertyBySemantic(e,this._properties,this._class)};y0.prototype.getPropertyIds=function(e){return Mn.getPropertyIds(this._properties,this._class,e)};y0.prototype.getProperty=function(e){return Mn.getProperty(e,this._properties,this._class)};y0.prototype.setProperty=function(e,t){return Mn.setProperty(e,t,this._properties,this._class)};y0.prototype.getPropertyBySemantic=function(e){return Mn.getPropertyBySemantic(e,this._properties,this._class)};y0.prototype.setPropertyBySemantic=function(e,t){return Mn.setPropertyBySemantic(e,t,this._properties,this._class)};var s1=y0;var _5n=T(S(),1);function g0(e){e=g(e,g.EMPTY_OBJECT);let t=e.tileset,n=e.class,i=l(t.properties)?t.properties:{};this._class=n,this._properties=i,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(g0.prototype,{class:{get:function(){return this._class}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});g0.prototype.hasProperty=function(e){return Mn.hasProperty(e,this._properties,this._class)};g0.prototype.hasPropertyBySemantic=function(e){return Mn.hasPropertyBySemantic(e,this._properties,this._class)};g0.prototype.getPropertyIds=function(e){return Mn.getPropertyIds(this._properties,this._class,e)};g0.prototype.getProperty=function(e){return Mn.getProperty(e,this._properties,this._class)};g0.prototype.setProperty=function(e,t){return Mn.setProperty(e,t,this._properties,this._class)};g0.prototype.getPropertyBySemantic=function(e){return Mn.getPropertyBySemantic(e,this._properties,this._class)};g0.prototype.setPropertyBySemantic=function(e,t){return Mn.setPropertyBySemantic(e,t,this._properties,this._class)};var V2=g0;function yle(e){e=g(e,g.EMPTY_OBJECT);let t=e.metadataJson,n=e.schema,i=g(t.metadata,t.tileset),o;l(i)&&(o=new V2({tileset:i,class:n.classes[i.class]}));let r=[],s=[],a=t.groups;if(Array.isArray(a)){let c=a.length;for(let d=0;d<c;d++){let u=a[d];s.push(new s1({group:u,class:n.classes[u.class]}))}}else if(l(a)){r=Object.keys(a).sort();let c=r.length;for(let d=0;d<c;d++){let u=r[d];if(a.hasOwnProperty(u)){let m=a[u];s.push(new s1({id:u,group:a[u],class:n.classes[m.class]}))}}}this._schema=n,this._groups=s,this._groupIds=r,this._tileset=o,this._statistics=t.statistics,this._extras=t.extras,this._extensions=t.extensions}Object.defineProperties(yle.prototype,{schema:{get:function(){return this._schema}},groups:{get:function(){return this._groups}},groupIds:{get:function(){return this._groupIds}},tileset:{get:function(){return this._tileset}},statistics:{get:function(){return this._statistics}},extras:{get:function(){return this._extras}},extensions:{get:function(){return this._extensions}}});var X_=yle;var W5n=T(S(),1);var gle={},HKe=new h;gle.checkChildrenWithinParent=function(e){let t=e.children,n=t.length,i=e.boundingVolume;if(i instanceof _d||i instanceof Iu){let o=i._orientedBoundingBox;e._optimChildrenWithinParent=Ru.USE_OPTIMIZATION;for(let r=0;r<n;++r){let a=t[r].boundingVolume;if(!(a instanceof _d||a instanceof Iu)){e._optimChildrenWithinParent=Ru.SKIP_OPTIMIZATION;break}let c=a._orientedBoundingBox,d=h.subtract(c.center,o.center,HKe),u=h.magnitude(d);h.divideByScalar(d,u,d);let m=Math.abs(o.halfAxes[0]*d.x)+Math.abs(o.halfAxes[1]*d.y)+Math.abs(o.halfAxes[2]*d.z)+Math.abs(o.halfAxes[3]*d.x)+Math.abs(o.halfAxes[4]*d.y)+Math.abs(o.halfAxes[5]*d.z)+Math.abs(o.halfAxes[6]*d.x)+Math.abs(o.halfAxes[7]*d.y)+Math.abs(o.halfAxes[8]*d.z),p=Math.abs(c.halfAxes[0]*d.x)+Math.abs(c.halfAxes[1]*d.y)+Math.abs(c.halfAxes[2]*d.z)+Math.abs(c.halfAxes[3]*d.x)+Math.abs(c.halfAxes[4]*d.y)+Math.abs(c.halfAxes[5]*d.z)+Math.abs(c.halfAxes[6]*d.x)+Math.abs(c.halfAxes[7]*d.y)+Math.abs(c.halfAxes[8]*d.z);if(m<=p+u){e._optimChildrenWithinParent=Ru.SKIP_OPTIMIZATION;break}}}return e._optimChildrenWithinParent===Ru.USE_OPTIMIZATION};var L2=gle;var N5n=T(S(),1);var w5n=T(S(),1);function Z2(){this.head=void 0,this.tail=void 0,this._length=0}Object.defineProperties(Z2.prototype,{length:{get:function(){return this._length}}});function KKe(e,t,n){this.item=e,this.previous=t,this.next=n}Z2.prototype.add=function(e){let t=new KKe(e,this.tail,void 0);return l(this.tail)?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t};function xle(e,t){l(t.previous)&&l(t.next)?(t.previous.next=t.next,t.next.previous=t.previous):l(t.previous)?(t.previous.next=void 0,e.tail=t.previous):l(t.next)?(t.next.previous=void 0,e.head=t.next):(e.head=void 0,e.tail=void 0),t.next=void 0,t.previous=void 0}Z2.prototype.remove=function(e){l(e)&&(xle(this,e),--this._length)};Z2.prototype.splice=function(e,t){if(e===t)return;xle(this,t);let n=e.next;e.next=t,this.tail===e?this.tail=t:n.previous=t,t.next=n,t.previous=e};var R2=Z2;function I_(){this._list=new R2,this._sentinel=this._list.add(),this._trimTiles=!1}I_.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)};I_.prototype.touch=function(e){let t=e.cacheNode;l(t)&&this._list.splice(this._sentinel,t)};I_.prototype.add=function(e){l(e.cacheNode)||(e.cacheNode=this._list.add(e))};I_.prototype.unloadTile=function(e,t,n){let i=t.cacheNode;l(i)&&(this._list.remove(i),t.cacheNode=void 0,n(e,t))};I_.prototype.unloadTiles=function(e,t){let n=this._trimTiles;this._trimTiles=!1;let i=this._list,o=this._sentinel,r=i.head;for(;r!==o&&(e.totalMemoryUsageInBytes>e.cacheBytes||n);){let s=r.item;r=r.next,this.unloadTile(e,s,t)}};I_.prototype.trim=function(){this._trimTiles=!0};var G2=I_;var O5n=T(S(),1);function BN(e){this.tilePropertyName=e,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE,this._previousMinimum=Number.MAX_VALUE,this._previousMaximum=-Number.MAX_VALUE,this._referenceMinimum={},this._referenceMaximum={}}function JH(e,t){let n;return t===\"_loadTimestamp\"?n=te.toDate(e).getTime():n=e,n}BN.prototype.setReferenceMinimumMaximum=function(e,t,n){this._referenceMinimum[n]=JH(e,n),this._referenceMaximum[n]=JH(t,n)};function JKe(e,t){let n=e.tilePropertyName;if(l(n)){let i=JH(t[n],n);return l(i)?(e._maximum=Math.max(i,e._maximum),e._minimum=Math.min(i,e._minimum),i):(e.tilePropertyName=void 0,i)}}var KH=[new O(.1,.1,.1,1),new O(.153,.278,.878,1),new O(.827,.231,.49,1),new O(.827,.188,.22,1),new O(1,.592,.259,1),new O(1,.843,0,1)];BN.prototype.colorize=function(e,t){let n=this.tilePropertyName;if(!l(n)||!e.contentAvailable||e._selectedFrame!==t.frameNumber)return;let i=JKe(this,e),o=this._previousMinimum,r=this._previousMaximum;if(o===Number.MAX_VALUE||r===-Number.MAX_VALUE)return;let s=r-o+P.EPSILON7,c=P.clamp(i-o,0,s)/s,d=KH.length-1,u=c*d,m=Math.floor(u),p=Math.ceil(u),b=u-m,f=KH[m],x=KH[p],_=O.clone(O.WHITE);_.red=P.lerp(f.red,x.red,b),_.green=P.lerp(f.green,x.green,b),_.blue=P.lerp(f.blue,x.blue,b),e._debugColor=_};BN.prototype.resetMinimumMaximum=function(){let e=this.tilePropertyName;if(l(e)){let t=this._referenceMinimum[e],n=this._referenceMaximum[e],i=l(t)&&l(n);this._previousMinimum=i?t:this._minimum,this._previousMaximum=i?n:this._maximum,this._minimum=Number.MAX_VALUE,this._maximum=-Number.MAX_VALUE}};var E2=BN;var K5n=T(S(),1);function a1(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfPendingRequests=0,this.numberOfTilesProcessing=0,this.numberOfTilesWithContentReady=0,this.numberOfTilesTotal=0,this.numberOfLoadedTilesTotal=0,this.numberOfFeaturesSelected=0,this.numberOfFeaturesLoaded=0,this.numberOfPointsSelected=0,this.numberOfPointsLoaded=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0,this.geometryByteLength=0,this.texturesByteLength=0,this.batchTableByteLength=0}a1.prototype.clear=function(){this.selected=0,this.visited=0,this.numberOfCommands=0,this.numberOfAttemptedRequests=0,this.numberOfFeaturesSelected=0,this.numberOfPointsSelected=0,this.numberOfTrianglesSelected=0,this.numberOfTilesStyled=0,this.numberOfFeaturesStyled=0,this.numberOfTilesCulledWithChildrenUnion=0};function YN(e,t,n,i){let o=t.innerContents,r=t.pointsLength,s=t.trianglesLength,a=t.featuresLength,c=t.geometryByteLength,d=t.texturesByteLength,u=t.batchTableByteLength;if(i?(e.numberOfFeaturesLoaded+=n?-a:a,e.numberOfPointsLoaded+=n?-r:r,e.geometryByteLength+=n?-c:c,e.texturesByteLength+=n?-d:d,e.batchTableByteLength+=n?-u:u):(e.numberOfFeaturesSelected+=n?-a:a,e.numberOfPointsSelected+=n?-r:r,e.numberOfTrianglesSelected+=n?-s:s),l(o)){let m=o.length;for(let p=0;p<m;++p)YN(e,o[p],n,i)}}a1.prototype.incrementSelectionCounts=function(e){YN(this,e,!1,!1)};a1.prototype.incrementLoadCounts=function(e){YN(this,e,!1,!0)};a1.prototype.decrementLoadCounts=function(e){YN(this,e,!0,!0)};a1.clone=function(e,t){t.selected=e.selected,t.visited=e.visited,t.numberOfCommands=e.numberOfCommands,t.selected=e.selected,t.numberOfAttemptedRequests=e.numberOfAttemptedRequests,t.numberOfPendingRequests=e.numberOfPendingRequests,t.numberOfTilesProcessing=e.numberOfTilesProcessing,t.numberOfTilesWithContentReady=e.numberOfTilesWithContentReady,t.numberOfTilesTotal=e.numberOfTilesTotal,t.numberOfFeaturesSelected=e.numberOfFeaturesSelected,t.numberOfFeaturesLoaded=e.numberOfFeaturesLoaded,t.numberOfPointsSelected=e.numberOfPointsSelected,t.numberOfPointsLoaded=e.numberOfPointsLoaded,t.numberOfTrianglesSelected=e.numberOfTrianglesSelected,t.numberOfTilesStyled=e.numberOfTilesStyled,t.numberOfFeaturesStyled=e.numberOfFeaturesStyled,t.numberOfTilesCulledWithChildrenUnion=e.numberOfTilesCulledWithChildrenUnion,t.geometryByteLength=e.geometryByteLength,t.texturesByteLength=e.texturesByteLength,t.batchTableByteLength=e.batchTableByteLength};var x0=a1;var j5n=T(S(),1);function X2(){this._style=void 0,this._styleDirty=!1,this._lastStyleTime=0}Object.defineProperties(X2.prototype,{style:{get:function(){return this._style},set:function(e){e!==this._style&&(this._style=e,this._styleDirty=!0)}}});X2.prototype.makeDirty=function(){this._styleDirty=!0};X2.prototype.resetDirty=function(){this._styleDirty=!1};X2.prototype.applyStyle=function(e){if(!l(e.root)||l(this._style)&&!this._style._ready)return;let t=this._styleDirty;t&&++this._lastStyleTime;let n=this._lastStyleTime,i=e._statistics,o=t?e._selectedTiles:e._selectedTilesToStyle,r=o.length;for(let s=0;s<r;++s){let a=o[s];if(a.lastStyleTime!==n){let c=a.content;a.lastStyleTime=n,c.applyStyle(this._style),i.numberOfFeaturesStyled+=c.featuresLength,++i.numberOfTilesStyled}}};var I2=X2;var rNn=T(S(),1);function QKe(e,t,n){let i=oi(t,\"3DTILES_implicit_tiling\")?t.extensions[\"3DTILES_implicit_tiling\"]:t.implicitTiling;this.baseResource=e,this.geometricError=t.geometricError,this.metadataSchema=n;let o=t.boundingVolume;if(!l(o.box)&&!l(o.region)&&!oi(o,\"3DTILES_bounding_volume_S2\")&&!oi(o,\"3DTILES_bounding_volume_cylinder\"))throw new ue(\"Only box, region, 3DTILES_bounding_volume_S2, and 3DTILES_bounding_volume_cylinder are supported for implicit tiling\");this.boundingVolume=o,this.refine=t.refine,this.subtreeUriTemplate=new Xe({url:i.subtrees.uri}),this.contentUriTemplates=[],this.contentHeaders=[];let r=jKe(t);for(let s=0;s<r.length;s++){let a=r[s];this.contentHeaders.push(Oe(a,!0));let c=new Xe({url:a.uri});this.contentUriTemplates.push(c)}this.contentCount=this.contentHeaders.length,this.tileHeader=qKe(t),this.subdivisionScheme=Or[i.subdivisionScheme],this.branchingFactor=Or.getBranchingFactor(this.subdivisionScheme),this.subtreeLevels=i.subtreeLevels,l(i.availableLevels)?this.availableLevels=i.availableLevels:this.availableLevels=i.maximumLevel+1}function jKe(e){if(oi(e,\"3DTILES_multiple_contents\")){let t=e.extensions[\"3DTILES_multiple_contents\"];return l(t.contents)?t.contents:t.content}return l(e.contents)?e.contents:l(e.content)?[e.content]:[]}function qKe(e){let t=Oe(e,!0);return l(t.extensions)&&(delete t.extensions[\"3DTILES_implicit_tiling\"],delete t.extensions[\"3DTILES_multiple_contents\"],Object.keys(t.extensions).length===0&&delete t.extensions),delete t.implicitTiling,delete t.contents,delete t.content,t}var W_=QKe;var hNn=T(S(),1);var cNn=T(S(),1);var W2={};function _le(e){return e=(e^e<<8)&16711935,e=(e^e<<4)&252645135,e=(e^e<<2)&858993459,e=(e^e<<1)&1431655765,e}function QH(e){return e=(e^e<<16)&50331903,e=(e^e<<8)&50393103,e=(e^e<<4)&51130563,e=(e^e<<2)&153391689,e}function Tle(e){return e&=1431655765,e=(e^e>>1)&858993459,e=(e^e>>2)&252645135,e=(e^e>>4)&16711935,e=(e^e>>8)&65535,e}function jH(e){return e&=153391689,e=(e^e>>2)&51130563,e=(e^e>>4)&50393103,e=(e^e>>8)&4278190335,e=(e^e>>16)&1023,e}W2.encode2D=function(e,t){return(_le(e)|_le(t)<<1)>>>0};W2.decode2D=function(e,t){return l(t)||(t=new Array(2)),t[0]=Tle(e),t[1]=Tle(e>>1),t};W2.encode3D=function(e,t,n){return QH(e)|QH(t)<<1|QH(n)<<2};W2.decode3D=function(e,t){return l(t)||(t=new Array(3)),t[0]=jH(e),t[1]=jH(e>>1),t[2]=jH(e>>2),t};var Xy=W2;function Ao(e){this.subdivisionScheme=e.subdivisionScheme,this.subtreeLevels=e.subtreeLevels,this.level=e.level,this.x=e.x,this.y=e.y,this.z=void 0,e.subdivisionScheme===Or.OCTREE&&(this.z=e.z)}Object.defineProperties(Ao.prototype,{childIndex:{get:function(){let e=0;return e|=this.x&1,e|=(this.y&1)<<1,this.subdivisionScheme===Or.OCTREE&&(e|=(this.z&1)<<2),e}},mortonIndex:{get:function(){return this.subdivisionScheme===Or.OCTREE?Xy.encode3D(this.x,this.y,this.z):Xy.encode2D(this.x,this.y)}},tileIndex:{get:function(){let e=this.subdivisionScheme===Or.OCTREE?((1<<3*this.level)-1)/7:((1<<2*this.level)-1)/3,t=this.mortonIndex;return e+t}}});Ao.prototype.getDescendantCoordinates=function(e){let t=this.level+e.level,n=(this.x<<e.level)+e.x,i=(this.y<<e.level)+e.y;if(this.subdivisionScheme===Or.OCTREE){let o=(this.z<<e.level)+e.z;return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i,z:o})}return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i})};Ao.prototype.getAncestorCoordinates=function(e){let t=1<<e,n=this.level-e,i=Math.floor(this.x/t),o=Math.floor(this.y/t);if(this.subdivisionScheme===Or.OCTREE){let r=Math.floor(this.z/t);return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o,z:r})}return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:n,x:i,y:o})};Ao.prototype.getOffsetCoordinates=function(e){let t=e.level-this.level,n=1<<t,i=e.x%n,o=e.y%n;if(this.subdivisionScheme===Or.OCTREE){let r=e.z%n;return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:o,z:r})}return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:i,y:o})};Ao.prototype.getChildCoordinates=function(e){let t=this.level+1,n=2*this.x+e%2,i=2*this.y+Math.floor(e/2)%2;if(this.subdivisionScheme===Or.OCTREE){let o=2*this.z+Math.floor(e/4)%2;return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i,z:o})}return new Ao({subdivisionScheme:this.subdivisionScheme,subtreeLevels:this.subtreeLevels,level:t,x:n,y:i})};Ao.prototype.getSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels)};Ao.prototype.getParentSubtreeCoordinates=function(){return this.getAncestorCoordinates(this.level%this.subtreeLevels+this.subtreeLevels)};Ao.prototype.isAncestor=function(e){let t=e.level-this.level;if(t<=0)return!1;let n=e.x>>t,i=e.y>>t,o=this.x===n,r=this.y===i;if(this.subdivisionScheme===Or.OCTREE){let s=e.z>>t,a=this.z===s;return o&&r&&a}return o&&r};Ao.prototype.isEqual=function(e){return this.subdivisionScheme===e.subdivisionScheme&&this.subtreeLevels===e.subtreeLevels&&this.level===e.level&&this.x===e.x&&this.y===e.y&&(this.subdivisionScheme===Or.OCTREE?this.z===e.z:!0)};Ao.prototype.isImplicitTilesetRoot=function(){return this.level===0};Ao.prototype.isSubtreeRoot=function(){return this.level%this.subtreeLevels===0};Ao.prototype.isBottomOfSubtree=function(){return this.level%this.subtreeLevels===this.subtreeLevels-1};Ao.prototype.getTemplateValues=function(){let e={level:this.level,x:this.x,y:this.y};return this.subdivisionScheme===Or.OCTREE&&(e.z=this.z),e};var Sle=[0,0,0];Ao.fromMortonIndex=function(e,t,n,i){let o;return e===Or.OCTREE?(o=Xy.decode3D(i,Sle),new Ao({subdivisionScheme:e,subtreeLevels:t,level:n,x:o[0],y:o[1],z:o[2]})):(o=Xy.decode2D(i,Sle),new Ao({subdivisionScheme:e,subtreeLevels:t,level:n,x:o[0],y:o[1]}))};Ao.fromTileIndex=function(e,t,n){let i,o,r;return e===Or.OCTREE?(i=Math.floor(P.log2(7*n+1)/3),o=((1<<3*i)-1)/7,r=n-o):(i=Math.floor(P.log2(3*n+1)/2),o=((1<<2*i)-1)/3,r=n-o),Ao.fromMortonIndex(e,t,i,r)};var P_=Ao;var ZNn=T(S(),1);var _Nn=T(S(),1);function _0(){}_0.selectTiles=function(e,t){fe.throwInstantiationError()};_0.sortChildrenByDistanceToCamera=function(e,t){return t._distanceToCamera===0&&e._distanceToCamera===0?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera};_0.canTraverse=function(e){return e.children.length===0?!1:e.hasTilesetContent||e.hasImplicitContent?!e.contentExpired:e._screenSpaceError>e.tileset.memoryAdjustedScreenSpaceError};_0.selectTile=function(e,t){if(e.contentVisibility(t)===nn.OUTSIDE)return;e._wasSelectedLastFrame=!0;let{content:n,tileset:i}=e;n.featurePropertiesDirty?(n.featurePropertiesDirty=!1,e.lastStyleTime=0,i._selectedTilesToStyle.push(e)):e._selectedFrame<t.frameNumber-1&&(i._selectedTilesToStyle.push(e),e._wasSelectedLastFrame=!1),e._selectedFrame=t.frameNumber,i._selectedTiles.push(e)};_0.visitTile=function(e,t){++e.tileset._statistics.visited,e._visitedFrame=t.frameNumber};_0.touchTile=function(e,t){e._touchedFrame!==t.frameNumber&&(e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber)};_0.loadTile=function(e,t){let{tileset:n}=e;if(e._requestedFrame===t.frameNumber||!e.hasUnloadedRenderableContent&&!e.contentExpired||!$Ke(e,t))return;let i=t.camera.timeSinceMoved<n.foveatedTimeDelay;e.priorityDeferred&&i||(e._requestedFrame=t.frameNumber,n._requestedTiles.push(e))};function $Ke(e,t){let{tileset:n}=e;if(!n._cullRequestsWhileMoving)return!0;let{positionWCDeltaMagnitude:i,positionWCDeltaMagnitudeLastFrame:o}=t.camera,r=i!==0?i:o,s=Math.max(e.boundingSphere.radius*2,1);return n.cullRequestsWhileMovingMultiplier*r/s<1}_0.updateTile=function(e,t){Cle(e,t),e.updateExpiration(),e._wasMinPriorityChild=!1,e._priorityHolder=e,nJe(e),e._shouldSelect=!1,e._finalResolution=!0};function Cle(e,t){if(e.updateVisibility(t),!e.isVisible)return;let n=e.children.length>0;if((e.hasTilesetContent||e.hasImplicitContent)&&n){let r=e.children[0];Cle(r,t),e._visible=r._visible;return}if(eJe(e,t)){e._visible=!1;return}let i=e.refine===vo.REPLACE,o=e._optimChildrenWithinParent===Ru.USE_OPTIMIZATION;if(i&&o&&n&&!tJe(e,t)){++e.tileset._statistics.numberOfTilesCulledWithChildrenUnion,e._visible=!1;return}}function eJe(e,t){let{parent:n,tileset:i}=e;return!l(n)||n.hasTilesetContent||n.hasImplicitContent||n.refine!==vo.ADD?!1:e.getScreenSpaceError(t,!0)<=i.memoryAdjustedScreenSpaceError}function tJe(e,t){let n=!1,i=e.children;for(let o=0;o<i.length;++o){let r=i[o];r.updateVisibility(t),n=n||r.isVisible}return n}function nJe(e){let t=e.tileset._minimumPriority,n=e.tileset._maximumPriority,i=e._priorityHolder;n.distance=Math.max(i._distanceToCamera,n.distance),t.distance=Math.min(i._distanceToCamera,t.distance),n.depth=Math.max(e._depth,n.depth),t.depth=Math.min(e._depth,t.depth),n.foveatedFactor=Math.max(i._foveatedFactor,n.foveatedFactor),t.foveatedFactor=Math.min(i._foveatedFactor,t.foveatedFactor),n.reverseScreenSpaceError=Math.max(e._priorityReverseScreenSpaceError,n.reverseScreenSpaceError),t.reverseScreenSpaceError=Math.min(e._priorityReverseScreenSpaceError,t.reverseScreenSpaceError)}var ks=_0;function Vle(){}var P2={stack:new Bc,stackMaximumLength:0};Vle.selectTiles=function(e,t){e._selectedTiles.length=0,e._requestedTiles.length=0,e.hasMixedContent=!1;let n=!0,i=e.root;if(i.updateVisibility(t),!i.isVisible)return n;let{touchTile:o,visitTile:r}=ks,s=P2.stack;for(s.push(i);s.length>0;){P2.stackMaximumLength=Math.max(P2.stackMaximumLength,s.length);let a=s.pop(),c=a.refine===vo.ADD,d=a.refine===vo.REPLACE,u=iJe(a);u&&oJe(a,s,t),(c||d&&!u)&&(rJe(e,a),o(a,t),sJe(a,t),a.hasRenderableContent&&!a.contentAvailable&&(n=!1)),r(a,t)}return P2.stack.trim(P2.stackMaximumLength),n};function iJe(e){return e.children.length===0?!1:e.hasTilesetContent||e.hasImplicitContent?!e.contentExpired:(e.hasEmptyContent,!0)}function oJe(e,t,n){let{children:i}=e;for(let o=0;o<i.length;++o){let r=i[o];r.updateVisibility(n),r.isVisible&&t.push(r)}}function rJe(e,t){(t.hasUnloadedRenderableContent||t.contentExpired)&&(t._priority=0,e._requestedTiles.push(t))}function sJe(e,t){e.contentAvailable&&e.contentVisibility(t)!==nn.OUTSIDE&&e.tileset._selectedTiles.push(e)}var v2=Vle;var WNn=T(S(),1);function Lle(){}var w2={stack:new Bc,stackMaximumLength:0},F2={stack:new Bc,stackMaximumLength:0};Lle.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e.hasMixedContent=!1;let n=e.root;if(ks.updateTile(n,t),!n.isVisible||n.getScreenSpaceError(t,!0)<=e.memoryAdjustedScreenSpaceError)return;cJe(n,t),w2.stack.trim(w2.stackMaximumLength),F2.stack.trim(F2.stackMaximumLength);let i=e._requestedTiles;for(let o=0;o<i.length;++o)i[o].updatePriority()};function qH(e,t){e.contentAvailable&&ks.selectTile(e,t)}function aJe(e,t,n){let i=e.refine===vo.REPLACE,{tileset:o,children:r}=e,{updateTile:s,loadTile:a,touchTile:c}=ks;for(let f=0;f<r.length;++f)s(r[f],n);r.sort(ks.sortChildrenByDistanceToCamera);let d=i&&e.hasRenderableContent,u=!0,m=!1,p=-1,b=Number.MAX_VALUE;for(let f=0;f<r.length;++f){let x=r[f];if(x.isVisible?(t.push(x),x._foveatedFactor<b&&(p=f,b=x._foveatedFactor),m=!0):(d||o.loadSiblings)&&(x._foveatedFactor<b&&(p=f,b=x._foveatedFactor),a(x,n),c(x,n)),d){let _;x._inRequestVolume?x.hasRenderableContent?_=x.contentAvailable:_=lJe(x,n):_=!1,u=u&&_}}if(m||(u=!1),p!==-1&&i){let f=r[p];f._wasMinPriorityChild=!0;let x=(e._wasMinPriorityChild||e===o.root)&&b<=e._priorityHolder._foveatedFactor?e._priorityHolder:e;x._foveatedFactor=Math.min(f._foveatedFactor,x._foveatedFactor),x._distanceToCamera=Math.min(f._distanceToCamera,x._distanceToCamera);for(let _=0;_<r.length;++_)r[_]._priorityHolder=x}return u}function cJe(e,t){let{tileset:n}=e,{canTraverse:i,loadTile:o,visitTile:r,touchTile:s}=ks,a=w2.stack;for(a.push(e);a.length>0;){w2.stackMaximumLength=Math.max(w2.stackMaximumLength,a.length);let c=a.pop(),d=c.parent,u=!l(d)||d._refines;c._refines=i(c)?aJe(c,a,t)&&u:!1;let m=!c._refines&&u;c.hasRenderableContent?c.refine===vo.ADD?(qH(c,t),o(c,t)):c.refine===vo.REPLACE&&(o(c,t),m&&qH(c,t)):(n._emptyTiles.push(c),o(c,t),m&&qH(c,t)),r(c,t),s(c,t)}}function lJe(e,t){let{canTraverse:n,updateTile:i,loadTile:o,touchTile:r}=ks,s=!0,a=F2.stack;for(a.push(e);a.length>0;){F2.stackMaximumLength=Math.max(F2.stackMaximumLength,a.length);let c=a.pop(),d=c.children,u=d.length,m=!c.hasRenderableContent&&n(c);if(!m&&!c.contentAvailable&&(s=!1),i(c,t),c.isVisible||(o(c,t),r(c,t)),m)for(let p=0;p<u;++p){let b=d[p];a.push(b)}}return e.hasEmptyContent||s}var A2=Lle;var MNn=T(S(),1);function Zle(){}var M2={stack:new Bc,stackMaximumLength:0},N2={stack:new Bc,stackMaximumLength:0},T0={stack:new Bc,stackMaximumLength:0,ancestorStack:new Bc,ancestorStackMaximumLength:0},dJe=2;Zle.selectTiles=function(e,t){if(e._requestedTiles.length=0,e.debugFreezeFrame)return;e._selectedTiles.length=0,e._selectedTilesToStyle.length=0,e._emptyTiles.length=0,e.hasMixedContent=!1;let n=e.root;if(ks.updateTile(n,t),!n.isVisible||n.getScreenSpaceError(t,!0)<=e.memoryAdjustedScreenSpaceError)return;bJe(n,t),yJe(n,t),M2.stack.trim(M2.stackMaximumLength),N2.stack.trim(N2.stackMaximumLength),T0.stack.trim(T0.stackMaximumLength),T0.ancestorStack.trim(T0.ancestorStackMaximumLength);let i=e._requestedTiles;for(let o=0;o<i.length;++o)i[o].updatePriority()};function uJe(e,t){let{updateTile:n,touchTile:i,selectTile:o}=ks,r=N2.stack;for(r.push(e);r.length>0;){N2.stackMaximumLength=Math.max(N2.stackMaximumLength,r.length);let a=r.pop().children;for(let c=0;c<a.length;++c){let d=a[c];d.isVisible&&(d.contentAvailable?(n(d,t),i(d,t),o(d,t)):d._depth-e._depth<dJe&&r.push(d))}}}function ON(e,t){let n=e.contentAvailable?e:e._ancestorWithContentAvailable;l(n)?n._shouldSelect=!0:uJe(e,t)}function mJe(e,t){e._ancestorWithContent=void 0,e._ancestorWithContentAvailable=void 0;let{parent:n}=e;if(!l(n))return;let i=!n.hasUnloadedRenderableContent||n._requestedFrame===t.frameNumber;e._ancestorWithContent=i?n:n._ancestorWithContent,e._ancestorWithContentAvailable=n.contentAvailable?n:n._ancestorWithContentAvailable}function hJe(e,t){let n=t._ancestorWithContent;return!e.immediatelyLoadDesiredLevelOfDetail&&(t._priorityProgressiveResolutionScreenSpaceErrorLeaf||l(n)&&t._screenSpaceError<n._screenSpaceError/e.skipScreenSpaceErrorFactor&&t._depth>n._depth+e.skipLevels)}function fJe(e,t,n){let{tileset:i,children:o}=e,{updateTile:r,loadTile:s,touchTile:a}=ks;for(let d=0;d<o.length;++d)r(o[d],n);o.sort(ks.sortChildrenByDistanceToCamera);let c=!1;for(let d=0;d<o.length;++d){let u=o[d];u.isVisible?(t.push(u),c=!0):i.loadSiblings&&(s(u,n),a(u,n))}return c}function pJe(e,t){let{tileset:n}=e;return n.immediatelyLoadDesiredLevelOfDetail?!1:l(e._ancestorWithContent)?e._screenSpaceError===0?e.parent._screenSpaceError>t:e._screenSpaceError>t:!0}function bJe(e,t){let{tileset:n}=e,i=n.immediatelyLoadDesiredLevelOfDetail?Number.MAX_VALUE:Math.max(n.baseScreenSpaceError,n.memoryAdjustedScreenSpaceError),{canTraverse:o,loadTile:r,visitTile:s,touchTile:a}=ks,c=M2.stack;for(c.push(e);c.length>0;){M2.stackMaximumLength=Math.max(M2.stackMaximumLength,c.length);let d=c.pop();mJe(d,t);let u=d.parent,m=!l(u)||u._refines;d._refines=o(d)?fJe(d,c,t)&&m:!1;let p=!d._refines&&m;d.hasRenderableContent?d.refine===vo.ADD?(ON(d,t),r(d,t)):d.refine===vo.REPLACE&&(pJe(d,i)?(r(d,t),p&&ON(d,t)):p?(ON(d,t),r(d,t)):hJe(n,d)&&r(d,t)):(n._emptyTiles.push(d),r(d,t),p&&ON(d,t)),s(d,t),a(d,t)}}function yJe(e,t){let{selectTile:n,canTraverse:i}=ks,{stack:o,ancestorStack:r}=T0,s;for(o.push(e);o.length>0||r.length>0;){if(T0.stackMaximumLength=Math.max(T0.stackMaximumLength,o.length),T0.ancestorStackMaximumLength=Math.max(T0.ancestorStackMaximumLength,r.length),r.length>0){let d=r.peek();if(d._stackLength===o.length){r.pop(),d!==s&&(d._finalResolution=!1),n(d,t);continue}}let a=o.pop();if(!l(a))continue;let c=i(a);if(a._shouldSelect)if(a.refine===vo.ADD)n(a,t);else{if(a._selectionDepth=r.length,a._selectionDepth>0&&(a.tileset.hasMixedContent=!0),s=a,!c){n(a,t);continue}r.push(a),a._stackLength=o.length}if(c){let d=a.children;for(let u=0;u<d.length;++u){let m=d[u];m.isVisible&&o.push(m)}}}}var k2=Zle;function Qo(e){e=g(e,g.EMPTY_OBJECT),this._url=void 0,this._basePath=void 0,this._root=void 0,this._resource=void 0,this._asset=void 0,this._properties=void 0,this._geometricError=void 0,this._scaledGeometricError=void 0,this._extensionsUsed=void 0,this._extensions=void 0,this._modelUpAxis=void 0,this._modelForwardAxis=void 0,this._cache=new G2,this._processingQueue=[],this._selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._loadTimestamp=void 0,this._timeSinceLoad=0,this._updatedVisibilityFrame=0,this._updatedModelMatrixFrame=0,this._modelMatrixChanged=!1,this._previousModelMatrix=void 0,this._extras=void 0,this._credits=void 0,this._showCreditsOnScreen=g(e.showCreditsOnScreen,!1),this._cullWithChildrenBounds=g(e.cullWithChildrenBounds,!0),this._allTilesAdditive=!0,this._hasMixedContent=!1,this._stencilClearCommand=void 0,this._backfaceCommands=new Bc,this._maximumScreenSpaceError=g(e.maximumScreenSpaceError,16),this._memoryAdjustedScreenSpaceError=this._maximumScreenSpaceError,this._cacheBytes=g(e.cacheBytes,512*1024*1024);let t=g(e.maximumCacheOverflowBytes,512*1024*1024);this._maximumCacheOverflowBytes=t,this._styleEngine=new I2,this._styleApplied=!1,this._modelMatrix=l(e.modelMatrix)?M.clone(e.modelMatrix):M.clone(M.IDENTITY),this._addHeightCallbacks=[],this._statistics=new x0,this._statisticsLast=new x0,this._statisticsPerPass=new Array(Io.NUMBER_OF_PASSES);for(let o=0;o<Io.NUMBER_OF_PASSES;++o)this._statisticsPerPass[o]=new x0;this._requestedTilesInFlight=[],this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE},this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE},this._heatmap=new E2(e.debugHeatmapTilePropertyName),this.cullRequestsWhileMoving=g(e.cullRequestsWhileMoving,!0),this._cullRequestsWhileMoving=!1,this.cullRequestsWhileMovingMultiplier=g(e.cullRequestsWhileMovingMultiplier,60),this.progressiveResolutionHeightFraction=P.clamp(g(e.progressiveResolutionHeightFraction,.3),0,.5),this.preferLeaves=g(e.preferLeaves,!1),this._tilesLoaded=!1,this._initialTilesLoaded=!1,this._tileDebugLabels=void 0,this._classificationType=e.classificationType,this._ellipsoid=g(e.ellipsoid,oe.WGS84),this._initialClippingPlanesOriginMatrix=M.IDENTITY,this._clippingPlanesOriginMatrix=void 0,this._clippingPlanesOriginMatrixDirty=!0,this._vectorClassificationOnly=g(e.vectorClassificationOnly,!1),this._vectorKeepDecodedPositions=g(e.vectorKeepDecodedPositions,!1),this.preloadWhenHidden=g(e.preloadWhenHidden,!1),this.preloadFlightDestinations=g(e.preloadFlightDestinations,!0),this._pass=void 0,this.dynamicScreenSpaceError=g(e.dynamicScreenSpaceError,!0),this.foveatedScreenSpaceError=g(e.foveatedScreenSpaceError,!0),this._foveatedConeSize=g(e.foveatedConeSize,.1),this._foveatedMinimumScreenSpaceErrorRelaxation=g(e.foveatedMinimumScreenSpaceErrorRelaxation,0),this.foveatedInterpolationCallback=g(e.foveatedInterpolationCallback,P.lerp),this.foveatedTimeDelay=g(e.foveatedTimeDelay,.2),this.dynamicScreenSpaceErrorDensity=g(e.dynamicScreenSpaceErrorDensity,2e-4),this.dynamicScreenSpaceErrorFactor=g(e.dynamicScreenSpaceErrorFactor,24),this.dynamicScreenSpaceErrorHeightFalloff=g(e.dynamicScreenSpaceErrorHeightFalloff,.25),this._dynamicScreenSpaceErrorComputedDensity=0,this.shadows=g(e.shadows,_n.ENABLED),this.show=g(e.show,!0),this.colorBlendMode=Rl.HIGHLIGHT,this.colorBlendAmount=.5,this._pointCloudShading=new cf(e.pointCloudShading),this._pointCloudEyeDomeLighting=new Kp,this.loadProgress=new ge,this.allTilesLoaded=new ge,this.initialTilesLoaded=new ge,this.tileLoad=new ge,this.tileUnload=new ge,this.tileFailed=new ge,this.tileVisible=new ge,this.skipLevelOfDetail=g(e.skipLevelOfDetail,!1),this._disableSkipLevelOfDetail=!1,this.baseScreenSpaceError=g(e.baseScreenSpaceError,1024),this.skipScreenSpaceErrorFactor=g(e.skipScreenSpaceErrorFactor,16),this.skipLevels=g(e.skipLevels,1),this.immediatelyLoadDesiredLevelOfDetail=g(e.immediatelyLoadDesiredLevelOfDetail,!1),this.loadSiblings=g(e.loadSiblings,!1),this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,l(e.imageBasedLighting)?(this._imageBasedLighting=e.imageBasedLighting,this._shouldDestroyImageBasedLighting=!1):(this._imageBasedLighting=new Ax,this._shouldDestroyImageBasedLighting=!0),this.lightColor=e.lightColor,this.backFaceCulling=g(e.backFaceCulling,!0),this._enableShowOutline=g(e.enableShowOutline,!0),this.showOutline=g(e.showOutline,!0),this.outlineColor=g(e.outlineColor,O.BLACK),this.splitDirection=g(e.splitDirection,Hc.NONE),this.enableCollision=g(e.enableCollision,!1),this._projectTo2D=g(e.projectTo2D,!1),this._enablePick=g(e.enablePick,!1),this.debugFreezeFrame=g(e.debugFreezeFrame,!1),this.debugColorizeTiles=g(e.debugColorizeTiles,!1),this._enableDebugWireframe=g(e.enableDebugWireframe,!1),this.debugWireframe=g(e.debugWireframe,!1),this.debugWireframe===!0&&this._enableDebugWireframe===!1&&wt(\"tileset-debug-wireframe-ignored\",\"enableDebugWireframe must be set to true in the Cesium3DTileset constructor, otherwise debugWireframe will be ignored.\"),this.debugShowBoundingVolume=g(e.debugShowBoundingVolume,!1),this.debugShowContentBoundingVolume=g(e.debugShowContentBoundingVolume,!1),this.debugShowViewerRequestVolume=g(e.debugShowViewerRequestVolume,!1),this._tileDebugLabels=void 0,this.debugPickedTileLabelOnly=!1,this.debugPickedTile=void 0,this.debugPickPosition=void 0,this.debugShowGeometricError=g(e.debugShowGeometricError,!1),this.debugShowRenderingStatistics=g(e.debugShowRenderingStatistics,!1),this.debugShowMemoryUsage=g(e.debugShowMemoryUsage,!1),this.debugShowUrl=g(e.debugShowUrl,!1),this.examineVectorLinesFunction=void 0,this._metadataExtension=void 0,this._customShader=e.customShader;let n=g(e.featureIdLabel,\"featureId_0\");typeof n==\"number\"&&(n=`featureId_${n}`),this._featureIdLabel=n;let i=g(e.instanceFeatureIdLabel,\"instanceFeatureId_0\");typeof i==\"number\"&&(i=`instanceFeatureId_${i}`),this._instanceFeatureIdLabel=i}Object.defineProperties(Qo.prototype,{isCesium3DTileset:{get:function(){return!0}},asset:{get:function(){return this._asset}},extensions:{get:function(){return this._extensions}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){fs.setOwner(e,this,\"_clippingPlanes\")}},properties:{get:function(){return this._properties}},tilesLoaded:{get:function(){return this._tilesLoaded}},resource:{get:function(){return this._resource}},basePath:{get:function(){return Is(\"Cesium3DTileset.basePath\",\"Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead.\"),this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(e){this._styleEngine.style=e}},customShader:{get:function(){return this._customShader},set:function(e){this._customShader=e}},hasMixedContent:{get:function(){return this._hasMixedContent},set:function(e){this._hasMixedContent=e}},isSkippingLevelOfDetail:{get:function(){return this.skipLevelOfDetail&&!l(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive}},metadataExtension:{get:function(){return this._metadataExtension}},metadata:{get:function(){if(l(this._metadataExtension))return this._metadataExtension.tileset}},schema:{get:function(){if(l(this._metadataExtension))return this._metadataExtension.schema}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(e){this._maximumScreenSpaceError=e,this._memoryAdjustedScreenSpaceError=e}},cacheBytes:{get:function(){return this._cacheBytes},set:function(e){this._cacheBytes=e}},maximumCacheOverflowBytes:{get:function(){return this._maximumCacheOverflowBytes},set:function(e){this._maximumCacheOverflowBytes=e}},memoryAdjustedScreenSpaceError:{get:function(){return this._memoryAdjustedScreenSpaceError}},pointCloudShading:{get:function(){return this._pointCloudShading},set:function(e){this._pointCloudShading=e}},root:{get:function(){return this._root}},boundingSphere:{get:function(){return this._root.updateTransform(this._modelMatrix),this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(e){this._modelMatrix=M.clone(e,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){let e=this._statistics;return e.texturesByteLength+e.geometryByteLength+e.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){return l(this._clippingPlanesOriginMatrix)?(this._clippingPlanesOriginMatrixDirty&&(M.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1),this._clippingPlanesOriginMatrix):M.IDENTITY}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(e){this._foveatedConeSize=e}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(e){this._foveatedMinimumScreenSpaceErrorRelaxation=e}},extras:{get:function(){return this._extras}},imageBasedLighting:{get:function(){return this._imageBasedLighting},set:function(e){e!==this._imageBasedLighting&&(this._shouldDestroyImageBasedLighting&&!this._imageBasedLighting.isDestroyed()&&this._imageBasedLighting.destroy(),this._imageBasedLighting=e,this._shouldDestroyImageBasedLighting=!1)}},vectorClassificationOnly:{get:function(){return this._vectorClassificationOnly}},vectorKeepDecodedPositions:{get:function(){return this._vectorKeepDecodedPositions}},showCreditsOnScreen:{get:function(){return this._showCreditsOnScreen},set:function(e){this._showCreditsOnScreen=e,vle(this)}},featureIdLabel:{get:function(){return this._featureIdLabel},set:function(e){typeof e==\"number\"&&(e=`featureId_${e}`),this._featureIdLabel=e}},instanceFeatureIdLabel:{get:function(){return this._instanceFeatureIdLabel},set:function(e){typeof e==\"number\"&&(e=`instanceFeatureId_${e}`),this._instanceFeatureIdLabel=e}}});Qo.fromIonAssetId=async function(e,t){let n=await md.fromAssetId(e);return Qo.fromUrl(n,t)};Qo.fromUrl=async function(e,t){t=g(t,g.EMPTY_OBJECT);let n=Xe.createIfNeeded(e),i;n.extension===\"json\"?i=n.getBaseUri(!0):n.isDataUri&&(i=\"\");let o=await Qo.loadJson(n),r=await gJe(n,o),s=new Qo(t);s._resource=n,s._url=n.url,s._basePath=i,s._metadataExtension=r,s._geometricError=o.geometricError,s._scaledGeometricError=o.geometricError;let a=o.asset;s._asset=a,s._extras=o.extras,vle(s);let c=l(o.asset.gltfUpAxis)?Ro.fromName(o.asset.gltfUpAxis):Ro.Y,d=g(t.modelUpAxis,c),u=g(t.modelForwardAxis,Ro.X);s._properties=o.properties,s._extensionsUsed=o.extensionsUsed,s._extensions=o.extensions,s._modelUpAxis=d,s._modelForwardAxis=u,s._root=s.loadTileset(n,o);let p=s._root.createBoundingVolume(o.root.boundingVolume,M.IDENTITY).boundingSphere.center,b=s._ellipsoid.cartesianToCartographic(p);return l(b)&&b.height>ai._defaultMinTerrainHeight&&(s._initialClippingPlanesOriginMatrix=Wt.eastNorthUpToFixedFrame(p)),s._clippingPlanesOriginMatrix=M.clone(s._initialClippingPlanesOriginMatrix),s};Qo.loadJson=function(e){return Xe.createIfNeeded(e).fetchJson()};Qo.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()};Qo.prototype.loadTileset=function(e,t,n){let i=t.asset;if(!l(i))throw new ue(\"Tileset must have an asset property.\");if(i.version!==\"0.0\"&&i.version!==\"1.0\"&&i.version!==\"1.1\")throw new ue(\"The tileset must be 3D Tiles version 0.0, 1.0, or 1.1\");l(t.extensionsRequired)&&Qo.checkSupportedExtensions(t.extensionsRequired);let o=this._statistics,r=i.tilesetVersion;l(r)&&(this._basePath+=`?v=${r}`,e=e.clone(),e.setQueryParameters({v:r}));let s=Rle(this,e,t.root,n);l(n)&&(n.children.push(s),s._depth=n._depth+1);let a=[];for(a.push(s);a.length>0;){let c=a.pop();++o.numberOfTilesTotal,this._allTilesAdditive=this._allTilesAdditive&&c.refine===vo.ADD;let d=c._header.children;if(l(d))for(let u=0;u<d.length;++u){let m=d[u],p=Rle(this,e,m,c);c.children.push(p),p._depth=c._depth+1,a.push(p)}this._cullWithChildrenBounds&&L2.checkChildrenWithinParent(c)}return s};function Rle(e,t,n,i){if(!(l(n.implicitTiling)||oi(n,\"3DTILES_implicit_tiling\")))return new Pu(e,t,n,i);let r=e.schema,s=new W_(t,n,r),a=new P_({subdivisionScheme:s.subdivisionScheme,subtreeLevels:s.subtreeLevels,level:0,x:0,y:0,z:0}),c=s.subtreeUriTemplate.getDerivedResource({templateValues:a.getTemplateValues()}).url,u=Oe(n,!0);u.contents=[{uri:c}],delete u.content,delete u.extensions;let m=new Pu(e,t,u,i);return m.implicitTileset=s,m.implicitCoordinates=a,m}async function gJe(e,t){let n=oi(t,\"3DTILES_metadata\")?t.extensions[\"3DTILES_metadata\"]:t,i;if(l(n.schemaUri))e=e.getDerivedResource({url:n.schemaUri}),i=Di.getSchemaLoader({resource:e});else if(l(n.schema))i=Di.getSchemaLoader({schema:n.schema});else return;await i.load();let o=new X_({schema:i.schema,metadataJson:n});return Di.unload(i),o}var Gle=new h,xJe=new he,_Je=new M,TJe=new h,SJe=new h,CJe=new h,VJe=new h;function LJe(e,t){let n,i,o,r,s,a=t.camera,c=e._root,d=c.contentBoundingVolume;if(d instanceof Iu)n=h.normalize(a.positionWC,Gle),i=a.directionWC,o=a.positionCartographic.height,r=d.minimumHeight,s=d.maximumHeight;else{let x=M.inverseTransformation(c.computedTransform,_Je),_=t.mapProjection.ellipsoid,C=d.boundingVolume,V=M.multiplyByPoint(x,C.center,TJe);if(h.magnitude(V)>_.minimumRadius){let L=he.fromCartesian(V,_,xJe);n=h.normalize(a.positionWC,Gle),i=a.directionWC,o=a.positionCartographic.height,r=0,s=L.height*2}else{let L=M.multiplyByPoint(x,a.positionWC,SJe);if(n=h.UNIT_Z,i=M.multiplyByPointAsVector(x,a.directionWC,CJe),i=h.normalize(i,i),o=L.z,d instanceof _d){let R=$.getColumn(C.halfAxes,2,VJe),G=h.magnitude(R);r=V.z-G,s=V.z+G}else if(d instanceof b0){let R=C.radius;r=V.z-R,s=V.z+R}}}let u=e.dynamicScreenSpaceErrorHeightFalloff,m=r+(s-r)*u,p=s,b=P.clamp((o-m)/(p-m),0,1),f=1-Math.abs(h.dot(i,n));f=f*(1-b),e._dynamicScreenSpaceErrorComputedDensity=e.dynamicScreenSpaceErrorDensity*f}function ZJe(e,t){if(t.hasEmptyContent)return;let{statistics:n}=e,i=t.contentExpired,o=t.requestContent();l(o)&&(o.then(r=>{!l(r)||t.isDestroyed()||e.isDestroyed()||(e._processingQueue.push(t),++n.numberOfTilesProcessing)}).catch(r=>{Ile(r,e,t)}),i&&(t.hasTilesetContent||t.hasImplicitContent?kJe(e,t):(n.decrementLoadCounts(t.content),--n.numberOfTilesWithContentReady)),e._requestedTilesInFlight.push(t))}function Xle(e,t){return e._priority-t._priority}Qo.prototype.postPassesUpdate=function(e){l(this._root)&&(RJe(this,e),DJe(this,e),this._cache.unloadTiles(this,Ple),this._styleApplied&&this._styleEngine.resetDirty(),this._styleApplied=!1)};Qo.prototype.prePassesUpdate=function(e){if(!l(this._root))return;vJe(this,e);let t=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0,l(t)&&t.enabled&&t.update(e),l(this._loadTimestamp)||(this._loadTimestamp=te.clone(e.time)),this._timeSinceLoad=Math.max(te.secondsDifference(e.time,this._loadTimestamp)*1e3,0),this.dynamicScreenSpaceError&&LJe(this,e),e.newFrame&&this._cache.reset()};function RJe(e,t){let n=e._requestedTilesInFlight,i=0;for(let o=0;o<n.length;++o){let r=n[o],s=t.frameNumber-r._touchedFrame>=1;if(r._contentState!==Fo.LOADING){++i;continue}else if(s){r.cancelRequests(),++i;continue}i>0&&(n[o-i]=r)}n.length-=i}function GJe(e){let t=e._requestedTiles;t.sort(Xle);for(let n=0;n<t.length;++n)ZJe(e,t[n])}function Ile(e,t,n){if(t.isDestroyed())return;let i;n.isDestroyed()||(i=n._contentResource.url);let o=l(e.message)?e.message:e.toString();t.tileFailed.numberOfListeners>0?t.tileFailed.raiseEvent({url:i,message:o}):(console.log(`A 3D tile failed to load: ${i}`),console.log(`Error: ${o}`))}function EJe(e){let t=e._processingQueue,n=0;for(let i=0;i<t.length;++i){let o=t[i];if(o.isDestroyed()||o._contentState!==Fo.PROCESSING){++n;continue}n>0&&(t[i-n]=o)}t.length-=n}var XJe=new he,IJe=new he,WJe=new h;function PJe(e,t,n){if(!e.enableCollision||!e.show)return;let i=e._addHeightCallbacks,o=t.boundingSphere;for(let r of i){if(r.invoked||t._wasSelectedLastFrame)continue;let s=r.ellipsoid,a=he.clone(r.positionCartographic,XJe),c=he.fromCartesian(o.center,s,IJe);l(c)&&(a.height=c.height);let d=he.toCartesian(a,s,WJe);if(h.distance(d,o.center)<=o.radius){let u=n.tilesetPassState&&n.tilesetPassState.pass;n.afterRender.push(()=>{l(r.callback)&&r.callback(a,t,u),r.invoked=!1})}}}function vJe(e,t){EJe(e);let n=e._processingQueue,{cacheBytes:i,maximumCacheOverflowBytes:o,statistics:r}=e,s=i+o,a=!1;for(let c=0;c<n.length;++c){if(e.totalMemoryUsageInBytes>s){a=!0;break}let d=n[c];try{d.process(e,t),d.contentReady&&(--r.numberOfTilesProcessing,e.tileLoad.raiseEvent(d))}catch(u){--r.numberOfTilesProcessing,Ile(u,e,d)}}e.totalMemoryUsageInBytes<i?FJe(e):a&&n.length>0&&wJe(e)}function wJe(e){e._memoryAdjustedScreenSpaceError*=1.02;let t=e._processingQueue;for(let n=0;n<t.length;++n)t[n].updatePriority();t.sort(Xle)}function FJe(e){e._memoryAdjustedScreenSpaceError=Math.max(e.memoryAdjustedScreenSpaceError/1.02,e.maximumScreenSpaceError)}var zN=new h,AJe={maximumFractionDigits:3};function Ele(e){let t=e/1048576;return"
}